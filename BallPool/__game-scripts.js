!function(){var t=new Ammo.btVector3,e=new Ammo.btVector3,o=function RaycastResult(t,e,o){this.entity=t,this.point=e,this.normal=o};pc.RigidBodyComponentSystem.prototype.raycastFiltered=function(i,s,n,l){t.setValue(i.x,i.y,i.z),e.setValue(s.x,s.y,s.z);var m=new Ammo.ClosestRayResultCallback(t,e);m.set_m_collisionFilterGroup(n),m.set_m_collisionFilterMask(l),this.app.systems.rigidbody.dynamicsWorld.rayTest(t,e,m);var r=null;if(m.hasHit()){var a=m.get_m_collisionObject(),c=Ammo.castObject(a,Ammo.btRigidBody),y=m.get_m_hitPointWorld(),d=m.get_m_hitNormalWorld();c&&(r=new o(c.entity,new pc.Vec3(y.x(),y.y(),y.z()),new pc.Vec3(d.x(),d.y(),d.z())))}return Ammo.destroy(m),r}}();var Ccd=pc.createScript("ccd");Ccd.attributes.add("motionThreshold",{type:"number",default:1,title:"Motion Threshold",description:"Number of meters moved in one frame before CCD is enabled"}),Ccd.attributes.add("sweptSphereRadius",{type:"number",default:.2,title:"Swept Sphere Radius",description:"This should be below the half extent of the collision volume. E.g For an object of dimensions 1 meter, try 0.2"}),Ccd.prototype.initialize=function(){var e;(e=this.entity.rigidbody.body).setCcdMotionThreshold(this.motionThreshold),e.setCcdSweptSphereRadius(this.sweptSphereRadius),this.on("attr:motionThreshold",(function(t,i){(e=this.entity.rigidbody.body).setCcdMotionThreshold(t)})),this.on("attr:sweptSphereRadius",(function(t,i){(e=this.entity.rigidbody.body).setCcdSweptSphereRadius(t)}))};var system,canvas,tutorial,messages,sys9ball,_menu,_sound,_LOCAL_PLAYER_NUMBER,_globalScore=0,_bestScore=0,forzeCueFactor=4.2,_IS_PHONE=!1,_physicWorldSystem=null,_masse=null,_2dScreen=null,physics_bodys=[],simulation=!1,ballPosGlobal=[],hitForze=.6,ballNames=["bb","b1","b2","b3","b4","b5","b6","b7","b8","b9","b10","b11","b12","b13","b14","b15"],simulationBallHit=[],indexHit=0,b_disablePhysics=!1,firstHit=!1,ballInCollider=!1,ballWhiteFirstBallContact=null,railHitsBalls=[],arrayBallsInCollision=[],soundEnabled=!0,_GUI_OPEN=!1,_TURN_TIME_OUT=!1,_LIMIT_TIME_TURN_SECONDS=180,_BLOCKED=!1,_SINGLE_PLAYER=!1,_BOT_PLAYING=!1,_TUTORIAL_PLAYING=!1,_DELAY_MSG_DOWN=10,_DELAY_MSG_SIDE=1300,lowTimeColor="#ff0000",normalColor="#ffffff",speedCue=1.4,_INGAME_MENU_OPEN=!1,_CLICKED_HOLE_8=!1,_MIN_FORCE_CUE=.5,_DIST_RESET_BALL=1,_9_BOLAS_ACTIVADO=!0,_VELOCIDAD_CORTINA_9=.4,_VELOCIDAD_CORTINA2_9=.5,colisionHoyo=!1,currentGamePlay="",_DESACTIVAR_CONDICION_4_MUROS_9_BOLAS=!0,extraScoreMasee=0,_9_BALLS_LEVELS_STRING="-4.7688/-0.5989|6853724,-4.6416/2.0541|3852764,-3.1782/0.0289|7523846,-3.0505/-0.2987|8432675,-3.4046/0.8732|2534867,-4.1861/-1.0951|7683452,-3.3231/-2.1682|8435762,-5.1098/0.3590|2568743,-3.0046/-1.3629|2673854,-4.2755/-2.1318|7526348,-3.0561/1.2109|7543268,-4.1763/2.2552|6475832,-4.4860/2.0336|7534862,-4.8111/1.0058|2678453,-3.6510/-1.6547|3274568,-4.0757/1.2298|2685347,-4.3932/-1.1741|3847562,-2.9007/-1.4895|5347268,-2.9968/0.1604|2735684,-4.9881/-2.1432|4726853,-4.7383/0.0988|2758346,-3.0444/-0.1365|4356872,-4.2235/0.5730|3468572,-5.0873/-0.6555|4268537,-2.8731/1.2508|4768532,-3.5533/2.1829|5347628,-3.8802/0.0890|3568247,-3.2198/-1.4029|5264738,-3.2027/0.3830|5348762,-3.0086/-1.6032|6542783,-4.1362/-1.5818|8723564,-4.8810/0.5833|8453627,-3.9280/0.9350|6825347,-4.0382/0.9924|8574362,-4.9219/2.0000|8376452,-2.8775/1.9409|8372546,-4.7013/0.6516|4832765,-2.9087/1.5375|4863725,-3.4437/-2.0961|7246583,-2.9417/-1.8529|4783625,-4.3190/0.1762|3842675,-3.2710/-0.2039|2587346,-4.2958/-0.4581|7563824,-3.0442/1.9185|2783456,-4.2339/0.2818|2568734,-4.5191/0.1150|8574326,-5.0361/1.9431|7482356,-3.4501/-1.1871|3654827,-2.9339/-0.6466|2568347,-4.3301/-0.8251|2865734,-4.9398/-0.6675|2648753,-4.1969/-1.5142|6834275,-3.5664/-0.1063|4685237,-4.9968/-0.8430|3527684,-3.5355/-2.0864|8265437,-3.0861/-0.4264|2546738,-4.9586/-0.4309|7684253,-3.8687/0.7835|6783452,-4.5115/0.0058|3476285,-3.7862/0.8963|4287635,-3.4284/-2.2378|6845723,-4.8819/-0.7370|8736254,-4.7960/-0.2289|4352687,-3.9966/-1.1905|4623587,-5.0196/1.4820|7358246,-4.3247/1.9181|5864723,-4.1539/-2.0709|2365784,-3.9420/-0.4327|3746258,-4.1898/0.5611|6285437,-2.9892/0.9730|3257864,-4.9942/0.2018|5384672,-3.8410/-0.0634|4367285,-4.3123/-0.3508|8326457,-3.7636/-1.4686|4875263,-3.0166/-1.8347|2348657,-5.0349/-0.0220|3647528,-3.3005/1.2521|5746328,-3.1315/2.2384|8674325,-4.4695/1.6995|5436728,-2.9277/-0.8720|2478563,-3.0024/0.1592|3742586,-4.9032/-0.4256|4725368,-3.2877/2.0869|7648253,-2.9486/1.7325|6458372,-3.2030/-2.0915|5472638,-3.6459/-1.0633|2765843,-4.7019/-0.7824|6572483,-5.0609/1.6274|5826473,-3.1148/-0.4281|6824537,-4.1421/-1.0733|5764823,-3.6089/-1.7150|4537826,-3.9166/-1.3653|8756432,-4.7331/0.2557|4378625,-4.4939/0.5880|5436827,-3.7332/-1.7972|5684732,-4.3145/1.0639|7542836,-4.1323/1.9152|7453826,-3.0590/-1.2073|4738526,-5.0991/1.6998|3825764,-3.1228/-1.5982|5286374,-3.8918/-2.0119|2638475,-3.4430/2.2498|7824635,-3.4229/1.2885|6257438,-4.3876/-1.2264|2357486,-3.3149/-1.2259|4258736,-4.3665/0.2361|5284637,-3.4180/0.4529|4752836,-4.0543/-0.4608|6785234,-4.3711/1.7844|7852364,-3.8744/0.2733|6382754,-3.5196/-0.1617|5482637,-4.7776/-1.4099|6758234,-3.4247/-0.0481|4267358,-3.4217/-0.5488|8573246,-4.9462/-0.7055|8432567,-3.9635/0.6969|3648572,-3.1763/1.2689|3287564,-3.8760/1.8317|6854273,-4.6120/0.8453|4752863,-4.3696/-2.0678|2374865,-4.3124/-0.3587|2348657,-2.9751/-0.8808|5247863,-3.1904/-0.7442|5786432,-3.5078/1.4176|2378456,-4.6803/1.1139|6487523,-3.9666/-0.1030|5468732,-4.7374/2.0986|8274563,-4.7494/0.1535|2486375,-3.2575/-1.9346|8653427,-3.6884/-1.4092|7834256,-3.1640/1.1276|3246857,-3.3198/1.9040|2864753,-3.7484/-0.5853|7382645,-3.9999/-2.2396|5842367,-4.1344/2.2343|4835726,-4.3734/1.8518|7865324,-4.0672/-1.8598|6528437,-3.7153/-0.4263|4586732,-3.3755/1.1307|8657342,-4.8531/0.5874|6837245,-3.1057/-0.4888|8342567,-4.7939/-1.6795|3852746,-4.8097/2.1089|7382546,-4.7849/-1.2016|3762584,-4.4177/1.6886|6234578,-3.5523/-2.0637|4837256,-4.9238/1.0380|4763258,-3.3727/-1.9031|7486523,-4.1695/1.5789|8427536,-3.1655/-1.8333|6837452,-4.5954/1.0659|8625473,-3.2566/-2.1053|6582347,-4.3629/1.2362|4257368,-4.4595/-0.4060|8675342,-4.8520/2.0507|5237864,-3.9099/-1.5801|6457328,-4.5725/0.0822|4578362,-4.4982/-1.3790|2583746,-4.3112/0.4308|2786543,-4.7690/0.5949|8632745,-4.4202/2.0615|5637284,-3.0875/-1.8586|7654283,-3.3483/1.6410|6452378,-3.6902/-2.0127|5638724,-3.2255/-0.8429|6275834,-4.4022/0.7761|4562873,-4.1998/2.0872|8653742,-3.3157/-0.2176|4786253,-3.1552/1.1881|4832756,-3.4659/0.6261|6458732,-2.8493/0.6375|4785623,-2.9317/-2.2523|6247358,-3.9146/1.5099|2354786,-4.8911/0.1952|4567283,-4.8372/2.1044|2468753,-4.4540/-0.5956|4237586,-4.3633/-0.7881|7468523,-4.4401/1.3220|8734265,-4.2945/1.2843|4372586,-4.5905/0.1119|4378652,-5.0665/-0.8931|2573684,-3.0742/-1.8298|7284536,-3.1358/-0.1130|2483765,-4.7393/-1.6702|6345287,-5.1127/-1.7187|8735462,-4.9421/0.6966|5432876,-3.0822/0.6880|5463827,-3.7207/0.0140|7645832,-3.6489/-2.2504|7352684,-4.3358/-2.0751|3527684,-4.1970/1.4376|2368754,-3.0673/0.6985|8247653,-4.6839/-0.9636|8275346,-4.7365/2.1126|3682574,-3.2548/-1.5651|7468235,-3.5071/0.4558|6324875,-4.0281/-1.2046|5826347,-3.8986/2.2055|4583672,-4.3262/2.2448|6275834,-3.1485/0.9861|7632548,-3.8661/0.8000|8326574,-3.2184/-1.5875|2368547,-3.3259/0.5814|5387642,-3.3797/1.8044|4837562,-4.0731/1.6269|3427865,-4.6356/-1.5009|7462853,-4.4694/1.0608|7485632,-4.6646/-1.6530|8246753,-3.2275/1.5355|3486257,-4.4258/0.8343|6385742,-3.3052/-0.1232|5786243,-3.9043/-0.5743|8347652,-2.9795/1.6091|7624538,-3.0080/1.4086|2843765,-2.8791/-0.4811|8475362,-4.2067/2.0982|8472536,-2.8206/1.4398|3267485,-3.1767/0.9216|7238546,-3.4010/1.0669|6538472,-3.9831/1.5734|5683247,-3.0625/-1.9052|5368742,-4.7242/2.0004|8253764,-3.0474/-0.9672|7465238,-3.2512/-0.5623|4725638,-4.6777/-0.6856|8625347,-5.0501/-0.8989|7846523,-3.1864/-2.2022|2654378,-4.7921/-1.2529|7563482,-4.0217/2.2121|6453728,-3.7121/-1.9983|3872645,-3.2792/1.3067|8745362,-3.6547/-0.0486|3546827,-5.0692/-1.9008|7284356,-3.2662/2.0055|3768245,-2.9051/-0.2324|8764352,-4.6956/-1.1598|4268537,-3.5953/-1.4459|4235678,-3.6666/1.3842|3784652,-4.5426/-1.5494|2345768,-3.8245/0.0270|2754638,-4.6791/0.2250|4862573,-5.0984/-0.9174|3726845,-3.3954/-0.0452|7485326,-4.2368/2.2649|8467235,-3.1619/-1.4855|7684532,-3.4230/-1.6721|3856742,-3.4767/-1.1582|6237584,-4.1858/0.8232|6823745,-4.2081/-1.1940|7243856,-3.8744/-0.3506|3826574,-3.8880/-0.6831|3542786,-2.9147/-0.0493|4352786,-4.5508/1.3148|2475683,-4.4598/-0.7476|8745236,-3.8962/-2.2115|3826475,-3.5466/-1.3437|2637845,-4.4251/-0.8436|2586473,-3.1673/-0.1934|7284356,-4.1676/-1.8053|2456378,-4.7749/1.2096|8426573,-4.7323/-0.0453|7642538,-3.4417/1.0551|8645327,-3.2459/0.8984|4283576,-3.6566/-1.6793|2657834,-5.1052/1.2396|2354867,-2.8560/0.9478|2346857,-3.6130/-0.3993|2873546,-3.3241/-0.9845|5482376,-4.3810/0.9864|6278354,-4.3857/1.3769|7826345,-4.1055/0.7453|7862354,-3.8775/0.0837|5672384,-3.3005/0.9433|3485627,-5.0982/1.4129|8746532,-2.8940/-0.1006|4632578,-4.8669/0.9719|6354728,-4.3082/-0.0736|2675834,-3.4432/0.0734|7264385,-3.7330/-0.1506|7362485,-3.4104/1.8982|8574326,-4.6991/0.4828|8734652,-3.6696/1.3571|7428356,-3.6821/1.5265|2385674,-5.0394/1.3932|2534687,-4.4774/-0.1003|8246753,-3.5869/2.2029|7562384,-3.7328/1.8703|2546378,-4.6246/1.2366|5368472,-4.4834/-1.9840|6428357,-3.5145/-1.5543|4326857,-4.8133/0.0722|4735682,-4.6586/0.1609|8367245,-3.8815/1.2218|5326874,-3.2339/2.1913|3786254,-4.8105/-1.6158|4827536,-3.4510/-0.8679|2364578,-3.9317/-0.1365|3467852,-4.1637/1.2641|2436758,-3.6638/0.5750|8462537,-3.4417/-1.2406|4257836",Get9BallsLevels=function(){for(var l=[],e=_9_BALLS_LEVELS_STRING.split(","),a=0;a<e.length;a++){for(var o={},s=e[a],i=s.split("|")[0],t=s.split("|")[1],n=[],r=0;r<t.length;r++)n.push(parseInt(t.charAt(r)));o.bolas=n,o.blanca={x:parseFloat(i.split("/")[0]),z:parseFloat(i.split("/")[1])},l.push(o)}return console.log(l),l},_9_BALLS_LEVELS=Get9BallsLevels(),_ACTUAL_EASE_LEVEL_INDEX=0,GetNewLevelToPlay9Balls=function(){var l=_ACTUAL_EASE_LEVEL_INDEX;return _ACTUAL_EASE_LEVEL_INDEX=_ACTUAL_EASE_LEVEL_INDEX+1==_ACTUAL_EASE_LEVELS.length?0:_ACTUAL_EASE_LEVEL_INDEX+1,_9_BALLS_LEVELS[_ACTUAL_EASE_LEVELS[l]]},_SCORE_9_BALLS=0,_SCORE_9_BALLS_BASE=10,_SCORE_9_BALLS_BASE_NEGATIVO=-10,_SCORE_9_BALLS_WIN=500,AddScore9Balls=function(l){_SCORE_9_BALLS=pc.math.clamp(_SCORE_9_BALLS+l,0,999999999),canvas.score9Balls.element.text=_SCORE_9_BALLS.toString();var e=_globalScore+l-_globalScore;_globalScore=_SCORE_9_BALLS,onGameUpdate(e)},PaintScore=function(){canvas.score9Balls.element.text=_SCORE_9_BALLS},_9_BALLS_SOUND=!1,multiplicador9Ball=1,numeroBolaGolpe=0,b_pegoBienPrimera=!1,b_botoBlanca=!1,conteoPuntajeJugada=0,b_inicioMalJugada=!1,conteoCapturadas=0,b_primeraBolaPegada=!1,muroHit=null,clonTiempo=0,ReinicioPuntajesSystem=function(){multiplicador9Ball=1,numeroBolaGolpe=0,b_pegoBienPrimera=!1,b_botoBlanca=!1,conteoPuntajeJugada=0,b_inicioMalJugada=!1,conteoCapturadas=0,b_primeraBolaPegada=!1,muroHit=null},b_perfectMesa=!0,b_perfectMultiMesa=!0,ReinicioPuntajesMesa=function(){b_perfectMesa=!0,b_perfectMultiMesa=!0},mesasPasadas=0,PasarMesa=function(){playSound("pasarNivel");var l=b_perfectMesa&&b_perfectMultiMesa?2e4:b_perfectMesa?1e4:4e3;console.log("Puntos: +"+l),clonTiempo>0&&(PokiSDK.happyTime(1),AddScore9Balls(l)),mesasPasadas++,messages.MSG9BALL_Win9Bolas(4e3==l?0:1e4==l?1:2)},TriggerHitMuro=function(l,e){3==multiplicador9Ball||b_primeraBolaPegada||e==muroHit||(muroHit=e,multiplicador9Ball=1==multiplicador9Ball?2:3,console.log("Multiplicador X"+multiplicador9Ball),2==multiplicador9Ball?(sys9ball.numerosX2.setPosition(new pc.Vec3(l.x,sys9ball.numerosX2.getPosition().y,l.z)),sys9ball.numerosX2.script.scoreNumerosManager.poneNumero("x2")):3==multiplicador9Ball&&(sys9ball.numerosX3.setPosition(new pc.Vec3(l.x,sys9ball.numerosX3.getPosition().y,l.z)),sys9ball.numerosX3.script.scoreNumerosManager.poneNumero("x3")))},TriggerHitBola=function(l,e){if(0==numeroBolaGolpe){if(b_primeraBolaPegada=!0,system.IsFirstHitCorrect9Balls(l.name)){var a=100*multiplicador9Ball;console.log("Puntos: +"+a),b_pegoBienPrimera=!0,conteoPuntajeJugada+=a,clonTiempo>0&&(PokiSDK.happyTime(.3),AddScore9Balls(a)),sys9ball.numerosBola.setPosition(new pc.Vec3(e.x,sys9ball.numerosBola.getPosition().y,e.z)),sys9ball.numerosBola.script.scoreNumerosManager.poneNumero("+"+a)}else b_inicioMalJugada=!0;numeroBolaGolpe=1}},CapturarBola=function(l,e){if(b_botoBlanca||b_inicioMalJugada)b_inicioMalJugada&&"1"==l.name&&(b_botoBlanca=!0,console.log("Pierde puntaje -"+(conteoPuntajeJugada+100)),clonTiempo>0&&AddScore9Balls(-conteoPuntajeJugada-100),AnimacionPuntajeHole(e,"-100"));else if("1"==l.name)b_botoBlanca=!0,console.log("Pierde puntaje -"+(conteoPuntajeJugada+100)),clonTiempo>0&&AddScore9Balls(-conteoPuntajeJugada-100),AnimacionPuntajeHole(e,"-100");else if(b_pegoBienPrimera){var a=0;a=1e3*multiplicador9Ball,AnimacionPuntajeHole(e,"+"+1e3*multiplicador9Ball),console.log("Puntos: +"+a),conteoPuntajeJugada+=a,clonTiempo>0&&(PokiSDK.happyTime(.8),AddScore9Balls(a)),conteoCapturadas++}},AnimacionPuntajeHole=function(l,e){switch(l){case"hole_down_right":sys9ball.numerosUpLeft.script.scoreNumerosManager.poneNumero(e);break;case"hole_down":sys9ball.numerosUp.script.scoreNumerosManager.poneNumero(e);break;case"hole_down_left":sys9ball.numerosUpRight.script.scoreNumerosManager.poneNumero(e);break;case"hole_up_right":sys9ball.numerosDownLeft.script.scoreNumerosManager.poneNumero(e);break;case"hole_up":sys9ball.numerosDown.script.scoreNumerosManager.poneNumero(e);break;case"hole_up_left":sys9ball.numerosDownRight.script.scoreNumerosManager.poneNumero(e)}},_fps=null,qualityFactor="alta",playerTurnStart=0,_IS_LOCAL_PLAYER_PLAYING=function(){return console.log("Is local player playing:",system.playerTurn,_LOCAL_PLAYER_NUMBER),system.playerTurn==_LOCAL_PLAYER_NUMBER},_COINS=0,_TABLES=[{status:2,price:100},{status:0,price:850},{status:0,price:1800},{status:0,price:3900},{status:0,price:7500},{status:0,price:9900}],_CUES=[{status:2,price:100},{status:0,price:650},{status:0,price:1300},{status:0,price:3200},{status:0,price:6e3},{status:0,price:8900}],_SELECTED_TABLE_INDEX=0,_SELECTED_CUE_INDEX=0;function collisionsStart(l){var e=l.bodyA.id,a=l.bodyB.id,o=search_physicsBody(e),s=search_physicsBody(a);if(null!=o&&null!=s){if(ballInCollider=[],simulation)return void(isBall(o[1])&&isBall(s[1],o[1])?"bb"==getBallName(o[1])?simulationBallHit.includes(s[1])||simulationBallHit.push(s[1]):"bb"==getBallName(s[1])&&(simulationBallHit.includes(o[1])||simulationBallHit.push(o[1])):isBall(o[1])&&isHole(s[1],o[1])?simulationBallHit.includes(s[1])||simulationBallHit.push(s[1]):isBall(s[1])&&isHole(o[1],s[1])?simulationBallHit.includes(o[1])||simulationBallHit.push(o[1]):isBall(o[1])&&isWall(s[1])?simulationBallHit.includes(s[1])||simulationBallHit.push(s[1]):isBall(s[1])&&isWall(o[1])&&(simulationBallHit.includes(o[1])||simulationBallHit.push(o[1])));if("ShootLap"==system.turnState){if(null==ballWhiteFirstBallContact&&isBall(o[1])&&isBall(s[1])&&("bb"==getBallName(o[1])?ballWhiteFirstBallContact=s[1]:"bb"==getBallName(s[1])&&(ballWhiteFirstBallContact=o[1])),isBall(o[1])&&isWall(s[1])){if("bb"==getBallName(o[1])){var i=o[1].getPosition().clone();s[1].script.p2Body.name.includes("down")?i=new pc.Vec3(i.x+.16,i.y,i.z-.11):s[1].script.p2Body.name.includes("up")?i=new pc.Vec3(i.x+.16,i.y,i.z+.11):s[1].script.p2Body.name.includes("left")?i=new pc.Vec3(i.x+.16,i.y,i.z-.11):s[1].script.p2Body.name.includes("right")&&(i=new pc.Vec3(i.x-.16,i.y,i.z-.11)),TriggerHitMuro(i,s[1].script.p2Body.name)}}else if(isBall(s[1])&&isWall(o[1])){if("bb"==getBallName(s[1])){i=s[1].getPosition().clone();o[1].script.p2Body.name.includes("down")?i=new pc.Vec3(i.x+.16,i.y,i.z-.11):o[1].script.p2Body.name.includes("up")?i=new pc.Vec3(i.x+.16,i.y,i.z+.11):o[1].script.p2Body.name.includes("left")?i=new pc.Vec3(i.x+.16,i.y,i.z-.11):o[1].script.p2Body.name.includes("right")&&(i=new pc.Vec3(i.x-.16,i.y,i.z-.11)),TriggerHitMuro(i,o[1].script.p2Body.name)}}else if(isBall(o[1])&&isBall(s[1]))if("bb"==getBallName(o[1])){i=s[1].getPosition().clone();TriggerHitBola(s[1],i)}else if("bb"==getBallName(s[1])){i=o[1].getPosition().clone();TriggerHitBola(o[1],i)}}else"Reseteando"!=system.turnState&&"MovingWhiteBallLap"!=system.turnState||isBall(o[1])&&isBall(s[1])&&(arrayBallsInCollision.includes(s[1])||arrayBallsInCollision.push(s[1]),simulationBallHit.includes(o[1])||arrayBallsInCollision.push(o[1]));if(isBall(o[1])&&isBall(s[1])&&("bb"==getBallName(o[1])?ballInCollider.includes(s[1])||ballInCollider.push(s[1]):"bb"==getBallName(s[1])&&(ballInCollider.includes(o[1])||ballInCollider.push(o[1]))),isBall(o[1])&&isHole(s[1],o[1]))"hole_up"==(t=getHoleName(s[1]))?s[1].script.colliderHoyo.triggerStart(o[1],-.14,t):"hole_down"==t?s[1].script.colliderHoyo.triggerStart(o[1],.14,t):s[1].script.colliderHoyo.triggerStart(o[1],0,t);else if(isBall(s[1])&&isHole(o[1],s[1])){var t;"hole_up"==(t=getHoleName(o[1]))?o[1].script.colliderHoyo.triggerStart(s[1],-.14,t):"hole_down"==t?o[1].script.colliderHoyo.triggerStart(s[1],.14,t):o[1].script.colliderHoyo.triggerStart(s[1],0,t)}else if(isBall(o[1])&&isBall(s[1])){"bb"==o[1].script.p2Body.name?_masse.doMasse(o[1],"ball"):"bb"==s[1].script.p2Body.name&&_masse.doMasse(s[1],"ball");var n=new pc.Vec2(o[1].script.p2Body.body.velocity[0],o[1].script.p2Body.body.velocity[1]),r=new pc.Vec2(s[1].script.p2Body.body.velocity[0],s[1].script.p2Body.body.velocity[1]);firstHit||system.b_PlayTutorial?n.length()>8||r.length()>8?playSound("ballHit"):n.length()>1.6||r.length()>1.6?playSound("ballHitMed"):playSound("ballHitLow"):(n.length()>.4||r.length()>.4?playSound("ballHitInitial"):(n.length()<.4||r.length()<.4)&&playSound("ballHitLow"),firstHit=!0)}else if(isBall(o[1])&&isWall(s[1])){"bb"==o[1].script.p2Body.name&&_masse.doMasse(o[1],"table"),(n=new pc.Vec2(o[1].script.p2Body.body.velocity[0],o[1].script.p2Body.body.velocity[1])).length()>.4&&playSound("ballHitWall"),railHitsBalls.includes(o[1])||railHitsBalls.push(o[1])}else if(isWall(o[1])&&isBall(s[1])){"bb"==s[1].script.p2Body.name&&_masse.doMasse(s[1],"table"),(r=new pc.Vec2(s[1].script.p2Body.body.velocity[0],s[1].script.p2Body.body.velocity[1])).length()>.4&&playSound("ballHitWall"),railHitsBalls.includes(s[1])||railHitsBalls.push(s[1])}}}function collisionsEnd(l){var e=l.bodyA.id,a=l.bodyB.id,o=search_physicsBody(e),s=search_physicsBody(a);null!=o&&null!=s&&isBall(o[1])&&isBall(s[1])&&("bb"==getBallName(o[1])||"bb"==getBallName(s[1]))&&ballInCollider.pop(),"Reseteando"!=system.turnState&&"MovingWhiteBallLap"!=system.turnState||(isBall(o[1])&&arrayBallsInCollision.pop(),isBall(s[1])&&arrayBallsInCollision.pop())}function search_physicsBody(l){for(var e=0;e<physics_bodys.length;e++)if(physics_bodys[e][0]==l)return physics_bodys[e];return null}function isBall(l){switch(l.script.p2Body.name){case"bb":case"b1":case"b2":case"b3":case"b4":case"b5":case"b6":case"b7":case"b8":case"b9":case"b10":case"b11":case"b12":case"b13":case"b14":case"b15":return!0}return!1}function getBallName(l){return l.script.p2Body.name}function getHoleName(l){return l.script.p2Body.name}function isHole(l,e){if("bb"==e.script.p2Body.name&&"SphereForWhite"!=l.name)return!1;switch(l.script.p2Body.name){case"hole_up_left":case"hole_up":case"hole_up_right":case"hole_down_left":case"hole_down":case"hole_down_right":return!0}return!1}function isWall(l){switch(l.script.p2Body.name){case"wall_up_left":case"wall_right":case"wall_up_right":case"wall_down_left":case"wall_left":case"wall_down_right":return!0}return!1}var _LANGUAGE=0,tipoVersion=0,skipMenu=!1,_ACTUAL_EASE_LEVELS=[];function setLevels(l){for(var e=l.split("-"),a=0;a<e.length;a++)_ACTUAL_EASE_LEVELS.push(e[a])}function onGameUpdate(){}function onGameLoad(){console.log("POKI GAME LOAD FINISHED"),PokiSDK.gameLoadingFinished()}function onGameStart(){"start"!=currentGamePlay&&(console.log("POKI GAME START"),PokiSDK.gameplayStart()),currentGamePlay="start"}function onGameEnd(){"stop"!=currentGamePlay&&(console.log("POKI GAME STOP"),PokiSDK.gameplayStop()),currentGamePlay="stop"}var _sound,isMobile={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return isMobile.Android()||isMobile.BlackBerry()||isMobile.iOS()||isMobile.Opera()||isMobile.Windows()||window.devicePixelRatio>=2&&navigator.maxTouchPoints>0}},bajarVelocidadChico=!1,bajarVelocidadMedio=!1,bajarVelocidadGrande=!1,esTunel=!1,noLimitar=!1,mute=0,tutorialEnabled=!0,currentMusic=null,currentMusicVolume=[];currentMusicVolume.menuMusic=.45,currentMusicVolume.vsMusic=.33,currentMusicVolume.vsCpuMusic=.33,currentMusicVolume.music2=.5,currentMusicVolume.music3=.5;var gamePrefix="9ballsPoolBekhoPoki_";function RayCast(e,a,t){var r=a.screenToWorld(e.x,e.y,a.nearClip),n=a.screenToWorld(e.x,e.y,a.farClip),s=t.systems.rigidbody.raycastFirst(r,n);return s?s.entity:null}function GetMouseGlobalPosition(e,a,t){var r=a.screenToWorld(e.x,e.y,a.nearClip),n=a.screenToWorld(e.x,e.y,a.farClip),s=t.systems.rigidbody.raycastFirst(r,n);return s||null}function GetMouseFloorPosition(e,a,t){var r=a.screenToWorld(e.x,e.y,a.nearClip),n=a.screenToWorld(e.x,e.y,a.farClip);return result=t.systems.rigidbody.raycastFiltered(r,n,PhysicsFilter.A,PhysicsFilter.A),result||null}function reproduceAnim(e,a,t,r,n,s){null!=t&&(e.animation.speed=t);var o=e.animation.assets[a],i=e.animation.animationsIndex[o];e.animation.play(i),e.animation.loop=!!s,r&&setTimeout((function(){e.enabled=!1}),n)}function reproduceParticulas(e,a){var t=e;t.enabled=!0,t.particlesystem.reset(),t.particlesystem.play(),setTimeout((function(){t.enabled=!1}),a)}function addEventFunction(e,a,t,r){var n=[];switch(null!=e.element&&(e=e.element),t){case 1:n[0]="touchstart",n[1]="mousedown";break;case 2:n[0]="touchend",n[1]="mouseup";break;case 3:n[0]="touchmove",n[1]="mousemove"}a?isMobile.any()?e.on(n[0],r):e.on(n[1],r):isMobile.any()?e.off(n[0],r):e.off(n[1],r)}function setTexto(e,a){e.text=a}function guarda_vars(e,a,t,r,n,s,o,i){t?1==r?e[n]=a:2==r?e[n][s]=a:3==r?e[n][s][o]=a:4==r&&(e[n][s][o][i]=a):e=a}function cargaTextura(e,a,t){_app.loader.getHandler("texture").crossOrigin="anonymous";var r=new pc.Asset("foto"+Math.round(1e3*Math.random()),"texture",{url:e});_app.assets.add(r),_app.assets.load(r),r.on("load",(function(e){if(t)for(var r=a.model.meshInstances,n=0;n<r.length;++n){var s=r[n];s.material.diffuseMap=e.resource,s.material.emissiveMap=e.resource,s.material.update()}else a.element.textureAsset=e,a.enabled=!0}))}function getTexture(e){var a=new pc.gfx.Texture(_app.graphicsDevice),t=new Image;return t.onload=function(){a.minFilter=pc.gfx.FILTER_LINEAR,a.magFilter=pc.gfx.FILTER_LINEAR,a.addressU=pc.ADDRESS_REPEAT,a.addressV=pc.ADDRESS_REPEAT,a.setSource(t)},t.src=e,a}function cambiaTextura3D(e,a){for(var t=a.model.meshInstances,r=0;r<t.length;++r){var n=t[r];n.material.diffuseMap=e,n.material.emissiveMap=e,n.material.update()}}function playSound(e,a){a?(currentMusic=e,_sound.play(e),canvas.setSoundData()):0==mute&&("apuntar"==e&&_sound.slot(e).isPlaying||_sound.play(e))}function muteMusic(){null!=currentMusic&&(_sound.slot(currentMusic).volume=0)}function unmuteMusic(){null!=currentMusic&&(_sound.slot(currentMusic).volume=currentMusicVolume[currentMusic])}function saveVariables(e,a){if(!supports_html5_storage())return!1;localStorage.setItem(gamePrefix+a,e+"")}function cargaVars(e){return supports_html5_storage()?localStorage.getItem(gamePrefix+e):0}function existeVars(e){return!!supports_html5_storage()&&localStorage.hasOwnProperty(gamePrefix+e)}function getAllVars(){for(var e=0;e<_TABLES.length;e++)existeVars("table_"+(e+1)+"_status")&&(_TABLES[e].status=parseInt(cargaVars("table_"+(e+1)+"_status")));for(e=0;e<_CUES.length;e++)existeVars("cue_"+(e+1)+"_status")&&(_CUES[e].status=parseInt(cargaVars("cue_"+(e+1)+"_status")));existeVars("_COINS")&&(_COINS=parseInt(cargaVars("_COINS"))),existeVars("_SELECTED_TABLE_INDEX")&&(_SELECTED_TABLE_INDEX=parseInt(cargaVars("_SELECTED_TABLE_INDEX"))),existeVars("_SELECTED_CUE_INDEX")&&(_SELECTED_CUE_INDEX=parseInt(cargaVars("_SELECTED_CUE_INDEX"))),existeVars("mute")&&(mute=parseInt(cargaVars("mute"))),existeVars("b_PlayTutorial")&&(1==(tutorialEnabled=parseInt(cargaVars("b_PlayTutorial")))?tutorialEnabled=!0:0==tutorialEnabled&&(tutorialEnabled=!1)),existeVars("bestScore")&&(_bestScore=parseInt(cargaVars("bestScore")))}function shake(e){window.navigator&&window.navigator.vibrate&&navigator.vibrate(e)}function supports_html5_storage(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}}function preloadSound(e){var a=soundKeys[e.name];_sound.slots[a].asset=e.id,_sound.slots[a].play().stop(),console.log("PRECARGADO!")}var soundKeys={"pool ingame.mp3":"vsCpuMusic","Poolside Serenade 1.mp3":"music2","Poolside Serenade 2.mp3":"music3"};function getKeyByValue(e,a){return Object.keys(e).find((t=>e[t]===a))}function trimPalo(e){for(var a="",t=0;t<e.length;t++)"|"!=e[t]&&(a+=e[t]);return a}var Torque=pc.createScript("torque");Torque.prototype.initialize=function(){this.torque=0;var t=this;this.app.on("p2:postStep",(function(){var o=t.entity.script.p2Body;o.angularVelocity*t.torque<100&&(o.angularForce+=t.torque)})),this.app.keyboard.on(pc.EVENT_KEYDOWN,this.onKeyDown,this),this.app.keyboard.on(pc.EVENT_KEYUP,this.onKeyUp,this)},Torque.prototype.onKeyDown=function(t){switch(t.key){case pc.KEY_LEFT:this.torque=5;break;case pc.KEY_RIGHT:this.torque=-5}},Torque.prototype.onKeyUp=function(t){this.torque=0};var P2World=pc.createScript("p2World");P2World.attributes.add("gravity",{type:"vec2",default:[0,-9.8],title:"Gravity",description:"Gravity to use when approximating the friction max force.",placeholder:["X","Y"]}),P2World.attributes.add("axes",{type:"number",enum:[{XY:1},{XZ:2},{YZ:3}],default:1,title:"Axes",description:"The axes on which the simulation is run."}),P2World.attributes.add("defaultFriction",{type:"number",default:.3,title:"Default Friction",description:"The default global friction."}),P2World.attributes.add("defaultRestitution",{type:"number",default:.5,title:"defaultRestitution",description:"The default global Restitution."}),P2World.attributes.add("maxSubSteps",{type:"number",default:10,title:"Max Substeps",description:"Maximum number of fixed steps to take when stepping the simulation."}),P2World.attributes.add("solverIterations",{type:"number",default:10,title:"Solver Iterations",description:"The maximum number of iterations to do when solving. More gives better results, but is more expensive."}),P2World.attributes.add("solverTolerance",{type:"number",default:0,title:"Solver Tolerance",description:"The error tolerance, per constraint. If the total error is below this limit, the solver will stop iterating. Set to zero for as good solution as possible, but to something larger than zero to make computations faster."}),P2World.attributes.add("sleepMode",{type:"number",enum:[{"No Sleeping":0},{"Body Sleeping":1},{"Island Sleeping":2}],default:0,title:"Sleep Mode",description:'How to deactivate bodies during simulation. Possible modes are: "No Sleeping", "Body Sleeping" and "Island Sleeping". If sleeping is enabled, you might need to wake up the bodies if they fall asleep. If you want to enable sleeping in the world, but want to disable it for a particular body, see p2Body.allowSleep.'}),P2World.attributes.add("islandSplit",{type:"boolean",default:!0,title:"Island Split",description:"Whether to enable island splitting. Island splitting can be an advantage for both precision and performance."}),P2World.attributes.add("debugDraw",{type:"boolean",default:!1,title:"Debug Draw",description:"Render a visual representation of the physics world in the running app."}),P2World.prototype.initialize=function(){_physicWorldSystem=this,this.lastTime=0;var t=[p2.World.NO_SLEEPING,p2.World.BODY_SLEEPING,p2.World.ISLAND_SLEEPING],i=new p2.World({gravity:[this.gravity.x,this.gravity.y],islandSplit:this.islandSplit});i.sleepMode=t[this.sleepMode],i.solver=new p2.GSSolver,i.solver.iterations=this.solverIterations,i.solver.tolerance=this.solverTolerance,i.defaultContactMaterial.friction=this.defaultFriction,i.defaultContactMaterial.restitution=this.defaultRestitution,this.on("attr:defaultFriction",(function(t,e){i.defaultContactMaterial.friction=t})),this.on("attr:defaultRestitution",(function(t,e){i.defaultContactMaterial.restitution=t})),this.on("attr:gravity",(function(t,e){i.gravity[0]=t.x,i.gravity[1]=t.y})),this.on("attr:islandSplit",(function(t,e){i.islandSplit=t})),this.on("attr:sleepMode",(function(e,o){i.sleepMode=t[e]})),this.on("attr:solverIterations",(function(t,e){i.solver.iterations=Math.round(t)})),this.on("attr:solverTolerance",(function(t,e){i.solver.tolerance=t}));var e=this;this.app.on("p2:getPosition",(function(t,i){var o=t.getPosition();switch(e.axes){case 1:[o.x,o.y];break;case 2:[o.x,-o.z];break;case 3:[-o.z,o.y]}})),this.app.on("p2:addBody",(function(t){var o=t.entity.getPosition();switch(e.axes){case 1:t.position=[o.x,o.y];break;case 2:t.position=[o.x,-o.z];break;case 3:t.position=[-o.z,o.y]}i.addBody(t)})),this.app.on("p2:removeBody",(function(t){i.removeBody(t)})),i.on("postStep",(function(t){e.app.fire("p2:postStep")})),i.on("beginContact",(function(t){collisionsStart(t)})),i.on("endContact",(function(t){collisionsEnd(t)})),this.world=i},P2World.prototype.simular=function(t,i,e,o,n){var s,a,l=o;this.world.bodies.length;var r=[],h=[];simulation=!0;var c,d=getBallName(i),p=i.getPosition().clone(),y=i.getEulerAngles().clone(),u=[],b=new pc.Vec3(t.followerGO.forward.x,0,t.followerGO.forward.z).normalize().scale(4.499999941690821*forzeCueFactor),f=!1;if(null!=this.forceOld&&(f=b.equals(this.forceOld)),f)simulation=!1;else{system.ballColisionada=null,ballPosGlobal.blanca=[],ballPosGlobal.blancaIni=[],ballPosGlobal.hit=[];var g=i.script.p2Body.body;u[0]=g.position[0],u[1]=g.position[1],c=g.angle;i.script.p2Circle;this.forceOld=b,t.ball.script.p2Body.body.applyImpulse([b.x,-b.z]),simulationBallHit=[],0;var B=null;colisionHoyo=!1,ballPosGlobal.blancaBordeFase1=[],ballPosGlobal.blancaBordeFase2=[];for(var P=0;P<16;P++)ballPosGlobal["blanca_"+P]=[],ballPosGlobal["blancaIni_"+P]=[];for(var m=!1,A=0;A<l;A++){for(var v=0;v<t.ballsAll.length;v++){if(a=(s=(g=t.ballsAll[v].script.p2Body.body).entity).getPosition(),0==A){var S=getBallName(s);ballPosGlobal[S]=[],S==d?(r[S]=[],r[S][0]=p,r[S][1]=y,h[S]=[],h[S][0]=[u[0],u[1]],h[S][1]=c/Math.PI*180):(r[S]=[],r[S][0]=s.getPosition().clone(),r[S][1]=s.getEulerAngles().clone(),h[S]=[],h[S][0]=[g.position[0],g.position[1]],h[S][1]=g.angle/Math.PI*180)}a.clone();switch(this.axes){case 1:s.setPosition(g.position[0],g.position[1],a.z),s.setEulerAngles(0,0,g.angle/Math.PI*180);break;case 2:s.setPosition(g.position[0],a.y,-g.position[1]),s.setEulerAngles(0,g.angle/Math.PI*180,0);break;case 3:s.setPosition(a.x,g.position[0],-g.position[1]),s.setEulerAngles(g.angle/Math.PI*180,0,0)}if((S=getBallName(s))==d&&(simulationBallHit.length>0&&(m||isWall(simulationBallHit[0]))?!m&&isWall(simulationBallHit[0])?(m=!0,ballPosGlobal.blancaBordeFase2.push(s.getPosition().clone())):m&&ballPosGlobal.blancaBordeFase2.push(s.getPosition().clone()):ballPosGlobal.blancaBordeFase1.push(s.getPosition().clone())),0==simulationBallHit.length){if(S==d)for(P=0;P<16;P++)ballPosGlobal["blancaIni_"+P].push(s.getPosition().clone())}else if(null==B){if(isHole(simulationBallHit[0],i)||isWall(simulationBallHit[0]))isHole(simulationBallHit[0],i)&&(colisionHoyo=!0);else if(B=simulationBallHit[0],S==d)for(P=1;P<16;P++)ballPosGlobal["blancaIni_"+P].push(s.getPosition().clone()),ballPosGlobal["blanca_"+P].push(s.getPosition().clone())}else{var w=0;for(P=0;P<simulationBallHit.length;P++)S==d&&ballPosGlobal["blanca_"+P].push(s.getPosition().clone()),w+=1;for(P=w;P<16;P++)S==d&&ballPosGlobal["blancaIni_"+P].push(s.getPosition().clone())}if(ballPosGlobal[S].push(s.getPosition().clone()),A==l-1){S=getBallName(s);g.velocity=[0,0],g.force=[0,0],g.angularVelocity=0,g.position=h[S][0],g.angle=h[S][1],s.setPosition(r[S][0]),s.setEulerAngles(r[S][1])}}this.world.step(1/n,0,1)}if(m||(colisionHoyo=!1),null==B)return simulationBallHit=[],void 0;for(v=0;v<simulationBallHit.length&&(!isHole(simulationBallHit[v],i)&&!isWall(simulationBallHit[v]));v++){B=simulationBallHit[v],ballPosGlobal.hit=[];for(S=getBallName(B),A=1;A<ballPosGlobal[S].length;A++){var x=new pc.Vec3;x.sub2(ballPosGlobal[S][A],ballPosGlobal[S][A-1]),x.length()>.001&&ballPosGlobal.hit.push(ballPosGlobal[S][A])}if(ballPosGlobal.hit.length>1){var C=B.getPosition(),I=B.getPosition().clone(),k=new pc.Vec3(ballPosGlobal.hit[1].x,C.y,ballPosGlobal.hit[1].z);if(I.distance(k)>.001){ballPosGlobal.blanca=ballPosGlobal["blanca_"+v],ballPosGlobal.blancaIni=ballPosGlobal["blancaIni_"+v];break}}}var M,G,W,T,L,R=[];for(v=0;v<ballPosGlobal.blancaIni.length;v++)if(0==v)M=ballPosGlobal.blancaIni[0].x,G=ballPosGlobal.blancaIni[0].z,ballPosGlobal.blancaIni.length>1?(W=ballPosGlobal.blancaIni[1].x,T=ballPosGlobal.blancaIni[1].z):(W=ballPosGlobal.blancaIni[0].x,T=ballPosGlobal.blancaIni[0].z),L=(T-G)/(W-M),R.push(ballPosGlobal.blancaIni[0]),R.push(ballPosGlobal.blancaIni[1]);else{if(Math.abs(ballPosGlobal.blancaIni[v].z-G-L*(ballPosGlobal.blancaIni[v].x-M))>.08)break;R.push(ballPosGlobal.blancaIni[v])}ballPosGlobal.blancaIni=R,t.ballColisionada=B,simulationBallHit=[],0}},P2World.prototype.stepToFuture=function(t){var i=system.fps;this.world.step(1/i,t,this.maxSubSteps)},P2World.prototype.postUpdate=function(t){if(!simulation&&!b_disablePhysics){var i,e,o,n,s;o=(e=this.world.bodies).length;var a=system.fps;this.world.step(1/a,t,this.maxSubSteps);for(var l=0;l<o;l++)if(null!=(i=e[l])&&(i.type===p2.Body.DYNAMIC||i.type===p2.Body.KINEMATIC)){(s=(n=i.entity).getPosition()).clone();if(!isNaN(i.position[0])&&!isNaN(i.position[1]))switch(this.axes){case 1:n.setPosition(i.position[0],i.position[1],s.z),n.setEulerAngles(0,0,i.angle/Math.PI*180);break;case 2:n.setPosition(i.position[0],s.y,-i.position[1]),n.setEulerAngles(0,i.angle/Math.PI*180,0);break;case 3:n.setPosition(s.x,i.position[0],-i.position[1]),n.setEulerAngles(i.angle/Math.PI*180,0,0)}}}};var P2Material=pc.createScript("p2Material");P2Material.attributes.add("friction",{type:"number",default:.55,min:0,max:1,title:"Friction",description:"The friction coefficient for this material."}),P2Material.attributes.add("restitution",{type:"number",default:.55,min:0,max:1,title:"Restitution",description:"The restitution for this material, defining its bounciness."}),P2Material.attributes.add("surfaceVelocity",{type:"number",default:0,title:"Surface Velocity",description:""}),P2Material.materialDefs=[],P2Material.prototype.updateMaterial=function(){var t,i,e;for((e=P2Material.materialDefs).length,t=0;t<numMaterials;t++)if((i=e[t]).friction===this.friction&&i.restitution===this.restitution)return void(this.material=i.material);e.push({})},P2Material.prototype.initialize=function(){this.on("attr",(function(t,i,e){this.updateMaterial()}))};var P2Box=pc.createScript("p2Box");P2Box.attributes.add("width",{type:"number",default:1,title:"Width",description:"Total width of the box."}),P2Box.attributes.add("height",{type:"number",default:1,title:"Height",description:"Total height of the box."}),P2Box.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Box.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Box.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Box.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See collisionGroup."}),P2Box.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Box.prototype.initialize=function(){if(this.shape=new p2.Box({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),height:this.height,position:[this.position.x,this.position.y],sensor:this.sensor,width:this.width}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:height",(function(t,i){this.shape.height=t})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),this.on("attr:width",(function(t,i){this.shape.width=t})),this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Circle=pc.createScript("p2Circle");P2Circle.attributes.add("radius",{type:"number",default:1,title:"Radius",description:"Radius of the circle."}),P2Circle.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Circle.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Circle.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Circle.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See .collisionGroup."}),P2Circle.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Circle.prototype.initialize=function(){if(this.shape=new p2.Circle({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),position:[this.position.x,this.position.y],radius:this.radius,sensor:this.sensor}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:radius",(function(t,i){this.shape.radius=t})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),null!==this.shape.body&&this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Capsule=pc.createScript("p2Capsule");P2Capsule.attributes.add("radius",{type:"number",default:1,title:"Radius",description:"The radius of the capsule."}),P2Capsule.attributes.add("length",{type:"number",default:1,title:"Length",description:"The distance between the end points."}),P2Capsule.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Capsule.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Capsule.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Capsule.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See .collisionGroup."}),P2Capsule.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Capsule.prototype.initialize=function(){if(this.shape=new p2.Capsule({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),length:this.length,position:[this.position.x,this.position.y],radius:this.radius,sensor:this.sensor}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:length",(function(t,i){this.shape.length=t})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:radius",(function(t,i){this.shape.radius=t})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),null!==this.shape.body&&this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Plane=pc.createScript("p2Plane");P2Plane.attributes.add("angle",{type:"number",default:0,title:"Angle",description:"Body-local angle of the shape in degrees.",placeholder:"degrees"}),P2Plane.attributes.add("position",{type:"vec2",default:[0,0],title:"Position",description:"Body-local position of the shape.",placeholder:["X","Y"]}),P2Plane.attributes.add("collisionGroup",{type:"string",default:"00000001",title:"Collision Group",description:"Collision group that this shape belongs to (bit mask)."}),P2Plane.attributes.add("collisionMask",{type:"string",default:"00000001",title:"Collision Mask",description:"Collision mask of this shape. See .collisionGroup."}),P2Plane.attributes.add("sensor",{type:"boolean",default:!1,title:"Sensor",description:"Set to true if you want this shape to be a sensor. A sensor does not generate contacts, but it still reports contact events. This is good if you want to know if a shape is overlapping another shape, without them generating contacts."}),P2Plane.prototype.initialize=function(){if(this.shape=new p2.Plane({angle:this.angle,collisionGroup:parseInt(this.collisionGroup,2),collisionMask:parseInt(this.collisionMask,2),position:[this.position.x,this.position.y],sensor:this.sensor}),this.on("attr:angle",(function(t,i){this.shape.angle=t*Math.PI/180})),this.on("attr:collisionGroup",(function(t,i){this.shape.collisionGroup=parseInt(t,2)})),this.on("attr:collisionMask",(function(t,i){this.shape.collisionMask=parseInt(t,2)})),this.on("attr:position",(function(t,i){this.shape.position[0]=t.x,this.shape.position[1]=t.y})),this.on("attr:sensor",(function(t,i){this.shape.sensor=t})),this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}this.on("enable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.addShape(this.shape)}})),this.on("disable",(function(){if(this.entity.script.p2Body){var t=this.entity.script.p2Body.body;t&&t.removeShape(this.shape)}}))};var P2Body=pc.createScript("p2Body");P2Body.attributes.add("type",{type:"number",enum:[{Static:0},{Dynamic:1},{Kinematic:2}],default:1,title:"Type",description:"The type of motion this body has. Should be one of: 0 (Static), 1 (Dynamic) and 2 (Kinematic). Static bodies do not move, and they do not respond to forces or collision. Dynamic bodies body can move and respond to collisions and forces. Kinematic bodies only moves according to its velocity, and does not respond to collisions or force."}),P2Body.attributes.add("mass",{type:"number",default:1,title:"Mass",description:"The mass of the body."}),P2Body.attributes.add("velocity",{type:"vec2",default:[0,0],title:"Velocity",description:"The current velocity of the body.",placeholder:["X","Y"]}),P2Body.attributes.add("angularVelocity",{type:"number",default:0,title:"Angular Velocity",description:"The angular velocity of the body, in degrees per second.",placeholder:"degrees/s"}),P2Body.attributes.add("damping",{type:"number",default:.1,min:0,max:1,title:"Damping",description:"The linear damping acting on the body in the velocity direction. Should be a value between 0 and 1."}),P2Body.attributes.add("angularDamping",{type:"number",min:0,max:1,default:.1,title:"Angular Damping",description:"The angular damping acting on the body. Should be a value between 0 and 1."}),P2Body.attributes.add("gravityScale",{type:"number",default:1,title:"Gravity Scale",description:"Gravity scaling factor. If you want the body to ignore gravity, set this to zero. If you want to reverse gravity, set it to -1."}),P2Body.attributes.add("fixedX",{type:"boolean",default:!1,title:"Fixed X",description:"Set to true if you want to fix the body movement along the X axis. The body will still be able to move along Y."}),P2Body.attributes.add("fixedY",{type:"boolean",default:!1,title:"Fixed Y",description:"Set to true if you want to fix the body movement along the Y axis. The body will still be able to move along X."}),P2Body.attributes.add("fixedRotation",{type:"boolean",default:!1,title:"Fixed Rotation",description:"Set to true if you want to fix the rotation of the body."}),P2Body.attributes.add("allowSleep",{type:"boolean",default:!0,title:"Allow Sleep",description:"If true, the body will automatically fall to sleep. Note that you need to enable sleeping in the p2World before anything will happen."}),P2Body.attributes.add("sleepSpeedLimit",{type:"number",default:.2,title:"Sleep Speed Limit",description:"If the speed (the norm of the velocity) is smaller than this value, the body is considered sleepy."}),P2Body.attributes.add("sleepTimeLimit",{type:"number",default:1,title:"Sleep Time Limit",description:"If the body has been sleepy for this sleepTimeLimit seconds, it is considered sleeping.",placeholder:"seconds"}),P2Body.attributes.add("collisionResponse",{type:"boolean",default:!0,title:"Collision Response",description:"Whether to produce contact forces when in contact with other bodies. Note that contacts will be generated, but they will be disabled. That means that this body will move through other bodies, but it will still trigger contact events, etc."}),P2Body.attributes.add("name",{type:"string",default:"",title:"name",description:"name to use as ID"}),Object.defineProperty(P2Body.prototype,"angularForce",{get:function(){return this.body?this.body.angularForce:0},set:function(t){null!=this.body&&(this.body.angularForce=t)}}),P2Body.prototype.postInitialize=function(){var t=[p2.Body.STATIC,p2.Body.DYNAMIC,p2.Body.KINEMATIC];this.app.fire("p2:getPosition",this.entity,[0,0]);var i,e=t[this.type];this.body=new p2.Body({allowSleep:this.allowSleep,angularVelocity:this.angularVelocity,angle:0,collisionResponse:this.collisionResponse,gravityScale:this.gravityScale,mass:e===p2.Body.STATIC?0:this.mass,damping:this.damping,angularDamping:this.angularDamping,ccdSpeedThreshold:.02,ccdIterations:10,type:e,velocity:[this.velocity.x,this.velocity.y]}),this.body.fixedX=this.fixedX,this.body.fixedY=this.fixedY,this.body.fixedRotation=this.fixedRotation,this.body.entity=this.entity,console.log(this.damping),this.on("attr:allowSleep",(function(t,i){this.body.allowSleep=t})),this.on("attr:angularDamping",(function(t,i){this.body.angularDamping=t})),this.on("attr:collisionResponse",(function(t,i){this.body.collisionResponse=t})),this.on("attr:damping",(function(t,i){this.body.damping=t})),this.on("attr:fixedX",(function(t,i){this.body.fixedX=t})),this.on("attr:fixedY",(function(t,i){this.body.fixedY=t})),this.on("attr:fixedRotation",(function(t,i){this.body.fixedRotation=t})),this.on("attr:gravityScale",(function(t,i){this.body.gravityScale=t})),this.on("attr:mass",(function(t,i){this.body.mass=t,this.body.updateMassProperties()})),this.on("attr:type",(function(i,e){this.body.type=t[i]})),this.entity.script.p2Box&&(i=this.entity.script.p2Box.shape),this.entity.script.p2Capsule&&(i=this.entity.script.p2Capsule.shape),this.entity.script.p2Circle&&(i=this.entity.script.p2Circle.shape),this.entity.script.p2Plane&&(i=this.entity.script.p2Plane.shape),i&&this.body.addShape(i),physics_bodys.push([this.body.id,this.entity,this.name]),this.app.fire("p2:addBody",this.body),this.on("enable",(function(){this.app.fire("p2:addBody",this.body)})),this.on("disable",(function(){this.app.fire("p2:removeBody",this.body)})),this.entity.fire("p2:newBody",this.body)};var P2DistanceConstraint=pc.createScript("p2DistanceConstraint");P2DistanceConstraint.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First entity with body participating in the constraint."}),P2DistanceConstraint.attributes.add("localAnchorA",{type:"vec2",default:[0,0],title:"Local Anchor A",description:"Local anchor in body A specified in local body coordinates.",placeholder:["X","Y"]}),P2DistanceConstraint.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second entity with body participating in the constraint."}),P2DistanceConstraint.attributes.add("localAnchorB",{type:"vec2",default:[0,0],title:"Local Anchor B",description:"Local anchor in body B specified in local body coordinates.",placeholder:["X","Y"]}),P2DistanceConstraint.attributes.add("collideConnected",{type:"boolean",default:!0,title:"Collide Connected",description:"Set to true if you want the connected bodies to collide."}),P2DistanceConstraint.attributes.add("stiffness",{type:"number",default:1e6,title:"Stiffness",description:"Set stiffness for this constraint."}),P2DistanceConstraint.attributes.add("relaxation",{type:"number",default:4,title:"Relaxation",description:"Set relaxation for this constraint."}),P2DistanceConstraint.prototype.createConstraint=function(){this.constraint&&this.bodyA.world.removeConstraint(this.constraint),this.constraint=new p2.DistanceConstraint(this.bodyA,this.bodyB,{collideConnected:this.collideConnected,localAnchorA:[this.localAnchorA.x,this.localAnchorA.y],localAnchorB:[this.localAnchorB.x,this.localAnchorB.y]}),this.constraint.setStiffness(this.stiffness),this.constraint.setRelaxation(this.relaxation),this.bodyA.world.addConstraint(this.constraint)},P2DistanceConstraint.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createConstraint();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createConstraint()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createConstraint()})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createConstraint()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createConstraint()}))})),this.on("attr:localAnchorA",(function(t,i){this.constraint&&(this.constraint.localAnchorA[0]=t.x,this.constraint.localAnchorA[1]=t.y)})),this.on("attr:localAnchorB",(function(t,i){this.constraint&&(this.constraint.localAnchorB[0]=t.x,this.constraint.localAnchorB[1]=t.y)})),this.on("attr:relaxation",(function(t,i){this.constraint&&this.constraint.setRelaxation(t)})),this.on("attr:stiffness",(function(t,i){this.constraint&&this.constraint.setStiffness(t)}))};var P2PrismaticConstraint=pc.createScript("p2PrismaticConstraint");P2PrismaticConstraint.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First entity with body participating in the constraint."}),P2PrismaticConstraint.attributes.add("localAnchorA",{type:"vec2",default:[0,0],title:"Local Anchor A",description:"Local anchor in body A specified in local body coordinates.",placeholder:["X","Y"]}),P2PrismaticConstraint.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second entity with body participating in the constraint."}),P2PrismaticConstraint.attributes.add("localAnchorB",{type:"vec2",default:[0,0],title:"Local Anchor B",description:"Local anchor in body B specified in local body coordinates.",placeholder:["X","Y"]}),P2PrismaticConstraint.attributes.add("localAxisA",{type:"vec2",default:[1,0],title:"Local Axis A",description:"An axis, defined in body A frame, that body B's anchor point may slide along.",placeholder:["X","Y"]}),P2PrismaticConstraint.attributes.add("disableRotationalLock",{type:"boolean",default:!1,title:"Disable Rotational Lock",description:"If set to true, body of entityB will be free to rotate around its anchor point."}),P2PrismaticConstraint.attributes.add("collideConnected",{type:"boolean",default:!0,title:"Collide Connected",description:"Set to true if you want the connected bodies to collide."}),P2PrismaticConstraint.attributes.add("stiffness",{type:"number",default:1e6,title:"Stiffness",description:"Set stiffness for this constraint."}),P2PrismaticConstraint.attributes.add("relaxation",{type:"number",default:4,title:"Relaxation",description:"Set relaxation for this constraint."}),P2PrismaticConstraint.prototype.createConstraint=function(){this.constraint&&this.bodyA.world.removeConstraint(this.constraint),this.constraint=new p2.PrismaticConstraint(this.bodyA,this.bodyB,{collideConnected:this.collideConnected,disableRotationalLock:this.disableRotationalLock,localAnchorA:[this.localAnchorA.x,this.localAnchorA.y],localAnchorB:[this.localAnchorB.x,this.localAnchorB.y],localAxisA:[this.localAxisA.x,this.localAxisA.y]}),this.constraint.setStiffness(this.stiffness),this.constraint.setRelaxation(this.relaxation),this.bodyA.world.addConstraint(this.constraint)},P2PrismaticConstraint.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createConstraint();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createConstraint()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createConstraint()})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createConstraint()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createConstraint()}))})),this.on("attr:localAnchorA",(function(t,i){this.constraint&&(this.constraint.localAnchorA[0]=t.x,this.constraint.localAnchorA[1]=t.y)})),this.on("attr:localAnchorB",(function(t,i){this.constraint&&(this.constraint.localAnchorB[0]=t.x,this.constraint.localAnchorB[1]=t.y)})),this.on("attr:localAxisA",(function(t,i){this.constraint&&(this.constraint.localAxisA[0]=t.x,this.constraint.localAxisA[1]=t.y)})),this.on("attr:relaxation",(function(t,i){this.constraint&&this.constraint.setRelaxation(t)})),this.on("attr:stiffness",(function(t,i){this.constraint&&this.constraint.setStiffness(t)}))};var P2RevoluteConstraint=pc.createScript("p2RevoluteConstraint");P2RevoluteConstraint.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First entity with body participating in the constraint."}),P2RevoluteConstraint.attributes.add("localPivotA",{type:"vec2",default:[0,0],title:"Local Pivot A",description:"Local pivot in body A specified in local body coordinates.",placeholder:["X","Y"]}),P2RevoluteConstraint.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second entity with body participating in the constraint."}),P2RevoluteConstraint.attributes.add("localPivotB",{type:"vec2",default:[0,0],title:"Local Pivot B",description:"Local pivot in body B specified in local body coordinates.",placeholder:["X","Y"]}),P2RevoluteConstraint.attributes.add("collideConnected",{type:"boolean",default:!0,title:"Collide Connected",description:"Set to true if you want the connected bodies to collide."}),P2RevoluteConstraint.attributes.add("stiffness",{type:"number",default:1e6,title:"Stiffness",description:"Set stiffness for this constraint."}),P2RevoluteConstraint.attributes.add("relaxation",{type:"number",default:4,title:"Relaxation",description:"Set relaxation for this constraint."}),P2RevoluteConstraint.attributes.add("limitsEnabled",{type:"boolean",default:!1,title:"Limits Enabled",description:"Enable constraint angle limits."}),P2RevoluteConstraint.attributes.add("limits",{type:"vec2",default:[0,0],title:"Limits",description:"Set the constraint angle limits.",placeholder:["lower","upper"]}),P2RevoluteConstraint.attributes.add("motorEnabled",{type:"boolean",default:!1,title:"Motor Enabled",description:"Enable the rotational motor."}),P2RevoluteConstraint.attributes.add("motorSpeed",{type:"number",default:0,title:"Motor Speed",description:"Set the speed of the rotational constraint motor."}),P2RevoluteConstraint.prototype.createConstraint=function(){this.constraint&&this.bodyA.world.removeConstraint(this.constraint),this.constraint=new p2.RevoluteConstraint(this.bodyA,this.bodyB,{collideConnected:this.collideConnected,localPivotA:[this.localPivotA.x,this.localPivotA.y],localPivotB:[this.localPivotB.x,this.localPivotB.y]}),this.constraint.limitsEnabled&&this.constraint.setLimits(this.limits.x*Math.PI/180,this.limits.y*Math.PI/180),this.constraint.setStiffness(this.stiffness),this.constraint.setRelaxation(this.relaxation),this.motorEnabled?this.constraint.enableMotor():this.constraint.disableMotor(),this.constraint.setMotorSpeed(this.motorSpeed),this.bodyA.world.addConstraint(this.constraint)},P2RevoluteConstraint.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createConstraint();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createConstraint()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createConstraint()})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createConstraint()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createConstraint()}))})),this.on("attr:limits",(function(t,i){this.constraint&&this.constraint.limitsEnabled&&this.constraint.setLimits(this.limits.x*Math.PI/180,this.limits.y*Math.PI/180)})),this.on("attr:limitsEnabled",(function(t,i){this.constraint&&(t?this.constraint.setLimits(this.limits.x*Math.PI/180,this.limits.y*Math.PI/180):(this.constraint.lowerlimitEnabled=!1,this.constraint.upperlimitEnabled=!1))})),this.on("attr:lowerLimitEnabled",(function(t,i){this.constraint&&(this.constraint.lowerLimitEnabled=t)})),this.on("attr:localPivotA",(function(t,i){this.constraint&&(this.constraint.localPivotA[0]=t.x,this.constraint.localPivotA[1]=t.y)})),this.on("attr:localPivotB",(function(t,i){this.constraint&&(this.constraint.localPivotB[0]=t.x,this.constraint.localPivotB[1]=t.y)})),this.on("attr:motorEnabled",(function(t,i){this.constraint&&(t?this.constraint.enableMotor():this.constraint.disableMotor())})),this.on("attr:motorSpeed",(function(t,i){this.constraint&&this.constraint.setMotorSpeed(t)})),this.on("attr:relaxation",(function(t,i){this.constraint&&this.constraint.setRelaxation(t)})),this.on("attr:stiffness",(function(t,i){this.constraint&&this.constraint.setStiffness(t)})),this.on("attr:upperLimit",(function(t,i){this.constraint&&(this.constraint.upperLimit=t)})),this.on("attr:upperLimitEnabled",(function(t,i){this.constraint&&(this.constraint.upperLimitEnabled=t)}))};var P2LinearSpring=pc.createScript("p2LinearSpring");P2LinearSpring.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First connected entity."}),P2LinearSpring.attributes.add("anchorA",{type:"vec2",default:[0,0],title:"Anchor A",description:"Where to hook the spring to body A, in local body coordinates or world space coordinates. Defaults to the body center in local space.",placeholder:["X","Y"]}),P2LinearSpring.attributes.add("anchorASpace",{type:"number",enum:[{Local:0},{World:1}],default:0,title:"Anchor A Space",description:"The coordinate space for anchor A. Can be local body space or world space."}),P2LinearSpring.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second connected entity."}),P2LinearSpring.attributes.add("anchorB",{type:"vec2",default:[0,0],title:"Anchor B",description:"Where to hook the spring to body B, in local body coordinates or world space coordinates. Defaults to the body center in local space.",placeholder:["X","Y"]}),P2LinearSpring.attributes.add("anchorBSpace",{type:"number",enum:[{Local:0},{World:1}],default:0,title:"Anchor B Space",description:"The coordinate space for anchor B. Can be local body space or world space."}),P2LinearSpring.attributes.add("restLength",{type:"number",default:0,title:"Rest Length",description:"Rest length of the spring."}),P2LinearSpring.attributes.add("stiffness",{type:"number",default:100,title:"Stiffness",description:"Stiffness of the spring. See Hookes Law."}),P2LinearSpring.attributes.add("damping",{type:"number",default:1,title:"Damping",description:"Damping of the spring."}),P2LinearSpring.prototype.createSpring=function(){this.spring&&this.bodyA.world.removeSpring(this.spring);var t={damping:this.damping,stiffness:this.stiffness};0===this.anchorASpace?t.localAnchorA=[this.anchorA.x,this.anchorA.y]:t.worldAnchorA=[this.anchorA.x,this.anchorA.y],0===this.anchorBSpace?t.localAnchorB=[this.anchorB.x,this.anchorB.y]:t.worldAnchorB=[this.anchorB.x,this.anchorB.y],this.restLength>0&&(t.restLength=this.restLength),this.spring=new p2.LinearSpring(this.bodyA,this.bodyB,t),this.bodyA.world.addSpring(this.spring)},P2LinearSpring.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createSpring();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createSpring()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createSpring()})),this.on("attr:anchorA",(function(t,i){this.spring&&(0===this.anchorASpace?(this.spring.localAnchorA[0]=t.x,this.spring.localAnchorA[1]=t.y):(this.spring.worldAnchorA[0]=t.x,this.spring.worldAnchorA[1]=t.y))})),this.on("attr:anchorASpace",(function(t,i){this.spring&&(0===t?(this.spring.localAnchorA[0]=this.anchorA.x,this.spring.localAnchorA[1]=this.anchorA.y):(this.spring.worldAnchorA[0]=this.anchorA.x,this.spring.worldAnchorA[1]=this.anchorA.y))})),this.on("attr:anchorB",(function(t,i){this.spring&&(0===this.anchorBSpace?(this.spring.localAnchorB[0]=t.x,this.spring.localAnchorB[1]=t.y):(this.spring.worldAnchorB[0]=t.x,this.spring.worldAnchorB[1]=t.y))})),this.on("attr:anchorBSpace",(function(t,i){this.spring&&(0===t?(this.spring.localAnchorB[0]=this.anchorB.x,this.spring.localAnchorB[1]=this.anchorB.y):(this.spring.worldAnchorB[0]=this.anchorB.x,this.spring.worldAnchorB[1]=this.anchorB.y))})),this.on("attr:damping",(function(t,i){this.spring&&(this.spring.damping=t)})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createSpring()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createSpring()}))})),this.on("attr:restLength",(function(t,i){this.spring&&(this.spring.restLength=t)})),this.on("attr:stiffness",(function(t,i){this.spring&&(this.spring.stiffness=t)}))};var P2RotationalSpring=pc.createScript("p2RotationalSpring");P2RotationalSpring.attributes.add("entityA",{type:"entity",title:"Entity A",description:"First connected entity."}),P2RotationalSpring.attributes.add("entityB",{type:"entity",title:"Entity B",description:"Second connected entity."}),P2RotationalSpring.attributes.add("stiffness",{type:"number",default:100,title:"Stiffness",description:"Stiffness of the spring. See Hookes Law."}),P2RotationalSpring.attributes.add("damping",{type:"number",default:1,title:"Damping",description:"Damping of the spring."}),P2RotationalSpring.prototype.createSpring=function(){this.spring&&this.bodyA.world.removeSpring(this.spring);var t={damping:this.damping,stiffness:this.stiffness};this.spring=new p2.RotationalSpring(this.bodyA,this.bodyB,t),this.bodyA.world.addSpring(this.spring)},P2RotationalSpring.prototype.postInitialize=function(){this.bodyA=null,this.bodyB=null,this.entityA&&this.entityA.script&&this.entityA.script.p2Body&&(this.bodyA=this.entityA.script.p2Body.body),this.entityB&&this.entityB.script&&this.entityB.script.p2Body&&(this.bodyB=this.entityB.script.p2Body.body),this.bodyA&&this.bodyB&&this.createSpring();var t=this;this.entityA&&this.entityA.on("p2:newBody",(function(i){t.bodyA=i,t.bodyB&&t.createSpring()})),this.entityB&&this.entityB.on("p2:newBody",(function(i){t.bodyB=i,t.bodyA&&t.createSpring()})),this.on("attr:damping",(function(t,i){this.spring&&(this.spring.damping=t)})),this.on("attr:entityA",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyA=t,this.bodyB&&this.createSpring()}))})),this.on("attr:entityB",(function(t,i){i.off("p2:newBody"),t.on("p2:newBody",(function(t){this.bodyB=t,this.bodyA&&this.createSpring()}))})),this.on("attr:stiffness",(function(t,i){this.spring&&(this.spring.stiffness=t)}))};var P2TopDownVehicle=pc.createScript("p2TopDownVehicle");P2TopDownVehicle.attributes.add("engineForce",{type:"number",default:7,title:"Engine Force",description:"The force to apply to the back wheel."}),P2TopDownVehicle.attributes.add("reverseForce",{type:"number",default:-2,title:"Reverse Force",description:"The force to apply to the back wheel when reversing."}),P2TopDownVehicle.attributes.add("brakeForce",{type:"number",default:5,title:"Brake Force",description:"The force to apply to the back wheel when braking."}),P2TopDownVehicle.attributes.add("maxSteer",{type:"number",default:45,title:"Max Steer",description:"The maximum steer angle in degrees.",placeholder:"degrees"}),P2TopDownVehicle.attributes.add("frontWheelOffset",{type:"vec2",default:[0,1],title:"Front Offset",description:"The offset in local body coordinates of the front wheel.",placeholder:["X","Y"]}),P2TopDownVehicle.attributes.add("frontWheelFriction",{type:"number",default:4,title:"Front Friction",description:"The side friction to apply to the front wheel."}),P2TopDownVehicle.attributes.add("backWheelOffset",{type:"vec2",default:[0,-1],title:"Back Offset",description:"The offset in local body coordinates of the back wheel.",placeholder:["X","Y"]}),P2TopDownVehicle.attributes.add("backWheelFriction",{type:"number",default:3,title:"Back Friction",description:"The side friction to apply to the back wheel."}),P2TopDownVehicle.prototype.createVehicle=function(){var t=this.entity.script.p2Body.body;this.vehicle&&this.vehicle.removeFromWorld(t.world),this.vehicle=new p2.TopDownVehicle(t),this.frontWheel=this.vehicle.addWheel({localPosition:[this.frontWheelOffset.x,this.frontWheelOffset.y]}),this.frontWheel.setSideFriction(this.frontWheelFriction),this.backWheel=this.vehicle.addWheel({localPosition:[this.backWheelOffset.x,this.backWheelOffset.y]}),this.backWheel.setSideFriction(this.backWheelFriction),this.vehicle.addToWorld(t.world)},P2TopDownVehicle.prototype.postInitialize=function(){this.steering=0,this.throttle=!1,this.brake=!1,this.entity.script.p2Body.body&&this.createVehicle();var t=this;this.entity.on("p2:newBody",(function(i){t.createVehicle()})),this.on("attr:frontWheelFriction",(function(t,i){this.vehicle&&this.frontWheel.setSideFriction(t)})),this.on("attr:frontWheelOffset",(function(t,i){this.vehicle&&(this.frontWheel.localPosition[0]=t.x,this.frontWheel.localPosition[1]=t.y)})),this.on("attr:backWheelFriction",(function(t,i){this.vehicle&&this.backWheel.setSideFriction(t)})),this.on("attr:backWheelOffset",(function(t,i){this.vehicle&&(this.backWheel.localPosition[0]=t.x,this.backWheel.localPosition[1]=t.y)})),this.on("enable",(function(){this.vehicle&&this.entity.script&&this.entity.script.p2Body&&this.entity.script.p2Body.body&&this.vehicle.addToWorld(this.entity.script.p2Body.body.world)})),this.on("disable",(function(){this.vehicle&&this.entity.script&&this.entity.script.p2Body&&this.entity.script.p2Body.body&&this.vehicle.removeFromWorld(this.entity.script.p2Body.body.world)}))},P2TopDownVehicle.prototype.update=function(t){this.vehicle&&(this.frontWheel.steerValue=this.steering*this.maxSteer/180*Math.PI,this.backWheel.engineForce=this.throttle?this.engineForce:0,this.backWheel.setBrakeForce(0),this.brake&&(this.backWheel.getSpeed()>.1?this.backWheel.setBrakeForce(this.brakeForce):(this.backWheel.setBrakeForce(0),this.backWheel.engineForce=this.reverseForce)))};// p2.min.js
/**
 * The MIT License (MIT)
 *
 * Copyright (c) 2015 p2.js authors
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(a){if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&false)define(a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.p2=a()}}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(){}var e=a("./Scalar");b.exports=d,d.lineInt=function(a,b,c){c=c||0;var d,f,g,h,i,j,k,l=[0,0];return d=a[1][1]-a[0][1],f=a[0][0]-a[1][0],g=d*a[0][0]+f*a[0][1],h=b[1][1]-b[0][1],i=b[0][0]-b[1][0],j=h*b[0][0]+i*b[0][1],k=d*i-h*f,e.eq(k,0,c)||(l[0]=(i*g-f*j)/k,l[1]=(d*j-h*g)/k),l},d.segmentsIntersect=function(a,b,c,d){var e=b[0]-a[0],f=b[1]-a[1],g=d[0]-c[0],h=d[1]-c[1];if(g*f-h*e==0)return!1;var i=(e*(c[1]-a[1])+f*(a[0]-c[0]))/(g*f-h*e),j=(g*(a[1]-c[1])+h*(c[0]-a[0]))/(h*e-g*f);return i>=0&&1>=i&&j>=0&&1>=j}},{"./Scalar":4}],2:[function(a,b,c){function d(){}b.exports=d,d.area=function(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1])},d.left=function(a,b,c){return d.area(a,b,c)>0},d.leftOn=function(a,b,c){return d.area(a,b,c)>=0},d.right=function(a,b,c){return d.area(a,b,c)<0},d.rightOn=function(a,b,c){return d.area(a,b,c)<=0};var e=[],f=[];d.collinear=function(a,b,c,g){if(g){var h=e,i=f;h[0]=b[0]-a[0],h[1]=b[1]-a[1],i[0]=c[0]-b[0],i[1]=c[1]-b[1];var j=h[0]*i[0]+h[1]*i[1],k=Math.sqrt(h[0]*h[0]+h[1]*h[1]),l=Math.sqrt(i[0]*i[0]+i[1]*i[1]),m=Math.acos(j/(k*l));return g>m}return 0==d.area(a,b,c)},d.sqdist=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d}},{}],3:[function(a,b,c){function d(){this.vertices=[]}function e(a,b,c,d,e){e=e||0;var f=b[1]-a[1],g=a[0]-b[0],i=f*a[0]+g*a[1],j=d[1]-c[1],k=c[0]-d[0],l=j*c[0]+k*c[1],m=f*k-j*g;return h.eq(m,0,e)?[0,0]:[(k*i-g*l)/m,(f*l-j*i)/m]}var f=a("./Line"),g=a("./Point"),h=a("./Scalar");b.exports=d,d.prototype.at=function(a){var b=this.vertices,c=b.length;return b[0>a?a%c+c:a%c]},d.prototype.first=function(){return this.vertices[0]},d.prototype.last=function(){return this.vertices[this.vertices.length-1]},d.prototype.clear=function(){this.vertices.length=0},d.prototype.append=function(a,b,c){if("undefined"==typeof b)throw new Error("From is not given!");if("undefined"==typeof c)throw new Error("To is not given!");if(b>c-1)throw new Error("lol1");if(c>a.vertices.length)throw new Error("lol2");if(0>b)throw new Error("lol3");for(var d=b;c>d;d++)this.vertices.push(a.vertices[d])},d.prototype.makeCCW=function(){for(var a=0,b=this.vertices,c=1;c<this.vertices.length;++c)(b[c][1]<b[a][1]||b[c][1]==b[a][1]&&b[c][0]>b[a][0])&&(a=c);g.left(this.at(a-1),this.at(a),this.at(a+1))||this.reverse()},d.prototype.reverse=function(){for(var a=[],b=0,c=this.vertices.length;b!==c;b++)a.push(this.vertices.pop());this.vertices=a},d.prototype.isReflex=function(a){return g.right(this.at(a-1),this.at(a),this.at(a+1))};var i=[],j=[];d.prototype.canSee=function(a,b){var c,d,e=i,h=j;if(g.leftOn(this.at(a+1),this.at(a),this.at(b))&&g.rightOn(this.at(a-1),this.at(a),this.at(b)))return!1;d=g.sqdist(this.at(a),this.at(b));for(var k=0;k!==this.vertices.length;++k)if((k+1)%this.vertices.length!==a&&k!==a&&g.leftOn(this.at(a),this.at(b),this.at(k+1))&&g.rightOn(this.at(a),this.at(b),this.at(k))&&(e[0]=this.at(a),e[1]=this.at(b),h[0]=this.at(k),h[1]=this.at(k+1),c=f.lineInt(e,h),g.sqdist(this.at(a),c)<d))return!1;return!0},d.prototype.copy=function(a,b,c){var e=c||new d;if(e.clear(),b>a)for(var f=a;b>=f;f++)e.vertices.push(this.vertices[f]);else{for(var f=0;b>=f;f++)e.vertices.push(this.vertices[f]);for(var f=a;f<this.vertices.length;f++)e.vertices.push(this.vertices[f])}return e},d.prototype.getCutEdges=function(){for(var a=[],b=[],c=[],e=new d,f=Number.MAX_VALUE,g=0;g<this.vertices.length;++g)if(this.isReflex(g))for(var h=0;h<this.vertices.length;++h)if(this.canSee(g,h)){b=this.copy(g,h,e).getCutEdges(),c=this.copy(h,g,e).getCutEdges();for(var i=0;i<c.length;i++)b.push(c[i]);b.length<f&&(a=b,f=b.length,a.push([this.at(g),this.at(h)]))}return a},d.prototype.decomp=function(){var a=this.getCutEdges();return a.length>0?this.slice(a):[this]},d.prototype.slice=function(a){if(0==a.length)return[this];if(a instanceof Array&&a.length&&a[0]instanceof Array&&2==a[0].length&&a[0][0]instanceof Array){for(var b=[this],c=0;c<a.length;c++)for(var d=a[c],e=0;e<b.length;e++){var f=b[e],g=f.slice(d);if(g){b.splice(e,1),b.push(g[0],g[1]);break}}return b}var d=a,c=this.vertices.indexOf(d[0]),e=this.vertices.indexOf(d[1]);return-1!=c&&-1!=e?[this.copy(c,e),this.copy(e,c)]:!1},d.prototype.isSimple=function(){for(var a=this.vertices,b=0;b<a.length-1;b++)for(var c=0;b-1>c;c++)if(f.segmentsIntersect(a[b],a[b+1],a[c],a[c+1]))return!1;for(var b=1;b<a.length-2;b++)if(f.segmentsIntersect(a[0],a[a.length-1],a[b],a[b+1]))return!1;return!0},d.prototype.quickDecomp=function(a,b,c,f,h,i){h=h||100,i=i||0,f=f||25,a="undefined"!=typeof a?a:[],b=b||[],c=c||[];var j=[0,0],k=[0,0],l=[0,0],m=0,n=0,o=0,p=0,q=0,r=0,s=0,t=new d,u=new d,v=this,w=this.vertices;if(w.length<3)return a;if(i++,i>h)return console.warn("quickDecomp: max level ("+h+") reached."),a;for(var x=0;x<this.vertices.length;++x)if(v.isReflex(x)){b.push(v.vertices[x]),m=n=Number.MAX_VALUE;for(var y=0;y<this.vertices.length;++y)g.left(v.at(x-1),v.at(x),v.at(y))&&g.rightOn(v.at(x-1),v.at(x),v.at(y-1))&&(l=e(v.at(x-1),v.at(x),v.at(y),v.at(y-1)),g.right(v.at(x+1),v.at(x),l)&&(o=g.sqdist(v.vertices[x],l),n>o&&(n=o,k=l,r=y))),g.left(v.at(x+1),v.at(x),v.at(y+1))&&g.rightOn(v.at(x+1),v.at(x),v.at(y))&&(l=e(v.at(x+1),v.at(x),v.at(y),v.at(y+1)),g.left(v.at(x-1),v.at(x),l)&&(o=g.sqdist(v.vertices[x],l),m>o&&(m=o,j=l,q=y)));if(r==(q+1)%this.vertices.length)l[0]=(k[0]+j[0])/2,l[1]=(k[1]+j[1])/2,c.push(l),q>x?(t.append(v,x,q+1),t.vertices.push(l),u.vertices.push(l),0!=r&&u.append(v,r,v.vertices.length),u.append(v,0,x+1)):(0!=x&&t.append(v,x,v.vertices.length),t.append(v,0,q+1),t.vertices.push(l),u.vertices.push(l),u.append(v,r,x+1));else{if(r>q&&(q+=this.vertices.length),p=Number.MAX_VALUE,r>q)return a;for(var y=r;q>=y;++y)g.leftOn(v.at(x-1),v.at(x),v.at(y))&&g.rightOn(v.at(x+1),v.at(x),v.at(y))&&(o=g.sqdist(v.at(x),v.at(y)),p>o&&(p=o,s=y%this.vertices.length));s>x?(t.append(v,x,s+1),0!=s&&u.append(v,s,w.length),u.append(v,0,x+1)):(0!=x&&t.append(v,x,w.length),t.append(v,0,s+1),u.append(v,s,x+1))}return t.vertices.length<u.vertices.length?(t.quickDecomp(a,b,c,f,h,i),u.quickDecomp(a,b,c,f,h,i)):(u.quickDecomp(a,b,c,f,h,i),t.quickDecomp(a,b,c,f,h,i)),a}return a.push(this),a},d.prototype.removeCollinearPoints=function(a){for(var b=0,c=this.vertices.length-1;this.vertices.length>3&&c>=0;--c)g.collinear(this.at(c-1),this.at(c),this.at(c+1),a)&&(this.vertices.splice(c%this.vertices.length,1),c--,b++);return b}},{"./Line":1,"./Point":2,"./Scalar":4}],4:[function(a,b,c){function d(){}b.exports=d,d.eq=function(a,b,c){return c=c||0,Math.abs(a-b)<c}},{}],5:[function(a,b,c){b.exports={Polygon:a("./Polygon"),Point:a("./Point")}},{"./Point":2,"./Polygon":3}],6:[function(a,b,c){b.exports={name:"p2",version:"0.7.1",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"^0.4.5","grunt-contrib-jshint":"^0.11.2","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.1"}}},{}],7:[function(a,b,c){function d(a){this.lowerBound=e.create(),a&&a.lowerBound&&e.copy(this.lowerBound,a.lowerBound),this.upperBound=e.create(),a&&a.upperBound&&e.copy(this.upperBound,a.upperBound)}var e=a("../math/vec2");a("../utils/Utils");b.exports=d;var f=e.create();d.prototype.setFromPoints=function(a,b,c,d){var g=this.lowerBound,h=this.upperBound;"number"!=typeof c&&(c=0),0!==c?e.rotate(g,a[0],c):e.copy(g,a[0]),e.copy(h,g);for(var i=Math.cos(c),j=Math.sin(c),k=1;k<a.length;k++){var l=a[k];if(0!==c){var m=l[0],n=l[1];f[0]=i*m-j*n,f[1]=j*m+i*n,l=f}for(var o=0;2>o;o++)l[o]>h[o]&&(h[o]=l[o]),l[o]<g[o]&&(g[o]=l[o])}b&&(e.add(this.lowerBound,this.lowerBound,b),e.add(this.upperBound,this.upperBound,b)),d&&(this.lowerBound[0]-=d,this.lowerBound[1]-=d,this.upperBound[0]+=d,this.upperBound[1]+=d)},d.prototype.copy=function(a){e.copy(this.lowerBound,a.lowerBound),e.copy(this.upperBound,a.upperBound)},d.prototype.extend=function(a){for(var b=2;b--;){var c=a.lowerBound[b];this.lowerBound[b]>c&&(this.lowerBound[b]=c);var d=a.upperBound[b];this.upperBound[b]<d&&(this.upperBound[b]=d)}},d.prototype.overlaps=function(a){var b=this.lowerBound,c=this.upperBound,d=a.lowerBound,e=a.upperBound;return(d[0]<=c[0]&&c[0]<=e[0]||b[0]<=e[0]&&e[0]<=c[0])&&(d[1]<=c[1]&&c[1]<=e[1]||b[1]<=e[1]&&e[1]<=c[1])},d.prototype.containsPoint=function(a){var b=this.lowerBound,c=this.upperBound;return b[0]<=a[0]&&a[0]<=c[0]&&b[1]<=a[1]&&a[1]<=c[1]},d.prototype.overlapsRay=function(a){var b=1/a.direction[0],c=1/a.direction[1],d=(this.lowerBound[0]-a.from[0])*b,e=(this.upperBound[0]-a.from[0])*b,f=(this.lowerBound[1]-a.from[1])*c,g=(this.upperBound[1]-a.from[1])*c,h=Math.max(Math.max(Math.min(d,e),Math.min(f,g))),i=Math.min(Math.min(Math.max(d,e),Math.max(f,g)));return 0>i?-1:h>i?-1:h}},{"../math/vec2":30,"../utils/Utils":57}],8:[function(a,b,c){function d(a){this.type=a,this.result=[],this.world=null,this.boundingVolumeType=d.AABB}var e=a("../math/vec2"),f=a("../objects/Body");b.exports=d,d.AABB=1,d.BOUNDING_CIRCLE=2,d.prototype.setWorld=function(a){this.world=a},d.prototype.getCollisionPairs=function(a){};var g=e.create();d.boundingRadiusCheck=function(a,b){e.sub(g,a.position,b.position);var c=e.squaredLength(g),d=a.boundingRadius+b.boundingRadius;return d*d>=c},d.aabbCheck=function(a,b){return a.getAABB().overlaps(b.getAABB())},d.prototype.boundingVolumeCheck=function(a,b){var c;switch(this.boundingVolumeType){case d.BOUNDING_CIRCLE:c=d.boundingRadiusCheck(a,b);break;case d.AABB:c=d.aabbCheck(a,b);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType)}return c},d.canCollide=function(a,b){var c=f.KINEMATIC,d=f.STATIC;return a.type===d&&b.type===d?!1:a.type===c&&b.type===d||a.type===d&&b.type===c?!1:a.type===c&&b.type===c?!1:a.sleepState===f.SLEEPING&&b.sleepState===f.SLEEPING?!1:a.sleepState===f.SLEEPING&&b.type===d||b.sleepState===f.SLEEPING&&a.type===d?!1:!0},d.NAIVE=1,d.SAP=2},{"../math/vec2":30,"../objects/Body":31}],9:[function(a,b,c){function d(){e.call(this,e.NAIVE)}var e=(a("../shapes/Circle"),a("../shapes/Plane"),a("../shapes/Shape"),a("../shapes/Particle"),a("../collision/Broadphase"));a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.getCollisionPairs=function(a){var b=a.bodies,c=this.result;c.length=0;for(var d=0,f=b.length;d!==f;d++)for(var g=b[d],h=0;d>h;h++){var i=b[h];e.canCollide(g,i)&&this.boundingVolumeCheck(g,i)&&c.push(g,i)}return c},d.prototype.aabbQuery=function(a,b,c){c=c||[];for(var d=a.bodies,e=0;e<d.length;e++){var f=d[e];f.aabbNeedsUpdate&&f.updateAABB(),f.aabb.overlaps(b)&&c.push(f)}return c}},{"../collision/Broadphase":8,"../math/vec2":30,"../shapes/Circle":39,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45}],10:[function(a,b,c){function d(){this.contactEquations=[],this.frictionEquations=[],this.enableFriction=!0,this.enabledEquations=!0,this.slipForce=10,this.frictionCoefficient=.3,this.surfaceVelocity=0,this.contactEquationPool=new k({size:32}),this.frictionEquationPool=new l({size:64}),this.restitution=0,this.stiffness=n.DEFAULT_STIFFNESS,this.relaxation=n.DEFAULT_RELAXATION,this.frictionStiffness=n.DEFAULT_STIFFNESS,this.frictionRelaxation=n.DEFAULT_RELAXATION,this.enableFrictionReduction=!0,this.collidingBodiesLastStep=new m,this.contactSkinSize=.01}function e(a,b){g.set(a.vertices[0],.5*-b.length,-b.radius),g.set(a.vertices[1],.5*b.length,-b.radius),g.set(a.vertices[2],.5*b.length,b.radius),g.set(a.vertices[3],.5*-b.length,b.radius)}function f(a,b,c,d){for(var e=T,f=U,j=V,k=W,l=a,m=b.vertices,n=null,o=0;o!==m.length+1;o++){var p=m[o%m.length],q=m[(o+1)%m.length];g.rotate(e,p,d),g.rotate(f,q,d),i(e,e,c),i(f,f,c),h(j,e,l),h(k,f,l);var r=g.crossLength(j,k);if(null===n&&(n=r),0>=r*n)return!1;n=r}return!0}var g=a("../math/vec2"),h=g.sub,i=g.add,j=g.dot,k=(a("../utils/Utils"),a("../utils/ContactEquationPool")),l=a("../utils/FrictionEquationPool"),m=a("../utils/TupleDictionary"),n=a("../equations/Equation"),o=(a("../equations/ContactEquation"),a("../equations/FrictionEquation"),a("../shapes/Circle")),p=a("../shapes/Convex"),q=a("../shapes/Shape"),r=(a("../objects/Body"),a("../shapes/Box"));b.exports=d;var s=g.fromValues(0,1),t=g.fromValues(0,0),u=g.fromValues(0,0),v=g.fromValues(0,0),w=g.fromValues(0,0),x=g.fromValues(0,0),y=g.fromValues(0,0),z=g.fromValues(0,0),A=g.fromValues(0,0),B=g.fromValues(0,0),C=g.fromValues(0,0),D=g.fromValues(0,0),E=g.fromValues(0,0),F=g.fromValues(0,0),G=g.fromValues(0,0),H=g.fromValues(0,0),I=g.fromValues(0,0),J=g.fromValues(0,0),K=g.fromValues(0,0),L=[],M=g.create(),N=g.create();d.prototype.bodiesOverlap=function(a,b){for(var c=M,d=N,e=0,f=a.shapes.length;e!==f;e++){var g=a.shapes[e];a.toWorldFrame(c,g.position);for(var h=0,i=b.shapes.length;h!==i;h++){var j=b.shapes[h];if(b.toWorldFrame(d,j.position),this[g.type|j.type](a,g,c,g.angle+a.angle,b,j,d,j.angle+b.angle,!0))return!0}}return!1},d.prototype.collidedLastStep=function(a,b){var c=0|a.id,d=0|b.id;return!!this.collidingBodiesLastStep.get(c,d)},d.prototype.reset=function(){this.collidingBodiesLastStep.reset();for(var a=this.contactEquations,b=a.length;b--;){var c=a[b],d=c.bodyA.id,e=c.bodyB.id;this.collidingBodiesLastStep.set(d,e,!0)}for(var f=this.contactEquations,g=this.frictionEquations,h=0;h<f.length;h++)this.contactEquationPool.release(f[h]);for(var h=0;h<g.length;h++)this.frictionEquationPool.release(g[h]);this.contactEquations.length=this.frictionEquations.length=0},d.prototype.createContactEquation=function(a,b,c,d){var e=this.contactEquationPool.get();return e.bodyA=a,e.bodyB=b,e.shapeA=c,e.shapeB=d,e.restitution=this.restitution,e.firstImpact=!this.collidedLastStep(a,b),e.stiffness=this.stiffness,e.relaxation=this.relaxation,e.needsUpdate=!0,e.enabled=this.enabledEquations,e.offset=this.contactSkinSize,e},d.prototype.createFrictionEquation=function(a,b,c,d){var e=this.frictionEquationPool.get();return e.bodyA=a,e.bodyB=b,e.shapeA=c,e.shapeB=d,e.setSlipForce(this.slipForce),e.frictionCoefficient=this.frictionCoefficient,e.relativeVelocity=this.surfaceVelocity,e.enabled=this.enabledEquations,e.needsUpdate=!0,e.stiffness=this.frictionStiffness,e.relaxation=this.frictionRelaxation,e.contactEquations.length=0,e},d.prototype.createFrictionFromContact=function(a){var b=this.createFrictionEquation(a.bodyA,a.bodyB,a.shapeA,a.shapeB);return g.copy(b.contactPointA,a.contactPointA),g.copy(b.contactPointB,a.contactPointB),g.rotate90cw(b.t,a.normalA),b.contactEquations.push(a),b},d.prototype.createFrictionFromAverage=function(a){var b=this.contactEquations[this.contactEquations.length-1],c=this.createFrictionEquation(b.bodyA,b.bodyB,b.shapeA,b.shapeB),d=b.bodyA;b.bodyB;g.set(c.contactPointA,0,0),g.set(c.contactPointB,0,0),g.set(c.t,0,0);for(var e=0;e!==a;e++)b=this.contactEquations[this.contactEquations.length-1-e],b.bodyA===d?(g.add(c.t,c.t,b.normalA),g.add(c.contactPointA,c.contactPointA,b.contactPointA),g.add(c.contactPointB,c.contactPointB,b.contactPointB)):(g.sub(c.t,c.t,b.normalA),g.add(c.contactPointA,c.contactPointA,b.contactPointB),g.add(c.contactPointB,c.contactPointB,b.contactPointA)),c.contactEquations.push(b);var f=1/a;return g.scale(c.contactPointA,c.contactPointA,f),g.scale(c.contactPointB,c.contactPointB,f),g.normalize(c.t,c.t),g.rotate90cw(c.t,c.t),c},d.prototype[q.LINE|q.CONVEX]=d.prototype.convexLine=function(a,b,c,d,e,f,g,h,i){return i?!1:0},d.prototype[q.LINE|q.BOX]=d.prototype.lineBox=function(a,b,c,d,e,f,g,h,i){return i?!1:0};var O=new r({width:1,height:1}),P=g.create();d.prototype[q.CAPSULE|q.CONVEX]=d.prototype[q.CAPSULE|q.BOX]=d.prototype.convexCapsule=function(a,b,c,d,f,h,i,j,k){var l=P;g.set(l,h.length/2,0),g.rotate(l,l,j),g.add(l,l,i);var m=this.circleConvex(f,h,l,j,a,b,c,d,k,h.radius);g.set(l,-h.length/2,0),g.rotate(l,l,j),g.add(l,l,i);var n=this.circleConvex(f,h,l,j,a,b,c,d,k,h.radius);if(k&&(m||n))return!0;var o=O;e(o,h);var p=this.convexConvex(a,b,c,d,f,o,i,j,k);return p+m+n},d.prototype[q.CAPSULE|q.LINE]=d.prototype.lineCapsule=function(a,b,c,d,e,f,g,h,i){return i?!1:0};var Q=g.create(),R=g.create(),S=new r({width:1,height:1});d.prototype[q.CAPSULE|q.CAPSULE]=d.prototype.capsuleCapsule=function(a,b,c,d,f,h,i,j,k){for(var l,m=Q,n=R,o=0,p=0;2>p;p++){g.set(m,(0===p?-1:1)*b.length/2,0),g.rotate(m,m,d),g.add(m,m,c);for(var q=0;2>q;q++){g.set(n,(0===q?-1:1)*h.length/2,0),g.rotate(n,n,j),g.add(n,n,i),this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var r=this.circleCircle(a,b,m,d,f,h,n,j,k,b.radius,h.radius);if(this.enableFrictionReduction&&(this.enableFriction=l),k&&r)return!0;o+=r}}this.enableFrictionReduction&&(l=this.enableFriction,this.enableFriction=!1);var s=S;e(s,b);var t=this.convexCapsule(a,s,c,d,f,h,i,j,k);if(this.enableFrictionReduction&&(this.enableFriction=l),k&&t)return!0;if(o+=t,this.enableFrictionReduction){var l=this.enableFriction;this.enableFriction=!1}e(s,h);var u=this.convexCapsule(f,s,i,j,a,b,c,d,k);return this.enableFrictionReduction&&(this.enableFriction=l),k&&u?!0:(o+=u,this.enableFrictionReduction&&o&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(o)),o)},d.prototype[q.LINE|q.LINE]=d.prototype.lineLine=function(a,b,c,d,e,f,g,h,i){return i?!1:0},d.prototype[q.PLANE|q.LINE]=d.prototype.planeLine=function(a,b,c,d,e,f,k,l,m){var n=t,o=u,p=v,q=w,r=x,C=y,D=z,E=A,F=B,G=L,H=0;g.set(n,-f.length/2,0),g.set(o,f.length/2,0),g.rotate(p,n,l),g.rotate(q,o,l),i(p,p,k),i(q,q,k),g.copy(n,p),g.copy(o,q),h(r,o,n),g.normalize(C,r),g.rotate90cw(F,C),g.rotate(E,s,d),G[0]=n,G[1]=o;for(var I=0;I<G.length;I++){var J=G[I];h(D,J,c);var K=j(D,E);if(0>K){if(m)return!0;var M=this.createContactEquation(a,e,b,f);H++,g.copy(M.normalA,E),g.normalize(M.normalA,M.normalA),g.scale(D,E,K),h(M.contactPointA,J,D),h(M.contactPointA,M.contactPointA,a.position),h(M.contactPointB,J,k),i(M.contactPointB,M.contactPointB,k),h(M.contactPointB,M.contactPointB,e.position),this.contactEquations.push(M),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(M))}}return m?!1:(this.enableFrictionReduction||H&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(H)),H)},d.prototype[q.PARTICLE|q.CAPSULE]=d.prototype.particleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius,0)},d.prototype[q.CIRCLE|q.LINE]=d.prototype.circleLine=function(a,b,c,d,e,f,k,l,m,n,o){var n=n||0,o="undefined"!=typeof o?o:b.radius,p=t,q=u,r=v,s=w,H=x,I=y,J=z,K=A,M=B,N=C,O=D,P=E,Q=F,R=G,S=L;g.set(K,-f.length/2,0),g.set(M,f.length/2,0),g.rotate(N,K,l),g.rotate(O,M,l),i(N,N,k),i(O,O,k),g.copy(K,N),g.copy(M,O),h(I,M,K),g.normalize(J,I),g.rotate90cw(H,J),h(P,c,K);var T=j(P,H);h(s,K,k),h(Q,c,k);var U=o+n;if(Math.abs(T)<U){g.scale(p,H,T),h(r,c,p),g.scale(q,H,j(H,Q)),g.normalize(q,q),g.scale(q,q,n),i(r,r,q);var V=j(J,r),W=j(J,K),X=j(J,M);if(V>W&&X>V){if(m)return!0;var Y=this.createContactEquation(a,e,b,f);return g.scale(Y.normalA,p,-1),g.normalize(Y.normalA,Y.normalA),g.scale(Y.contactPointA,Y.normalA,o),i(Y.contactPointA,Y.contactPointA,c),h(Y.contactPointA,Y.contactPointA,a.position),h(Y.contactPointB,r,k),i(Y.contactPointB,Y.contactPointB,k),h(Y.contactPointB,Y.contactPointB,e.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1}}S[0]=K,S[1]=M;for(var Z=0;Z<S.length;Z++){var $=S[Z];if(h(P,$,c),g.squaredLength(P)<Math.pow(U,2)){if(m)return!0;var Y=this.createContactEquation(a,e,b,f);return g.copy(Y.normalA,P),g.normalize(Y.normalA,Y.normalA),g.scale(Y.contactPointA,Y.normalA,o),i(Y.contactPointA,Y.contactPointA,c),h(Y.contactPointA,Y.contactPointA,a.position),h(Y.contactPointB,$,k),g.scale(R,Y.normalA,-n),i(Y.contactPointB,Y.contactPointB,R),i(Y.contactPointB,Y.contactPointB,k),h(Y.contactPointB,Y.contactPointB,e.position),this.contactEquations.push(Y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(Y)),1}}return 0},d.prototype[q.CIRCLE|q.CAPSULE]=d.prototype.circleCapsule=function(a,b,c,d,e,f,g,h,i){return this.circleLine(a,b,c,d,e,f,g,h,i,f.radius)},d.prototype[q.CIRCLE|q.CONVEX]=d.prototype[q.CIRCLE|q.BOX]=d.prototype.circleConvex=function(a,b,c,d,e,j,k,l,m,n){for(var n="number"==typeof n?n:b.radius,o=t,p=u,q=v,r=w,s=x,y=C,z=D,A=F,B=G,E=H,J=I,K=!1,L=Number.MAX_VALUE,M=j.vertices,N=0;N!==M.length+1;N++){var O=M[N%M.length],P=M[(N+1)%M.length];if(g.rotate(o,O,l),g.rotate(p,P,l),i(o,o,k),i(p,p,k),h(q,p,o),g.normalize(r,q),g.rotate90cw(s,r),g.scale(B,s,-b.radius),i(B,B,c),f(B,j,k,l)){g.sub(E,o,B);var Q=Math.abs(g.dot(E,s));L>Q&&(g.copy(J,B),L=Q,g.scale(A,s,Q),g.add(A,A,B),K=!0)}}if(K){if(m)return!0;var R=this.createContactEquation(a,e,b,j);return g.sub(R.normalA,J,c),g.normalize(R.normalA,R.normalA),g.scale(R.contactPointA,R.normalA,n),i(R.contactPointA,R.contactPointA,c),h(R.contactPointA,R.contactPointA,a.position),h(R.contactPointB,A,k),i(R.contactPointB,R.contactPointB,k),h(R.contactPointB,R.contactPointB,e.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R)),1}if(n>0)for(var N=0;N<M.length;N++){var S=M[N];if(g.rotate(z,S,l),i(z,z,k),h(y,z,c),g.squaredLength(y)<Math.pow(n,2)){if(m)return!0;var R=this.createContactEquation(a,e,b,j);return g.copy(R.normalA,y),g.normalize(R.normalA,R.normalA),g.scale(R.contactPointA,R.normalA,n),i(R.contactPointA,R.contactPointA,c),h(R.contactPointA,R.contactPointA,a.position),h(R.contactPointB,z,k),i(R.contactPointB,R.contactPointB,k),h(R.contactPointB,R.contactPointB,e.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R)),1}}return 0};var T=g.create(),U=g.create(),V=g.create(),W=g.create();d.prototype[q.PARTICLE|q.CONVEX]=d.prototype[q.PARTICLE|q.BOX]=d.prototype.particleConvex=function(a,b,c,d,e,k,l,m,n){var o=t,p=u,q=v,r=w,s=x,A=y,B=z,D=C,E=F,G=J,H=K,I=Number.MAX_VALUE,L=!1,M=k.vertices;if(!f(c,k,l,m))return 0;if(n)return!0;for(var N=0;N!==M.length+1;N++){var O=M[N%M.length],P=M[(N+1)%M.length];g.rotate(o,O,m),g.rotate(p,P,m),i(o,o,l),i(p,p,l),h(q,p,o),g.normalize(r,q),g.rotate90cw(s,r),h(D,c,o);j(D,s);h(A,o,l),h(B,c,l),g.sub(G,o,c);var Q=Math.abs(g.dot(G,s));I>Q&&(I=Q,g.scale(E,s,Q),g.add(E,E,c),g.copy(H,s),L=!0)}if(L){var R=this.createContactEquation(a,e,b,k);return g.scale(R.normalA,H,-1),g.normalize(R.normalA,R.normalA),g.set(R.contactPointA,0,0),i(R.contactPointA,R.contactPointA,c),h(R.contactPointA,R.contactPointA,a.position),h(R.contactPointB,E,l),i(R.contactPointB,R.contactPointB,l),h(R.contactPointB,R.contactPointB,e.position),this.contactEquations.push(R),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(R)),1}return 0},d.prototype[q.CIRCLE]=d.prototype.circleCircle=function(a,b,c,d,e,f,j,k,l,m,n){var o=t,m=m||b.radius,n=n||f.radius;h(o,c,j);var p=m+n;if(g.squaredLength(o)>Math.pow(p,2))return 0;if(l)return!0;var q=this.createContactEquation(a,e,b,f);return h(q.normalA,j,c),g.normalize(q.normalA,q.normalA),g.scale(q.contactPointA,q.normalA,m),g.scale(q.contactPointB,q.normalA,-n),i(q.contactPointA,q.contactPointA,c),h(q.contactPointA,q.contactPointA,a.position),i(q.contactPointB,q.contactPointB,j),h(q.contactPointB,q.contactPointB,e.position),this.contactEquations.push(q),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(q)),1},d.prototype[q.PLANE|q.CONVEX]=d.prototype[q.PLANE|q.BOX]=d.prototype.planeConvex=function(a,b,c,d,e,f,k,l,m){var n=t,o=u,p=v,q=0;g.rotate(o,s,d);for(var r=0;r!==f.vertices.length;r++){var w=f.vertices[r];if(g.rotate(n,w,l),i(n,n,k),h(p,n,c),j(p,o)<=0){if(m)return!0;q++;var x=this.createContactEquation(a,e,b,f);h(p,n,c),g.copy(x.normalA,o);var y=j(p,x.normalA);g.scale(p,x.normalA,y),h(x.contactPointB,n,e.position),h(x.contactPointA,n,p),h(x.contactPointA,x.contactPointA,a.position),this.contactEquations.push(x),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(x))}}return this.enableFrictionReduction&&this.enableFriction&&q&&this.frictionEquations.push(this.createFrictionFromAverage(q)),q},d.prototype[q.PARTICLE|q.PLANE]=d.prototype.particlePlane=function(a,b,c,d,e,f,i,k,l){var m=t,n=u;k=k||0,h(m,c,i),g.rotate(n,s,k);var o=j(m,n);if(o>0)return 0;if(l)return!0;var p=this.createContactEquation(e,a,f,b);return g.copy(p.normalA,n),g.scale(m,p.normalA,o),h(p.contactPointA,c,m),h(p.contactPointA,p.contactPointA,e.position),h(p.contactPointB,c,a.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1},d.prototype[q.CIRCLE|q.PARTICLE]=d.prototype.circleParticle=function(a,b,c,d,e,f,j,k,l){var m=t;if(h(m,j,c),g.squaredLength(m)>Math.pow(b.radius,2))return 0;if(l)return!0;var n=this.createContactEquation(a,e,b,f);return g.copy(n.normalA,m),g.normalize(n.normalA,n.normalA),g.scale(n.contactPointA,n.normalA,b.radius),i(n.contactPointA,n.contactPointA,c),h(n.contactPointA,n.contactPointA,a.position),h(n.contactPointB,j,e.position),this.contactEquations.push(n),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(n)),1};var X=new o({radius:1}),Y=g.create(),Z=g.create();g.create();d.prototype[q.PLANE|q.CAPSULE]=d.prototype.planeCapsule=function(a,b,c,d,e,f,h,j,k){var l=Y,m=Z,n=X;g.set(l,-f.length/2,0),g.rotate(l,l,j),i(l,l,h),g.set(m,f.length/2,0),g.rotate(m,m,j),i(m,m,h),n.radius=f.radius;var o;this.enableFrictionReduction&&(o=this.enableFriction,this.enableFriction=!1);var p=this.circlePlane(e,n,l,0,a,b,c,d,k),q=this.circlePlane(e,n,m,0,a,b,c,d,k);if(this.enableFrictionReduction&&(this.enableFriction=o),k)return p||q;var r=p+q;return this.enableFrictionReduction&&r&&this.frictionEquations.push(this.createFrictionFromAverage(r)),r},d.prototype[q.CIRCLE|q.PLANE]=d.prototype.circlePlane=function(a,b,c,d,e,f,k,l,m){var n=a,o=b,p=c,q=e,r=k,w=l;w=w||0;var x=t,y=u,z=v;h(x,p,r),g.rotate(y,s,w);var A=j(y,x);if(A>o.radius)return 0;if(m)return!0;var B=this.createContactEquation(q,n,f,b);return g.copy(B.normalA,y),g.scale(B.contactPointB,B.normalA,-o.radius),i(B.contactPointB,B.contactPointB,p),h(B.contactPointB,B.contactPointB,n.position),g.scale(z,B.normalA,A),h(B.contactPointA,x,z),i(B.contactPointA,B.contactPointA,r),h(B.contactPointA,B.contactPointA,q.position),this.contactEquations.push(B),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(B)),1},d.prototype[q.CONVEX]=d.prototype[q.CONVEX|q.BOX]=d.prototype[q.BOX]=d.prototype.convexConvex=function(a,b,c,e,f,k,l,m,n,o){var p=t,q=u,r=v,s=w,y=x,C=z,D=A,E=B,F=0,o="number"==typeof o?o:0,G=d.findSeparatingAxis(b,c,e,k,l,m,p);if(!G)return 0;h(D,l,c),j(p,D)>0&&g.scale(p,p,-1);var H=d.getClosestEdge(b,e,p,!0),I=d.getClosestEdge(k,m,p);if(-1===H||-1===I)return 0;for(var J=0;2>J;J++){var K=H,L=I,M=b,N=k,O=c,P=l,Q=e,R=m,S=a,T=f;if(0===J){var U;U=K,K=L,L=U,U=M,M=N,N=U,U=O,O=P,P=U,U=Q,Q=R,R=U,U=S,S=T,T=U}for(var V=L;L+2>V;V++){var W=N.vertices[(V+N.vertices.length)%N.vertices.length];g.rotate(q,W,R),i(q,q,P);for(var X=0,Y=K-1;K+2>Y;Y++){var Z=M.vertices[(Y+M.vertices.length)%M.vertices.length],$=M.vertices[(Y+1+M.vertices.length)%M.vertices.length];g.rotate(r,Z,Q),g.rotate(s,$,Q),i(r,r,O),i(s,s,O),h(y,s,r),g.rotate90cw(E,y),g.normalize(E,E),h(D,q,r);var _=j(E,D);(Y===K&&o>=_||Y!==K&&0>=_)&&X++}if(X>=3){if(n)return!0;var aa=this.createContactEquation(S,T,M,N);F++;var Z=M.vertices[K%M.vertices.length],$=M.vertices[(K+1)%M.vertices.length];g.rotate(r,Z,Q),g.rotate(s,$,Q),i(r,r,O),i(s,s,O),h(y,s,r),g.rotate90cw(aa.normalA,y),g.normalize(aa.normalA,aa.normalA),h(D,q,r);var _=j(aa.normalA,D);g.scale(C,aa.normalA,_),h(aa.contactPointA,q,O),h(aa.contactPointA,aa.contactPointA,C),i(aa.contactPointA,aa.contactPointA,O),h(aa.contactPointA,aa.contactPointA,S.position),h(aa.contactPointB,q,P),i(aa.contactPointB,aa.contactPointB,P),h(aa.contactPointB,aa.contactPointB,T.position),this.contactEquations.push(aa),this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(aa))}}}return this.enableFrictionReduction&&this.enableFriction&&F&&this.frictionEquations.push(this.createFrictionFromAverage(F)),F};var $=g.fromValues(0,0);d.projectConvexOntoAxis=function(a,b,c,d,e){var f,h,i=null,k=null,l=$;g.rotate(l,d,-c);for(var m=0;m<a.vertices.length;m++)f=a.vertices[m],h=j(f,l),(null===i||h>i)&&(i=h),(null===k||k>h)&&(k=h);if(k>i){var n=k;k=i,i=n}var o=j(b,d);g.set(e,k+o,i+o)};var _=g.fromValues(0,0),aa=g.fromValues(0,0),ba=g.fromValues(0,0),ca=g.fromValues(0,0),da=g.fromValues(0,0),ea=g.fromValues(0,0);d.findSeparatingAxis=function(a,b,c,e,f,i,j){var k=null,l=!1,m=!1,n=_,o=aa,p=ba,q=ca,s=da,t=ea;if(a instanceof r&&e instanceof r)for(var u=0;2!==u;u++){var v=a,w=c;1===u&&(v=e,w=i);for(var x=0;2!==x;x++){0===x?g.set(q,0,1):1===x&&g.set(q,1,0),0!==w&&g.rotate(q,q,w),d.projectConvexOntoAxis(a,b,c,q,s),d.projectConvexOntoAxis(e,f,i,q,t);var y=s,z=t,A=!1;s[0]>t[0]&&(z=s,y=t,A=!0);var B=z[0]-y[1];l=0>=B,(null===k||B>k)&&(g.copy(j,q),k=B,m=l)}}else for(var u=0;2!==u;u++){var v=a,w=c;1===u&&(v=e,w=i);for(var x=0;x!==v.vertices.length;x++){g.rotate(o,v.vertices[x],w),g.rotate(p,v.vertices[(x+1)%v.vertices.length],w),h(n,p,o),g.rotate90cw(q,n),g.normalize(q,q),d.projectConvexOntoAxis(a,b,c,q,s),d.projectConvexOntoAxis(e,f,i,q,t);var y=s,z=t,A=!1;s[0]>t[0]&&(z=s,y=t,A=!0);var B=z[0]-y[1];l=0>=B,(null===k||B>k)&&(g.copy(j,q),k=B,m=l)}}return m};var fa=g.fromValues(0,0),ga=g.fromValues(0,0),ha=g.fromValues(0,0);d.getClosestEdge=function(a,b,c,d){var e=fa,f=ga,i=ha;g.rotate(e,c,-b),d&&g.scale(e,e,-1);for(var k=-1,l=a.vertices.length,m=-1,n=0;n!==l;n++){h(f,a.vertices[(n+1)%l],a.vertices[n%l]),g.rotate90cw(i,f),g.normalize(i,i);var o=j(i,e);(-1===k||o>m)&&(k=n%l,m=o)}return k};var ia=g.create(),ja=g.create(),ka=g.create(),la=g.create(),ma=g.create(),na=g.create(),oa=g.create();d.prototype[q.CIRCLE|q.HEIGHTFIELD]=d.prototype.circleHeightfield=function(a,b,c,d,e,f,j,k,l,m){var n=f.heights,m=m||b.radius,o=f.elementWidth,p=ja,q=ia,r=ma,s=oa,t=na,u=ka,v=la,w=Math.floor((c[0]-m-j[0])/o),x=Math.ceil((c[0]+m-j[0])/o);0>w&&(w=0),x>=n.length&&(x=n.length-1);for(var y=n[w],z=n[x],A=w;x>A;A++)n[A]<z&&(z=n[A]),n[A]>y&&(y=n[A]);if(c[1]-m>y)return l?!1:0;for(var B=!1,A=w;x>A;A++){g.set(u,A*o,n[A]),g.set(v,(A+1)*o,n[A+1]),g.add(u,u,j),g.add(v,v,j),g.sub(t,v,u),g.rotate(t,t,Math.PI/2),g.normalize(t,t),g.scale(q,t,-m),g.add(q,q,c),g.sub(p,q,u);var C=g.dot(p,t);if(q[0]>=u[0]&&q[0]<v[0]&&0>=C){if(l)return!0;B=!0,g.scale(p,t,-C),g.add(r,q,p),g.copy(s,t);var D=this.createContactEquation(e,a,f,b);g.copy(D.normalA,s),g.scale(D.contactPointB,D.normalA,-m),i(D.contactPointB,D.contactPointB,c),h(D.contactPointB,D.contactPointB,a.position),g.copy(D.contactPointA,r),g.sub(D.contactPointA,D.contactPointA,e.position),this.contactEquations.push(D),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}}if(B=!1,m>0)for(var A=w;x>=A;A++)if(g.set(u,A*o,n[A]),g.add(u,u,j),g.sub(p,c,u),g.squaredLength(p)<Math.pow(m,2)){
if(l)return!0;B=!0;var D=this.createContactEquation(e,a,f,b);g.copy(D.normalA,p),g.normalize(D.normalA,D.normalA),g.scale(D.contactPointB,D.normalA,-m),i(D.contactPointB,D.contactPointB,c),h(D.contactPointB,D.contactPointB,a.position),h(D.contactPointA,u,j),i(D.contactPointA,D.contactPointA,j),h(D.contactPointA,D.contactPointA,e.position),this.contactEquations.push(D),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(D))}return B?1:0};var pa=g.create(),qa=g.create(),ra=g.create(),sa=new p({vertices:[g.create(),g.create(),g.create(),g.create()]});d.prototype[q.BOX|q.HEIGHTFIELD]=d.prototype[q.CONVEX|q.HEIGHTFIELD]=d.prototype.convexHeightfield=function(a,b,c,d,e,f,h,i,j){var k=f.heights,l=f.elementWidth,m=pa,n=qa,o=ra,p=sa,q=Math.floor((a.aabb.lowerBound[0]-h[0])/l),r=Math.ceil((a.aabb.upperBound[0]-h[0])/l);0>q&&(q=0),r>=k.length&&(r=k.length-1);for(var s=k[q],t=k[r],u=q;r>u;u++)k[u]<t&&(t=k[u]),k[u]>s&&(s=k[u]);if(a.aabb.lowerBound[1]>s)return j?!1:0;for(var v=0,u=q;r>u;u++){g.set(m,u*l,k[u]),g.set(n,(u+1)*l,k[u+1]),g.add(m,m,h),g.add(n,n,h);var w=100;g.set(o,.5*(n[0]+m[0]),.5*(n[1]+m[1]-w)),g.sub(p.vertices[0],n,o),g.sub(p.vertices[1],m,o),g.copy(p.vertices[2],p.vertices[1]),g.copy(p.vertices[3],p.vertices[0]),p.vertices[2][1]-=w,p.vertices[3][1]-=w,v+=this.convexConvex(a,b,c,d,e,p,o,0,j)}return v}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../shapes/Box":37,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Shape":45,"../utils/ContactEquationPool":48,"../utils/FrictionEquationPool":49,"../utils/TupleDictionary":56,"../utils/Utils":57}],11:[function(a,b,c){function d(a){a=a||{},this.from=a.from?f.fromValues(a.from[0],a.from[1]):f.create(),this.to=a.to?f.fromValues(a.to[0],a.to[1]):f.create(),this.checkCollisionResponse=void 0!==a.checkCollisionResponse?a.checkCollisionResponse:!0,this.skipBackfaces=!!a.skipBackfaces,this.collisionMask=void 0!==a.collisionMask?a.collisionMask:-1,this.collisionGroup=void 0!==a.collisionGroup?a.collisionGroup:-1,this.mode=void 0!==a.mode?a.mode:d.ANY,this.callback=a.callback||function(a){},this.direction=f.create(),this.length=1,this.update()}function e(a,b,c){f.sub(h,c,a);var d=f.dot(h,b);return f.scale(i,b,d),f.add(i,i,a),f.squaredDistance(c,i)}b.exports=d;var f=a("../math/vec2");a("../collision/RaycastResult"),a("../shapes/Shape"),a("../collision/AABB");d.prototype.constructor=d,d.CLOSEST=1,d.ANY=2,d.ALL=4,d.prototype.update=function(){var a=this.direction;f.sub(a,this.to,this.from),this.length=f.length(a),f.normalize(a,a)},d.prototype.intersectBodies=function(a,b){for(var c=0,d=b.length;!a.shouldStop(this)&&d>c;c++){var e=b[c],f=e.getAABB();(f.overlapsRay(this)>=0||f.containsPoint(this.from))&&this.intersectBody(a,e)}};var g=f.create();d.prototype.intersectBody=function(a,b){var c=this.checkCollisionResponse;if(!c||b.collisionResponse)for(var d=g,e=0,h=b.shapes.length;h>e;e++){var i=b.shapes[e];if((!c||i.collisionResponse)&&0!==(this.collisionGroup&i.collisionMask)&&0!==(i.collisionGroup&this.collisionMask)){f.rotate(d,i.position,b.angle),f.add(d,d,b.position);var j=i.angle+b.angle;if(this.intersectShape(a,i,j,d,b),a.shouldStop(this))break}}},d.prototype.intersectShape=function(a,b,c,d,f){var g=this.from,h=e(g,this.direction,d);h>b.boundingRadius*b.boundingRadius||(this._currentBody=f,this._currentShape=b,b.raycast(a,this,d,c),this._currentBody=this._currentShape=null)},d.prototype.getAABB=function(a){var b=this.to,c=this.from;f.set(a.lowerBound,Math.min(b[0],c[0]),Math.min(b[1],c[1])),f.set(a.upperBound,Math.max(b[0],c[0]),Math.max(b[1],c[1]))};f.create();d.prototype.reportIntersection=function(a,b,c,e){var g=(this.from,this.to,this._currentShape),h=this._currentBody;if(!(this.skipBackfaces&&f.dot(c,this.direction)>0))switch(this.mode){case d.ALL:a.set(c,g,h,b,e),this.callback(a);break;case d.CLOSEST:(b<a.fraction||!a.hasHit())&&a.set(c,g,h,b,e);break;case d.ANY:a.set(c,g,h,b,e)}};var h=f.create(),i=f.create()},{"../collision/AABB":7,"../collision/RaycastResult":12,"../math/vec2":30,"../shapes/Shape":45}],12:[function(a,b,c){function d(){this.normal=e.create(),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1}var e=a("../math/vec2"),f=a("../collision/Ray");b.exports=d,d.prototype.reset=function(){e.set(this.normal,0,0),this.shape=null,this.body=null,this.faceIndex=-1,this.fraction=-1,this.isStopped=!1},d.prototype.getHitDistance=function(a){return e.distance(a.from,a.to)*this.fraction},d.prototype.hasHit=function(){return-1!==this.fraction},d.prototype.getHitPoint=function(a,b){e.lerp(a,b.from,b.to,this.fraction)},d.prototype.stop=function(){this.isStopped=!0},d.prototype.shouldStop=function(a){return this.isStopped||-1!==this.fraction&&a.mode===f.ANY},d.prototype.set=function(a,b,c,d,f){e.copy(this.normal,a),this.shape=b,this.body=c,this.fraction=d,this.faceIndex=f}},{"../collision/Ray":11,"../math/vec2":30}],13:[function(a,b,c){function d(){f.call(this,f.SAP),this.axisList=[],this.axisIndex=0;var a=this;this._addBodyHandler=function(b){a.axisList.push(b.body)},this._removeBodyHandler=function(b){var c=a.axisList.indexOf(b.body);-1!==c&&a.axisList.splice(c,1)}}var e=a("../utils/Utils"),f=a("../collision/Broadphase");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.setWorld=function(a){this.axisList.length=0,e.appendArray(this.axisList,a.bodies),a.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler),a.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler),this.world=a},d.sortAxisList=function(a,b){b=0|b;for(var c=1,d=a.length;d>c;c++){for(var e=a[c],f=c-1;f>=0&&!(a[f].aabb.lowerBound[b]<=e.aabb.lowerBound[b]);f--)a[f+1]=a[f];a[f+1]=e}return a},d.prototype.sortList=function(){var a=this.axisList,b=this.axisIndex;d.sortAxisList(a,b)},d.prototype.getCollisionPairs=function(a){var b=this.axisList,c=this.result,d=this.axisIndex;c.length=0;for(var e=b.length;e--;){var g=b[e];g.aabbNeedsUpdate&&g.updateAABB()}this.sortList();for(var h=0,i=0|b.length;h!==i;h++)for(var j=b[h],k=h+1;i>k;k++){var l=b[k],m=l.aabb.lowerBound[d]<=j.aabb.upperBound[d];if(!m)break;f.canCollide(j,l)&&this.boundingVolumeCheck(j,l)&&c.push(j,l)}return c},d.prototype.aabbQuery=function(a,b,c){c=c||[],this.sortList();var d=this.axisIndex,e="x";1===d&&(e="y"),2===d&&(e="z");for(var f=this.axisList,g=(b.lowerBound[e],b.upperBound[e],0);g<f.length;g++){var h=f[g];h.aabbNeedsUpdate&&h.updateAABB(),h.aabb.overlaps(b)&&c.push(h)}return c}},{"../collision/Broadphase":8,"../utils/Utils":57}],14:[function(a,b,c){function d(a,b,c,d){this.type=c,d=e.defaults(d,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=a,this.bodyB=b,this.collideConnected=d.collideConnected,d.wakeUpBodies&&(a&&a.wakeUp(),b&&b.wakeUp())}b.exports=d;var e=a("../utils/Utils");d.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},d.DISTANCE=1,d.GEAR=2,d.LOCK=3,d.PRISMATIC=4,d.REVOLUTE=5,d.prototype.setStiffness=function(a){for(var b=this.equations,c=0;c!==b.length;c++){var d=b[c];d.stiffness=a,d.needsUpdate=!0}},d.prototype.setRelaxation=function(a){for(var b=this.equations,c=0;c!==b.length;c++){var d=b[c];d.relaxation=a,d.needsUpdate=!0}}},{"../utils/Utils":57}],15:[function(a,b,c){function d(a,b,c){c=h.defaults(c,{localAnchorA:[0,0],localAnchorB:[0,0]}),e.call(this,a,b,e.DISTANCE,c),this.localAnchorA=g.fromValues(c.localAnchorA[0],c.localAnchorA[1]),this.localAnchorB=g.fromValues(c.localAnchorB[0],c.localAnchorB[1]);var d=this.localAnchorA,i=this.localAnchorB;if(this.distance=0,"number"==typeof c.distance)this.distance=c.distance;else{var j=g.create(),k=g.create(),l=g.create();g.rotate(j,d,a.angle),g.rotate(k,i,b.angle),g.add(l,b.position,k),g.sub(l,l,j),g.sub(l,l,a.position),this.distance=g.length(l)}var m;m="undefined"==typeof c.maxForce?Number.MAX_VALUE:c.maxForce;var n=new f(a,b,-m,m);this.equations=[n],this.maxForce=m;var l=g.create(),o=g.create(),p=g.create(),q=this;n.computeGq=function(){var a=this.bodyA,b=this.bodyB,c=a.position,e=b.position;return g.rotate(o,d,a.angle),g.rotate(p,i,b.angle),g.add(l,e,p),g.sub(l,l,o),g.sub(l,l,c),g.length(l)-q.distance},this.setMaxForce(m),this.upperLimitEnabled=!1,this.upperLimit=1,this.lowerLimitEnabled=!1,this.lowerLimit=0,this.position=0}var e=a("./Constraint"),f=a("../equations/Equation"),g=a("../math/vec2"),h=a("../utils/Utils");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var i=g.create(),j=g.create(),k=g.create();d.prototype.update=function(){var a=this.equations[0],b=this.bodyA,c=this.bodyB,d=(this.distance,b.position),e=c.position,f=this.equations[0],h=a.G;g.rotate(j,this.localAnchorA,b.angle),g.rotate(k,this.localAnchorB,c.angle),g.add(i,e,k),g.sub(i,i,j),g.sub(i,i,d),this.position=g.length(i);var l=!1;if(this.upperLimitEnabled&&this.position>this.upperLimit&&(f.maxForce=0,f.minForce=-this.maxForce,this.distance=this.upperLimit,l=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(f.maxForce=this.maxForce,f.minForce=0,this.distance=this.lowerLimit,l=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!l)return void(f.enabled=!1);f.enabled=!0,g.normalize(i,i);var m=g.crossLength(j,i),n=g.crossLength(k,i);h[0]=-i[0],h[1]=-i[1],h[2]=-m,h[3]=i[0],h[4]=i[1],h[5]=n},d.prototype.setMaxForce=function(a){var b=this.equations[0];b.minForce=-a,b.maxForce=a},d.prototype.getMaxForce=function(){var a=this.equations[0];return a.maxForce}},{"../equations/Equation":22,"../math/vec2":30,"../utils/Utils":57,"./Constraint":14}],16:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.GEAR,c),this.ratio=void 0!==c.ratio?c.ratio:1,this.angle=void 0!==c.angle?c.angle:b.angle-this.ratio*a.angle,c.angle=this.angle,c.ratio=this.ratio,this.equations=[new f(a,b,c)],void 0!==c.maxTorque&&this.setMaxTorque(c.maxTorque)}var e=a("./Constraint"),f=(a("../equations/Equation"),a("../equations/AngleLockEquation"));a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.update=function(){var a=this.equations[0];a.ratio!==this.ratio&&a.setRatio(this.ratio),a.angle=this.angle},d.prototype.setMaxTorque=function(a){this.equations[0].setMaxTorque(a)},d.prototype.getMaxTorque=function(a){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":20,"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],17:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.LOCK,c);var d="undefined"==typeof c.maxForce?Number.MAX_VALUE:c.maxForce,h=(c.localAngleB||0,new g(a,b,-d,d)),i=new g(a,b,-d,d),j=new g(a,b,-d,d),k=f.create(),l=f.create(),m=this;h.computeGq=function(){return f.rotate(k,m.localOffsetB,a.angle),f.sub(l,b.position,a.position),f.sub(l,l,k),l[0]},i.computeGq=function(){return f.rotate(k,m.localOffsetB,a.angle),f.sub(l,b.position,a.position),f.sub(l,l,k),l[1]};var n=f.create(),o=f.create();j.computeGq=function(){return f.rotate(n,m.localOffsetB,b.angle-m.localAngleB),f.scale(n,n,-1),f.sub(l,a.position,b.position),f.add(l,l,n),f.rotate(o,n,-Math.PI/2),f.normalize(o,o),f.dot(l,o)},this.localOffsetB=f.create(),c.localOffsetB?f.copy(this.localOffsetB,c.localOffsetB):(f.sub(this.localOffsetB,b.position,a.position),f.rotate(this.localOffsetB,this.localOffsetB,-a.angle)),this.localAngleB=0,"number"==typeof c.localAngleB?this.localAngleB=c.localAngleB:this.localAngleB=b.angle-a.angle,this.equations.push(h,i,j),this.setMaxForce(d)}var e=a("./Constraint"),f=a("../math/vec2"),g=a("../equations/Equation");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.setMaxForce=function(a){for(var b=this.equations,c=0;c<this.equations.length;c++)b[c].maxForce=a,b[c].minForce=-a},d.prototype.getMaxForce=function(){return this.equations[0].maxForce};var h=f.create(),i=f.create(),j=f.create(),k=f.fromValues(1,0),l=f.fromValues(0,1);d.prototype.update=function(){var a=this.equations[0],b=this.equations[1],c=this.equations[2],d=this.bodyA,e=this.bodyB;f.rotate(h,this.localOffsetB,d.angle),f.rotate(i,this.localOffsetB,e.angle-this.localAngleB),f.scale(i,i,-1),f.rotate(j,i,Math.PI/2),f.normalize(j,j),a.G[0]=-1,a.G[1]=0,a.G[2]=-f.crossLength(h,k),a.G[3]=1,b.G[0]=0,b.G[1]=-1,b.G[2]=-f.crossLength(h,l),b.G[4]=1,c.G[0]=-j[0],c.G[1]=-j[1],c.G[3]=j[0],c.G[4]=j[1],c.G[5]=f.crossLength(i,j)}},{"../equations/Equation":22,"../math/vec2":30,"./Constraint":14}],18:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.PRISMATIC,c);var d=h.fromValues(0,0),j=h.fromValues(1,0),k=h.fromValues(0,0);c.localAnchorA&&h.copy(d,c.localAnchorA),c.localAxisA&&h.copy(j,c.localAxisA),c.localAnchorB&&h.copy(k,c.localAnchorB),this.localAnchorA=d,this.localAnchorB=k,this.localAxisA=j;var l=this.maxForce="undefined"!=typeof c.maxForce?c.maxForce:Number.MAX_VALUE,m=new g(a,b,-l,l),n=new h.create,o=new h.create,p=new h.create,q=new h.create;if(m.computeGq=function(){return h.dot(p,q)},m.updateJacobian=function(){var c=this.G,e=a.position,f=b.position;h.rotate(n,d,a.angle),h.rotate(o,k,b.angle),h.add(p,f,o),h.sub(p,p,e),h.sub(p,p,n),h.rotate(q,j,a.angle+Math.PI/2),c[0]=-q[0],c[1]=-q[1],c[2]=-h.crossLength(n,q)+h.crossLength(q,p),c[3]=q[0],c[4]=q[1],c[5]=h.crossLength(o,q)},this.equations.push(m),!c.disableRotationalLock){var r=new i(a,b,-l,l);this.equations.push(r)}this.position=0,this.velocity=0,this.lowerLimitEnabled="undefined"!=typeof c.lowerLimit?!0:!1,this.upperLimitEnabled="undefined"!=typeof c.upperLimit?!0:!1,this.lowerLimit="undefined"!=typeof c.lowerLimit?c.lowerLimit:0,this.upperLimit="undefined"!=typeof c.upperLimit?c.upperLimit:1,this.upperLimitEquation=new f(a,b),this.lowerLimitEquation=new f(a,b),this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0,this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=l,this.motorEquation=new g(a,b),this.motorEnabled=!1,this.motorSpeed=0;var s=this,t=this.motorEquation;t.computeGW;t.computeGq=function(){return 0},t.computeGW=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=b.velocity,e=c.velocity,f=b.angularVelocity,g=c.angularVelocity;return this.gmult(a,d,f,e,g)+s.motorSpeed}}var e=a("./Constraint"),f=a("../equations/ContactEquation"),g=a("../equations/Equation"),h=a("../math/vec2"),i=a("../equations/RotationalLockEquation");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var j=h.create(),k=h.create(),l=h.create(),m=h.create(),n=h.create(),o=h.create();d.prototype.update=function(){var a=this.equations,b=a[0],c=this.upperLimit,d=this.lowerLimit,e=this.upperLimitEquation,f=this.lowerLimitEquation,g=this.bodyA,i=this.bodyB,p=this.localAxisA,q=this.localAnchorA,r=this.localAnchorB;b.updateJacobian(),h.rotate(j,p,g.angle),h.rotate(m,q,g.angle),h.add(k,m,g.position),h.rotate(n,r,i.angle),h.add(l,n,i.position);var s=this.position=h.dot(l,j)-h.dot(k,j);if(this.motorEnabled){var t=this.motorEquation.G;t[0]=j[0],t[1]=j[1],t[2]=h.crossLength(j,n),t[3]=-j[0],t[4]=-j[1],t[5]=-h.crossLength(j,m)}if(this.upperLimitEnabled&&s>c)h.scale(e.normalA,j,-1),h.sub(e.contactPointA,k,g.position),h.sub(e.contactPointB,l,i.position),h.scale(o,j,c),h.add(e.contactPointA,e.contactPointA,o),-1===a.indexOf(e)&&a.push(e);else{var u=a.indexOf(e);-1!==u&&a.splice(u,1)}if(this.lowerLimitEnabled&&d>s)h.scale(f.normalA,j,1),h.sub(f.contactPointA,k,g.position),h.sub(f.contactPointB,l,i.position),h.scale(o,j,d),h.sub(f.contactPointB,f.contactPointB,o),-1===a.indexOf(f)&&a.push(f);else{var u=a.indexOf(f);-1!==u&&a.splice(u,1)}},d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1),this.motorEnabled=!1}},d.prototype.setLimits=function(a,b){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1),"number"==typeof b?(this.upperLimit=b,this.upperLimitEnabled=!0):(this.upperLimit=b,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":21,"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../math/vec2":30,"./Constraint":14}],19:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,e.REVOLUTE,c);var d=this.maxForce="undefined"!=typeof c.maxForce?c.maxForce:Number.MAX_VALUE;this.pivotA=i.create(),this.pivotB=i.create(),c.worldPivot?(i.sub(this.pivotA,c.worldPivot,a.position),i.sub(this.pivotB,c.worldPivot,b.position),i.rotate(this.pivotA,this.pivotA,-a.angle),i.rotate(this.pivotB,this.pivotB,-b.angle)):(i.copy(this.pivotA,c.localPivotA),i.copy(this.pivotB,c.localPivotB));var o=this.equations=[new f(a,b,-d,d),new f(a,b,-d,d)],p=o[0],q=o[1],r=this;p.computeGq=function(){return i.rotate(j,r.pivotA,a.angle),i.rotate(k,r.pivotB,b.angle),i.add(n,b.position,k),i.sub(n,n,a.position),i.sub(n,n,j),i.dot(n,l)},q.computeGq=function(){return i.rotate(j,r.pivotA,a.angle),i.rotate(k,r.pivotB,b.angle),i.add(n,b.position,k),i.sub(n,n,a.position),i.sub(n,n,j),i.dot(n,m)},q.minForce=p.minForce=-d,q.maxForce=p.maxForce=d,this.motorEquation=new g(a,b),this.motorEnabled=!1,this.angle=0,this.lowerLimitEnabled=!1,this.upperLimitEnabled=!1,this.lowerLimit=0,this.upperLimit=0,this.upperLimitEquation=new h(a,b),this.lowerLimitEquation=new h(a,b),this.upperLimitEquation.minForce=0,this.lowerLimitEquation.maxForce=0}var e=a("./Constraint"),f=a("../equations/Equation"),g=a("../equations/RotationalVelocityEquation"),h=a("../equations/RotationalLockEquation"),i=a("../math/vec2");b.exports=d;var j=i.create(),k=i.create(),l=i.fromValues(1,0),m=i.fromValues(0,1),n=i.create();d.prototype=new e,d.prototype.constructor=d,d.prototype.setLimits=function(a,b){"number"==typeof a?(this.lowerLimit=a,this.lowerLimitEnabled=!0):(this.lowerLimit=a,this.lowerLimitEnabled=!1),"number"==typeof b?(this.upperLimit=b,this.upperLimitEnabled=!0):(this.upperLimit=b,this.upperLimitEnabled=!1)},d.prototype.update=function(){var a=this.bodyA,b=this.bodyB,c=this.pivotA,d=this.pivotB,e=this.equations,f=(e[0],e[1],e[0]),g=e[1],h=this.upperLimit,n=this.lowerLimit,o=this.upperLimitEquation,p=this.lowerLimitEquation,q=this.angle=b.angle-a.angle;if(this.upperLimitEnabled&&q>h)o.angle=h,-1===e.indexOf(o)&&e.push(o);else{var r=e.indexOf(o);-1!==r&&e.splice(r,1)}if(this.lowerLimitEnabled&&n>q)p.angle=n,-1===e.indexOf(p)&&e.push(p);else{var r=e.indexOf(p);-1!==r&&e.splice(r,1)}i.rotate(j,c,a.angle),i.rotate(k,d,b.angle),f.G[0]=-1,f.G[1]=0,f.G[2]=-i.crossLength(j,l),f.G[3]=1,f.G[4]=0,f.G[5]=i.crossLength(k,l),g.G[0]=0,g.G[1]=-1,g.G[2]=-i.crossLength(j,m),g.G[3]=0,g.G[4]=1,g.G[5]=i.crossLength(k,m)},d.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)},d.prototype.disableMotor=function(){if(this.motorEnabled){var a=this.equations.indexOf(this.motorEquation);this.equations.splice(a,1),this.motorEnabled=!1}},d.prototype.motorIsEnabled=function(){return!!this.motorEnabled},d.prototype.setMotorSpeed=function(a){if(this.motorEnabled){var b=this.equations.indexOf(this.motorEquation);this.equations[b].relativeVelocity=a}},d.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":22,"../equations/RotationalLockEquation":24,"../equations/RotationalVelocityEquation":25,"../math/vec2":30,"./Constraint":14}],20:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=c.angle||0,this.ratio="number"==typeof c.ratio?c.ratio:1,this.setRatio(this.ratio)}var e=a("./Equation");a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle},d.prototype.setRatio=function(a){var b=this.G;b[2]=a,b[5]=-1,this.ratio=a},d.prototype.setMaxTorque=function(a){this.maxForce=a,this.minForce=-a}},{"../math/vec2":30,"./Equation":22}],21:[function(a,b,c){function d(a,b){e.call(this,a,b,0,Number.MAX_VALUE),this.contactPointA=f.create(),this.penetrationVec=f.create(),this.contactPointB=f.create(),this.normalA=f.create(),this.restitution=0,this.firstImpact=!1,this.shapeA=null,this.shapeB=null}var e=a("./Equation"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeB=function(a,b,c){var d=this.bodyA,e=this.bodyB,g=this.contactPointA,h=this.contactPointB,i=d.position,j=e.position,k=this.penetrationVec,l=this.normalA,m=this.G,n=f.crossLength(g,l),o=f.crossLength(h,l);m[0]=-l[0],m[1]=-l[1],m[2]=-n,m[3]=l[0],m[4]=l[1],m[5]=o,f.add(k,j,h),f.sub(k,k,i),f.sub(k,k,g);var p,q;this.firstImpact&&0!==this.restitution?(q=0,p=1/b*(1+this.restitution)*this.computeGW()):(q=f.dot(l,k)+this.offset,p=this.computeGW());var r=this.computeGiMf(),s=-q*a-p*b-c*r;return s};var g=f.create(),h=f.create(),i=f.create();d.prototype.getVelocityAlongNormal=function(){return this.bodyA.getVelocityAtPoint(g,this.contactPointA),this.bodyB.getVelocityAtPoint(h,this.contactPointB),f.subtract(i,g,h),f.dot(this.normalA,i)}},{"../math/vec2":30,"./Equation":22}],22:[function(a,b,c){function d(a,b,c,e){this.minForce="undefined"==typeof c?-Number.MAX_VALUE:c,this.maxForce="undefined"==typeof e?Number.MAX_VALUE:e,this.bodyA=a,this.bodyB=b,this.stiffness=d.DEFAULT_STIFFNESS,this.relaxation=d.DEFAULT_RELAXATION,this.G=new f.ARRAY_TYPE(6);for(var g=0;6>g;g++)this.G[g]=0;this.offset=0,this.a=0,this.b=0,this.epsilon=0,this.timeStep=1/60,this.needsUpdate=!0,this.multiplier=0,this.relativeVelocity=0,this.enabled=!0}b.exports=d;var e=a("../math/vec2"),f=a("../utils/Utils");a("../objects/Body");d.prototype.constructor=d,d.DEFAULT_STIFFNESS=1e6,d.DEFAULT_RELAXATION=4,d.prototype.update=function(){var a=this.stiffness,b=this.relaxation,c=this.timeStep;this.a=4/(c*(1+4*b)),this.b=4*b/(1+4*b),this.epsilon=4/(c*c*a*(1+4*b)),this.needsUpdate=!1},d.prototype.gmult=function(a,b,c,d,e){return a[0]*b[0]+a[1]*b[1]+a[2]*c+a[3]*d[0]+a[4]*d[1]+a[5]*e},d.prototype.computeB=function(a,b,c){var d=this.computeGW(),e=this.computeGq(),f=this.computeGiMf();return-e*a-d*b-f*c};var g=e.create(),h=e.create();d.prototype.computeGq=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=(b.position,c.position,b.angle),e=c.angle;return this.gmult(a,g,d,h,e)+this.offset},d.prototype.computeGW=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=b.velocity,e=c.velocity,f=b.angularVelocity,g=c.angularVelocity;return this.gmult(a,d,f,e,g)+this.relativeVelocity},d.prototype.computeGWlambda=function(){var a=this.G,b=this.bodyA,c=this.bodyB,d=b.vlambda,e=c.vlambda,f=b.wlambda,g=c.wlambda;return this.gmult(a,d,f,e,g)};var i=e.create(),j=e.create();d.prototype.computeGiMf=function(){var a=this.bodyA,b=this.bodyB,c=a.force,d=a.angularForce,f=b.force,g=b.angularForce,h=a.invMassSolve,k=b.invMassSolve,l=a.invInertiaSolve,m=b.invInertiaSolve,n=this.G;return e.scale(i,c,h),e.multiply(i,a.massMultiplier,i),e.scale(j,f,k),e.multiply(j,b.massMultiplier,j),this.gmult(n,i,d*l,j,g*m)},d.prototype.computeGiMGt=function(){var a=this.bodyA,b=this.bodyB,c=a.invMassSolve,d=b.invMassSolve,e=a.invInertiaSolve,f=b.invInertiaSolve,g=this.G;return g[0]*g[0]*c*a.massMultiplier[0]+g[1]*g[1]*c*a.massMultiplier[1]+g[2]*g[2]*e+g[3]*g[3]*d*b.massMultiplier[0]+g[4]*g[4]*d*b.massMultiplier[1]+g[5]*g[5]*f};var k=e.create(),l=e.create(),m=e.create();e.create(),e.create(),e.create();d.prototype.addToWlambda=function(a){var b=this.bodyA,c=this.bodyB,d=k,f=l,g=m,h=b.invMassSolve,i=c.invMassSolve,j=b.invInertiaSolve,n=c.invInertiaSolve,o=this.G;f[0]=o[0],f[1]=o[1],g[0]=o[3],g[1]=o[4],e.scale(d,f,h*a),e.multiply(d,d,b.massMultiplier),e.add(b.vlambda,b.vlambda,d),b.wlambda+=j*o[2]*a,e.scale(d,g,i*a),e.multiply(d,d,c.massMultiplier),e.add(c.vlambda,c.vlambda,d),c.wlambda+=n*o[5]*a},d.prototype.computeInvC=function(a){return 1/(this.computeGiMGt()+a)}},{"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],23:[function(a,b,c){function d(a,b,c){f.call(this,a,b,-c,c),this.contactPointA=e.create(),this.contactPointB=e.create(),this.t=e.create(),this.contactEquations=[],this.shapeA=null,this.shapeB=null,this.frictionCoefficient=.3}var e=a("../math/vec2"),f=a("./Equation");a("../utils/Utils");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.setSlipForce=function(a){this.maxForce=a,this.minForce=-a},d.prototype.getSlipForce=function(){return this.maxForce},d.prototype.computeB=function(a,b,c){var d=(this.bodyA,this.bodyB,this.contactPointA),f=this.contactPointB,g=this.t,h=this.G;h[0]=-g[0],h[1]=-g[1],h[2]=-e.crossLength(d,g),h[3]=g[0],h[4]=g[1],h[5]=e.crossLength(f,g);var i=this.computeGW(),j=this.computeGiMf(),k=-i*b-c*j;return k}},{"../math/vec2":30,"../utils/Utils":57,"./Equation":22}],24:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.angle=c.angle||0;var d=this.G;d[2]=1,d[5]=-1}var e=a("./Equation"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var g=f.create(),h=f.create(),i=f.fromValues(1,0),j=f.fromValues(0,1);d.prototype.computeGq=function(){return f.rotate(g,i,this.bodyA.angle+this.angle),f.rotate(h,j,this.bodyB.angle),f.dot(g,h)}},{"../math/vec2":30,"./Equation":22}],25:[function(a,b,c){function d(a,b){e.call(this,a,b,-Number.MAX_VALUE,Number.MAX_VALUE),this.relativeVelocity=1,this.ratio=1}var e=a("./Equation");a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeB=function(a,b,c){var d=this.G;d[2]=-1,d[5]=this.ratio;var e=this.computeGiMf(),f=this.computeGW(),g=-f*b-c*e;return g}},{"../math/vec2":30,"./Equation":22}],26:[function(a,b,c){var d=function(){};b.exports=d,d.prototype={constructor:d,on:function(a,b,c){b.context=c||this,void 0===this._listeners&&(this._listeners={});var d=this._listeners;return void 0===d[a]&&(d[a]=[]),-1===d[a].indexOf(b)&&d[a].push(b),this},has:function(a,b){if(void 0===this._listeners)return!1;var c=this._listeners;if(b){if(void 0!==c[a]&&-1!==c[a].indexOf(b))return!0}else if(void 0!==c[a])return!0;return!1},off:function(a,b){if(void 0===this._listeners)return this;var c=this._listeners,d=c[a].indexOf(b);return-1!==d&&c[a].splice(d,1),this},emit:function(a){if(void 0===this._listeners)return this;var b=this._listeners,c=b[a.type];if(void 0!==c){a.target=this;for(var d=0,e=c.length;e>d;d++){var f=c[d];f.call(f.context,a)}}return this}}},{}],27:[function(a,b,c){function d(a,b,c){if(c=c||{},!(a instanceof e&&b instanceof e))throw new Error("First two arguments must be Material instances.");this.id=d.idCounter++,this.materialA=a,this.materialB=b,this.friction="undefined"!=typeof c.friction?Number(c.friction):.3,this.restitution="undefined"!=typeof c.restitution?Number(c.restitution):0,this.stiffness="undefined"!=typeof c.stiffness?Number(c.stiffness):f.DEFAULT_STIFFNESS,this.relaxation="undefined"!=typeof c.relaxation?Number(c.relaxation):f.DEFAULT_RELAXATION,this.frictionStiffness="undefined"!=typeof c.frictionStiffness?Number(c.frictionStiffness):f.DEFAULT_STIFFNESS,this.frictionRelaxation="undefined"!=typeof c.frictionRelaxation?Number(c.frictionRelaxation):f.DEFAULT_RELAXATION,this.surfaceVelocity="undefined"!=typeof c.surfaceVelocity?Number(c.surfaceVelocity):0,this.contactSkinSize=.005}var e=a("./Material"),f=a("../equations/Equation");b.exports=d,d.idCounter=0},{"../equations/Equation":22,"./Material":28}],28:[function(a,b,c){function d(a){this.id=a||d.idCounter++}b.exports=d,d.idCounter=0},{}],29:[function(a,b,c){var d={};d.GetArea=function(a){if(a.length<6)return 0;for(var b=a.length-2,c=0,d=0;b>d;d+=2)c+=(a[d+2]-a[d])*(a[d+1]+a[d+3]);return c+=(a[0]-a[b])*(a[b+1]+a[1]),.5*-c},d.Triangulate=function(a){var b=a.length>>1;if(3>b)return[];for(var c=[],e=[],f=0;b>f;f++)e.push(f);for(var f=0,g=b;g>3;){var h=e[(f+0)%g],i=e[(f+1)%g],j=e[(f+2)%g],k=a[2*h],l=a[2*h+1],m=a[2*i],n=a[2*i+1],o=a[2*j],p=a[2*j+1],q=!1;if(d._convex(k,l,m,n,o,p)){q=!0;for(var r=0;g>r;r++){var s=e[r];if(s!=h&&s!=i&&s!=j&&d._PointInTriangle(a[2*s],a[2*s+1],k,l,m,n,o,p)){q=!1;break}}}if(q)c.push(h,i,j),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g)break}return c.push(e[0],e[1],e[2]),c},d._PointInTriangle=function(a,b,c,d,e,f,g,h){var i=g-c,j=h-d,k=e-c,l=f-d,m=a-c,n=b-d,o=i*i+j*j,p=i*k+j*l,q=i*m+j*n,r=k*k+l*l,s=k*m+l*n,t=1/(o*r-p*p),u=(r*q-p*s)*t,v=(o*s-p*q)*t;return u>=0&&v>=0&&1>u+v},d._convex=function(a,b,c,d,e,f){return(b-d)*(e-c)+(c-a)*(f-d)>=0},b.exports=d},{}],30:[function(a,b,c){var d=b.exports={},e=a("../utils/Utils");d.crossLength=function(a,b){return a[0]*b[1]-a[1]*b[0]},d.crossVZ=function(a,b,c){return d.rotate(a,b,-Math.PI/2),d.scale(a,a,c),a},d.crossZV=function(a,b,c){return d.rotate(a,c,Math.PI/2),d.scale(a,a,b),a},d.rotate=function(a,b,c){if(0!==c){var d=Math.cos(c),e=Math.sin(c),f=b[0],g=b[1];a[0]=d*f-e*g,a[1]=e*f+d*g}else a[0]=b[0],a[1]=b[1]},d.rotate90cw=function(a,b){var c=b[0],d=b[1];a[0]=d,a[1]=-c},d.toLocalFrame=function(a,b,c,e){d.copy(a,b),d.sub(a,a,c),d.rotate(a,a,-e)},d.toGlobalFrame=function(a,b,c,e){d.copy(a,b),d.rotate(a,a,e),d.add(a,a,c)},d.vectorToLocalFrame=function(a,b,c){d.rotate(a,b,-c)},d.vectorToGlobalFrame=function(a,b,c){d.rotate(a,b,c)},d.centroid=function(a,b,c,e){return d.add(a,b,c),d.add(a,a,e),d.scale(a,a,1/3),a},d.create=function(){var a=new e.ARRAY_TYPE(2);return a[0]=0,a[1]=0,a},d.clone=function(a){var b=new e.ARRAY_TYPE(2);return b[0]=a[0],b[1]=a[1],b},d.fromValues=function(a,b){var c=new e.ARRAY_TYPE(2);return c[0]=a,c[1]=b,c},d.copy=function(a,b){return a[0]=b[0],a[1]=b[1],a},d.set=function(a,b,c){return a[0]=b,a[1]=c,a},d.add=function(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a},d.subtract=function(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a},d.sub=d.subtract,d.multiply=function(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a},d.mul=d.multiply,d.divide=function(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a},d.div=d.divide,d.scale=function(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a},d.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)},d.dist=d.distance,d.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d},d.sqrDist=d.squaredDistance,d.length=function(a){var b=a[0],c=a[1];return Math.sqrt(b*b+c*c)},d.len=d.length,d.squaredLength=function(a){var b=a[0],c=a[1];return b*b+c*c},d.sqrLen=d.squaredLength,d.negate=function(a,b){return a[0]=-b[0],a[1]=-b[1],a},d.normalize=function(a,b){var c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e),a[0]=b[0]*e,a[1]=b[1]*e),a},d.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]},d.str=function(a){return"vec2("+a[0]+", "+a[1]+")"},d.lerp=function(a,b,c,d){var e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a},d.reflect=function(a,b,c){var d=b[0]*c[0]+b[1]*c[1];a[0]=b[0]-2*c[0]*d,a[1]=b[1]-2*c[1]*d},d.getLineSegmentsIntersection=function(a,b,c,e,f){var g=d.getLineSegmentsIntersectionFraction(b,c,e,f);return 0>g?!1:(a[0]=b[0]+g*(c[0]-b[0]),a[1]=b[1]+g*(c[1]-b[1]),!0)},d.getLineSegmentsIntersectionFraction=function(a,b,c,d){var e,f,g=b[0]-a[0],h=b[1]-a[1],i=d[0]-c[0],j=d[1]-c[1];return e=(-h*(a[0]-c[0])+g*(a[1]-c[1]))/(-i*h+g*j),f=(i*(a[1]-c[1])-j*(a[0]-c[0]))/(-i*h+g*j),e>=0&&1>=e&&f>=0&&1>=f?f:-1}},{"../utils/Utils":57}],31:[function(a,b,c){function d(a){a=a||{},k.call(this),this.id=a.id||++d._idCounter,this.world=null,this.shapes=[],this.mass=a.mass||0,this.invMass=0,this.inertia=0,this.invInertia=0,this.invMassSolve=0,this.invInertiaSolve=0,this.fixedRotation=!!a.fixedRotation,this.fixedX=!!a.fixedX,this.fixedY=!!a.fixedY,this.massMultiplier=e.create(),this.position=e.fromValues(0,0),a.position&&e.copy(this.position,a.position),this.interpolatedPosition=e.fromValues(0,0),this.interpolatedAngle=0,this.previousPosition=e.fromValues(0,0),this.previousAngle=0,this.velocity=e.fromValues(0,0),a.velocity&&e.copy(this.velocity,a.velocity),this.vlambda=e.fromValues(0,0),this.wlambda=0,this.angle=a.angle||0,this.angularVelocity=a.angularVelocity||0,this.force=e.create(),a.force&&e.copy(this.force,a.force),this.angularForce=a.angularForce||0,this.damping="number"==typeof a.damping?a.damping:.1,
this.angularDamping="number"==typeof a.angularDamping?a.angularDamping:.1,this.type=d.STATIC,"undefined"!=typeof a.type?this.type=a.type:a.mass?this.type=d.DYNAMIC:this.type=d.STATIC,this.boundingRadius=0,this.aabb=new j,this.aabbNeedsUpdate=!0,this.allowSleep=void 0!==a.allowSleep?a.allowSleep:!0,this.wantsToSleep=!1,this.sleepState=d.AWAKE,this.sleepSpeedLimit=void 0!==a.sleepSpeedLimit?a.sleepSpeedLimit:.2,this.sleepTimeLimit=void 0!==a.sleepTimeLimit?a.sleepTimeLimit:1,this.gravityScale=void 0!==a.gravityScale?a.gravityScale:1,this.collisionResponse=void 0!==a.collisionResponse?a.collisionResponse:!0,this.idleTime=0,this.timeLastSleepy=0,this.ccdSpeedThreshold=void 0!==a.ccdSpeedThreshold?a.ccdSpeedThreshold:-1,this.ccdIterations=void 0!==a.ccdIterations?a.ccdIterations:10,this.concavePath=null,this._wakeUpAfterNarrowphase=!1,this.updateMassProperties()}var e=a("../math/vec2"),f=a("poly-decomp"),g=a("../shapes/Convex"),h=a("../collision/RaycastResult"),i=a("../collision/Ray"),j=a("../collision/AABB"),k=a("../events/EventEmitter");b.exports=d,d.prototype=new k,d.prototype.constructor=d,d._idCounter=0,d.prototype.updateSolveMassProperties=function(){this.sleepState===d.SLEEPING||this.type===d.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)},d.prototype.setDensity=function(a){var b=this.getArea();this.mass=b*a,this.updateMassProperties()},d.prototype.getArea=function(){for(var a=0,b=0;b<this.shapes.length;b++)a+=this.shapes[b].area;return a},d.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};var l=new j,m=e.create();d.prototype.updateAABB=function(){for(var a=this.shapes,b=a.length,c=m,d=this.angle,f=0;f!==b;f++){var g=a[f],h=g.angle+d;e.rotate(c,g.position,d),e.add(c,c,this.position),g.computeAABB(l,c,h),0===f?this.aabb.copy(l):this.aabb.extend(l)}this.aabbNeedsUpdate=!1},d.prototype.updateBoundingRadius=function(){for(var a=this.shapes,b=a.length,c=0,d=0;d!==b;d++){var f=a[d],g=e.length(f.position),h=f.boundingRadius;g+h>c&&(c=g+h)}this.boundingRadius=c},d.prototype.addShape=function(a,b,c){if(a.body)throw new Error("A shape can only be added to one body.");a.body=this,b?e.copy(a.position,b):e.set(a.position,0,0),a.angle=c||0,this.shapes.push(a),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0},d.prototype.removeShape=function(a){var b=this.shapes.indexOf(a);return-1!==b?(this.shapes.splice(b,1),this.aabbNeedsUpdate=!0,a.body=null,!0):!1},d.prototype.updateMassProperties=function(){if(this.type===d.STATIC||this.type===d.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var a=this.shapes,b=a.length,c=this.mass/b,f=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(var g=0;b>g;g++){var h=a[g],i=e.squaredLength(h.position),j=h.computeMomentOfInertia(c);f+=j+c*i}this.inertia=f,this.invInertia=f>0?1/f:0}this.invMass=1/this.mass,e.set(this.massMultiplier,this.fixedX?0:1,this.fixedY?0:1)}};e.create();d.prototype.applyForce=function(a,b){if(e.add(this.force,this.force,a),b){var c=e.crossLength(b,a);this.angularForce+=c}};var n=e.create(),o=e.create(),p=e.create();d.prototype.applyForceLocal=function(a,b){b=b||p;var c=n,d=o;this.vectorToWorldFrame(c,a),this.vectorToWorldFrame(d,b),this.applyForce(c,d)};var q=e.create();d.prototype.applyImpulse=function(a,b){if(this.type===d.DYNAMIC){var c=q;if(e.scale(c,a,this.invMass),e.multiply(c,this.massMultiplier,c),e.add(this.velocity,c,this.velocity),b){var f=e.crossLength(b,a);f*=this.invInertia,this.angularVelocity+=f}}};var r=e.create(),s=e.create(),t=e.create();d.prototype.applyImpulseLocal=function(a,b){b=b||t;var c=r,d=s;this.vectorToWorldFrame(c,a),this.vectorToWorldFrame(d,b),this.applyImpulse(c,d)},d.prototype.toLocalFrame=function(a,b){e.toLocalFrame(a,b,this.position,this.angle)},d.prototype.toWorldFrame=function(a,b){e.toGlobalFrame(a,b,this.position,this.angle)},d.prototype.vectorToLocalFrame=function(a,b){e.vectorToLocalFrame(a,b,this.angle)},d.prototype.vectorToWorldFrame=function(a,b){e.vectorToGlobalFrame(a,b,this.angle)},d.prototype.fromPolygon=function(a,b){b=b||{};for(var c=this.shapes.length;c>=0;--c)this.removeShape(this.shapes[c]);var d=new f.Polygon;if(d.vertices=a,d.makeCCW(),"number"==typeof b.removeCollinearPoints&&d.removeCollinearPoints(b.removeCollinearPoints),"undefined"==typeof b.skipSimpleCheck&&!d.isSimple())return!1;this.concavePath=d.vertices.slice(0);for(var c=0;c<this.concavePath.length;c++){var h=[0,0];e.copy(h,this.concavePath[c]),this.concavePath[c]=h}var i;i=b.optimalDecomp?d.decomp():d.quickDecomp();for(var j=e.create(),c=0;c!==i.length;c++){for(var k=new g({vertices:i[c].vertices}),l=0;l!==k.vertices.length;l++){var h=k.vertices[l];e.sub(h,h,k.centerOfMass)}e.scale(j,k.centerOfMass,1),k.updateTriangles(),k.updateCenterOfMass(),k.updateBoundingRadius(),this.addShape(k,j)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var u=(e.fromValues(0,0),e.fromValues(0,0)),v=e.fromValues(0,0),w=e.fromValues(0,0);d.prototype.adjustCenterOfMass=function(){var a=u,b=v,c=w,d=0;e.set(b,0,0);for(var f=0;f!==this.shapes.length;f++){var g=this.shapes[f];e.scale(a,g.position,g.area),e.add(b,b,a),d+=g.area}e.scale(c,b,1/d);for(var f=0;f!==this.shapes.length;f++){var g=this.shapes[f];e.sub(g.position,g.position,c)}e.add(this.position,this.position,c);for(var f=0;this.concavePath&&f<this.concavePath.length;f++)e.sub(this.concavePath[f],this.concavePath[f],c);this.updateMassProperties(),this.updateBoundingRadius()},d.prototype.setZeroForce=function(){e.set(this.force,0,0),this.angularForce=0},d.prototype.resetConstraintVelocity=function(){var a=this,b=a.vlambda;e.set(b,0,0),a.wlambda=0},d.prototype.addConstraintVelocity=function(){var a=this,b=a.velocity;e.add(b,b,a.vlambda),a.angularVelocity+=a.wlambda},d.prototype.applyDamping=function(a){if(this.type===d.DYNAMIC){var b=this.velocity;e.scale(b,b,Math.pow(1-this.damping,a)),this.angularVelocity*=Math.pow(1-this.angularDamping,a)}},d.prototype.wakeUp=function(){var a=this.sleepState;this.sleepState=d.AWAKE,this.idleTime=0,a!==d.AWAKE&&this.emit(d.wakeUpEvent)},d.prototype.sleep=function(){this.sleepState=d.SLEEPING,this.angularVelocity=0,this.angularForce=0,e.set(this.velocity,0,0),e.set(this.force,0,0),this.emit(d.sleepEvent)},d.prototype.sleepTick=function(a,b,c){if(this.allowSleep&&this.type!==d.SLEEPING){this.wantsToSleep=!1;var f=(this.sleepState,e.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2)),g=Math.pow(this.sleepSpeedLimit,2);f>=g?(this.idleTime=0,this.sleepState=d.AWAKE):(this.idleTime+=c,this.sleepState=d.SLEEPY),this.idleTime>this.sleepTimeLimit&&(b?this.wantsToSleep=!0:this.sleep())}},d.prototype.overlaps=function(a){return this.world.overlapKeeper.bodiesAreOverlapping(this,a)};var x=e.create(),y=e.create();d.prototype.integrate=function(a){var b=this.invMass,c=this.force,d=this.position,f=this.velocity;e.copy(this.previousPosition,this.position),this.previousAngle=this.angle,this.fixedRotation||(this.angularVelocity+=this.angularForce*this.invInertia*a),e.scale(x,c,a*b),e.multiply(x,this.massMultiplier,x),e.add(f,x,f),this.integrateToTimeOfImpact(a)||(e.scale(y,f,a),e.add(d,d,y),this.fixedRotation||(this.angle+=this.angularVelocity*a)),this.aabbNeedsUpdate=!0};var z=new h,A=new i({mode:i.ALL}),B=e.create(),C=e.create(),D=e.create(),E=e.create();d.prototype.integrateToTimeOfImpact=function(a){if(this.ccdSpeedThreshold<0||e.squaredLength(this.velocity)<Math.pow(this.ccdSpeedThreshold,2))return!1;e.normalize(B,this.velocity),e.scale(C,this.velocity,a),e.add(C,C,this.position),e.sub(D,C,this.position);var b,c=this.angularVelocity*a,d=e.length(D),f=1,g=this;if(z.reset(),A.callback=function(a){a.body!==g&&(b=a.body,a.getHitPoint(C,A),e.sub(D,C,g.position),f=e.length(D)/d,a.stop())},e.copy(A.from,this.position),e.copy(A.to,C),A.update(),this.world.raycast(z,A),!b)return!1;var h=this.angle;e.copy(E,this.position);for(var i=0,j=0,k=0,l=f;l>=j&&i<this.ccdIterations;){i++,k=(l-j)/2,e.scale(y,D,f),e.add(this.position,E,y),this.angle=h+c*f,this.updateAABB();var m=this.aabb.overlaps(b.aabb)&&this.world.narrowphase.bodiesOverlap(this,b);m?j=k:l=k}return f=k,e.copy(this.position,E),this.angle=h,e.scale(y,D,f),e.add(this.position,this.position,y),this.fixedRotation||(this.angle+=c*f),!0},d.prototype.getVelocityAtPoint=function(a,b){return e.crossVZ(a,b,this.angularVelocity),e.subtract(a,this.velocity,a),a},d.sleepyEvent={type:"sleepy"},d.sleepEvent={type:"sleep"},d.wakeUpEvent={type:"wakeup"},d.DYNAMIC=1,d.STATIC=2,d.KINEMATIC=4,d.AWAKE=0,d.SLEEPY=1,d.SLEEPING=2},{"../collision/AABB":7,"../collision/Ray":11,"../collision/RaycastResult":12,"../events/EventEmitter":26,"../math/vec2":30,"../shapes/Convex":40,"poly-decomp":5}],32:[function(a,b,c){function d(a,b,c){c=c||{},f.call(this,a,b,c),this.localAnchorA=e.fromValues(0,0),this.localAnchorB=e.fromValues(0,0),c.localAnchorA&&e.copy(this.localAnchorA,c.localAnchorA),c.localAnchorB&&e.copy(this.localAnchorB,c.localAnchorB),c.worldAnchorA&&this.setWorldAnchorA(c.worldAnchorA),c.worldAnchorB&&this.setWorldAnchorB(c.worldAnchorB);var d=e.create(),g=e.create();this.getWorldAnchorA(d),this.getWorldAnchorB(g);var h=e.distance(d,g);this.restLength="number"==typeof c.restLength?c.restLength:h}var e=a("../math/vec2"),f=a("./Spring");a("../utils/Utils");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.setWorldAnchorA=function(a){this.bodyA.toLocalFrame(this.localAnchorA,a)},d.prototype.setWorldAnchorB=function(a){this.bodyB.toLocalFrame(this.localAnchorB,a)},d.prototype.getWorldAnchorA=function(a){this.bodyA.toWorldFrame(a,this.localAnchorA)},d.prototype.getWorldAnchorB=function(a){this.bodyB.toWorldFrame(a,this.localAnchorB)};var g=e.create(),h=e.create(),i=e.create(),j=e.create(),k=e.create(),l=e.create(),m=e.create(),n=e.create(),o=e.create();d.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restLength,d=this.bodyA,f=this.bodyB,p=g,q=h,r=i,s=j,t=o,u=k,v=l,w=m,x=n;this.getWorldAnchorA(u),this.getWorldAnchorB(v),e.sub(w,u,d.position),e.sub(x,v,f.position),e.sub(p,v,u);var y=e.len(p);e.normalize(q,p),e.sub(r,f.velocity,d.velocity),e.crossZV(t,f.angularVelocity,x),e.add(r,r,t),e.crossZV(t,d.angularVelocity,w),e.sub(r,r,t),e.scale(s,q,-a*(y-c)-b*e.dot(r,q)),e.sub(d.force,d.force,s),e.add(f.force,f.force,s);var z=e.crossLength(w,s),A=e.crossLength(x,s);d.angularForce-=z,f.angularForce+=A}},{"../math/vec2":30,"../utils/Utils":57,"./Spring":34}],33:[function(a,b,c){function d(a,b,c){c=c||{},e.call(this,a,b,c),this.restAngle="number"==typeof c.restAngle?c.restAngle:b.angle-a.angle}var e=(a("../math/vec2"),a("./Spring"));b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.applyForce=function(){var a=this.stiffness,b=this.damping,c=this.restAngle,d=this.bodyA,e=this.bodyB,f=e.angle-d.angle,g=e.angularVelocity-d.angularVelocity,h=-a*(f-c)-b*g*0;d.angularForce-=h,e.angularForce+=h}},{"../math/vec2":30,"./Spring":34}],34:[function(a,b,c){function d(a,b,c){c=e.defaults(c,{stiffness:100,damping:1}),this.stiffness=c.stiffness,this.damping=c.damping,this.bodyA=a,this.bodyB=b}var e=(a("../math/vec2"),a("../utils/Utils"));b.exports=d,d.prototype.applyForce=function(){}},{"../math/vec2":30,"../utils/Utils":57}],35:[function(a,b,c){function d(a,b){b=b||{},this.chassisBody=a,this.wheels=[],this.groundBody=new i({mass:0}),this.world=null;var c=this;this.preStepCallback=function(){c.update()}}function e(a,b){b=b||{},this.vehicle=a,this.forwardEquation=new h(a.chassisBody,a.groundBody),this.sideEquation=new h(a.chassisBody,a.groundBody),this.steerValue=0,this.engineForce=0,this.setSideFriction(void 0!==b.sideFriction?b.sideFriction:5),this.localForwardVector=f.fromValues(0,1),b.localForwardVector&&f.copy(this.localForwardVector,b.localForwardVector),this.localPosition=f.fromValues(0,0),b.localPosition&&f.copy(this.localPosition,b.localPosition),g.apply(this,a.chassisBody,a.groundBody),this.equations.push(this.forwardEquation,this.sideEquation),this.setBrakeForce(0)}var f=a("../math/vec2"),g=(a("../utils/Utils"),a("../constraints/Constraint")),h=a("../equations/FrictionEquation"),i=a("../objects/Body");b.exports=d,d.prototype.addToWorld=function(a){this.world=a,a.addBody(this.groundBody),a.on("preStep",this.preStepCallback);for(var b=0;b<this.wheels.length;b++){var c=this.wheels[b];a.addConstraint(c)}},d.prototype.removeFromWorld=function(){var a=this.world;a.removeBody(this.groundBody),a.off("preStep",this.preStepCallback);for(var b=0;b<this.wheels.length;b++){var c=this.wheels[b];a.removeConstraint(c)}this.world=null},d.prototype.addWheel=function(a){var b=new e(this,a);return this.wheels.push(b),b},d.prototype.update=function(){for(var a=0;a<this.wheels.length;a++)this.wheels[a].update()},e.prototype=new g,e.prototype.setBrakeForce=function(a){this.forwardEquation.setSlipForce(a)},e.prototype.setSideFriction=function(a){this.sideEquation.setSlipForce(a)};var j=f.create(),k=f.create();e.prototype.getSpeed=function(){return this.vehicle.chassisBody.vectorToWorldFrame(k,this.localForwardVector),this.vehicle.chassisBody.getVelocityAtPoint(j,k),f.dot(j,k)};var l=f.create();e.prototype.update=function(){this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.t,this.localForwardVector),f.rotate(this.sideEquation.t,this.localForwardVector,Math.PI/2),this.vehicle.chassisBody.vectorToWorldFrame(this.sideEquation.t,this.sideEquation.t),f.rotate(this.forwardEquation.t,this.forwardEquation.t,this.steerValue),f.rotate(this.sideEquation.t,this.sideEquation.t,this.steerValue),this.vehicle.chassisBody.toWorldFrame(this.forwardEquation.contactPointB,this.localPosition),f.copy(this.sideEquation.contactPointB,this.forwardEquation.contactPointB),this.vehicle.chassisBody.vectorToWorldFrame(this.forwardEquation.contactPointA,this.localPosition),f.copy(this.sideEquation.contactPointA,this.forwardEquation.contactPointA),f.normalize(l,this.forwardEquation.t),f.scale(l,l,this.engineForce),this.vehicle.chassisBody.applyForce(l,this.forwardEquation.contactPointA)}},{"../constraints/Constraint":14,"../equations/FrictionEquation":23,"../math/vec2":30,"../objects/Body":31,"../utils/Utils":57}],36:[function(a,b,c){var d=b.exports={AABB:a("./collision/AABB"),AngleLockEquation:a("./equations/AngleLockEquation"),Body:a("./objects/Body"),Broadphase:a("./collision/Broadphase"),Capsule:a("./shapes/Capsule"),Circle:a("./shapes/Circle"),Constraint:a("./constraints/Constraint"),ContactEquation:a("./equations/ContactEquation"),ContactEquationPool:a("./utils/ContactEquationPool"),ContactMaterial:a("./material/ContactMaterial"),Convex:a("./shapes/Convex"),DistanceConstraint:a("./constraints/DistanceConstraint"),Equation:a("./equations/Equation"),EventEmitter:a("./events/EventEmitter"),FrictionEquation:a("./equations/FrictionEquation"),FrictionEquationPool:a("./utils/FrictionEquationPool"),GearConstraint:a("./constraints/GearConstraint"),GSSolver:a("./solver/GSSolver"),Heightfield:a("./shapes/Heightfield"),Line:a("./shapes/Line"),LockConstraint:a("./constraints/LockConstraint"),Material:a("./material/Material"),Narrowphase:a("./collision/Narrowphase"),NaiveBroadphase:a("./collision/NaiveBroadphase"),Particle:a("./shapes/Particle"),Plane:a("./shapes/Plane"),Pool:a("./utils/Pool"),RevoluteConstraint:a("./constraints/RevoluteConstraint"),PrismaticConstraint:a("./constraints/PrismaticConstraint"),Ray:a("./collision/Ray"),RaycastResult:a("./collision/RaycastResult"),Box:a("./shapes/Box"),RotationalVelocityEquation:a("./equations/RotationalVelocityEquation"),SAPBroadphase:a("./collision/SAPBroadphase"),Shape:a("./shapes/Shape"),Solver:a("./solver/Solver"),Spring:a("./objects/Spring"),TopDownVehicle:a("./objects/TopDownVehicle"),LinearSpring:a("./objects/LinearSpring"),RotationalSpring:a("./objects/RotationalSpring"),Utils:a("./utils/Utils"),World:a("./world/World"),vec2:a("./math/vec2"),version:a("../package.json").version};Object.defineProperty(d,"Rectangle",{get:function(){return console.warn("The Rectangle class has been renamed to Box."),this.Box}})},{"../package.json":6,"./collision/AABB":7,"./collision/Broadphase":8,"./collision/NaiveBroadphase":9,"./collision/Narrowphase":10,"./collision/Ray":11,"./collision/RaycastResult":12,"./collision/SAPBroadphase":13,"./constraints/Constraint":14,"./constraints/DistanceConstraint":15,"./constraints/GearConstraint":16,"./constraints/LockConstraint":17,"./constraints/PrismaticConstraint":18,"./constraints/RevoluteConstraint":19,"./equations/AngleLockEquation":20,"./equations/ContactEquation":21,"./equations/Equation":22,"./equations/FrictionEquation":23,"./equations/RotationalVelocityEquation":25,"./events/EventEmitter":26,"./material/ContactMaterial":27,"./material/Material":28,"./math/vec2":30,"./objects/Body":31,"./objects/LinearSpring":32,"./objects/RotationalSpring":33,"./objects/Spring":34,"./objects/TopDownVehicle":35,"./shapes/Box":37,"./shapes/Capsule":38,"./shapes/Circle":39,"./shapes/Convex":40,"./shapes/Heightfield":41,"./shapes/Line":42,"./shapes/Particle":43,"./shapes/Plane":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/ContactEquationPool":48,"./utils/FrictionEquationPool":49,"./utils/Pool":55,"./utils/Utils":57,"./world/World":61}],37:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(a={width:arguments[0],height:arguments[1]},console.warn("The Rectangle has been renamed to Box and its constructor signature has changed. Please use the following format: new Box({ width: 1, height: 1, ... })")),a=a||{};var b=this.width=a.width||1,c=this.height=a.height||1,d=[e.fromValues(-b/2,-c/2),e.fromValues(b/2,-c/2),e.fromValues(b/2,c/2),e.fromValues(-b/2,c/2)],h=[e.fromValues(1,0),e.fromValues(0,1)];a.vertices=d,a.axes=h,a.type=f.BOX,g.call(this,a)}var e=a("../math/vec2"),f=a("./Shape"),g=a("./Convex");b.exports=d,d.prototype=new g,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){var b=this.width,c=this.height;return a*(c*c+b*b)/12},d.prototype.updateBoundingRadius=function(){var a=this.width,b=this.height;this.boundingRadius=Math.sqrt(a*a+b*b)/2};e.create(),e.create(),e.create(),e.create();d.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c,0)},d.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":30,"./Convex":40,"./Shape":45}],38:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&"number"==typeof arguments[1]&&(a={length:arguments[0],radius:arguments[1]},console.warn("The Capsule constructor signature has changed. Please use the following format: new Capsule({ radius: 1, length: 1 })")),a=a||{},this.length=a.length||1,this.radius=a.radius||1,a.type=e.CAPSULE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){var b=this.radius,c=this.length+b,d=2*b;return a*(d*d+c*c)/12},d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2},d.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+2*this.radius*this.length};var g=f.create();d.prototype.computeAABB=function(a,b,c){var d=this.radius;f.set(g,this.length/2,0),0!==c&&f.rotate(g,g,c),f.set(a.upperBound,Math.max(g[0]+d,-g[0]+d),Math.max(g[1]+d,-g[1]+d)),f.set(a.lowerBound,Math.min(g[0]-d,-g[0]-d),Math.min(g[1]-d,-g[1]-d)),f.add(a.lowerBound,a.lowerBound,b),f.add(a.upperBound,a.upperBound,b)};var h=f.create(),i=f.create(),j=f.create(),k=f.create(),l=f.fromValues(0,1);d.prototype.raycast=function(a,b,c,d){for(var e=b.from,g=b.to,m=(b.direction,h),n=i,o=j,p=k,q=this.length/2,r=0;2>r;r++){var s=this.radius*(2*r-1);f.set(o,-q,s),f.set(p,q,s),f.toGlobalFrame(o,o,c,d),f.toGlobalFrame(p,p,c,d);var t=f.getLineSegmentsIntersectionFraction(e,g,o,p);if(t>=0&&(f.rotate(n,l,d),f.scale(n,n,2*r-1),b.reportIntersection(a,t,n,-1),a.shouldStop(b)))return}for(var u=Math.pow(this.radius,2)+Math.pow(q,2),r=0;2>r;r++){f.set(o,q*(2*r-1),0),f.toGlobalFrame(o,o,c,d);var v=Math.pow(g[0]-e[0],2)+Math.pow(g[1]-e[1],2),w=2*((g[0]-e[0])*(e[0]-o[0])+(g[1]-e[1])*(e[1]-o[1])),x=Math.pow(e[0]-o[0],2)+Math.pow(e[1]-o[1],2)-Math.pow(this.radius,2),t=Math.pow(w,2)-4*v*x;if(!(0>t))if(0===t){if(f.lerp(m,e,g,t),f.squaredDistance(m,c)>u&&(f.sub(n,m,o),f.normalize(n,n),b.reportIntersection(a,t,n,-1),a.shouldStop(b)))return}else{var y=Math.sqrt(t),z=1/(2*v),A=(-w-y)*z,B=(-w+y)*z;if(A>=0&&1>=A&&(f.lerp(m,e,g,A),f.squaredDistance(m,c)>u&&(f.sub(n,m,o),f.normalize(n,n),b.reportIntersection(a,A,n,-1),a.shouldStop(b))))return;if(B>=0&&1>=B&&(f.lerp(m,e,g,B),f.squaredDistance(m,c)>u&&(f.sub(n,m,o),f.normalize(n,n),b.reportIntersection(a,B,n,-1),a.shouldStop(b))))return}}}},{"../math/vec2":30,"./Shape":45}],39:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&(a={radius:arguments[0]},console.warn("The Circle constructor signature has changed. Please use the following format: new Circle({ radius: 1 })")),a=a||{},this.radius=a.radius||1,a.type=e.CIRCLE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){var b=this.radius;return a*b*b/2},d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius},d.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius},d.prototype.computeAABB=function(a,b,c){var d=this.radius;f.set(a.upperBound,d,d),f.set(a.lowerBound,-d,-d),b&&(f.add(a.lowerBound,a.lowerBound,b),f.add(a.upperBound,a.upperBound,b))};var g=f.create(),h=f.create();d.prototype.raycast=function(a,b,c,d){var e=b.from,i=b.to,j=this.radius,k=Math.pow(i[0]-e[0],2)+Math.pow(i[1]-e[1],2),l=2*((i[0]-e[0])*(e[0]-c[0])+(i[1]-e[1])*(e[1]-c[1])),m=Math.pow(e[0]-c[0],2)+Math.pow(e[1]-c[1],2)-Math.pow(j,2),n=Math.pow(l,2)-4*k*m,o=g,p=h;if(!(0>n))if(0===n)f.lerp(o,e,i,n),f.sub(p,o,c),f.normalize(p,p),b.reportIntersection(a,n,p,-1);else{var q=Math.sqrt(n),r=1/(2*k),s=(-l-q)*r,t=(-l+q)*r;if(s>=0&&1>=s&&(f.lerp(o,e,i,s),f.sub(p,o,c),f.normalize(p,p),b.reportIntersection(a,s,p,-1),a.shouldStop(b)))return;t>=0&&1>=t&&(f.lerp(o,e,i,t),f.sub(p,o,c),f.normalize(p,p),b.reportIntersection(a,t,p,-1))}}},{"../math/vec2":30,"./Shape":45}],40:[function(a,b,c){function d(a){Array.isArray(arguments[0])&&(a={vertices:arguments[0],axes:arguments[1]},console.warn("The Convex constructor signature has changed. Please use the following format: new Convex({ vertices: [...], ... })")),a=a||{},this.vertices=[];for(var b=void 0!==a.vertices?a.vertices:[],c=0;c<b.length;c++){var d=f.create();f.copy(d,b[c]),this.vertices.push(d)}if(this.axes=[],a.axes)for(var c=0;c<a.axes.length;c++){var g=f.create();f.copy(g,a.axes[c]),this.axes.push(g)}else for(var c=0;c<this.vertices.length;c++){var h=this.vertices[c],i=this.vertices[(c+1)%this.vertices.length],j=f.create();f.sub(j,i,h),f.rotate90cw(j,j),f.normalize(j,j),this.axes.push(j)}if(this.centerOfMass=f.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,a.type=e.CONVEX,e.call(this,a),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.")}var e=a("./Shape"),f=a("../math/vec2"),g=a("../math/polyk");a("poly-decomp");b.exports=d,d.prototype=new e,d.prototype.constructor=d;var h=f.create(),i=f.create();d.prototype.projectOntoLocalAxis=function(a,b){for(var c,d,e=null,g=null,a=h,i=0;i<this.vertices.length;i++)c=this.vertices[i],d=f.dot(c,a),(null===e||d>e)&&(e=d),(null===g||g>d)&&(g=d);if(g>e){var j=g;g=e,e=j}f.set(b,g,e)},d.prototype.projectOntoWorldAxis=function(a,b,c,d){var e=i;this.projectOntoLocalAxis(a,d),0!==c?f.rotate(e,a,c):e=a;var g=f.dot(b,e);f.set(d,d[0]+g,d[1]+g)},d.prototype.updateTriangles=function(){this.triangles.length=0;for(var a=[],b=0;b<this.vertices.length;b++){var c=this.vertices[b];a.push(c[0],c[1])}for(var d=g.Triangulate(a),b=0;b<d.length;b+=3){var e=d[b],f=d[b+1],h=d[b+2];this.triangles.push([e,f,h])}};var j=f.create(),k=f.create(),l=f.create(),m=f.create(),n=f.create();f.create(),f.create(),f.create(),f.create();d.prototype.updateCenterOfMass=function(){var a=this.triangles,b=this.vertices,c=this.centerOfMass,e=j,g=l,h=m,i=n,o=k;f.set(c,0,0);for(var p=0,q=0;q!==a.length;q++){var r=a[q],g=b[r[0]],h=b[r[1]],i=b[r[2]];f.centroid(e,g,h,i);var s=d.triangleArea(g,h,i);p+=s,f.scale(o,e,s),f.add(c,c,o)}f.scale(c,c,1/p)},d.prototype.computeMomentOfInertia=function(a){for(var b=0,c=0,d=this.vertices.length,e=d-1,g=0;d>g;e=g,g++){var h=this.vertices[e],i=this.vertices[g],j=Math.abs(f.crossLength(h,i)),k=f.dot(i,i)+f.dot(i,h)+f.dot(h,h);b+=j*k,c+=j}return a/6*(b/c)},d.prototype.updateBoundingRadius=function(){for(var a=this.vertices,b=0,c=0;c!==a.length;c++){var d=f.squaredLength(a[c]);d>b&&(b=d)}this.boundingRadius=Math.sqrt(b)},d.triangleArea=function(a,b,c){return.5*((b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]))},d.prototype.updateArea=function(){this.updateTriangles(),this.area=0;for(var a=this.triangles,b=this.vertices,c=0;c!==a.length;c++){var e=a[c],f=b[e[0]],g=b[e[1]],h=b[e[2]],i=d.triangleArea(f,g,h);this.area+=i}},d.prototype.computeAABB=function(a,b,c){a.setFromPoints(this.vertices,b,c,0)};var o=f.create(),p=f.create(),q=f.create();d.prototype.raycast=function(a,b,c,d){var e=o,g=p,h=q,i=this.vertices;f.toLocalFrame(e,b.from,c,d),f.toLocalFrame(g,b.to,c,d);for(var j=i.length,k=0;j>k&&!a.shouldStop(b);k++){var l=i[k],m=i[(k+1)%j],n=f.getLineSegmentsIntersectionFraction(e,g,l,m);n>=0&&(f.sub(h,m,l),f.rotate(h,h,-Math.PI/2+d),f.normalize(h,h),b.reportIntersection(a,n,h,k))}}},{"../math/polyk":29,"../math/vec2":30,"./Shape":45,"poly-decomp":5}],41:[function(a,b,c){function d(a){if(Array.isArray(arguments[0])){if(a={heights:arguments[0]},"object"==typeof arguments[1])for(var b in arguments[1])a[b]=arguments[1][b];console.warn("The Heightfield constructor signature has changed. Please use the following format: new Heightfield({ heights: [...], ... })")}a=a||{},this.heights=a.heights?a.heights.slice(0):[],this.maxValue=a.maxValue||null,this.minValue=a.minValue||null,this.elementWidth=a.elementWidth||.1,(void 0===a.maxValue||void 0===a.minValue)&&this.updateMaxMinValues(),a.type=e.HEIGHTFIELD,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");a("../utils/Utils");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.updateMaxMinValues=function(){for(var a=this.heights,b=a[0],c=a[0],d=0;d!==a.length;d++){var e=a[d];e>b&&(b=e),c>e&&(c=e)}this.maxValue=b,this.minValue=c},d.prototype.computeMomentOfInertia=function(a){return Number.MAX_VALUE},d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},d.prototype.updateArea=function(){for(var a=this.heights,b=0,c=0;c<a.length-1;c++)b+=(a[c]+a[c+1])/2*this.elementWidth;this.area=b};var g=[f.create(),f.create(),f.create(),f.create()];d.prototype.computeAABB=function(a,b,c){f.set(g[0],0,this.maxValue),f.set(g[1],this.elementWidth*this.heights.length,this.maxValue),f.set(g[2],this.elementWidth*this.heights.length,this.minValue),f.set(g[3],0,this.minValue),a.setFromPoints(g,b,c)},d.prototype.getLineSegment=function(a,b,c){var d=this.heights,e=this.elementWidth;f.set(a,c*e,d[c]),f.set(b,(c+1)*e,d[c+1])},d.prototype.getSegmentIndex=function(a){return Math.floor(a[0]/this.elementWidth)},d.prototype.getClampedSegmentIndex=function(a){var b=this.getSegmentIndex(a);return b=Math.min(this.heights.length,Math.max(b,0))};var h=(f.create(),f.create()),i=f.create(),j=f.create(),k=f.create(),l=f.create();f.fromValues(0,1);d.prototype.raycast=function(a,b,c,d){var e=b.from,g=b.to,m=(b.direction,h),n=i,o=j,p=k,q=l;f.toLocalFrame(p,e,c,d),f.toLocalFrame(q,g,c,d);var r=this.getClampedSegmentIndex(p),s=this.getClampedSegmentIndex(q);if(r>s){var t=r;r=s,s=t}for(var u=0;u<this.heights.length-1;u++){this.getLineSegment(n,o,u);var v=f.getLineSegmentsIntersectionFraction(p,q,n,o);if(v>=0&&(f.sub(m,o,n),f.rotate(m,m,d+Math.PI/2),f.normalize(m,m),b.reportIntersection(a,v,m,-1),a.shouldStop(b)))return}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],42:[function(a,b,c){function d(a){"number"==typeof arguments[0]&&(a={length:arguments[0]},console.warn("The Line constructor signature has changed. Please use the following format: new Line({ length: 1, ... })")),a=a||{},this.length=a.length||1,a.type=e.LINE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){return a*Math.pow(this.length,2)/12},d.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};var g=[f.create(),f.create()];d.prototype.computeAABB=function(a,b,c){var d=this.length/2;f.set(g[0],-d,0),f.set(g[1],d,0),a.setFromPoints(g,b,c,0)};var h=(f.create(),f.create()),i=f.create(),j=f.create(),k=f.fromValues(0,1);d.prototype.raycast=function(a,b,c,d){var e=b.from,g=b.to,l=i,m=j,n=this.length/2;f.set(l,-n,0),f.set(m,n,0),f.toGlobalFrame(l,l,c,d),f.toGlobalFrame(m,m,c,d);var o=f.getLineSegmentsIntersectionFraction(l,m,e,g);if(o>=0){var p=h;f.rotate(p,k,d),b.reportIntersection(a,o,p,-1)}}},{"../math/vec2":30,"./Shape":45}],43:[function(a,b,c){function d(a){a=a||{},a.type=e.PARTICLE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){return 0},d.prototype.updateBoundingRadius=function(){this.boundingRadius=0},d.prototype.computeAABB=function(a,b,c){f.copy(a.lowerBound,b),f.copy(a.upperBound,b)}},{"../math/vec2":30,"./Shape":45}],44:[function(a,b,c){function d(a){a=a||{},a.type=e.PLANE,e.call(this,a)}var e=a("./Shape"),f=a("../math/vec2");a("../utils/Utils");b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.computeMomentOfInertia=function(a){return 0},d.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE},d.prototype.computeAABB=function(a,b,c){var d=c%(2*Math.PI),e=f.set,g=1e7,h=a.lowerBound,i=a.upperBound;e(h,-g,-g),e(i,g,g),0===d?i[1]=0:d===Math.PI/2?h[0]=0:d===Math.PI?h[1]=0:d===3*Math.PI/2&&(i[0]=0)},d.prototype.updateArea=function(){this.area=Number.MAX_VALUE};var g=f.create(),h=(f.create(),f.create(),f.create()),i=f.create();d.prototype.raycast=function(a,b,c,d){var e=b.from,j=b.to,k=b.direction,l=g,m=h,n=i;f.set(m,0,1),f.rotate(m,m,d),f.sub(n,e,c);var o=f.dot(n,m);f.sub(n,j,c);var p=f.dot(n,m);if(!(o*p>0||f.squaredDistance(e,j)<o*o)){var q=f.dot(m,k);f.sub(l,e,c);var r=-f.dot(m,l)/q/b.length;b.reportIntersection(a,r,m,-1)}}},{"../math/vec2":30,"../utils/Utils":57,"./Shape":45}],45:[function(a,b,c){function d(a){a=a||{},this.body=null,this.position=e.fromValues(0,0),a.position&&e.copy(this.position,a.position),this.angle=a.angle||0,this.type=a.type||0,this.id=d.idCounter++,this.boundingRadius=0,this.collisionGroup=void 0!==a.collisionGroup?a.collisionGroup:1,this.collisionResponse=void 0!==a.collisionResponse?a.collisionResponse:!0,this.collisionMask=void 0!==a.collisionMask?a.collisionMask:1,this.material=a.material||null,this.area=0,this.sensor=void 0!==a.sensor?a.sensor:!1,this.type&&this.updateBoundingRadius(),this.updateArea()}b.exports=d;var e=a("../math/vec2");d.idCounter=0,d.CIRCLE=1,d.PARTICLE=2,d.PLANE=4,d.CONVEX=8,d.LINE=16,d.BOX=32,Object.defineProperty(d,"RECTANGLE",{get:function(){return console.warn("Shape.RECTANGLE is deprecated, use Shape.BOX instead."),d.BOX}}),d.CAPSULE=64,d.HEIGHTFIELD=128,d.prototype.computeMomentOfInertia=function(a){},d.prototype.updateBoundingRadius=function(){},d.prototype.updateArea=function(){},d.prototype.computeAABB=function(a,b,c){},d.prototype.raycast=function(a,b,c,d){}},{"../math/vec2":30}],46:[function(a,b,c){function d(a){g.call(this,a,g.GS),a=a||{},this.iterations=a.iterations||10,this.tolerance=a.tolerance||1e-7,this.arrayStep=30,this.lambda=new h.ARRAY_TYPE(this.arrayStep),
this.Bs=new h.ARRAY_TYPE(this.arrayStep),this.invCs=new h.ARRAY_TYPE(this.arrayStep),this.useZeroRHS=!1,this.frictionIterations=void 0!==a.frictionIterations?0:a.frictionIterations,this.usedIterations=0}function e(a){for(var b=a.length;b--;)a[b]=0}var f=a("../math/vec2"),g=a("./Solver"),h=a("../utils/Utils"),i=a("../equations/FrictionEquation");b.exports=d,d.prototype=new g,d.prototype.constructor=d,d.prototype.solve=function(a,b){this.sortEquations();var c=0,g=this.iterations,j=this.frictionIterations,k=this.equations,l=k.length,m=Math.pow(this.tolerance*l,2),n=b.bodies,o=b.bodies.length,p=(f.add,f.set,this.useZeroRHS),q=this.lambda;if(this.usedIterations=0,l)for(var r=0;r!==o;r++){var s=n[r];s.updateSolveMassProperties()}q.length<l&&(q=this.lambda=new h.ARRAY_TYPE(l+this.arrayStep),this.Bs=new h.ARRAY_TYPE(l+this.arrayStep),this.invCs=new h.ARRAY_TYPE(l+this.arrayStep)),e(q);for(var t=this.invCs,u=this.Bs,q=this.lambda,r=0;r!==k.length;r++){var v=k[r];(v.timeStep!==a||v.needsUpdate)&&(v.timeStep=a,v.update()),u[r]=v.computeB(v.a,v.b,a),t[r]=v.computeInvC(v.epsilon)}var v,w,r,x;if(0!==l){for(r=0;r!==o;r++){var s=n[r];s.resetConstraintVelocity()}if(j){for(c=0;c!==j;c++){for(w=0,x=0;x!==l;x++){v=k[x];var y=d.iterateEquation(x,v,v.epsilon,u,t,q,p,a,c);w+=Math.abs(y)}if(this.usedIterations++,m>=w*w)break}for(d.updateMultipliers(k,q,1/a),x=0;x!==l;x++){var z=k[x];if(z instanceof i){for(var A=0,B=0;B!==z.contactEquations.length;B++)A+=z.contactEquations[B].multiplier;A*=z.frictionCoefficient/z.contactEquations.length,z.maxForce=A,z.minForce=-A}}}for(c=0;c!==g;c++){for(w=0,x=0;x!==l;x++){v=k[x];var y=d.iterateEquation(x,v,v.epsilon,u,t,q,p,a,c);w+=Math.abs(y)}if(this.usedIterations++,m>=w*w)break}for(r=0;r!==o;r++)n[r].addConstraintVelocity();d.updateMultipliers(k,q,1/a)}},d.updateMultipliers=function(a,b,c){for(var d=a.length;d--;)a[d].multiplier=b[d]*c},d.iterateEquation=function(a,b,c,d,e,f,g,h,i){var j=d[a],k=e[a],l=f[a],m=b.computeGWlambda(),n=b.maxForce,o=b.minForce;g&&(j=0);var p=k*(j-m-c*l),q=l+p;return o*h>q?p=o*h-l:q>n*h&&(p=n*h-l),f[a]+=p,b.addToWlambda(p),p}},{"../equations/FrictionEquation":23,"../math/vec2":30,"../utils/Utils":57,"./Solver":47}],47:[function(a,b,c){function d(a,b){a=a||{},e.call(this),this.type=b,this.equations=[],this.equationSortFunction=a.equationSortFunction||!1}var e=(a("../utils/Utils"),a("../events/EventEmitter"));b.exports=d,d.prototype=new e,d.prototype.constructor=d,d.prototype.solve=function(a,b){throw new Error("Solver.solve should be implemented by subclasses!")};var f={bodies:[]};d.prototype.solveIsland=function(a,b){this.removeAllEquations(),b.equations.length&&(this.addEquations(b.equations),f.bodies.length=0,b.getBodies(f.bodies),f.bodies.length&&this.solve(a,f))},d.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)},d.prototype.addEquation=function(a){a.enabled&&this.equations.push(a)},d.prototype.addEquations=function(a){for(var b=0,c=a.length;b!==c;b++){var d=a[b];d.enabled&&this.equations.push(d)}},d.prototype.removeEquation=function(a){var b=this.equations.indexOf(a);-1!==b&&this.equations.splice(b,1)},d.prototype.removeAllEquations=function(){this.equations.length=0},d.GS=1,d.ISLAND=2},{"../events/EventEmitter":26,"../utils/Utils":57}],48:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../equations/ContactEquation"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.bodyA=a.bodyB=null,this}},{"../equations/ContactEquation":21,"./Pool":55}],49:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../equations/FrictionEquation"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.bodyA=a.bodyB=null,this}},{"../equations/FrictionEquation":23,"./Pool":55}],50:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../world/IslandNode"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.reset(),this}},{"../world/IslandNode":60,"./Pool":55}],51:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("../world/Island"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.reset(),this}},{"../world/Island":58,"./Pool":55}],52:[function(a,b,c){function d(){this.overlappingShapesLastState=new e,this.overlappingShapesCurrentState=new e,this.recordPool=new f({size:16}),this.tmpDict=new e,this.tmpArray1=[]}var e=a("./TupleDictionary"),f=(a("./OverlapKeeperRecord"),a("./OverlapKeeperRecordPool"));a("./Utils");b.exports=d,d.prototype.tick=function(){for(var a=this.overlappingShapesLastState,b=this.overlappingShapesCurrentState,c=a.keys.length;c--;){var d=a.keys[c],e=a.getByKey(d);b.getByKey(d);e&&this.recordPool.release(e)}a.reset(),a.copy(b),b.reset()},d.prototype.setOverlapping=function(a,b,c,d){var e=(this.overlappingShapesLastState,this.overlappingShapesCurrentState);if(!e.get(b.id,d.id)){var f=this.recordPool.get();f.set(a,b,c,d),e.set(b.id,d.id,f)}},d.prototype.getNewOverlaps=function(a){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,a)},d.prototype.getEndOverlaps=function(a){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,a)},d.prototype.bodiesAreOverlapping=function(a,b){for(var c=this.overlappingShapesCurrentState,d=c.keys.length;d--;){var e=c.keys[d],f=c.data[e];if(f.bodyA===a&&f.bodyB===b||f.bodyA===b&&f.bodyB===a)return!0}return!1},d.prototype.getDiff=function(a,b,c){var c=c||[],d=a,e=b;c.length=0;for(var f=e.keys.length;f--;){var g=e.keys[f],h=e.data[g];if(!h)throw new Error("Key "+g+" had no data!");var i=d.data[g];i||c.push(h)}return c},d.prototype.isNewOverlap=function(a,b){var c=0|a.id,d=0|b.id,e=this.overlappingShapesLastState,f=this.overlappingShapesCurrentState;return!e.get(c,d)&&!!f.get(c,d)},d.prototype.getNewBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)},d.prototype.getEndBodyOverlaps=function(a){this.tmpArray1.length=0;var b=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(b,a)},d.prototype.getBodyDiff=function(a,b){b=b||[];for(var c=this.tmpDict,d=a.length;d--;){var e=a[d];c.set(0|e.bodyA.id,0|e.bodyB.id,e)}for(d=c.keys.length;d--;){var e=c.getByKey(c.keys[d]);e&&b.push(e.bodyA,e.bodyB)}return c.reset(),b}},{"./OverlapKeeperRecord":53,"./OverlapKeeperRecordPool":54,"./TupleDictionary":56,"./Utils":57}],53:[function(a,b,c){function d(a,b,c,d){this.shapeA=b,this.shapeB=d,this.bodyA=a,this.bodyB=c}b.exports=d,d.prototype.set=function(a,b,c,e){d.call(this,a,b,c,e)}},{}],54:[function(a,b,c){function d(){f.apply(this,arguments)}var e=a("./OverlapKeeperRecord"),f=a("./Pool");b.exports=d,d.prototype=new f,d.prototype.constructor=d,d.prototype.create=function(){return new e},d.prototype.destroy=function(a){return a.bodyA=a.bodyB=a.shapeA=a.shapeB=null,this}},{"./OverlapKeeperRecord":53,"./Pool":55}],55:[function(a,b,c){function d(a){a=a||{},this.objects=[],void 0!==a.size&&this.resize(a.size)}b.exports=d,d.prototype.resize=function(a){for(var b=this.objects;b.length>a;)b.pop();for(;b.length<a;)b.push(this.create());return this},d.prototype.get=function(){var a=this.objects;return a.length?a.pop():this.create()},d.prototype.release=function(a){return this.destroy(a),this.objects.push(a),this}},{}],56:[function(a,b,c){function d(){this.data={},this.keys=[]}var e=a("./Utils");b.exports=d,d.prototype.getKey=function(a,b){return a=0|a,b=0|b,(0|a)===(0|b)?-1:0|((0|a)>(0|b)?a<<16|65535&b:b<<16|65535&a)},d.prototype.getByKey=function(a){return a=0|a,this.data[a]},d.prototype.get=function(a,b){return this.data[this.getKey(a,b)]},d.prototype.set=function(a,b,c){if(!c)throw new Error("No data!");var d=this.getKey(a,b);return this.data[d]||this.keys.push(d),this.data[d]=c,d},d.prototype.reset=function(){for(var a=this.data,b=this.keys,c=b.length;c--;)delete a[b[c]];b.length=0},d.prototype.copy=function(a){this.reset(),e.appendArray(this.keys,a.keys);for(var b=a.keys.length;b--;){var c=a.keys[b];this.data[c]=a.data[c]}}},{"./Utils":57}],57:[function(a,b,c){function d(){}b.exports=d,d.appendArray=function(a,b){if(b.length<15e4)a.push.apply(a,b);else for(var c=0,d=b.length;c!==d;++c)a.push(b[c])},d.splice=function(a,b,c){c=c||1;for(var d=b,e=a.length-c;e>d;d++)a[d]=a[d+c];a.length=e},"undefined"!=typeof P2_ARRAY_TYPE?d.ARRAY_TYPE=P2_ARRAY_TYPE:"undefined"!=typeof Float32Array?d.ARRAY_TYPE=Float32Array:d.ARRAY_TYPE=Array,d.extend=function(a,b){for(var c in b)a[c]=b[c]},d.defaults=function(a,b){a=a||{};for(var c in b)c in a||(a[c]=b[c]);return a}},{}],58:[function(a,b,c){function d(){this.equations=[],this.bodies=[]}var e=a("../objects/Body");b.exports=d,d.prototype.reset=function(){this.equations.length=this.bodies.length=0};var f=[];d.prototype.getBodies=function(a){var b=a||[],c=this.equations;f.length=0;for(var d=0;d!==c.length;d++){var e=c[d];-1===f.indexOf(e.bodyA.id)&&(b.push(e.bodyA),f.push(e.bodyA.id)),-1===f.indexOf(e.bodyB.id)&&(b.push(e.bodyB),f.push(e.bodyB.id))}return b},d.prototype.wantsToSleep=function(){for(var a=0;a<this.bodies.length;a++){var b=this.bodies[a];if(b.type===e.DYNAMIC&&!b.wantsToSleep)return!1}return!0},d.prototype.sleep=function(){for(var a=0;a<this.bodies.length;a++){var b=this.bodies[a];b.sleep()}return!0}},{"../objects/Body":31}],59:[function(a,b,c){function d(a){this.nodePool=new e({size:16}),this.islandPool=new f({size:8}),this.equations=[],this.islands=[],this.nodes=[],this.queue=[]}var e=(a("../math/vec2"),a("./Island"),a("./IslandNode"),a("./../utils/IslandNodePool")),f=a("./../utils/IslandPool"),g=a("../objects/Body");b.exports=d,d.getUnvisitedNode=function(a){for(var b=a.length,c=0;c!==b;c++){var d=a[c];if(!d.visited&&d.body.type===g.DYNAMIC)return d}return!1},d.prototype.visit=function(a,b,c){b.push(a.body);for(var d=a.equations.length,e=0;e!==d;e++){var f=a.equations[e];-1===c.indexOf(f)&&c.push(f)}},d.prototype.bfs=function(a,b,c){var e=this.queue;for(e.length=0,e.push(a),a.visited=!0,this.visit(a,b,c);e.length;)for(var f,h=e.pop();f=d.getUnvisitedNode(h.neighbors);)f.visited=!0,this.visit(f,b,c),f.body.type===g.DYNAMIC&&e.push(f)},d.prototype.split=function(a){for(var b=a.bodies,c=this.nodes,e=this.equations;c.length;)this.nodePool.release(c.pop());for(var f=0;f!==b.length;f++){var g=this.nodePool.get();g.body=b[f],c.push(g)}for(var h=0;h!==e.length;h++){var i=e[h],f=b.indexOf(i.bodyA),j=b.indexOf(i.bodyB),k=c[f],l=c[j];k.neighbors.push(l),l.neighbors.push(k),k.equations.push(i),l.equations.push(i)}for(var m=this.islands,f=0;f<m.length;f++)this.islandPool.release(m[f]);m.length=0;for(var n;n=d.getUnvisitedNode(c);){var o=this.islandPool.get();this.bfs(n,o.bodies,o.equations),m.push(o)}return m}},{"../math/vec2":30,"../objects/Body":31,"./../utils/IslandNodePool":50,"./../utils/IslandPool":51,"./Island":58,"./IslandNode":60}],60:[function(a,b,c){function d(a){this.body=a,this.neighbors=[],this.equations=[],this.visited=!1}b.exports=d,d.prototype.reset=function(){this.equations.length=0,this.neighbors.length=0,this.visited=!1,this.body=null}},{}],61:[function(a,b,c){function d(a){l.apply(this),a=a||{},this.springs=[],this.bodies=[],this.disabledBodyCollisionPairs=[],this.solver=a.solver||new e,this.narrowphase=new r(this),this.islandManager=new u,this.gravity=f.fromValues(0,-9.78),a.gravity&&f.copy(this.gravity,a.gravity),this.frictionGravity=f.length(this.gravity)||10,this.useWorldGravityAsFrictionGravity=!0,this.useFrictionGravityOnZeroGravity=!0,this.broadphase=a.broadphase||new q,this.broadphase.setWorld(this),this.constraints=[],this.defaultMaterial=new n,this.defaultContactMaterial=new o(this.defaultMaterial,this.defaultMaterial),this.lastTimeStep=1/60,this.applySpringForces=!0,this.applyDamping=!0,this.applyGravity=!0,this.solveConstraints=!0,this.contactMaterials=[],this.time=0,this.accumulator=0,this.stepping=!1,this.bodiesToBeRemoved=[],this.islandSplit="undefined"!=typeof a.islandSplit?!!a.islandSplit:!0,this.emitImpactEvent=!0,this._constraintIdCounter=0,this._bodyIdCounter=0,this.postStepEvent={type:"postStep"},this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null},this.addSpringEvent={type:"addSpring",spring:null},this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null},this.postBroadphaseEvent={type:"postBroadphase",pairs:null},this.sleepMode=d.NO_SLEEPING,this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]},this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null},this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null},this.overlappingShapesLastState={keys:[]},this.overlappingShapesCurrentState={keys:[]},this.overlapKeeper=new t}var e=a("../solver/GSSolver"),f=(a("../solver/Solver"),a("../collision/Ray"),a("../math/vec2")),g=a("../shapes/Circle"),h=a("../shapes/Convex"),i=(a("../shapes/Line"),a("../shapes/Plane")),j=a("../shapes/Capsule"),k=a("../shapes/Particle"),l=a("../events/EventEmitter"),m=a("../objects/Body"),n=(a("../shapes/Shape"),a("../objects/LinearSpring"),a("../material/Material")),o=a("../material/ContactMaterial"),p=(a("../constraints/DistanceConstraint"),a("../constraints/Constraint"),a("../constraints/LockConstraint"),a("../constraints/RevoluteConstraint"),a("../constraints/PrismaticConstraint"),a("../constraints/GearConstraint"),a("../../package.json"),a("../collision/Broadphase"),a("../collision/AABB")),q=a("../collision/SAPBroadphase"),r=a("../collision/Narrowphase"),s=a("../utils/Utils"),t=a("../utils/OverlapKeeper"),u=a("./IslandManager");a("../objects/RotationalSpring");b.exports=d,d.prototype=new Object(l.prototype),d.prototype.constructor=d,d.NO_SLEEPING=1,d.BODY_SLEEPING=2,d.ISLAND_SLEEPING=4,d.prototype.addConstraint=function(a){this.constraints.push(a)},d.prototype.addContactMaterial=function(a){this.contactMaterials.push(a)},d.prototype.removeContactMaterial=function(a){var b=this.contactMaterials.indexOf(a);-1!==b&&s.splice(this.contactMaterials,b,1)},d.prototype.getContactMaterial=function(a,b){for(var c=this.contactMaterials,d=0,e=c.length;d!==e;d++){var f=c[d];if(f.materialA.id===a.id&&f.materialB.id===b.id||f.materialA.id===b.id&&f.materialB.id===a.id)return f}return!1},d.prototype.removeConstraint=function(a){var b=this.constraints.indexOf(a);-1!==b&&s.splice(this.constraints,b,1)};var v=(f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()),w=f.fromValues(0,0),x=f.fromValues(0,0);f.fromValues(0,0),f.fromValues(0,0);d.prototype.step=function(a,b,c){if(c=c||10,b=b||0,0===b)this.internalStep(a),this.time+=a;else{this.accumulator+=b;for(var d=0;this.accumulator>=a&&c>d;)this.internalStep(a),this.time+=a,this.accumulator-=a,d++;for(var e=this.accumulator%a/a,g=0;g!==this.bodies.length;g++){var h=this.bodies[g];f.lerp(h.interpolatedPosition,h.previousPosition,h.position,e),h.interpolatedAngle=h.previousAngle+e*(h.angle-h.previousAngle)}}};var y=[];d.prototype.internalStep=function(a){this.stepping=!0;var b=this.springs.length,c=this.springs,e=this.bodies,g=this.gravity,h=this.solver,i=this.bodies.length,j=this.broadphase,k=this.narrowphase,l=this.constraints,n=v,o=(f.scale,f.add),p=(f.rotate,this.islandManager);if(this.overlapKeeper.tick(),this.lastTimeStep=a,this.useWorldGravityAsFrictionGravity){var q=f.length(this.gravity);0===q&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=q)}if(this.applyGravity)for(var r=0;r!==i;r++){var t=e[r],u=t.force;t.type===m.DYNAMIC&&t.sleepState!==m.SLEEPING&&(f.scale(n,g,t.mass*t.gravityScale),o(u,u,n))}if(this.applySpringForces)for(var r=0;r!==b;r++){var w=c[r];w.applyForce()}if(this.applyDamping)for(var r=0;r!==i;r++){var t=e[r];t.type===m.DYNAMIC&&t.applyDamping(a)}for(var x=j.getCollisionPairs(this),z=this.disabledBodyCollisionPairs,r=z.length-2;r>=0;r-=2)for(var A=x.length-2;A>=0;A-=2)(z[r]===x[A]&&z[r+1]===x[A+1]||z[r+1]===x[A]&&z[r]===x[A+1])&&x.splice(A,2);var B=l.length;for(r=0;r!==B;r++){var C=l[r];if(!C.collideConnected)for(var A=x.length-2;A>=0;A-=2)(C.bodyA===x[A]&&C.bodyB===x[A+1]||C.bodyB===x[A]&&C.bodyA===x[A+1])&&x.splice(A,2)}this.postBroadphaseEvent.pairs=x,this.emit(this.postBroadphaseEvent),this.postBroadphaseEvent.pairs=null,k.reset(this);for(var r=0,D=x.length;r!==D;r+=2)for(var E=x[r],F=x[r+1],G=0,H=E.shapes.length;G!==H;G++)for(var I=E.shapes[G],J=I.position,K=I.angle,L=0,M=F.shapes.length;L!==M;L++){var N=F.shapes[L],O=N.position,P=N.angle,Q=this.defaultContactMaterial;if(I.material&&N.material){var R=this.getContactMaterial(I.material,N.material);R&&(Q=R)}this.runNarrowphase(k,E,I,J,K,F,N,O,P,Q,this.frictionGravity)}for(var r=0;r!==i;r++){var S=e[r];S._wakeUpAfterNarrowphase&&(S.wakeUp(),S._wakeUpAfterNarrowphase=!1)}if(this.has("endContact")){this.overlapKeeper.getEndOverlaps(y);for(var T=this.endContactEvent,L=y.length;L--;){var U=y[L];T.shapeA=U.shapeA,T.shapeB=U.shapeB,T.bodyA=U.bodyA,T.bodyB=U.bodyB,this.emit(T)}y.length=0}var V=this.preSolveEvent;V.contactEquations=k.contactEquations,V.frictionEquations=k.frictionEquations,this.emit(V),V.contactEquations=V.frictionEquations=null;var B=l.length;for(r=0;r!==B;r++)l[r].update();if(k.contactEquations.length||k.frictionEquations.length||B)if(this.islandSplit){for(p.equations.length=0,s.appendArray(p.equations,k.contactEquations),s.appendArray(p.equations,k.frictionEquations),r=0;r!==B;r++)s.appendArray(p.equations,l[r].equations);p.split(this);for(var r=0;r!==p.islands.length;r++){var W=p.islands[r];W.equations.length&&h.solveIsland(a,W)}}else{for(h.addEquations(k.contactEquations),h.addEquations(k.frictionEquations),r=0;r!==B;r++)h.addEquations(l[r].equations);this.solveConstraints&&h.solve(a,this),h.removeAllEquations()}for(var r=0;r!==i;r++){var S=e[r];S.integrate(a)}for(var r=0;r!==i;r++)e[r].setZeroForce();if(this.emitImpactEvent&&this.has("impact"))for(var X=this.impactEvent,r=0;r!==k.contactEquations.length;r++){var Y=k.contactEquations[r];Y.firstImpact&&(X.bodyA=Y.bodyA,X.bodyB=Y.bodyB,X.shapeA=Y.shapeA,X.shapeB=Y.shapeB,X.contactEquation=Y,this.emit(X))}if(this.sleepMode===d.BODY_SLEEPING)for(r=0;r!==i;r++)e[r].sleepTick(this.time,!1,a);else if(this.sleepMode===d.ISLAND_SLEEPING&&this.islandSplit){for(r=0;r!==i;r++)e[r].sleepTick(this.time,!0,a);for(var r=0;r<this.islandManager.islands.length;r++){var W=this.islandManager.islands[r];W.wantsToSleep()&&W.sleep()}}this.stepping=!1;for(var Z=this.bodiesToBeRemoved,r=0;r!==Z.length;r++)this.removeBody(Z[r]);Z.length=0,this.emit(this.postStepEvent)},d.prototype.runNarrowphase=function(a,b,c,d,e,g,h,i,j,k,l){if(0!==(c.collisionGroup&h.collisionMask)&&0!==(h.collisionGroup&c.collisionMask)){f.rotate(w,d,b.angle),f.rotate(x,i,g.angle),f.add(w,w,b.position),f.add(x,x,g.position);var n=e+b.angle,o=j+g.angle;a.enableFriction=k.friction>0,a.frictionCoefficient=k.friction;var p;p=b.type===m.STATIC||b.type===m.KINEMATIC?g.mass:g.type===m.STATIC||g.type===m.KINEMATIC?b.mass:b.mass*g.mass/(b.mass+g.mass),a.slipForce=k.friction*l*p,a.restitution=k.restitution,a.surfaceVelocity=k.surfaceVelocity,a.frictionStiffness=k.frictionStiffness,a.frictionRelaxation=k.frictionRelaxation,a.stiffness=k.stiffness,a.relaxation=k.relaxation,a.contactSkinSize=k.contactSkinSize,a.enabledEquations=b.collisionResponse&&g.collisionResponse&&c.collisionResponse&&h.collisionResponse;var q=a[c.type|h.type],r=0;if(q){var s=c.sensor||h.sensor,t=a.frictionEquations.length;r=c.type<h.type?q.call(a,b,c,w,n,g,h,x,o,s):q.call(a,g,h,x,o,b,c,w,n,s);var u=a.frictionEquations.length-t;if(r){if(b.allowSleep&&b.type===m.DYNAMIC&&b.sleepState===m.SLEEPING&&g.sleepState===m.AWAKE&&g.type!==m.STATIC){var v=f.squaredLength(g.velocity)+Math.pow(g.angularVelocity,2),y=Math.pow(g.sleepSpeedLimit,2);v>=2*y&&(b._wakeUpAfterNarrowphase=!0)}if(g.allowSleep&&g.type===m.DYNAMIC&&g.sleepState===m.SLEEPING&&b.sleepState===m.AWAKE&&b.type!==m.STATIC){var z=f.squaredLength(b.velocity)+Math.pow(b.angularVelocity,2),A=Math.pow(b.sleepSpeedLimit,2);z>=2*A&&(g._wakeUpAfterNarrowphase=!0)}if(this.overlapKeeper.setOverlapping(b,c,g,h),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(c,h)){var B=this.beginContactEvent;if(B.shapeA=c,B.shapeB=h,B.bodyA=b,B.bodyB=g,B.contactEquations.length=0,"number"==typeof r)for(var C=a.contactEquations.length-r;C<a.contactEquations.length;C++)B.contactEquations.push(a.contactEquations[C]);this.emit(B)}if("number"==typeof r&&u>1)for(var C=a.frictionEquations.length-u;C<a.frictionEquations.length;C++){var D=a.frictionEquations[C];D.setSlipForce(D.getSlipForce()/u)}}}}},d.prototype.addSpring=function(a){this.springs.push(a);var b=this.addSpringEvent;b.spring=a,this.emit(b),b.spring=null},d.prototype.removeSpring=function(a){var b=this.springs.indexOf(a);-1!==b&&s.splice(this.springs,b,1)},d.prototype.addBody=function(a){if(-1===this.bodies.indexOf(a)){this.bodies.push(a),a.world=this;var b=this.addBodyEvent;b.body=a,this.emit(b),b.body=null}},d.prototype.removeBody=function(a){if(this.stepping)this.bodiesToBeRemoved.push(a);else{a.world=null;var b=this.bodies.indexOf(a);-1!==b&&(s.splice(this.bodies,b,1),this.removeBodyEvent.body=a,a.resetConstraintVelocity(),this.emit(this.removeBodyEvent),this.removeBodyEvent.body=null)}},d.prototype.getBodyById=function(a){for(var b=this.bodies,c=0;c<b.length;c++){var d=b[c];if(d.id===a)return d}return!1},d.prototype.disableBodyCollision=function(a,b){this.disabledBodyCollisionPairs.push(a,b)},d.prototype.enableBodyCollision=function(a,b){for(var c=this.disabledBodyCollisionPairs,d=0;d<c.length;d+=2)if(c[d]===a&&c[d+1]===b||c[d+1]===a&&c[d]===b)return void c.splice(d,2)},d.prototype.clear=function(){this.time=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations();for(var a=this.constraints,b=a.length-1;b>=0;b--)this.removeConstraint(a[b]);for(var c=this.bodies,b=c.length-1;b>=0;b--)this.removeBody(c[b]);for(var e=this.springs,b=e.length-1;b>=0;b--)this.removeSpring(e[b]);for(var f=this.contactMaterials,b=f.length-1;b>=0;b--)this.removeContactMaterial(f[b]);d.apply(this)};var z=f.create(),A=(f.fromValues(0,0),f.fromValues(0,0));d.prototype.hitTest=function(a,b,c){c=c||0;var d=new m({position:a}),e=new k,l=a,n=0,o=z,p=A;d.addShape(e);for(var q=this.narrowphase,r=[],s=0,t=b.length;s!==t;s++)for(var u=b[s],v=0,w=u.shapes.length;v!==w;v++){var x=u.shapes[v];f.rotate(o,x.position,u.angle),f.add(o,o,u.position);var y=x.angle+u.angle;(x instanceof g&&q.circleParticle(u,x,o,y,d,e,l,n,!0)||x instanceof h&&q.particleConvex(d,e,l,n,u,x,o,y,!0)||x instanceof i&&q.particlePlane(d,e,l,n,u,x,o,y,!0)||x instanceof j&&q.particleCapsule(d,e,l,n,u,x,o,y,!0)||x instanceof k&&f.squaredLength(f.sub(p,o,a))<c*c)&&r.push(u)}return r},d.prototype.setGlobalStiffness=function(a){for(var b=this.constraints,c=0;c!==b.length;c++)for(var d=b[c],e=0;e!==d.equations.length;e++){var f=d.equations[e];f.stiffness=a,f.needsUpdate=!0}for(var g=this.contactMaterials,c=0;c!==g.length;c++){var d=g[c];d.stiffness=d.frictionStiffness=a}var d=this.defaultContactMaterial;d.stiffness=d.frictionStiffness=a},d.prototype.setGlobalRelaxation=function(a){for(var b=0;b!==this.constraints.length;b++)for(var c=this.constraints[b],d=0;d!==c.equations.length;d++){var e=c.equations[d];e.relaxation=a,e.needsUpdate=!0}for(var b=0;b!==this.contactMaterials.length;b++){var c=this.contactMaterials[b];c.relaxation=c.frictionRelaxation=a}var c=this.defaultContactMaterial;c.relaxation=c.frictionRelaxation=a};var B=new p,C=[];d.prototype.raycast=function(a,b){return b.getAABB(B),this.broadphase.aabbQuery(this,B,C),b.intersectBodies(a,C),C.length=0,a.hasHit()}},{"../../package.json":6,"../collision/AABB":7,"../collision/Broadphase":8,"../collision/Narrowphase":10,"../collision/Ray":11,"../collision/SAPBroadphase":13,"../constraints/Constraint":14,"../constraints/DistanceConstraint":15,"../constraints/GearConstraint":16,"../constraints/LockConstraint":17,"../constraints/PrismaticConstraint":18,"../constraints/RevoluteConstraint":19,"../events/EventEmitter":26,"../material/ContactMaterial":27,"../material/Material":28,"../math/vec2":30,"../objects/Body":31,"../objects/LinearSpring":32,"../objects/RotationalSpring":33,"../shapes/Capsule":38,"../shapes/Circle":39,"../shapes/Convex":40,"../shapes/Line":42,"../shapes/Particle":43,"../shapes/Plane":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":52,"../utils/Utils":57,"./IslandManager":59}]},{},[36])(36)});

var KinematicBody=pc.createScript("kinematicBody");KinematicBody.prototype.initialize=function(){this.time=0},KinematicBody.prototype.update=function(i){this.time+=i,this.entity.script.p2Body.body.velocity[1]=2*Math.sin(2*this.time)};var PhysicsFilter=pc.createScript("physicsFilter");PhysicsFilter.attributes.add("groupA",{type:"boolean",title:"Group A",default:!1}),PhysicsFilter.attributes.add("groupB",{type:"boolean",title:"Group B",default:!1}),PhysicsFilter.attributes.add("groupC",{type:"boolean",title:"Group C",default:!1}),PhysicsFilter.attributes.add("groupD",{type:"boolean",title:"Group D",default:!1}),PhysicsFilter.attributes.add("groupE",{type:"boolean",title:"Group E",default:!1}),PhysicsFilter.attributes.add("groupF",{type:"boolean",title:"Group F",default:!1}),PhysicsFilter.attributes.add("groupG",{type:"boolean",title:"Group G",default:!1}),PhysicsFilter.attributes.add("groupH",{type:"boolean",title:"Group H",default:!1}),PhysicsFilter.attributes.add("maskA",{type:"boolean",title:"Mask A",default:!1}),PhysicsFilter.attributes.add("maskB",{type:"boolean",title:"Mask B",default:!1}),PhysicsFilter.attributes.add("maskC",{type:"boolean",title:"Mask C",default:!1}),PhysicsFilter.attributes.add("maskD",{type:"boolean",title:"Mask D",default:!1}),PhysicsFilter.attributes.add("maskE",{type:"boolean",title:"Mask E",default:!1}),PhysicsFilter.attributes.add("maskF",{type:"boolean",title:"Mask F",default:!1}),PhysicsFilter.attributes.add("maskG",{type:"boolean",title:"Mask G",default:!1}),PhysicsFilter.attributes.add("maskH",{type:"boolean",title:"Mask H",default:!1}),PhysicsFilter.A=8,PhysicsFilter.B=16,PhysicsFilter.C=32,PhysicsFilter.D=64,PhysicsFilter.E=128,PhysicsFilter.F=256,PhysicsFilter.G=512,PhysicsFilter.H=1024,PhysicsFilter.prototype.initialize=function(){this.entity.rigidbody.group=(this.groupA?PhysicsFilter.A:0)|(this.groupB?PhysicsFilter.B:0)|(this.groupC?PhysicsFilter.C:0)|(this.groupD?PhysicsFilter.D:0)|(this.groupE?PhysicsFilter.E:0)|(this.groupF?PhysicsFilter.F:0)|(this.groupG?PhysicsFilter.G:0)|(this.groupH?PhysicsFilter.H:0),this.entity.rigidbody.mask=(this.maskA?PhysicsFilter.A:0)|(this.maskB?PhysicsFilter.B:0)|(this.maskC?PhysicsFilter.C:0)|(this.maskD?PhysicsFilter.D:0)|(this.maskE?PhysicsFilter.E:0)|(this.maskF?PhysicsFilter.F:0)|(this.maskG?PhysicsFilter.G:0)|(this.maskH?PhysicsFilter.H:0)};var CanvasController=pc.createScript("canvasController");CanvasController.prototype.posInit=function(){canvas.setTutorialData(),canvas.setSoundData(),canvas.PaintCoins()},CanvasController.prototype.quickStart=function(){skipMenu&&!canvas.juegoEmpezado&&(skipMenu=!1,canvas.juegoEmpezado=!0,playSound("mainMenuClick"),console.log("Play 9 Balls"),canvas.CerrarCortinas((function(){canvas.mainMenuGUI9Ball.enabled=!1,canvas.menu_storeButton.enabled=!1,canvas.menu_settings.enabled=!1,canvas.store_coins.enabled=!1,canvas.GroupHeaderGame.enabled=!0,canvas.enableHeaderGame(!0),system.InitFirstTImeGame9Balls(),system.StartGame9Balls(),_GUI_OPEN=!1,window.setTimeout((function(){canvas.AbrirCortinas((function(){}))}),200)})))},CanvasController.prototype.setTime_eazegames=function(a){_LIMIT_TIME_TURN_SECONDS=a},CanvasController.prototype.finalForzado=function(){_LIMIT_TIME_TURN_SECONDS=0,system.b_GAME_FINISHED=!0,system.FinishEASEgame()},CanvasController.prototype.UnMute=function(){_9_BALLS_SOUND=!0,canvas._9Balls_soundButton.children[0].enabled=!1,canvas._9Balls_soundButton.children[1].enabled=!0,soundEnabled=_9_BALLS_SOUND,mute=0,saveVariables(mute+"","mute"),unmuteMusic()},CanvasController.prototype.Mute=function(){_9_BALLS_SOUND=!1,canvas._9Balls_soundButton.children[0].enabled=!0,canvas._9Balls_soundButton.children[1].enabled=!1,soundEnabled=_9_BALLS_SOUND,mute=1,saveVariables(mute+"","mute"),muteMusic()},CanvasController.prototype.initialize=function(){if(canvas=this,_menu=this,this.juegoEmpezado=!1,_IS_PHONE=isMobile.any(),canvas.cancelGUI=!1,getAllVars(),canvas.mainMenuGUI9Ball=this.app.root.findByName("MainMenuGUI9Ball"),canvas.ButtonClickToPlay9b=canvas.mainMenuGUI9Ball.children[2],canvas.mainMenuGUI=this.app.root.findByName("MainMenuGUI"),canvas.menu_settings=this.app.root.findByName("menu_settings"),canvas.menu_playCpuButton=this.app.root.findByName("menu_playCpuButton"),canvas.menu_playMultiplayerButton=this.app.root.findByName("menu_playMultiplayerButton"),canvas.menu_storeButton=this.app.root.findByName("menu_storeButton"),canvas.GroupHeaderGame=this.app.root.findByName("GroupHeaderGame"),canvas.GroupHeaderStore=this.app.root.findByName("GroupHeaderStore"),canvas.store_backButton=this.app.root.findByName("store_backButton"),_IS_PHONE){var a=canvas.store_backButton.getLocalPosition().clone();canvas.store_backButton.setLocalPosition(a.x,-140,a.z)}else{a=canvas.store_backButton.getLocalPosition().clone();canvas.store_backButton.setLocalPosition(a.x,-26,a.z)}if(canvas.textStoreCoins=this.app.root.findByName("textoStoreCoins"),canvas.textStoreCoins.element.text=_COINS.toString(),canvas.Store_upBar=this.app.root.findByName("Store_upBar"),canvas.store_coins=this.app.root.findByName("store_coins"),canvas.Store_slots=this.app.root.findByName("Store_slots"),canvas.Store_slotsP=this.app.root.findByName("Store_slotsP"),canvas._9BallsIndicatorL=this.app.root.findByName("_9BallsIndicator"),canvas._9BallsIndicatorRightL=this.app.root.findByName("_9BallsIndicatorRight"),canvas._9BallsIndicatorP=this.app.root.findByName("_9BallsIndicator_Portrait"),canvas._9BallsIndicatorRightP=this.app.root.findByName("_9BallsIndicatorRight_Portrait"),canvas._9BallsIndicator=null,canvas._9BallsIndicatorRight=null,canvas.score9Balls=null,canvas._9Balls_tutorialButton=this.app.root.findByName("_9Balls_tutorialButton"),canvas._9Balls_tutorialButtonP=this.app.root.findByName("_9Balls_tutorialButton_portrait"),canvas.pause9Balls=this.app.root.findByName("pause9Balls"),canvas.howToPlay9Balls=canvas.pause9Balls.children[0],canvas.endgame9Balls=canvas.pause9Balls.children[1],canvas.resume9Balls=canvas.pause9Balls.children[2],continuePanel=this.app.root.findByName("continuePanel"),canvas._9Balls_soundButton=this.app.root.findByName("_9Balls_soundButton"),canvas._9Balls_soundButtonP=this.app.root.findByName("_9Balls_soundButton_portrait"),canvas.panelInstrucciones=this.app.root.findByName("panelInstrucciones"),canvas.panelInstruccionesCruz=canvas.panelInstrucciones.children[0],canvas.panelInstruccionesCruzAll=canvas.panelInstrucciones.children[3],canvas.panelInstrucciones.enabled=!1,canvas.YouWin9Balls=this.app.root.findByName("YouWin9Balls"),canvas.finalScoreText=canvas.YouWin9Balls.children[1],canvas.botonRestart=canvas.YouWin9Balls.children[2],canvas.finalBestText=canvas.YouWin9Balls.children[3],canvas.finalRewardCoins=canvas.YouWin9Balls.children[4],canvas.botonHome=canvas.YouWin9Balls.children[5],canvas.botonReward=canvas.YouWin9Balls.children[6],canvas.botonNoReward=canvas.YouWin9Balls.children[7],canvas.YouWin9Balls.enabled=!1,0==_LANGUAGE?canvas._9BallReadyGo=this.app.root.findByName("_9BallReadyGo"):1==_LANGUAGE?canvas._9BallReadyGo=this.app.root.findByName("_9BallReadyGoNL"):2==_LANGUAGE&&(canvas._9BallReadyGo=this.app.root.findByName("_9BallReadyGoNLGER")),canvas._9BallReadyGo.enabled=!1,canvas._9BallCortinaUp=this.app.root.findByName("_9BallCortinaUp"),canvas._9BallCortinaDown=this.app.root.findByName("_9BallCortinaDown"),canvas.posCortinaUp=canvas._9BallCortinaUp.getLocalPosition().clone(),canvas.posCortinaDown=canvas._9BallCortinaDown.getLocalPosition().clone(),canvas.CerrarCortinas=function(a){console.log("CErrar cortinas"),canvas._9BallCortinaUp.enabled=!0;var n=new pc.Vec3(canvas._9BallCortinaUp.getLocalPosition().clone().x,360,canvas._9BallCortinaUp.getLocalPosition().clone().z);canvas._9BallCortinaUp.tween(canvas._9BallCortinaUp.getLocalPosition()).to(n,_VELOCIDAD_CORTINA_9,pc.SineOut).onComplete((()=>{null!==a&&a()})).start(),canvas._9BallCortinaDown.enabled=!0;var e=new pc.Vec3(canvas._9BallCortinaDown.getLocalPosition().clone().x,-360,canvas._9BallCortinaDown.getLocalPosition().clone().z);canvas._9BallCortinaDown.tween(canvas._9BallCortinaDown.getLocalPosition()).to(e,_VELOCIDAD_CORTINA_9,pc.SineOut).onComplete((()=>{})).start()},canvas.AbrirCortinas=function(a){console.log("Abrir cortinas");var n=canvas.posCortinaUp;canvas._9BallCortinaUp.tween(canvas._9BallCortinaUp.getLocalPosition()).to(n,_VELOCIDAD_CORTINA2_9,pc.SineOut).onComplete((()=>{null!==a&&a(),canvas._9BallCortinaUp.enabled=!1})).start();var e=canvas.posCortinaDown;canvas._9BallCortinaDown.tween(canvas._9BallCortinaDown.getLocalPosition()).to(e,_VELOCIDAD_CORTINA2_9,pc.SineOut).onComplete((()=>{canvas._9BallCortinaDown.enabled=!1})).start()},canvas.CerrarCortinasInGame=function(a){console.log("CErrar cortinas"),canvas._9BallCortinaUp.enabled=!0;var n=new pc.Vec3(canvas._9BallCortinaUp.getLocalPosition().clone().x,360,canvas._9BallCortinaUp.getLocalPosition().clone().z);canvas._9BallCortinaUp.tween(canvas._9BallCortinaUp.getLocalPosition()).to(n,_VELOCIDAD_CORTINA_9,pc.SineOut).onComplete((()=>{null!==a&&a()})).delay(.8).start(),canvas._9BallCortinaDown.enabled=!0;var e=new pc.Vec3(canvas._9BallCortinaDown.getLocalPosition().clone().x,-360,canvas._9BallCortinaDown.getLocalPosition().clone().z);canvas._9BallCortinaDown.tween(canvas._9BallCortinaDown.getLocalPosition()).to(e,_VELOCIDAD_CORTINA_9,pc.SineOut).onComplete((()=>{})).delay(.8).start()},canvas.AbrirCortinasInGame=function(a){console.log("Abrir cortinas");var n=canvas.posCortinaUp;canvas._9BallCortinaUp.tween(canvas._9BallCortinaUp.getLocalPosition()).to(n,_VELOCIDAD_CORTINA2_9,pc.SineOut).onComplete((()=>{null!==a&&a(),canvas._9BallCortinaUp.enabled=!1})).start();var e=canvas.posCortinaDown;canvas._9BallCortinaDown.tween(canvas._9BallCortinaDown.getLocalPosition()).to(e,_VELOCIDAD_CORTINA2_9,pc.SineOut).onComplete((()=>{canvas._9BallCortinaDown.enabled=!1})).start()},canvas.EndGameButtons=function(a){canvas.botonNoReward.enabled=!1,canvas.botonReward.enabled=!1,canvas.botonRestart.enabled=!0,a&&(_COINS+=parseInt(canvas.finalRewardCoins.element.text),canvas.finalRewardCoins.element.text=2*parseInt(canvas.finalRewardCoins.element.text),playSound("buy"),canvas.PaintCoins())},canvas.ClickBackToHome=function(){mesasPasadas=0,adsUsados=!1,canvas.menu_storeButton.enabled=!1,canvas.YouWin9Balls.enabled=!1,canvas.store_coins.enabled=!1,playSound("storeClick"),onGameEnd(),canvas.pause9Balls.enabled=!1,system.b_GAME_FINISHED=!0,_sound.slot("vsCpuMusic").stop(),_sound.slot("vsMusic").stop(),_sound.slot("music2").stop(),_sound.slot("music3").stop(),canvas.CerrarCortinasInGame((function(){playSound("menuMusic",!0),system.Camera.enabled=!1,system.cameraBlur.enabled=!0,canvas.macePanelGUI.enabled=!1,canvas.panelInstrucciones.enabled=!1,canvas.maceButtonGUIA.enabled=!1,n=!1,window.setTimeout((function(){canvas.AbrirCortinasInGame((function(){system.REINITGAME(!1),system.b_GAME_FINISHED=!1,_BLOCKED=!1,setTimeout((()=>{canvas.juegoEmpezado=!1}),150)})),canvas.mainMenuGUI9Ball.enabled=!0,canvas.menu_storeButton.enabled=!0,canvas.store_coins.enabled=!0,canvas.GroupHeaderGame.enabled=!1,canvas.enableHeaderGame(!1),_GUI_OPEN=!0}),50)}))},addEventFunction(canvas.botonRestart,!0,1,(function(){_SCORE_9_BALLS=0,mesasPasadas=0,onGameEnd(),canvas.menu_storeButton.enabled=!1,canvas.store_coins.enabled=!1,system.WinGame9Balls(!0),AddScore9Balls(0),canvas.YouWin9Balls.enabled=!1,playSound("storeClick")})),addEventFunction(canvas.botonHome,!0,1,(function(){canvas.ClickBackToHome()})),addEventFunction(canvas.botonReward,!0,1,(function(){playSound("storeClick");showReward((()=>{canvas.EndGameButtons(!0)}),(()=>{canvas.EndGameButtons(!1)}),"doubleReward")})),addEventFunction(canvas.botonNoReward,!0,1,(function(){playSound("storeClick"),canvas.EndGameButtons(!1)})),addEventFunction(canvas._9Balls_tutorialButton,!0,1,(function(){continuePanel.enabled||(canvas.pause9Balls.enabled=!0,playSound("storeClick"),onGameEnd(),_BLOCKED=!0)})),addEventFunction(canvas._9Balls_tutorialButtonP,!0,1,(function(){continuePanel.enabled||(canvas.pause9Balls.enabled=!0,playSound("storeClick"),onGameEnd(),_BLOCKED=!0)})),addEventFunction(canvas.howToPlay9Balls,!0,1,(function(){playSound("storeClick"),canvas.panelInstrucciones.enabled=!0,_IS_PHONE?(canvas.panelInstrucciones.children[2].enabled=!0,canvas.panelInstrucciones.children[1].enabled=!1):(canvas.panelInstrucciones.children[2].enabled=!1,canvas.panelInstrucciones.children[1].enabled=!0),_BLOCKED=!0})),addEventFunction(canvas.endgame9Balls,!0,1,(function(){canvas.ClickBackToHome()})),addEventFunction(canvas.resume9Balls,!0,1,(function(){showAds(function(){playSound("storeClick"),onGameStart(),canvas.pause9Balls.enabled=!1,_BLOCKED=!1}.bind(this))})),addEventFunction(canvas.panelInstruccionesCruz,!0,1,(function(){canvas.panelInstrucciones.enabled=!1})),addEventFunction(canvas.panelInstruccionesCruzAll,!0,1,(function(){canvas.panelInstrucciones.enabled=!1})),addEventFunction(canvas._9Balls_soundButton.children[0],!0,1,(function(){_9_BALLS_SOUND=!0,canvas._9Balls_soundButton.children[0].enabled=!1,canvas._9Balls_soundButton.children[1].enabled=!0,soundEnabled=_9_BALLS_SOUND,mute=0,saveVariables(mute+"","mute"),unmuteMusic()})),addEventFunction(canvas._9Balls_soundButton.children[1],!0,1,(function(){_9_BALLS_SOUND=!1,canvas._9Balls_soundButton.children[0].enabled=!0,canvas._9Balls_soundButton.children[1].enabled=!1,soundEnabled=_9_BALLS_SOUND,mute=1,saveVariables(mute+"","mute"),muteMusic()})),addEventFunction(canvas._9Balls_soundButtonP.children[0],!0,1,(function(){_9_BALLS_SOUND=!0,canvas._9Balls_soundButtonP.children[0].enabled=!1,canvas._9Balls_soundButtonP.children[1].enabled=!0,soundEnabled=_9_BALLS_SOUND,mute=0,saveVariables(mute+"","mute"),unmuteMusic()})),addEventFunction(canvas._9Balls_soundButtonP.children[1],!0,1,(function(){_9_BALLS_SOUND=!1,canvas._9Balls_soundButtonP.children[0].enabled=!0,canvas._9Balls_soundButtonP.children[1].enabled=!1,soundEnabled=_9_BALLS_SOUND,mute=1,saveVariables(mute+"","mute"),muteMusic()})),_9_BOLAS_ACTIVADO&&null!=canvas.score9Balls&&(canvas.score9Balls.enabled=!0),canvas.leftBallsIndicatorA=this.app.root.findByName("leftBallsIndicator"),canvas.rightBallsIndicatorA=this.app.root.findByName("rightBallsIndicator"),canvas.optionsButton_player1A=this.app.root.findByName("optionsButton_player1"),canvas.player2GUIA=this.app.root.findByName("player2GUI"),canvas.timeGUIA=this.app.root.findByName("timeGUI"),canvas.maceButtonGUIA=this.app.root.findByName("maceButtonGUI"),canvas.leftIndicatorGUIA=this.app.root.findByName("leftIndicatorGUI"),canvas.rightIndicatorGUIA=this.app.root.findByName("rightIndicatorGUI"),canvas.storeTables=[canvas.Store_slots.findByName("store_table_slot1"),canvas.Store_slots.findByName("store_table_slot2"),canvas.Store_slots.findByName("store_table_slot3"),canvas.Store_slots.findByName("store_table_slot4"),canvas.Store_slots.findByName("store_table_slot5"),canvas.Store_slots.findByName("store_table_slot6")],canvas.storeCues=[canvas.Store_slots.findByName("store_cue_slot1"),canvas.Store_slots.findByName("store_cue_slot2"),canvas.Store_slots.findByName("store_cue_slot3"),canvas.Store_slots.findByName("store_cue_slot4"),canvas.Store_slots.findByName("store_cue_slot5"),canvas.Store_slots.findByName("store_cue_slot6")],canvas.storeTablesP=[canvas.Store_slotsP.findByName("store_table_slot1"),canvas.Store_slotsP.findByName("store_table_slot2"),canvas.Store_slotsP.findByName("store_table_slot3"),canvas.Store_slotsP.findByName("store_table_slot4"),canvas.Store_slotsP.findByName("store_table_slot5"),canvas.Store_slotsP.findByName("store_table_slot6")],canvas.storeCuesP=[canvas.Store_slotsP.findByName("store_cue_slot1"),canvas.Store_slotsP.findByName("store_cue_slot2"),canvas.Store_slotsP.findByName("store_cue_slot3"),canvas.Store_slotsP.findByName("store_cue_slot4"),canvas.Store_slotsP.findByName("store_cue_slot5"),canvas.Store_slotsP.findByName("store_cue_slot6")],canvas.pointLeftCanvas=this.app.root.findByName("leftBallsIndicator"),canvas.pointRightCanvas=this.app.root.findByName("rightBallsIndicator"),canvas.poolCue=this.app.root.findByName("poolCue"),canvas.ForceBar=this.app.root.findByName("ForceBar"),canvas.shadowBarMove=this.app.root.findByName("shadowBarMove"),canvas.optionsPanel=this.app.root.findByName("optionsPanel"),canvas.resumeButton=this.app.root.findByName("resumeButton"),canvas.closeButton=this.app.root.findByName("closeButton"),canvas.endGameButton=this.app.root.findByName("endGameButton"),canvas.rulesButton=this.app.root.findByName("rulesButton"),canvas.rulesInGameButton=this.app.root.findByName("rulesInGameButton"),canvas.soundON=this.app.root.findByName("soundON"),canvas.soundOFF=this.app.root.findByName("soundOFF"),canvas.tutorialON=this.app.root.findByName("tutoON"),canvas.tutorialOFF=this.app.root.findByName("tutoOFF"),canvas.gameEndPanel=this.app.root.findByName("gameEndPanel"),canvas.victoryGUI=this.app.root.findByName("victoryGUI"),canvas.looseGUI=this.app.root.findByName("looseGUI"),canvas.homeButtonGUI=this.app.root.findByName("homeButtonGUI"),canvas.playAgainButtonGUI=this.app.root.findByName("playAgainButtonGUI"),canvas.optionsButton_player1=this.app.root.findByName("optionsButton_player1"),canvas.turnPlayer1GUI=this.app.root.findByName("turnPlayer1GUI"),canvas.turnPlayer2GUI=this.app.root.findByName("turnPlayer2GUI"),canvas.choosePocketHoleGUI=this.app.root.findByName("choosePocketHoleGUI"),canvas.maceBallPointGUI=this.app.root.findByName("maceBallPointGUI"),canvas.pointIndicatorGUI=this.app.root.findByName("pointIndicatorGUI"),canvas.leftIndicatorGUI=this.app.root.findByName("leftIndicatorGUI"),canvas.rightIndicatorGUI=this.app.root.findByName("rightIndicatorGUI"),canvas.timeGUI=this.app.root.findByName("timeGUI"),_9_BOLAS_ACTIVADO?(canvas.macePanelGUI=this.app.root.findByName("_9BallmacePanelGUI"),canvas.macePanelGUI_tapador=canvas.macePanelGUI.findByName("macePanelGUI_tapador"),_masse=canvas.macePanelGUI.children[5].findByName("pointIndicatorGUI").script.draggable):(canvas.macePanelGUI=this.app.root.findByName("macePanelGUI"),canvas.macePanelGUI_tapador=this.app.root.findByName("macePanelGUI_tapador"),_masse=canvas.macePanelGUI.children[2].script.uiSlider),canvas.turnOverGUI=this.app.root.findByName("turnOverGUI"),canvas.tutorialPanelGUI=this.app.root.findByName("panelTutorial"),canvas.tutorialOK=canvas.tutorialPanelGUI.children[1],canvas.panelEndTutorial=this.app.root.findByName("panelEndTutorial"),canvas.okbuttonEnd=canvas.panelEndTutorial.children[1],canvas.panelRules=this.app.root.findByName("panelRules"),canvas.panelRulesDirect=this.app.root.findByName("panelRulesDirect"),canvas.okbuttonEndRules=canvas.panelRules.children[1],canvas.okbuttonEndRulesDirect=canvas.panelRulesDirect.children[1],canvas.messagesTutorialUp=this.app.root.findByName("messagesTutorialUp"),canvas.panelTutoMouse=this.app.root.findByName("panelTutoMouse"),canvas.GroupHeaderGame.enabled=!1,canvas.GroupHeaderStore.enabled=!1,_9_BOLAS_ACTIVADO){canvas.mainMenuGUI9Ball.enabled=!0,canvas.menu_storeButton.enabled=!0,canvas.store_coins.enabled=!0;var n=!1;addEventFunction(canvas.ButtonClickToPlay9b,!0,1,(function(){1!=n&&(canvas.juegoEmpezado||(canvas.juegoEmpezado=!0,n=!0,playSound("mainMenuClick"),console.log("Play 9 Balls"),canvas.CerrarCortinas((function(){canvas.mainMenuGUI9Ball.enabled=!1,canvas.menu_settings.enabled=!1,canvas.menu_storeButton.enabled=!1,canvas.store_coins.enabled=!1,canvas.GroupHeaderGame.enabled=!0,canvas.enableHeaderGame(!0),system.InitFirstTImeGame9Balls(),system.StartGame9Balls(),_GUI_OPEN=!1,window.setTimeout((function(){canvas.AbrirCortinas((function(){}))}),200)}))))}))}else canvas.mainMenuGUI.enabled=!0,canvas.menu_settings.enabled=!0,canvas.store_coins.enabled=!0;canvas.messagesCenter=this.app.root.findByName("messagesCenter"),canvas.messagesLow=this.app.root.findByName("messagesLow"),canvas.panelTutoPowerBar=this.app.root.findByName("panelTutoPowerBar"),canvas.EnableCue=function(){canvas.ForceBar.enabled=!0,canvas.poolCue.enabled=!0,canvas.shadowBarMove.enabled=!0},canvas.EnableHeaderStore=function(a){if(canvas.Store_upBar.enabled=a,null!=system){if(system.isPortrait){var n=this.app.graphicsDevice.width,e=this.app.graphicsDevice.height/n;console.log(e),e<=1.35?canvas.Store_upBar.setLocalPosition(0,-18,0):e<1.78?canvas.Store_upBar.setLocalPosition(-35,-50,0):canvas.Store_upBar.setLocalPosition(0,-150,0),canvas.Store_slots.enabled=!1,canvas.Store_slotsP.enabled=a}else canvas.Store_upBar.setLocalPosition(0,-35,0),canvas.Store_slotsP.enabled=!1,canvas.Store_slots.enabled=a;canvas.store_backButton.enabled=a}},canvas.enableHeaderGame=function(a){_9_BOLAS_ACTIVADO?null!=canvas._9BallsIndicator&&(canvas._9BallsIndicator.enabled=a,canvas._9BallsIndicatorRight.enabled=a,canvas.optionsButton_player1A.enabled=!1,canvas.player2GUIA.enabled=!1,canvas.leftIndicatorGUIA.enabled=!1,canvas.rightIndicatorGUIA.enabled=!1,canvas._9Balls_tutorialButton.enabled=a,canvas._9Balls_tutorialButtonP.enabled=a,canvas._9Balls_soundButton.enabled=a,canvas._9Balls_soundButtonP.enabled=a,system.isPortrait=null):(canvas.leftBallsIndicatorA.enabled=a,canvas.rightBallsIndicatorA.enabled=a,canvas.optionsButton_player1A.enabled=a,canvas.player2GUIA.enabled=a,canvas.leftIndicatorGUIA.enabled=a,canvas.rightIndicatorGUIA.enabled=a,canvas._9Balls_tutorialButton.enabled=!1,canvas._9Balls_soundButton.enabled=!1),canvas.timeGUIA.enabled=a,canvas.maceButtonGUIA.enabled=a,canvas.ForceBar.enabled=a,_IS_PHONE||(canvas.ForceBar.enabled=!1)},canvas.enableHeaderGame(!1),canvas.EnableHeaderStore(!1),canvas.MenuButtonEvents=function(){addEventFunction(canvas.menu_playCpuButton,!0,1,(function(){console.log("Play vs CPU"),system.b_BOT_ENABLE=!0,_GUI_OPEN=!1,playSound("mainMenuClick"),canvas.mainMenuGUI.enabled=!1,canvas.store_coins.enabled=!1,canvas.menu_settings.enabled=!1,canvas.GroupHeaderGame.enabled=!0,canvas.enableHeaderGame(!0),system.StartGame()})),addEventFunction(canvas.menu_playMultiplayerButton,!0,1,(function(){console.log("Play vs MULTIPLAYER"),_GUI_OPEN=!1,playSound("mainMenuClick"),system.b_BOT_ENABLE=!1,canvas.mainMenuGUI.enabled=!1,canvas.store_coins.enabled=!1,canvas.menu_settings.enabled=!1,canvas.GroupHeaderGame.enabled=!0,canvas.enableHeaderGame(!0),system.StartGame()})),addEventFunction(canvas.menu_storeButton,!0,1,(function(){console.log("OPEN STORE"),playSound("storeClick"),canvas.GroupHeaderStore.enabled=!0,canvas.EnableHeaderStore(!0),canvas.store_coins.enabled=!0,canvas.textStoreCoins.element.text=_COINS.toString(),canvas.PaintStore()})),addEventFunction(canvas.store_backButton,!0,1,(function(){console.log("CLOSE STORE"),playSound("backClick"),canvas.GroupHeaderStore.enabled=!1,canvas.EnableHeaderStore(!1),canvas.store_coins.enabled=!0}));for(var a=0;a<_TABLES.length;a++){(function(a){var n=_TABLES[a].price;addEventFunction(canvas.storeTables[a].children[2],!0,1,(function(){if(_COINS-n>=0)return _COINS-=n,canvas.PaintCoins(),_TABLES[_SELECTED_TABLE_INDEX].status=1,saveVariables(_TABLES[_SELECTED_TABLE_INDEX].status+"","table_"+(_SELECTED_TABLE_INDEX+1)+"_status"),_TABLES[a].status=2,saveVariables(_TABLES[a].status+"","table_"+(a+1)+"_status"),_SELECTED_TABLE_INDEX=a,saveVariables(_SELECTED_TABLE_INDEX+"_SELECTED_TABLE_INDEX"),playSound("buy"),PokiSDK.happyTime(1),canvas.PaintStore(),system.poolTable.script.cambiaTextura.cambio(_SELECTED_TABLE_INDEX),void system.poolTable.script.colorMaterial.colorChange(_SELECTED_TABLE_INDEX);playSound("noCoins")})),addEventFunction(canvas.storeTables[a].children[3],!0,1,(function(){_TABLES[_SELECTED_TABLE_INDEX].status=1,saveVariables(_TABLES[_SELECTED_TABLE_INDEX].status+"","table_"+(_SELECTED_TABLE_INDEX+1)+"_status"),_TABLES[a].status=2,saveVariables(_TABLES[a].status+"","table_"+(a+1)+"_status"),_SELECTED_TABLE_INDEX=a,saveVariables(_SELECTED_TABLE_INDEX+"_SELECTED_TABLE_INDEX"),playSound("equip"),system.poolTable.script.cambiaTextura.cambio(_SELECTED_TABLE_INDEX),system.poolTable.script.colorMaterial.colorChange(_SELECTED_TABLE_INDEX),canvas.PaintStore()})),addEventFunction(canvas.storeTablesP[a].children[2],!0,1,(function(){if(_COINS-n>=0)return _COINS-=n,canvas.PaintCoins(),_TABLES[_SELECTED_TABLE_INDEX].status=1,saveVariables(_TABLES[_SELECTED_TABLE_INDEX].status+"","table_"+(_SELECTED_TABLE_INDEX+1)+"_status"),_TABLES[a].status=2,saveVariables(_TABLES[a].status+"","table_"+(a+1)+"_status"),_SELECTED_TABLE_INDEX=a,saveVariables(_SELECTED_TABLE_INDEX+"_SELECTED_TABLE_INDEX"),playSound("buy"),PokiSDK.happyTime(1),canvas.PaintStore(),system.poolTable.script.cambiaTextura.cambio(_SELECTED_TABLE_INDEX),void system.poolTable.script.colorMaterial.colorChange(_SELECTED_TABLE_INDEX);playSound("noCoins")})),addEventFunction(canvas.storeTablesP[a].children[3],!0,1,(function(){_TABLES[_SELECTED_TABLE_INDEX].status=1,saveVariables(_TABLES[_SELECTED_TABLE_INDEX].status+"","table_"+(_SELECTED_TABLE_INDEX+1)+"_status"),_TABLES[a].status=2,saveVariables(_TABLES[a].status+"","table_"+(a+1)+"_status"),_SELECTED_TABLE_INDEX=a,saveVariables(_SELECTED_TABLE_INDEX+"_SELECTED_TABLE_INDEX"),playSound("equip"),canvas.PaintStore(),system.poolTable.script.cambiaTextura.cambio(_SELECTED_TABLE_INDEX),system.poolTable.script.colorMaterial.colorChange(_SELECTED_TABLE_INDEX)}))})(a)}for(a=0;a<_CUES.length;a++){(function(a){var n=_CUES[a].price;addEventFunction(canvas.storeCues[a].children[2],!0,1,(function(){if(_COINS-n>=0)return _COINS-=n,canvas.PaintCoins(),playSound("buy"),PokiSDK.happyTime(1),_CUES[_SELECTED_CUE_INDEX].status=1,saveVariables(_CUES[_SELECTED_CUE_INDEX].status+"","cue_"+(_SELECTED_CUE_INDEX+1)+"_status"),_CUES[a].status=2,saveVariables(_CUES[a].status+"","cue_"+(a+1)+"_status"),_SELECTED_CUE_INDEX=a,saveVariables(_SELECTED_CUE_INDEX+"_SELECTED_CUE_INDEX"),void canvas.PaintStore();playSound("noCoins")})),addEventFunction(canvas.storeCues[a].children[3],!0,1,(function(){_CUES[_SELECTED_CUE_INDEX].status=1,saveVariables(_CUES[_SELECTED_CUE_INDEX].status+"","cue_"+(_SELECTED_CUE_INDEX+1)+"_status"),_CUES[a].status=2,saveVariables(_CUES[a].status+"","cue_"+(a+1)+"_status"),_SELECTED_CUE_INDEX=a,saveVariables(_SELECTED_CUE_INDEX+"_SELECTED_CUE_INDEX"),playSound("equip"),canvas.PaintStore()})),addEventFunction(canvas.storeCuesP[a].children[2],!0,1,(function(){if(_COINS-n>=0)return _COINS-=n,canvas.PaintCoins(),playSound("buy"),PokiSDK.happyTime(1),_CUES[_SELECTED_CUE_INDEX].status=1,saveVariables(_CUES[_SELECTED_CUE_INDEX].status+"","cue_"+(_SELECTED_CUE_INDEX+1)+"_status"),_CUES[a].status=2,saveVariables(_CUES[a].status+"","cue_"+(a+1)+"_status"),_SELECTED_CUE_INDEX=a,saveVariables(_SELECTED_CUE_INDEX+"_SELECTED_CUE_INDEX"),void canvas.PaintStore();playSound("noCoins")})),addEventFunction(canvas.storeCuesP[a].children[3],!0,1,(function(){_CUES[_SELECTED_CUE_INDEX].status=1,saveVariables(_CUES[_SELECTED_CUE_INDEX].status+"","cue_"+(_SELECTED_CUE_INDEX+1)+"_status"),_CUES[a].status=2,saveVariables(_CUES[a].status+"","cue_"+(a+1)+"_status"),_SELECTED_CUE_INDEX=a,saveVariables(_SELECTED_CUE_INDEX+"_SELECTED_CUE_INDEX"),playSound("equip"),canvas.PaintStore()}))})(a)}},canvas.GUIButtonEvents=function(){addEventFunction(canvas.poolCue,!0,1,system.ClickPoolCue.bind(system)),addEventFunction(canvas.poolCue,!0,3,system.ReleasePoolCue.bind(system)),addEventFunction(canvas.optionsButton_player1,!0,1,(function(){_9_BOLAS_ACTIVADO||(canvas.cancelGUI?canvas.CancelOptions():(canvas.optionsPanel.enabled=!0,canvas.resumeButton.enabled=!0,canvas.closeButton.enabled=!1,canvas.endGameButton.enabled=!0,canvas.rulesButton.enabled=!1,canvas.rulesInGameButton.enabled=!0,playSound("storeClick"),canvas.setSoundData(),canvas.setTutorialData(),_INGAME_MENU_OPEN=!0))})),addEventFunction(canvas.menu_settings,!0,1,(function(){canvas.optionsPanel.enabled=!0,canvas.resumeButton.enabled=!1,canvas.closeButton.enabled=!0,canvas.rulesButton.enabled=!0,canvas.endGameButton.enabled=!1,canvas.rulesInGameButton.enabled=!1,playSound("storeClick"),canvas.setSoundData(),canvas.setTutorialData(),_GUI_OPEN=!0})),addEventFunction(canvas.resumeButton,!0,1,(function(){canvas.optionsPanel.enabled=!1,playSound("backClick"),_INGAME_MENU_OPEN=!1})),addEventFunction(canvas.closeButton,!0,1,(function(){canvas.optionsPanel.enabled=!1,playSound("backClick"),_GUI_OPEN=!1})),addEventFunction(canvas.endGameButton,!0,1,(function(){_GUI_OPEN=!0,_sound.slot("vsCpuMusic").stop(),_sound.slot("vsMusic").stop(),_sound.slot("music2").stop(),_sound.slot("music3").stop(),playSound("menuMusic",!0),playSound("storeClick"),system.REINITGAME(),canvas.GroupHeaderGame.enabled=!1,canvas.enableHeaderGame(!1),canvas.GroupHeaderStore.enabled=!1,canvas.EnableHeaderStore(!1),canvas.mainMenuGUI.enabled=!0,canvas.store_coins.enabled=!0,canvas.menu_settings.enabled=!0,system.camera.enabled=!1,system.cameraBlur.enabled=!0,_INGAME_MENU_OPEN=!1})),addEventFunction(canvas.soundON,!0,1,(function(){canvas.soundON.enabled=!1,canvas.soundOFF.enabled=!0,soundEnabled=!1,mute=1,playSound("clickMute"),saveVariables(mute+"","mute"),muteMusic()})),addEventFunction(canvas.soundOFF,!0,1,(function(){canvas.soundON.enabled=!0,canvas.soundOFF.enabled=!1,soundEnabled=!0,mute=0,playSound("clickMute"),saveVariables(mute+"","mute"),unmuteMusic()})),addEventFunction(canvas.tutorialON,!0,1,(function(){canvas.tutorialON.enabled=!1,canvas.tutorialOFF.enabled=!0,playSound("clickMute"),system.b_PlayTutorial=!1;saveVariables("0","b_PlayTutorial")})),addEventFunction(canvas.tutorialOFF,!0,1,(function(){canvas.tutorialON.enabled=!0,canvas.tutorialOFF.enabled=!1,playSound("clickMute"),system.b_PlayTutorial=!0;saveVariables("1","b_PlayTutorial")})),addEventFunction(canvas.rulesButton,!0,1,(function(){canvas.panelRulesDirect.enabled=!0,playSound("storeClick")})),addEventFunction(canvas.rulesInGameButton,!0,1,(function(){canvas.panelRulesDirect.enabled=!0,playSound("storeClick")})),addEventFunction(canvas.okbuttonEndRulesDirect,!0,1,(function(){canvas.panelRulesDirect.enabled=!1,playSound("backClick")})),addEventFunction(canvas.homeButtonGUI,!0,1,(function(){_GUI_OPEN=!0,_sound.slot("vsCpuMusic").stop(),_sound.slot("vsMusic").stop(),_sound.slot("music2").stop(),_sound.slot("music3").stop(),playSound("menuMusic",!0),playSound("storeClick"),system.REINITGAME(),canvas.GroupHeaderGame.enabled=!1,canvas.enableHeaderGame(!1),canvas.GroupHeaderStore.enabled=!1,canvas.EnableHeaderStore(!1),canvas.mainMenuGUI.enabled=!0,canvas.menu_settings.enabled=!0,canvas.store_coins.enabled=!0,system.camera.enabled=!1,system.cameraBlur.enabled=!0,_INGAME_MENU_OPEN=!1})),system.playAgainFunction=function(){void 0!==system.ball.animationHoleIn&&system.ball.animationHoleIn.stop(),void 0!==system.ball.animationHoleIn2&&system.ball.animationHoleIn2.stop(),void 0!==system.ball.animationHoleIn3&&system.ball.animationHoleIn3.stop(),ballWhiteFirstBallContact=null,system.ball.setLocalScale(.45,.45,.45),system.ball.dir=pc.Vec3.ZERO,system.ball.pushedBall=!1,system.ball.captured=!1,system.ball.processing=!1,system.ResetBallsCaptured(),_sound.slot("vsCpuMusic").stop(),_sound.slot("vsMusic").stop(),_sound.slot("music2").stop(),_sound.slot("music3").stop(),playSound("storeClick"),system.playMusic(),system.REINITGAME(),system.b_GAME_FINISHED=!1,_TURN_TIME_OUT=!1,_masse.resetMasse(),system.setCueToPlayer(1),canvas.showTurnPlayer1(),_9_BOLAS_ACTIVADO||(canvas.leftIndicatorGUI.enabled=!0,canvas.rightIndicatorGUI.enabled=!1),system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0;for(var a=0;a<system.ballsFollower.length;a++)system.ballsFollower[a].enabled=!0;for(a=0;a<system.ballsAll.length;a++)system.ballsAll[a].enabled=!0,system.ballsAll[a].script.p2Body.enabled=!0;system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,system.ball.setLocalScale(.45,.45,.45),system.ball.dir=pc.Vec3.ZERO,system.ball.pushedBall=!1,system.ball.captured=!1,system.ball.processing=!1,system.followerGO.lookAt(new pc.Vec3(0,system.followerGO.getPosition().y,0)),system.PreDrawLine(),system.poolCueGO.enabled=!0,setTimeout((function(){system.b_IS_FIRST_TURN=!0,system.EnableCanMoveWhiteBall(),system.StartTurnTimer(),_BLOCKED=!1,_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_youBreak_start():_BOT_PLAYING&&messages.MSG_opponentBreak_start()}),600)},addEventFunction(canvas.playAgainButtonGUI,!0,1,(function(){system.playAgainFunction()})),addEventFunction(canvas.maceButtonGUIA,!0,1,(function(){console.log("aprete mace"),canvas.macePanelGUI.enabled?(setTimeout(function(){_GUI_OPEN=!1}.bind(system),200),canvas.macePanelGUI.enabled=!1,playSound("backClick")):0!=system.playerTurn&&(1!=system.playerTurn||system.b_BOT_ENABLE)||"ShootLap"==system.turnState||"ForceLap"==system.turnState||(_GUI_OPEN=!0,canvas.macePanelGUI.enabled=!0,canvas.maceButtonGUIA.enabled=!1,playSound("storeClick"))})),addEventFunction(canvas.macePanelGUI_tapador,!0,1,(function(){canvas.macePanelGUI.enabled=!1,canvas.maceButtonGUIA.enabled=!0,setTimeout(function(){_GUI_OPEN=!1,playSound("backClick")}.bind(system),200)}))},canvas.PaintStore=function(){for(var a=0;a<_TABLES.length;a++)canvas.storeTables[a].children[1].element.enabled=0!=_TABLES[a].status&&1!=_TABLES[a].status,canvas.storeTables[a].children[1].element.enabled&&(_SELECTED_TABLE_INDEX=a,saveVariables(_SELECTED_TABLE_INDEX+"","_SELECTED_TABLE_INDEX")),canvas.storeTables[a].children[4].enabled=2==_TABLES[a].status,canvas.storeTables[a].children[2].enabled=0==_TABLES[a].status,canvas.storeTables[a].children[2].children[0].element.text=_TABLES[a].price.toString(),canvas.storeTables[a].children[3].enabled=1==_TABLES[a].status,canvas.storeTablesP[a].children[1].element.enabled=0!=_TABLES[a].status&&1!=_TABLES[a].status,canvas.storeTablesP[a].children[1].element.enabled&&(_SELECTED_TABLE_INDEX=a,saveVariables(_SELECTED_TABLE_INDEX+"","_SELECTED_TABLE_INDEX")),canvas.storeTablesP[a].children[4].enabled=2==_TABLES[a].status,canvas.storeTablesP[a].children[2].enabled=0==_TABLES[a].status,canvas.storeTablesP[a].children[2].children[0].element.text=_TABLES[a].price.toString(),canvas.storeTablesP[a].children[3].enabled=1==_TABLES[a].status;for(a=0;a<_CUES.length;a++)canvas.storeCues[a].children[1].element.enabled=0!=_CUES[a].status&&1!=_CUES[a].status,canvas.storeCues[a].children[1].element.enabled&&(_SELECTED_CUE_INDEX=a,saveVariables(_SELECTED_CUE_INDEX+"","_SELECTED_CUE_INDEX")),canvas.storeCues[a].children[4].enabled=2==_CUES[a].status,canvas.storeCues[a].children[2].enabled=0==_CUES[a].status,canvas.storeCues[a].children[2].children[0].element.text=_CUES[a].price.toString(),canvas.storeCues[a].children[3].enabled=1==_CUES[a].status,canvas.storeCuesP[a].children[1].element.enabled=0!=_CUES[a].status&&1!=_CUES[a].status,canvas.storeCuesP[a].children[1].element.enabled&&(_SELECTED_CUE_INDEX=a,saveVariables(_SELECTED_CUE_INDEX+"","_SELECTED_CUE_INDEX")),canvas.storeCuesP[a].children[4].enabled=2==_CUES[a].status,canvas.storeCuesP[a].children[2].enabled=0==_CUES[a].status,canvas.storeCuesP[a].children[2].children[0].element.text=_CUES[a].price.toString(),canvas.storeCuesP[a].children[3].enabled=1==_CUES[a].status}},CanvasController.prototype.showTurnPlayer1=function(a){},CanvasController.prototype.showTurnPlayer2=function(a){},CanvasController.prototype.setTutorialData=function(){system.b_PlayTutorial?(canvas.tutorialON.enabled=!0,canvas.tutorialOFF.enabled=!1):(canvas.tutorialON.enabled=!1,canvas.tutorialOFF.enabled=!0)},CanvasController.prototype.setSoundData=function(){0==mute?(canvas.soundON.enabled=!0,canvas.soundOFF.enabled=!1,canvas._9Balls_soundButton.children[0].enabled=!1,canvas._9Balls_soundButton.children[1].enabled=!0,unmuteMusic()):(canvas.soundON.enabled=!1,canvas.soundOFF.enabled=!0,canvas._9Balls_soundButton.children[0].enabled=!0,canvas._9Balls_soundButton.children[1].enabled=!1,muteMusic())},CanvasController.prototype.Drawscore=function(){if(_9_BOLAS_ACTIVADO){for(var a=2;a<11;a++)canvas._9BallsIndicator.children[a].children[1].element.enabled=!1,canvas._9BallsIndicator.children[a].children[0].element.opacity=1;console.log(system.GetCorrect9BallsNumber()),null!=system.GetCorrect9BallsNumber()&&(canvas._9BallsIndicator.children[system.GetCorrect9BallsNumber().index-1+2].children[1].element.enabled=!0);for(a=0;a<pc.math.clamp(system.capturedBallsPlayer1.length,0,9);a++){var n=parseInt(system.capturedBallsPlayer1[a].name)-2+2;canvas._9BallsIndicator.children[n].children[0].element.opacity=.3}}else{for(a=0;a<7;a++)for(var e=0;e<15;e++)canvas.pointLeftCanvas.children[a].children[e].element.enabled=!1;for(a=0;a<7;a++)for(e=0;e<15;e++)canvas.pointRightCanvas.children[a].children[e].element.enabled=!1;for(a=0;a<pc.math.clamp(system.capturedBallsPlayer1.length,0,7);a++){n=parseInt(system.capturedBallsPlayer1[a].name)-2;canvas.pointLeftCanvas.children[a].children[n].element.enabled=!0}for(a=0;a<pc.math.clamp(system.capturedBallsPlayer2.length,0,7);a++){n=parseInt(system.capturedBallsPlayer2[a].name)-2;canvas.pointRightCanvas.children[a].children[n].element.enabled=!0}}},CanvasController.prototype.PaintCoins=function(){canvas.textStoreCoins.element.text=_COINS.toString(),saveVariables(_COINS.toString(),"_COINS")},CanvasController.prototype.CancelOptions=function(){canvas.optionsPanel.enabled=!1,_INGAME_MENU_OPEN=!1,canvas.optionsButton_player1.element.opacity=.75},CanvasController.prototype.update=function(a){};var GameSystem=pc.createScript("gameSystem");GameSystem.prototype.initialize=function(){system=this,_sound=this.app.root.findByName("sounds").sound,system.coliderHoyoTest=this.app.root.findByName("SphereTestColl"),system.cameraBlur=this.app.root.findByName("Main3D"),system.Camera=this.app.root.findByName("Camera"),system.poolTable=this.app.root.findByName("poolTable"),system.camera=this.app.root.findByName("Camera"),system.ball=this.app.root.findByName("1"),system.spawnA=this.app.root.findByName("SpawnA"),system.targetGO=this.app.root.findByName("Target"),system.targetExtendedGO=this.app.root.findByName("TargetExtendido"),system.TOP=this.app.root.findByName("TOP"),system.DOWN=this.app.root.findByName("DOWN"),system.LEFT=this.app.root.findByName("LEFT"),system.RIGHT=this.app.root.findByName("RIGHT"),system.TOPWHITEBALL=this.app.root.findByName("TOPBLANCA"),system.DOWNWHITEBALL=this.app.root.findByName("DOWNBLANCA"),system.LEFTWHITEBALL=this.app.root.findByName("LEFTBLANCA"),system.RIGHTWHITEBALL=this.app.root.findByName("RIGHTBLANCA"),system.TOPWHITEBALLFirstTurn=this.app.root.findByName("TOPBLANCAFirstTurn"),system.DOWNWHITEBALLFirstTurn=this.app.root.findByName("DOWNBLANCAFirstTurn"),system.LEFTWHITEBALLFirstTurn=this.app.root.findByName("LEFTBLANCAFirstTurn"),system.RIGHTWHITEBALLFirstTurn=this.app.root.findByName("RIGHTBLANCAFirstTurn"),system.ballWhiteLine=this.app.root.findByName("ballLineWhite"),system.ballWhiteLine2=this.app.root.findByName("ballLineWhite2"),system.ballWhiteColor=this.app.root.findByName("ballLineColor"),system.ballWhiteColor2=this.app.root.findByName("ballLineColor2"),system.Ex=this.app.root.findByName("Ex"),system.ballWhiteLineInitial=this.app.root.findByName("ballWhiteLineInitial"),system.ballWhiteLineInitial2=this.app.root.findByName("ballWhiteLineInitial2"),system.startLeft=this.app.root.findByName("StartIzquierdo").getLocalPosition(),system.startRight=this.app.root.findByName("StartDerecho").getLocalPosition(),system.ballsCloned=[this.app.root.findByName("1clon"),this.app.root.findByName("2clon"),this.app.root.findByName("3clon"),this.app.root.findByName("4clon"),this.app.root.findByName("5clon"),this.app.root.findByName("6clon"),this.app.root.findByName("7clon"),this.app.root.findByName("8clon"),this.app.root.findByName("9clon"),this.app.root.findByName("10clon"),this.app.root.findByName("11clon"),this.app.root.findByName("12clon"),this.app.root.findByName("13clon"),this.app.root.findByName("14clon"),this.app.root.findByName("15clon"),this.app.root.findByName("16clon")],system.ballsClonedShadow=[this.app.root.findByName("AxisSombra1"),this.app.root.findByName("AxisSombra2"),this.app.root.findByName("AxisSombra3"),this.app.root.findByName("AxisSombra4"),this.app.root.findByName("AxisSombra5"),this.app.root.findByName("AxisSombra6"),this.app.root.findByName("AxisSombra7"),this.app.root.findByName("AxisSombra8"),this.app.root.findByName("AxisSombra9"),this.app.root.findByName("AxisSombra10"),this.app.root.findByName("AxisSombra11"),this.app.root.findByName("AxisSombra12"),this.app.root.findByName("AxisSombra13"),this.app.root.findByName("AxisSombra14"),this.app.root.findByName("AxisSombra15"),this.app.root.findByName("AxisSombra16")],system.ballsFollower=[this.app.root.findByName("1F"),this.app.root.findByName("2F"),this.app.root.findByName("3F"),this.app.root.findByName("4F"),this.app.root.findByName("5F"),this.app.root.findByName("6F"),this.app.root.findByName("7F"),this.app.root.findByName("8F"),this.app.root.findByName("9F"),this.app.root.findByName("10F"),this.app.root.findByName("11F"),this.app.root.findByName("12F"),this.app.root.findByName("13F"),this.app.root.findByName("14F"),this.app.root.findByName("15F"),this.app.root.findByName("16F")],system.ballsFollower[0].collision.enabled=!1,system.balls=[this.app.root.findByName("2"),this.app.root.findByName("3"),this.app.root.findByName("4"),this.app.root.findByName("5"),this.app.root.findByName("6"),this.app.root.findByName("7"),this.app.root.findByName("8"),this.app.root.findByName("9"),this.app.root.findByName("10"),this.app.root.findByName("11"),this.app.root.findByName("12"),this.app.root.findByName("13"),this.app.root.findByName("14"),this.app.root.findByName("15"),this.app.root.findByName("16")],system.ballsAll=[this.app.root.findByName("1"),this.app.root.findByName("2"),this.app.root.findByName("3"),this.app.root.findByName("4"),this.app.root.findByName("5"),this.app.root.findByName("6"),this.app.root.findByName("7"),this.app.root.findByName("8"),this.app.root.findByName("9"),this.app.root.findByName("10"),this.app.root.findByName("11"),this.app.root.findByName("12"),this.app.root.findByName("13"),this.app.root.findByName("14"),this.app.root.findByName("15"),this.app.root.findByName("16")],system.followerGO=this.app.root.findByName("Seguidor"),system.poolCueGO=this.app.root.findByName("poolTaco"),system.circleGO=this.app.root.findByName("indicador-circulo"),system.circleErrorGO=this.app.root.findByName("indicador-circulo-error"),system.targetAux=this.app.root.findByName("TargetAux"),system.targetAux2=this.app.root.findByName("TargetAux2"),system.targetAux3=this.app.root.findByName("TargetAux3"),system.targetAux4=this.app.root.findByName("TargetAux4"),system.TargetMouse=this.app.root.findByName("TargetMouse"),system.takeIconWhiteBall=this.app.root.findByName("indicador-tomar-blanca"),system.colliderBall8Entity=this.app.root.findByName("elementBall8"),system.glowFloorInitial=this.app.root.findByName("glow-inicial"),system.glowFloor=this.app.root.findByName("glow-mesacompleta"),system.arrowsIconWhiteBall=this.app.root.findByName("indicadorFlechasBlanca"),system.takeWhiteBallError=this.app.root.findByName("indicador-tomar-blanca-error"),system.colliderBall8=[this.app.root.findByName("Box1"),this.app.root.findByName("Box2"),this.app.root.findByName("Box3"),this.app.root.findByName("Box4"),this.app.root.findByName("Box5"),this.app.root.findByName("Box6")],system.colliderBall8ON=[this.app.root.findByName("Box1A"),this.app.root.findByName("Box2A"),this.app.root.findByName("Box3A"),this.app.root.findByName("Box4A"),this.app.root.findByName("Box5A"),this.app.root.findByName("Box6A")],system.setGamePlayFunctions(),canvas.posInit(),onGameLoad(),skipMenu&&canvas.quickStart()},GameSystem.prototype.setGamePlayFunctions=function(){system.reCheck=!1,system.isPortrait=null,system.inTap=0,system.fps=500,system.iteraciones=420,system.eventTapLimitTime=.2,system.forceStopDelta=.14,system.extraImpulse=1.35,system.coreLoaded=!1,system.recoveringWhiteBall=!1,system.countEventTap=0,system.b_movingWhiteBall=!1,system.b_enableCanMoveWhiteBall=!1,system.lastVectorAuxA=new pc.Vec2,system.tetaAngleRad=0,system.player1={},system.player2={},system.b_BOT_ENABLE=!0,_GUI_OPEN=!0,_BLOCKED=!0,system.b_PlayTutorial=tutorialEnabled,canvas.MenuButtonEvents(),canvas.GUIButtonEvents(),system.GamePlayButtonEvents(),system.InitGamePlayVariables(),system.ResetBall(!0),_IS_PHONE?(console.log("Iniciar palo en mobile"),system.followerGO.script.follower.enabled=!0,system.poolCueGO.enabled=!0):system.hidePoolCueGO(),playSound("menuMusic",!0),system.changeTurn=function(){var e=!1;if(system.ballsCapturedInTurn.length>0)for(var t=0;t<system.ballsCapturedInTurn.length;t++)"1"==system.ballsCapturedInTurn[t].name&&(e=!0);var s=!1;if(system.ballsCapturedInTurn.length>0)for(t=0;t<system.ballsCapturedInTurn.length;t++)"1"!=system.ballsCapturedInTurn[t].name&&"9"!=system.ballsCapturedInTurn[t].name&&(s=!0);if(system.b_FirstTurnComplete){e=!1;if(system.ballsCapturedInTurn.length>0)for(t=0;t<system.ballsCapturedInTurn.length;t++)"1"==system.ballsCapturedInTurn[t].name&&(e=!0);s=!1;if(system.ballsCapturedInTurn.length>0)for(t=0;t<system.ballsCapturedInTurn.length;t++)"1"!=system.ballsCapturedInTurn[t].name&&"9"!=system.ballsCapturedInTurn[t].name&&(s=!0);o=null!==ballWhiteFirstBallContact?ballWhiteFirstBallContact.name:"";if(ballWhiteFirstBallContact=null,system.ballsCapturedInTurn.length>0&&system.isBall8Captured(system.ballsCapturedInTurn)){if(system.Ball8Phase()){if(system.b_BOT_ENABLE&&!_IS_LOCAL_PLAYER_PLAYING())return console.log("Bot gana el juego, reportar este alert para borrarlo"),void system.GameOverFunction("Bot Win");var l="";switch(this.blackBallHoleDropName){case"hole_up_left":l="Box6";break;case"hole_up":l="Box5";break;case"hole_up_right":l="Box4";break;case"hole_down_left":l="Box3";break;case"hole_down":l="Box2";break;case"hole_down_right":l="Box1"}return system.selectedHole==l?void system.GameWinFunction():void system.GameOverFunction("MISS POCKET 8 BALL")}return void(system.b_BOT_ENABLE?_IS_LOCAL_PLAYER_PLAYING()?e?system.GameOverFunction("Captura negra con blanca"):s?system.GameOverFunction("Captura negra con color"):system.GameOverFunction("Captura negra"):system.GameWinFunction():e?system.GameOverFunction("Captura negra con blanca"):s?system.GameOverFunction("Captura negra con color"):system.GameOverFunction("Captura negra"))}if(0==this.ballsCapturedInTurn.length)""==o||this.IsFirstHitCorrectWithMessage(o)?system.CheckRail()?(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_PassTurn():system.b_BOT_ENABLE&&messages.MSG_youTurn(),0==this.playerTurn?this.switch(""+this.player2.color):this.switch(""+this.player1.color)):(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_noRail_FOUL():system.b_BOT_ENABLE&&messages.MSG_OponnentNoRail_FOUL(),0==this.playerTurn?this.switch(""+this.player2.color,!0):this.switch(""+this.player1.color,!0)):0==this.playerTurn?this.switch(this.player2.color+"\n Puede mover",!0):this.switch(this.player1.color+"\n Puede mover",!0);else if(e)_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_DropWhiteBall():system.b_BOT_ENABLE&&messages.MSG_OpponentDropWhiteBall(),0==this.playerTurn?this.switch(this.player2.color+"\n Puede mover",!0,!0):1==this.playerTurn&&this.switch(this.player1.color+"\n Puede mover",!0,!0);else{a=this.ballsCapturedInTurn[0].name;this.IsFirstHitCorrectWithMessage(o)?this.BotoBolasCorrectas()?0==this.playerTurn?(this.Ball8Phase()&&this.SetBall8Phase(),_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_youTurn()):1==this.playerTurn&&(this.Ball8Phase()&&this.SetBall8Phase(),_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_youTurn(),this.b_BOT_ENABLE&&(this.Ball8Phase(),messages.MSG_PassTurn(),this.PlayBot())):(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_PassTurn():system.b_BOT_ENABLE&&messages.MSG_youTurn(),0==this.playerTurn?this.switch(""+this.player2.color):this.switch(""+this.player1.color)):0==this.playerTurn?this.switch(this.player2.color+"\n Puede mover",!0,!0):this.switch(this.player1.color+"\n Puede mover",!0,!0)}}else{var o=null!==ballWhiteFirstBallContact?ballWhiteFirstBallContact.name:"";if(ballWhiteFirstBallContact=null,0==system.ballsCapturedInTurn.length)system.b_FirstTurnComplete=!1,""!==o?this.IsFirstHitCorrectWithMessage(o)?system.CheckRail()?(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_PassTurn():system.b_BOT_ENABLE&&messages.MSG_youTurn(),system.switch("Peleando primer punto")):(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_noRail_FOUL():system.b_BOT_ENABLE&&messages.MSG_OponnentNoRail_FOUL(),system.switch("Peleando primer punto Puede Mover",!0)):system.switch("Peleando primer punto",!0,!0):system.CheckRail()?(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_PassTurn():system.b_BOT_ENABLE&&messages.MSG_youTurn(),system.switch("Peleando primer punto")):(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_noRail_FOUL():system.b_BOT_ENABLE&&messages.MSG_OponnentNoRail_FOUL(),system.switch("Peleando primer punto Puede Mover",!0));else{var a=system.ballsCapturedInTurn[0].name;system.isBall8Captured(system.ballsCapturedInTurn)?0==system.playerTurn?e?system.GameOverFunction("Captura negra con blanca"):s?system.GameOverFunction("Captura negra con color"):system.GameOverFunction("Captura negra"):system.GameWinFunction():e?(system.b_FirstTurnComplete=!1,_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_DropWhiteBall():_BOT_PLAYING&&messages.MSG_youTurn(),system.switch("Peleando primer punto\n Puede mover",!0,!0),system.player1.color=null,system.player2.color=null):this.IsFirstHitCorrectWithMessage(o)?system.IsSolidBallHit(a)?0==system.playerTurn?(system.player1.color="planas",system.player2.color="franjas",system.startPlayer(0,""+system.player1.color),_IS_LOCAL_PLAYER_PLAYING()&&(messages.MSG_youTurn(),window.setTimeout((function(){_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_6moreBallsToWin()}),3e3))):(system.player2.color="planas",system.player1.color="franjas",system.startPlayer(1,""+system.player2.color),_IS_LOCAL_PLAYER_PLAYING()&&(messages.MSG_youTurn(),window.setTimeout((function(){_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_6moreBallsToWin()}),3e3))):system.IsStripesBallHit(a)&&(0==system.playerTurn?(system.player1.color="franjas",system.player2.color="planas",system.startPlayer(0,""+system.player1.color),_IS_LOCAL_PLAYER_PLAYING()&&(messages.MSG_youTurn(),window.setTimeout((function(){_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_6moreBallsToWin()}),3e3))):(system.player2.color="franjas",system.player1.color="planas",system.startPlayer(1,""+system.player2.color),_IS_LOCAL_PLAYER_PLAYING()&&(messages.MSG_youTurn(),window.setTimeout((function(){_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_6moreBallsToWin()}),3e3)))):system.switch("Le pego a negra primero",!0,!0)}}this.ballsCapturedInTurn=[]},system.switch=function(e,t,s){if(s&&system.ResetBallsCaptured(),t&&(_IS_LOCAL_PLAYER_PLAYING()?messages.MSGCENTER_Foul():system.b_BOT_ENABLE&&messages.MSGCENTER_OpponentFoul()),_9_BOLAS_ACTIVADO?system.playerTurn=0:system.playerTurn=0==system.playerTurn?1:0,t&&(_9_BOLAS_ACTIVADO||system.EnableCanMoveWhiteBall()),system.b_BOT_ENABLE&&1==system.playerTurn&&system.PlayBot(),_9_BOLAS_ACTIVADO){if(system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,system.followerGO.setPosition(new pc.Vec3(system.ball.getPosition().x,system.followerGO.getPosition().y,system.ball.getPosition().z)),system.followerGO.lookAt(new pc.Vec3(0,system.followerGO.getPosition().y,0)),system.TargetMouse.setPosition(new pc.Vec3(0,system.TargetMouse.getPosition().y,0)),_IS_PHONE){system.lastVectorAuxA={x:null,y:null},system.lastVectorAuxA.x=0,system.lastVectorAuxA.y=0,system.target.x=window.innerWidth/2,system.target.y=window.innerHeight/2;var l=system.ball.getPosition().clone();if(null==system.lastVectorAuxA)return;var o=(0-system.lastVectorAuxA.x)/65,a=(0-system.lastVectorAuxA.y)/65,i=GetMouseFloorPosition(new pc.Vec2(system.target.x,system.target.y),system.camera.camera,system.app).point;vc=system.TargetMouse.getPosition();var n=new pc.Vec2(l.x,l.z).distance(new pc.Vec2(i.x,i.z));n>8&&(n=8);var r,h=system.TargetMouse.right.normalize().scale(-o),c=system.TargetMouse.forward.normalize().scale(-a),y=new pc.Vec3(vc.x,vc.y,vc.z),m=n/1,p=l.x,b=l.z,u=system.tetaAngleRad,d=Math.atan2(i.z-l.z,i.x-l.x),B=180*Math.atan2(Math.sin(d),Math.cos(d))/Math.PI,_=0;Math.abs(h.x)>=Math.abs(c.z)?B>=0&&B<=180?(r=p+Math.cos(u+h.x/m)*n,_=b+Math.sin(u+h.x/m)*n,system.tetaAngleRad=u+h.x/m):(r=p+Math.cos(u-h.x/m)*n,_=b+Math.sin(u-h.x/m)*n,system.tetaAngleRad=u-h.x/m):B<=90&&B>=-90?(r=p+Math.cos(u+c.z/m)*n,_=b+Math.sin(u+c.z/m)*n,system.tetaAngleRad=u+c.z/m):(r=p+Math.cos(u-c.z/m)*n,_=b+Math.sin(u-c.z/m)*n,system.tetaAngleRad=u-c.z/m),y.x=r,y.z=_,system.TargetMouse.setPosition(y);system.ball.getPosition().clone().distance(system.TargetMouse.getPosition());system.lastVectorAuxA=new pc.Vec2(0,0),system.followerGO.lookAt(new pc.Vec3(vc.x,system.followerGO.getPosition().y,vc.z))}system.PreDrawLine(),system.TurnOffPoolCueLine()}else if(this.Ball8Phase())this.SetBall8Phase();else{for(var f=0;f<system.colliderBall8.length;f++)system.colliderBall8[f].enabled=!1;system.b_SelectingBall8=!1,system.selectedHole=null}0==system.playerTurn?(system.setCueToPlayer(1),playSound("cambioTurno"),setTimeout(function(){playSound("finCambioTurno")}.bind(system),1600),_masse.resetMasse(),canvas.showTurnPlayer1(t),_9_BOLAS_ACTIVADO||(canvas.leftIndicatorGUI.enabled=!0,canvas.rightIndicatorGUI.enabled=!1)):(playSound("cambioTurno"),setTimeout(function(){playSound("finCambioTurno")}.bind(system),1600),_masse.resetMasse(),system.b_BOT_ENABLE?system.setCueToPlayer(0):system.setCueToPlayer(2),canvas.showTurnPlayer2(t),_9_BOLAS_ACTIVADO||(canvas.leftIndicatorGUI.enabled=!1,canvas.rightIndicatorGUI.enabled=!0))},this.startPlayer=function(e,t){system.b_FirstTurnComplete=!0,system.playerTurn=e,_IS_LOCAL_PLAYER_PLAYING()?"planas"==t?messages.MSGCENTER_youAreSolid():"franjas"==t&&messages.MSGCENTER_youAreStripes():system.b_BOT_ENABLE&&("planas"==t?messages.MSGCENTER_youAreStripes():"franjas"==t&&messages.MSGCENTER_youAreSolid()),system.b_BOT_ENABLE&&1==system.playerTurn&&system.PlayBot()},system.ResetBallsCapturedVersion2=function(){for(var e=this.ballsCapturedInTurn,t=0;t<e.length;t++)for(var s=0;s<this.capturedBallsPlayer2.length;s++)this.capturedBallsPlayer2[s].name==e[t].name&&this.capturedBallsPlayer2.splice(s,1);for(t=0;t<e.length;t++)for(s=0;s<this.capturedBallsPlayer1.length;s++)this.capturedBallsPlayer1[s].name==e[t].name&&this.capturedBallsPlayer1.splice(s,1);for(t=0;t<e.length;t++)for(s=0;s<this.ballsCloned.length;s++)if(this.ballsCloned[s].name==e[t].name+"clon"){void 0!==this.ballsCloned[s].animacion&&(this.ballsCloned[s].animacion.stop(),this.ballsCloned[s].script.giroEntidad.enabled=!1),this.ballsCloned[s].setPosition(new pc.Vec3(-3e3,0,0));break}for(t=0;t<e.length;t++)for(var l=0;l<this.lastPositionBalls.length;l++)if(this.lastPositionBalls[l].bola.name==e[t].name){var o=this.lastPositionBalls[l].pos;e[t].script.p2Body.enabled=!0,e[t].setPosition(o),e[t].script.p2Body.body.position=[o.x,-1*o.z],e[t].enabled=!0,e[t].captured=!1}for(s=0;s<10;s++)system.ballsAll[s].captured||(system.ballsAll[s].script.p2Circle.sensor=!0,system.ballsAll[s].enabled=!0);e=this.ballsCapturedInTurn;var checkPositionBall=function(){for(var t=0;t<e.length;t++)for(var s=0;s<system.ballsAll.length;s++)if(!system.ballsAll[s].captured&&e[t].name!=system.ballsAll[s].name){var l=e[t].getPosition(),o=system.ballsAll[s].getPosition();if(l.distance(o)<=1){var a=l.clone();return a.x=pc.math.random(system.LEFT.getPosition().clone().x,system.RIGHT.getPosition().clone().x),a.z=pc.math.random(system.TOP.getPosition().clone().z,system.DOWN.getPosition().clone().z),e[t].setPosition(a),e[t].script.p2Body.body.position=[a.x,-1*a.z],void checkPositionBall()}}};checkPositionBall();for(s=0;s<10;s++)system.ballsAll[s].captured||(system.ballsAll[s].script.p2Circle.sensor=!1)},system.ResetBallsCaptured=function(){system.ResetBallsCapturedVersion2()},this.IsFirstHitCorrect=function(e){return!("9"==e&&!this.Ball8Phase())&&(!("9"!=e||!this.Ball8Phase())||(!(0!=this.playerTurn||"planas"!=this.player1.color||!this.IsSolidBallHit(e))||(0!=this.playerTurn||"planas"!=this.player1.color||!this.IsStripesBallHit(e))&&((0!=this.playerTurn||"franjas"!=this.player1.color||!this.IsSolidBallHit(e))&&(!(0!=this.playerTurn||"franjas"!=this.player1.color||!this.IsStripesBallHit(e))||(!(1!=this.playerTurn||"planas"!=this.player2.color||!this.IsSolidBallHit(e))||(1!=this.playerTurn||"planas"!=this.player2.color||!this.IsStripesBallHit(e))&&((1!=this.playerTurn||"franjas"!=this.player2.color||!this.IsSolidBallHit(e))&&(!(1!=this.playerTurn||"franjas"!=this.player2.color||!this.IsStripesBallHit(e))||void 0)))))))},this.IsFirstHitCorrectWithMessage=function(e){return"9"!=e||this.Ball8Phase()?!system.b_FirstTurnComplete||(!("9"!=e||!this.Ball8Phase())||(!(0!=this.playerTurn||"planas"!=this.player1.color||!this.IsSolidBallHit(e))||(0==this.playerTurn&&"planas"==this.player1.color&&this.IsStripesBallHit(e)||0==this.playerTurn&&"franjas"==this.player1.color&&this.IsSolidBallHit(e)?(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_hitRivalBall_FOUL():system.b_BOT_ENABLE&&messages.MSG_youTurn_byOponentHitYouBall_FOUL(),!1):!(0!=this.playerTurn||"franjas"!=this.player1.color||!this.IsStripesBallHit(e))||(!(1!=this.playerTurn||"planas"!=this.player2.color||!this.IsSolidBallHit(e))||(1==this.playerTurn&&"planas"==this.player2.color&&this.IsStripesBallHit(e)||1==this.playerTurn&&"franjas"==this.player2.color&&this.IsSolidBallHit(e)?(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_hitRivalBall_FOUL():system.b_BOT_ENABLE&&messages.MSG_youTurn_byOponentHitYouBall_FOUL(),!1):!(1!=this.playerTurn||"franjas"!=this.player2.color||!this.IsStripesBallHit(e))||void 0))))):(_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_hitBlackAtLast_FOUL():system.b_BOT_ENABLE&&messages.MSG_youTurn_byOponentHitBlackFoul(),!1)},this.BotoBolasCorrectas=function(){for(var e=this.ballsCapturedInTurn,t=0;t<e.length;t++)if(this.IsFirstHitCorrect(e[t].name))return!0;return!1},this.PlayBot=function(){_BOT_PLAYING=!0,this.poolCueGO.setLocalPosition(new pc.Vec3(0,0,0)),this.ballsFollower[0].collision.enabled=!0,this.TurnOffPoolCueLine(),this.Ball8Phase()&&(this.selectedHole="everyone",this.b_SelectingBall8=!1,this.turnState="Waiting"),system.followerGO.takeBot=window.setTimeout((function(){system.poolCueGO.setLocalPosition(new pc.Vec3(0,0,0)),system.followerGO.lookAt(new pc.Vec3(pc.math.random(100,1e3),system.followerGO.getPosition().y,pc.math.random(100,1e3)))}),500);var e=system.GetBotBallTarget();this.ballsFollower[0].collision.enabled=!1,console.log("Bola seleccionada por bot",e),system.followerGO.apuntarBot=window.setTimeout((function(){if(null!=e){var t=system.followerGO.getLocalEulerAngles().clone();system.TargetMouse.setPosition(new pc.Vec3(e.getPosition().x,system.TargetMouse.getPosition().y,e.getPosition().z));var s=system.TargetMouse.getPosition();system.followerGO.lookAt(new pc.Vec3(s.x,system.followerGO.getPosition().y,s.z));var l=system.followerGO.getLocalEulerAngles().clone();system.followerGO.setLocalEulerAngles(t);var o=system.followerGO.getLocalEulerAngles();system.turnState="BOT_TARGET",system.fuerzaDisparo=0,system.distancia=0,system.followerGO.rotationBot=system.followerGO.tween(o).rotate(l,1.5,pc.SineOut).onUpdate(function(){}.bind(system)).start()}else console.log("No encontro objetivo el bot")}),1e3),system.shootInterval=window.setTimeout((function(){_TURN_TIME_OUT=!1,system.turnState="ForceLap",system.addDistance=window.setInterval((function(){if(system.distancia+=.05,system.distancia>=3.8){system.turnState="MovingPoolCueLap",system.fuerzaDisparo=1e3,system.distancia=0,system.adjustDistance=system.poolCueGO.getPosition().clone().distance(system.ball.getPosition().clone()),console.log("Distancia bot ",system.adjustDistance),system.followerGO.script.follower.enabled=!1,system.callbackDisparo=function(){system.circleGO.enabled=!1,this.circleGO.children[0].enabled=!1,system.circleErrorGO.enabled=!1,system.ballWhiteLineInitial.enabled=!1,system.ballWhiteLine.enabled=!1,system.ballWhiteColor.enabled=!1,system.ballWhiteColor2.enabled=!1,system.ballWhiteLine2.enabled=!1,system.ballWhiteLineInitial2.enabled=!1,system.Ex.enabled=!1,window.setTimeout((function(){system.hidePoolCueGO()}),30),system.shootBallFunction(),system.turnState="ShootLap"},system.preShoot();var e=25*(hitForze-0)+0,t=new pc.Vec3(0,0,0).distance(system.poolCueGO.getLocalPosition())/e;system.followerGO.miTweenPoolTaco=system.poolCueGO.tween(system.poolCueGO.getLocalPosition()).to(new pc.Vec3(0,0,0),t,pc.Linear),system.followerGO.miTweenPoolTaco.onComplete((()=>{system.callbackDisparo()})),system.followerGO.miTweenPoolTaco.start(),window.clearInterval(system.addDistance)}}),10)}),3e3)},system.CancelTurnAndSwitch=function(){canvas.turnOverGUI.enabled=!0,playSound("derrota"),canvas.turnOverGUI.script.animaTextoMsg.poneScale(),system.poolCueGO.enabled=!0,system.poolCueGO.setLocalPosition(new pc.Vec3(0,0,0)),system.arrowsIconWhiteBall.enabled=!1,system.b_IS_FIRST_TURN=!1,system.takeIconWhiteBall.enabled=!1,system.glowFloorInitial.enabled=!1,system.glowFloor.enabled=!1,system.takeWhiteBallError.enabled=!1,(system.b_movingWhiteBall||system.b_enableCanMoveWhiteBall)&&(_physicWorldSystem.stepToFuture(.01),arrayBallsInCollision.length>0&&(system.b_movingWhiteBall=!1,system.ballsCapturedInTurn.push(system.ball),system.ResetBallsCaptured())),system.poolCueGO.setLocalPosition(new pc.Vec3(0,0,0)),system.b_enableCanMoveWhiteBall=!1,system.b_WrongPositionWhiteBall=!1,system.b_movingWhiteBall=!1,console.log("dejar de mover blanca"),system.turnState="Waiting",simulation=!0,system.ball.script.p2Circle.sensor=!1,system.b_whiteBallReleased=!0,_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_timeUp_FOUL():system.b_BOT_ENABLE&&messages.MSG_OponnentTimeUp_FOUL(),setTimeout((function(){canvas.turnOverGUI.script.animaTextoMsg.sacaScale(!0),_BLOCKED=!0,setTimeout((function(){system.switch("SWITCH POR FALTA TURNO",!0,!1),_BLOCKED=!1,system.StartTurnTimer()}),500),_TURN_TIME_OUT=!1}),1e3)}},GameSystem.prototype.ActiveCanMoveWhiteBall=function(e){if(ballInCollider.lenght>0)console.log("Posicion incorrecta"),this.turnState="BolaEstaEnPosicionIncorrecta";else if(this.b_movingWhiteBall)this.b_WrongPositionWhiteBall&&console.log("Volvio a tomar la bola blanca de una posicion incorrecta");else if(!this.b_movingWhiteBall){var t=RayCast(e,this.camera.camera,this.app);null!==t&&"1"==t.name&&(this.b_movingWhiteBall=!0,console.log("mover blanca"),this.turnState="MovingWhiteBallLap",this.poolCueGO.enabled=!1,simulation=!1,this.ball.script.p2Circle.sensor=!0,this.TurnOffPoolCueLine(),this.lastPositionBalls=[{bola:this.ballsAll[0],pos:this.ballsAll[0].getPosition().clone()},{bola:this.ballsAll[1],pos:this.ballsAll[1].getPosition().clone()},{bola:this.ballsAll[2],pos:this.ballsAll[2].getPosition().clone()},{bola:this.ballsAll[3],pos:this.ballsAll[3].getPosition().clone()},{bola:this.ballsAll[4],pos:this.ballsAll[4].getPosition().clone()},{bola:this.ballsAll[5],pos:this.ballsAll[5].getPosition().clone()},{bola:this.ballsAll[6],pos:this.ballsAll[6].getPosition().clone()},{bola:this.ballsAll[7],pos:this.ballsAll[7].getPosition().clone()},{bola:this.ballsAll[8],pos:this.ballsAll[8].getPosition().clone()},{bola:this.ballsAll[9],pos:this.ballsAll[9].getPosition().clone()},{bola:this.ballsAll[10],pos:this.ballsAll[10].getPosition().clone()},{bola:this.ballsAll[11],pos:this.ballsAll[11].getPosition().clone()},{bola:this.ballsAll[12],pos:this.ballsAll[12].getPosition().clone()},{bola:this.ballsAll[13],pos:this.ballsAll[13].getPosition().clone()},{bola:this.ballsAll[14],pos:this.ballsAll[14].getPosition().clone()},{bola:this.ballsAll[15],pos:this.ballsAll[15].getPosition().clone()}],this.takeIconWhiteBall.enabled=!0,playSound("tapWhite"),this.takeIconWhiteBall.setPosition(this.ball.getPosition()),this.arrowsIconWhiteBall.enabled=!1,this.b_IS_FIRST_TURN?this.glowFloorInitial.enabled=!0:this.glowFloor.enabled=!0)}},GameSystem.prototype.StartGame=function(){_LOCAL_PLAYER_NUMBER=playerTurnStart,_OPONENT_PLAYER_NUMBER=0==playerTurnStart?1:0,system.playerTurn=playerTurnStart,system.poolTable.script.cambiaTextura.cambio(_SELECTED_TABLE_INDEX),system.poolTable.script.colorMaterial.colorChange(_SELECTED_TABLE_INDEX),system.cueBotIndex=Math.floor(Math.random()*system.poolCueGO.children.length),system.setCueToPlayer(playerTurnStart),system.cameraBlur.enabled=!1,system.Camera.enabled=!0;var tutorialCallback=function(){ballWhiteFirstBallContact=null,_sound.slot("menuMusic").stop(),system.playMusic(),_masse.resetMasse(),setTimeout(function(){playSound("cambioTurno")}.bind(system),150),setTimeout(function(){playSound("finCambioTurno")}.bind(system),1750),0==playerTurnStart?(canvas.showTurnPlayer1(),_9_BOLAS_ACTIVADO||(canvas.leftIndicatorGUI.enabled=!0,canvas.rightIndicatorGUI.enabled=!1)):1==playerTurnStart&&(canvas.showTurnPlayer2(),_9_BOLAS_ACTIVADO||(canvas.leftIndicatorGUI.enabled=!1,canvas.rightIndicatorGUI.enabled=!0)),system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,setTimeout((function(){if(system.b_IS_FIRST_TURN=!0,system.EnableCanMoveWhiteBall(playerTurnStart),system.turnState="Waiting",system.poolCueGO.enabled=!0,_9_BOLAS_ACTIVADO);else{var e=_LIMIT_TIME_TURN_SECONDS;canvas.timeGUI.element.text=e<10?"0"+e:e.toString(),system.StartTurnTimer()}_BLOCKED=!1,console.log(system.playerTurn+"/"+_LOCAL_PLAYER_NUMBER),_IS_LOCAL_PLAYER_PLAYING()?messages.MSG_youBreak_start():_BOT_PLAYING&&messages.MSG_opponentBreak_start()}),600)};system.b_PlayTutorial?(system.b_PlayTutorial=!0,tutorial.playTutorial(tutorialCallback)):(tutorialCallback(),ballWhiteFirstBallContact=null,system.ball.script.p2Body.body.position=[-3.538,0],system.ball.setPosition(new pc.Vec3(-3.538,2.586,0)),system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,system.followerGO.setPosition(new pc.Vec3(system.ball.getPosition().x,system.followerGO.getPosition().y,system.ball.getPosition().z)),system.followerGO.lookAt(new pc.Vec3(0,system.followerGO.getPosition().y,0)),system.poolCueGO.enabled=!0,system.PreDrawLine(),system.TurnOffPoolCueLine())},GameSystem.prototype.EnableCanMoveWhiteBall=function(e){system.b_enableCanMoveWhiteBall=!0,(!system.b_BOT_ENABLE||system.b_BOT_ENABLE&&null!=e&&system.playerTurn==e)&&(system.arrowsIconWhiteBall.enabled=!0),system.arrowsIconWhiteBall.setPosition(system.ball.getPosition())},GameSystem.prototype.setCueToPlayer=function(e){for(var t=0;t<this.poolCueGO.children.length;t++)this.poolCueGO.children[t].enabled=!1;0==e?this.poolCueGO.children[_SELECTED_CUE_INDEX].enabled=!0:2==e?this.poolCueGO.children[this.cueBotIndex].enabled=!0:1==e&&(this.poolCueGO.children[_SELECTED_CUE_INDEX].enabled=!0)},GameSystem.prototype.REINITGAME=function(e=!0){_BLOCKED=!0,e&&clearInterval(this.timerGUI),this.inTap=0,this.coreLoaded=!1,this.recoveringWhiteBall=!1,this.countEventTap=0,this.b_movingWhiteBall=!1,this.b_enableCanMoveWhiteBall=!1,this.lastVectorAuxA=new pc.Vec2,this.tetaAngleRad=0,this.player1={},this.player2={},this.followerGO.enabled=!0,_BOT_PLAYING=!1,_TURN_TIME_OUT=!1,void 0!==system.followerGO.rotationBot&&null!==system.followerGO.rotationBot&&system.followerGO.rotationBot.stop(),void 0!==system.followerGO.apuntarBot&&null!==system.followerGO.apuntarBot&&window.clearTimeout(system.followerGO.apuntarBot),void 0!==system.followerGO.takeBot&&null!==system.followerGO.takeBot&&window.clearTimeout(system.followerGO.takeBot),void 0!==system.addDistance&&window.clearInterval(system.addDistance),void 0!==system.shootInterval&&window.clearTimeout(system.shootInterval),void 0!==system.followerGO.miTweenPoolTaco&&null!==system.followerGO.rotamiTweenPoolTacotionBot&&system.followerGO.miTweenPoolTaco.stop(),system.eventsQueue=[],null!==system.queueTimeOut&&window.clearTimeout(system.queueTimeOut);for(var t=0;t<this.ballsCloned.length;t++)void 0!==this.ballsCloned[t].animacion&&(this.ballsCloned[t].animacion.stop(),this.ballsCloned[t].script.giroEntidad.enabled=!1),this.ballsCloned[t].setPosition(new pc.Vec3(-3e3,0,0));if(_9_BOLAS_ACTIVADO)for(var s=0;s<this.ballsAll.length;s++)this.ballsAll[s].script.p2Body.body.velocity=[0,0],this.ballsAll[s].script.p2Body.body.force=[0,0],this.ballsAll[s].script.p2Body.body.angularVelocity=0,this.ballsAll[s].script.p2Body.enabled=!0,this.ballsAll[s].setPosition(this.firstPositionBalls[s].pos),this.ballsAll[s].script.p2Body.body.position=[this.firstPositionBalls[s].pos.x,-1*this.firstPositionBalls[s].pos.z],this.ballsAll[s].enabled=!0,this.ballsAll[s].pushedBall=!1,this.ballsAll[s].captured=!1,this.ballsAll[s].processing=!1,this.ballsAll[s].setLocalScale(.45,.45,.45),this.ballsAll[s].dir=pc.Vec3.ZERO,void 0!==system.ballsAll[s].animationHoleIn&&system.ballsAll[s].animationHoleIn.stop(),void 0!==system.ballsAll[s].animationHoleIn1&&system.ballsAll[s].animationHoleIn1.stop(),void 0!==system.ballsAll[s].animationHoleIn2&&system.ballsAll[s].animationHoleIn2.stop();else for(s=0;s<this.ballsAll.length;s++)this.ballsAll[s].script.p2Body.body.velocity=[0,0],this.ballsAll[s].script.p2Body.body.force=[0,0],this.ballsAll[s].script.p2Body.body.angularVelocity=0,this.ballsAll[s].script.p2Body.enabled=!0,this.ballsAll[s].setPosition(this.firstPositionBalls[s].pos),this.ballsAll[s].script.p2Body.body.position=[this.firstPositionBalls[s].pos.x,-1*this.firstPositionBalls[s].pos.z],this.ballsAll[s].enabled=!0,this.ballsAll[s].pushedBall=!1,this.ballsAll[s].captured=!1,this.ballsAll[s].processing=!1,this.ballsAll[s].setLocalScale(.45,.45,.45),this.ballsAll[s].dir=pc.Vec3.ZERO,void 0!==system.ballsAll[s].animationHoleIn&&system.ballsAll[s].animationHoleIn.stop(),void 0!==system.ballsAll[s].animationHoleIn1&&system.ballsAll[s].animationHoleIn1.stop(),void 0!==system.ballsAll[s].animationHoleIn2&&system.ballsAll[s].animationHoleIn2.stop();this.InitGamePlayVariables(),system.ball.script.p2Body.body.position=[-3.538,0],system.ball.setPosition(new pc.Vec3(-3.538,2.586,0)),system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,system.followerGO.setPosition(new pc.Vec3(system.ball.getPosition().x,system.followerGO.getPosition().y,system.ball.getPosition().z)),system.followerGO.lookAt(new pc.Vec3(0,system.followerGO.getPosition().y,0)),system.PreDrawLine(),system.TurnOffPoolCueLine(),canvas.Drawscore(),this.turnState="Waiting",this.playerTurn=0},GameSystem.prototype.TurnOffPoolCueLine=function(){this.circleGO.enabled=!1,this.circleGO.children[0].enabled=!1,this.circleErrorGO.enabled=!1,this.ballWhiteLineInitial.enabled=!1,system.ballWhiteLineInitial2.enabled=!1,this.ballWhiteLine.enabled=!1,this.ballWhiteColor.enabled=!1,this.ballWhiteColor2.enabled=!1,this.ballWhiteLine2.enabled=!1,this.ballWhiteLineInitial2.enabled=!1,this.Ex.enabled=!1},GameSystem.prototype.playMusic=function(){_sound.slot("vsCpuMusic").stop(),_sound.slot("vsMusic").stop(),_sound.slot("music2").stop(),_sound.slot("music3").stop();var e=Math.floor(3*Math.random()),t=0==e?"music2":1==e?"vsCpuMusic":"music3";console.log(_sound.slots[t]);var s=setInterval((()=>{null!=_sound.slots[t].asset?(clearInterval(s),playSound(t,!0),console.log("music ready")):console.log("music is null, reintentando")}),30)},GameSystem.prototype.GamePlayButtonEvents=function(){_BUTTON_EVENTS()},GameSystem.prototype.ReleasePoolCue=function(e){"Waiting"==this.turnState&&(this.turnState="ForceLapGUI")},GameSystem.prototype.ClickPoolCue=function(e){if("MovingPoolCueLap"!=this.turnState&&"ShootLap"!=this.turnState&&!system.takeIconWhiteBall.enabled){if(isMobile.any()){system.poolCueGO.enabled=!0,console.log("Usando barra");e.touches[0].screenX;var t=e.touches[0].screenY;this.cueClicky=t}else this.cueClicky=e.y;this.usingCueLoadBar=!0}},GameSystem.prototype.CaptureBallFunction=function(e,t){_TUTORIAL_PLAYING&&tutorial.FinishPhase3(),system.AddEventQueue((function(){if(system.blackBallHoleDropName=t,system.ballsCapturedInTurn.push(e),"1"!=e.name){var s=system.GetBallClon(e);if(_9_BOLAS_ACTIVADO){var l=system.ballRadius,o="planas",a=null,i=null;if(system.player1.color==o){a=system.startLeft.clone(),i=system.finishLeft.clone();var n=system.capturedBallsPlayer1.length;system.capturedBallsPlayer1.push(e)}}else{l=system.ballRadius,o=system.IsSolidBallHit(e.name)?"planas":system.IsStripesBallHit(e.name)?"franjas":"1"==e.name?"blanca":"9"==e.name?"negra":"imposible",a=null,i=null;if(system.player1.color==o){a=system.startLeft.clone(),i=system.finishLeft.clone();n=system.capturedBallsPlayer1.length;system.capturedBallsPlayer1.push(e)}if(system.player2.color==o){a=system.startRight.clone(),i=system.finishRight.clone();n=system.capturedBallsPlayer2.length;system.capturedBallsPlayer2.push(e)}if(void 0!==system.player1.color&&"negra"==o)if(0==system.playerTurn){a=system.startLeft.clone(),i=system.finishLeft.clone();n=system.capturedBallsPlayer1.length;system.capturedBallsPlayer1.push(e)}else{a=system.startRight.clone(),i=system.finishRight.clone();n=system.capturedBallsPlayer2.length;system.capturedBallsPlayer2.push(e)}}if(void 0===system.player1.color||null===system.player1.color)if(0==system.playerTurn){a=system.startLeft.clone(),i=system.finishLeft.clone(),"planas"==o?(system.player1.color="planas",system.player2.color="franjas"):"franjas"==o&&(system.player1.color="franjas",system.player2.color="planas");n=system.capturedBallsPlayer1.length;system.capturedBallsPlayer1.push(e)}else if(1==system.playerTurn){a=system.startRight.clone(),i=system.finishRight.clone(),"planas"==o?(system.player1.color="franjas",system.player2.color="planas"):"franjas"==o&&(system.player1.color="planas",system.player2.color="franjas");n=system.capturedBallsPlayer2.length;system.capturedBallsPlayer2.push(e)}i.z-=l*n;var r=a.clone().distance(i)/2;console.log(s.name);s.getLocalRotation().clone();s.script.giroEntidad.enabled=!0,s.setLocalPosition(a);var h=s.tween(s.getLocalPosition()).to(i,r,pc.Linear);h.onComplete((()=>{console.log("Guardo bola"),s.script.giroEntidad.enabled=!1})),s.animacion=h,h.start(),e.processing=!1}else system.AddEventQueue((function(){e.processing=!1}))}))},GameSystem.prototype.hidePoolCueGO=function(){this.poolCueGO.enabled=!1},GameSystem.prototype.ResetPhysic=function(e){null!=e.script.p2Body.body&&(e.script.p2Body.body.velocity=[0,0],e.script.p2Body.body.angularVelocity=0,e.script.p2Body.body.force=[0,0],e.script.p2Body.body.angularForce=0)},GameSystem.prototype.ResetBall=function(e){console.log("DEVOLVER BOLA A SPAWN"),this.ResetPhysic(this.ball),null==e&&this.ball.setPosition(new pc.Vec3(this.spawnA.getPosition().clone().x,2.575,this.spawnA.getPosition().clone().z)),this.ball.enabled=!0,this.ball.script.p2Body.enabled=!0,this.turnState="Waiting"},GameSystem.prototype.resetInPlace=function(){if(!this.b_GAME_FINISHED){console.log("Reset!"),isMobile.any()?(console.log("REset in place"),this.mobileWaitingClick=!0):this.mobileWaitingClick=!0,this.poolCueGO.enabled=!0,this.ResetPhysic(this.ball);for(var e=0;e<this.balls.length;e++)this.ResetPhysic(this.balls[e]);_TUTORIAL_PLAYING&&"Phase3"==tutorial.tutorialStatus?tutorial.ResetInPlaceTutorial():this.ResetInPlaceSwitchTurn()}},GameSystem.prototype.ResetInPlaceSwitchTurn=function(){if(_9_BOLAS_ACTIVADO?system.changeTurn9Balls():system.changeTurn(),system.b_GAME_FINISHED)ReinicioPuntajesSystem();else if(canvas.Drawscore(),ReinicioPuntajesSystem(),_BLOCKED=!0,_9_BOLAS_ACTIVADO)system.ponerIndicados9Bolas(),_BLOCKED=!1,system.StartTurnTimer();else{var e=_LIMIT_TIME_TURN_SECONDS;canvas.timeGUI.element.text=e<10?"0"+e:e.toString(),setTimeout((function(){_BLOCKED=!1,system.StartTurnTimer()}),500)}},GameSystem.prototype.RestoreWhiteBall=function(e,t){this.recoveringWhiteBall=!0},GameSystem.prototype.update=function(e){if(!(this.b_GAME_FINISHED||_BLOCKED||_GUI_OPEN)&&(this.isClicking&&(this.countEventTap=this.countEventTap+e),"Waiting"!=this.turnState||this.takeIconWhiteBall.enabled||this.poolCueGO.enabled&&(isMobile.any(),_physicWorldSystem.simular(this,this.ball,this.ballColisionada,system.iteraciones,system.fps),this.DrawPoolCueLine()),this.takeIconWhiteBall.enabled?this.poolCueGO.enabled=!1:"ForceLap"==this.turnState?(this.DrawPoolCueLine(),this.poolCueGO.setLocalPosition(new pc.Vec3(0,0,pc.math.clamp(this.distancia,0,this.maxCueDistance)))):"ForceLapGUI"==this.turnState&&(this.DrawPoolCueLine(),this.poolCueGO.setLocalPosition(new pc.Vec3(0,0,this.maxCueDistance*system.cueLoad))),"ShootLap"==this.turnState)){var t=!0;(new pc.Vec2(this.ball.script.p2Body.body.velocity[0],this.ball.script.p2Body.body.velocity[1]).length()<=this.forceStopDelta||this.ball.captured)&&!this.ball.processing?this.ResetPhysic(this.ball):t=!1;var s=this.tryToStopBalls();!s||!t||system.b_eventQueueRunning||system.ballsInProcessToHole()||system.reCheck||s&&t&&!system.b_eventQueueRunning&&!system.ballsInProcessToHole()&&(console.log("Cambia estado a Reseteando"),system.followerGO.script.follower.enabled=!0,system.turnState="Reseteando",system.resetInPlace(),_BOT_PLAYING=!1,console.log("Cambia estado a Waiting"),system.turnState="Waiting")}},GameSystem.prototype.tryToStopBalls=function(){for(var e=0;e<this.balls.length;e++){if(!(new pc.Vec2(this.balls[e].script.p2Body.body.velocity[0],this.balls[e].script.p2Body.body.velocity[1]).length()<=this.forceStopDelta||this.balls[e].captured)||this.balls[e].processing)return!1;this.ResetPhysic(this.balls[e])}return!0},GameSystem.prototype.ballsInProcessToHole=function(){for(var e=0;e<this.balls.length;e++)if(this.balls[e].processing)return!0;return!!this.ball.processing},GameSystem.prototype.onMouseDown=function(e){if(!this.b_FrozeGame){var t=e.x,s=e.y;this.Click(t,s,e)}},GameSystem.prototype.onTouchStart=function(e){if(!this.b_FrozeGame){var t=e.touches[0].x,s=e.touches[0].y;this.lastTouchPosition.x=t,this.lastTouchPosition.y=s,this.Click(t,s)}},GameSystem.prototype.onMouseMove=function(e){if(this.target={x:e.x,y:e.y},!this.b_FrozeGame){var t=e.x,s=e.y;this.Move(t,s,e)}},GameSystem.prototype.onTouchMove=function(e){if(this.target={x:e.touches[0].x,y:e.touches[0].y},!this.b_FrozeGame){var t=e.touches[0].x,s=e.touches[0].y;this.lastTouchPosition={x:t,y:s},this.Move(t,s,e)}},GameSystem.prototype.onMouseUp=function(e){if(!this.b_FrozeGame){var t=e.x,s=e.y;this.Up(t,s,e)}},GameSystem.prototype.onTouchEnd=function(e){this.b_FrozeGame||this.Up(this.lastTouchPosition.x,this.lastTouchPosition.y,e)},GameSystem.prototype.Click=function(e,t,s){_CLICK(e,t,s)},GameSystem.prototype.Move=function(e,t,s){_MOVE(e,t,s)},GameSystem.prototype.preShoot=function(){simulation=!1;this.fuerzaDisparo,this.targetExtendedGO.getPosition().clone(),this.ball.getPosition().clone(),new pc.Vec3(0,0,0);var e=this.adjustDistance/2.500000045969642;e=pc.math.clamp(e,0,1),hitForze=e},GameSystem.prototype.shootBallFunction=function(){this.arrowsIconWhiteBall.enabled=!1,this.b_IS_FIRST_TURN=!1,this.b_enableCanMoveWhiteBall=!1,_9_BOLAS_ACTIVADO?system.correctNumberBeforeShoot=system.GetCorrect9BallsNumber():(_TURN_TIME_OUT=!1,window.clearInterval(system.timerGUI)),canvas.cancelGUI=!0,canvas.CancelOptions(),this.lastPositionBalls=[{bola:this.ballsAll[0],pos:this.ballsAll[0].getPosition().clone()},{bola:this.ballsAll[1],pos:this.ballsAll[1].getPosition().clone()},{bola:this.ballsAll[2],pos:this.ballsAll[2].getPosition().clone()},{bola:this.ballsAll[3],pos:this.ballsAll[3].getPosition().clone()},{bola:this.ballsAll[4],pos:this.ballsAll[4].getPosition().clone()},{bola:this.ballsAll[5],pos:this.ballsAll[5].getPosition().clone()},{bola:this.ballsAll[6],pos:this.ballsAll[6].getPosition().clone()},{bola:this.ballsAll[7],pos:this.ballsAll[7].getPosition().clone()},{bola:this.ballsAll[8],pos:this.ballsAll[8].getPosition().clone()},{bola:this.ballsAll[9],pos:this.ballsAll[9].getPosition().clone()},{bola:this.ballsAll[10],pos:this.ballsAll[10].getPosition().clone()},{bola:this.ballsAll[11],pos:this.ballsAll[11].getPosition().clone()},{bola:this.ballsAll[12],pos:this.ballsAll[12].getPosition().clone()},{bola:this.ballsAll[13],pos:this.ballsAll[13].getPosition().clone()},{bola:this.ballsAll[14],pos:this.ballsAll[14].getPosition().clone()},{bola:this.ballsAll[15],pos:this.ballsAll[15].getPosition().clone()}];var e=4.5*hitForze*system.extraImpulse;console.log("LA FUERZA Q TIRO "+e);var t=new pc.Vec3(this.followerGO.forward.x,0,this.followerGO.forward.z).normalize().scale(e*forzeCueFactor);this.ball.script.p2Body.body.applyImpulse([t.x,-t.z]),_masse.configMasse(new pc.Vec2(t.x,-t.z),hitForze),hitForze>.6?playSound("poolCueHitHigh"):playSound("poolCueLow")},GameSystem.prototype.MetodoDumpingBolas=function(e,t){for(var s=0;s<this.ballsAll.length;s++)this.ballsAll[s].script.p2Body.body.damping=e;clearInterval(this.hiloShoot),0==t?this.hiloShoot=setInterval(this.MetodoDumpingBolas.bind(this,.4,1),300):1==t?this.hiloShoot=setInterval(this.MetodoDumpingBolas.bind(this,.6,2),300):2==t&&(this.hiloShoot=setInterval(this.MetodoDumpingBolas.bind(this,.85,3),500))},GameSystem.prototype.loopShootBall=function(){isMobile.any()||this.followerGO.lookAt(this.targetExtendedGO.getPosition().clone())},GameSystem.prototype.Up=function(e,t,s){_UP(e,t,s)},GameSystem.prototype.DrawPoolCueLine=function(){if(!_BOT_PLAYING&&!this.mobileWaitingClick)if(this.circleGO.children[0].enabled=!1,null!=this.ballColisionada){var e=this.ballColisionada.getPosition();new pc.Color(191,63,101);if(null!=ballPosGlobal.blanca&&null!=this.ballColisionada&&ballPosGlobal.hit.length>1){this.ballWhiteLineInitial2.enabled=!1;for(var t,s=new pc.Vec3(ballPosGlobal.hit[0].x,e.y,ballPosGlobal.hit[0].z),l=new pc.Vec3(ballPosGlobal.hit[1].x,e.y,ballPosGlobal.hit[1].z),o=(l=new pc.Vec3(e.x,e.y,e.z),!1),a=ballPosGlobal.blancaIni.length-1;a>0;a--){if(null==ballPosGlobal.blancaIni[a])return;s=new pc.Vec3(ballPosGlobal.blancaIni[a].x,e.y,ballPosGlobal.blancaIni[a].z);for(var i=new pc.Vec3(ballPosGlobal.blancaIni[a-1].x,e.y,ballPosGlobal.blancaIni[a-1].z),n=0;n<=10;n++){var r=new pc.Vec2,h=new pc.Vec2(s.x,s.z),c=new pc.Vec2(i.x,i.z);if(r.lerp(c,h,1-.1*n),(r=new pc.Vec3(r.x,e.y,r.y)).distance(l)>=.362){t=r,o=!0;break}}if(o)break}this.circleGO.setPosition(t),this.circleErrorGO.setPosition(t),_9_BOLAS_ACTIVADO?this.ballColisionada.name==system.GetCorrect9BallsNumber().objeto.name?(this.circleGO.enabled=!0,this.circleErrorGO.enabled=!1):(this.circleGO.enabled=!1,this.circleErrorGO.enabled=!0):this.b_FirstTurnComplete?this.IsFirstHitCorrect(this.ballColisionada.name)?(this.circleGO.enabled=!0,this.circleErrorGO.enabled=!1):(this.circleGO.enabled=!1,this.circleErrorGO.enabled=!0):"9"==this.ballColisionada.name?(this.circleGO.enabled=!1,this.circleErrorGO.enabled=!0):(this.circleGO.enabled=!0,this.circleErrorGO.enabled=!1),(f=(1-(_=0))/(1.199-(B=0))*((s=this.ball.getPosition().clone()).distance(t)-B)+_)<.05&&(f=.05),this.ballWhiteLineInitial.setLocalScale(1,1,f),this.ballWhiteLineInitial.setPosition(s),this.ballWhiteLineInitial.lookAt(t),this.ballWhiteLineInitial.enabled=!0;s=t,l=new pc.Vec3(ballPosGlobal.blanca[0].x,e.y,ballPosGlobal.blanca[0].z);(f=(1-(_=0))/(1.199-(B=0))*(s.distance(l)-B)+_)>.6&&(f=.6),this.ballWhiteLine.setLocalScale(1,1,f),this.ballWhiteLine.setPosition(s),this.ballWhiteLine.lookAt(l),this.ballWhiteLine.enabled=!0,this.ballWhiteLine2.enabled=!1,this.ballWhiteLineInitial2.enabled=!1,this.Ex.setPosition(s),this.Ex.enabled=!0,this.Ex.lookAt(l),(f*=1.35)<.28&&(f=.28),f>.68&&(f=.68),this.ballWhiteLine.setLocalScale(1,1,f),s=this.ballColisionada.getPosition().clone(),l=new pc.Vec3(ballPosGlobal.hit[0].x,e.y,ballPosGlobal.hit[0].z),(f=(.85-(_=.2))/(.0496-(B=.001))*(s.distance(l)-B)+_)<0&&(f=0),f>.85&&(f=.85),this.ballWhiteColor.setLocalScale(1,1,f),this.ballWhiteColor.setPosition(s),this.ballWhiteColor.lookAt(l),this.ballWhiteColor.enabled=!0,this.ballWhiteColor2.enabled=!1;var y=this.ballColisionada.name,m=parseInt(y)-2;this.ballWhiteColor.script.cambiaTextura.cambio(m)}}else{if(this.ballWhiteLine.enabled=!1,this.ballWhiteColor.enabled=!1,this.ballWhiteColor2.enabled=!1,this.ballWhiteLine2.enabled=!1,this.ballWhiteLineInitial2.enabled=!1,this.Ex.enabled=!1,this.circleGO.children[0].enabled=!1,colisionHoyo||null==ballPosGlobal.blancaBordeFase2||0==ballPosGlobal.blancaBordeFase2.length){var p=this.ball.getPosition().clone(),b=this.targetExtendedGO.getPosition().clone(),u=new pc.Vec3(p.x,this.ball.getPosition().clone().y,p.z);return(f=(1-(_=0))/(1.199-(B=0))*((d=new pc.Vec3(b.x,this.ball.getPosition().clone().y,b.z)).distance(u)-B)+_)<.05&&(f=.05),this.ballWhiteLineInitial.setLocalScale(1,1,f),this.ballWhiteLineInitial.setPosition(u),this.ballWhiteLineInitial.lookAt(d),this.ballWhiteLineInitial.enabled=!0,this.circleErrorGO.enabled=!1,this.circleGO.setPosition(new pc.Vec3(d.x,d.y,d.z)),this.circleGO.enabled=!0,void(this.circleGO.children[0].enabled=!1)}var d,B,_,f,A=ballPosGlobal.blancaBordeFase1,P=ballPosGlobal.blancaBordeFase2;u=new pc.Vec3(A[0].x,this.ball.getPosition().clone().y,A[0].z);(f=(1-(_=0))/(1.199-(B=0))*((d=new pc.Vec3(A[A.length-1].x,this.ball.getPosition().clone().y,A[A.length-1].z)).distance(u)-B)+_)<.05&&(f=.05),this.ballWhiteLineInitial.setLocalScale(1,1,f),this.ballWhiteLineInitial.setPosition(u),this.ballWhiteLineInitial.lookAt(d),this.ballWhiteLineInitial.enabled=!0,this.circleErrorGO.enabled=!1,this.circleGO.setPosition(new pc.Vec3(d.x,d.y,d.z)),this.circleGO.enabled=!0,this.circleGO.children[0].enabled=!0;P.length;var g=new pc.Vec3(P[2].x,d.y,P[2].z);this.ballWhiteLineInitial2.enabled=!0,this.ballWhiteLineInitial2.setPosition(d),this.ballWhiteLineInitial2.lookAt(g)}},GameSystem.prototype.InitGamePlayVariables=function(){this.b_FrozeGame=!1,this.lastTouchPosition={x:0,y:0},this.target={x:0,y:0},this.targetExtended={x:0,y:0},this.turnState="",this.ballRadius=.356,this.maxCueDistance=2.5,this.barSpeed=4,this.cueLoad=0,this.usingCueLoadBar=!1,this.dynamicDistance=0,this.rotationSpeed=.11,this.factorMouseSwipe=-1,this.b_SelectingBall8=!1,this.blackBallHoleDropName="",this.selectedHole="",this.b_WrongPositionWhiteBall=!1,this.b_whiteBallReleased=!1,this.b_ENABLE_TEST_BALL8=!1,this.playerTurn=0,this.b_FirstTurnComplete=!1,this.ballsCapturedInTurn=[],this.b_GAME_FINISHED=!1,this.ball.captured=!1,this.ball.processing=!1,this.finishLeft=new pc.Vec3(this.startLeft.x,this.startLeft.y,-1*this.startLeft.z),this.finishRight=new pc.Vec3(this.startRight.x,this.startRight.y,-1*this.startRight.z),this.capturedBallsPlayer1=[],this.capturedBallsPlayer2=[],this.firstPositionBalls=[{bola:this.ballsAll[0],pos:this.ballsAll[0].getPosition().clone()},{bola:this.ballsAll[1],pos:this.ballsAll[1].getPosition().clone()},{bola:this.ballsAll[2],pos:this.ballsAll[2].getPosition().clone()},{bola:this.ballsAll[3],pos:this.ballsAll[3].getPosition().clone()},{bola:this.ballsAll[4],pos:this.ballsAll[4].getPosition().clone()},{bola:this.ballsAll[5],pos:this.ballsAll[5].getPosition().clone()},{bola:this.ballsAll[6],pos:this.ballsAll[6].getPosition().clone()},{bola:this.ballsAll[7],pos:this.ballsAll[7].getPosition().clone()},{bola:this.ballsAll[8],pos:this.ballsAll[8].getPosition().clone()},{bola:this.ballsAll[9],pos:this.ballsAll[9].getPosition().clone()},{bola:this.ballsAll[10],pos:this.ballsAll[10].getPosition().clone()},{bola:this.ballsAll[11],pos:this.ballsAll[11].getPosition().clone()},{bola:this.ballsAll[12],pos:this.ballsAll[12].getPosition().clone()},{bola:this.ballsAll[13],pos:this.ballsAll[13].getPosition().clone()},{bola:this.ballsAll[14],pos:this.ballsAll[14].getPosition().clone()},{bola:this.ballsAll[15],pos:this.ballsAll[15].getPosition().clone()}],canvas.optionsPanel.enabled=!1,canvas.soundOFF.enabled=!1,canvas.gameEndPanel.enabled=!1,canvas.victoryGUI.enabled=!1,canvas.looseGUI.enabled=!1,canvas.turnPlayer1GUI.enabled=!1,canvas.turnPlayer2GUI.enabled=!1,canvas.choosePocketHoleGUI.enabled=!1,canvas.macePanelGUI.enabled=!1,canvas.timeGUI.element.text=_LIMIT_TIME_TURN_SECONDS+"",canvas.leftIndicatorGUI.enabled=!1,canvas.rightIndicatorGUI.enabled=!1,canvas.choosePocketHoleGUI.enabled=!1,system.StartTurnTimer=function(){if(!(system.b_GAME_FINISHED||_TUTORIAL_PLAYING||_GUI_OPEN||_9_BOLAS_ACTIVADO)){var e=_LIMIT_TIME_TURN_SECONDS;canvas.timeGUI.element.text=e<10?"0"+e:e.toString();var t=new pc.Color;canvas.timeGUI.element.color=t.fromString(normalColor),canvas.timeGUI.script.parpadear.autoStart=0,canvas.timeGUI.enabled=!0,system.timerGUI=setInterval((function(){if(system.b_GAME_FINISHED)window.clearInterval(system.timerGUI);else{if(_GUI_OPEN&&_SINGLE_PLAYER&&0==this.player||e--,e==_LIMIT_TIME_TURN_SECONDS/2&&_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_clockTicking(),e==_LIMIT_TIME_TURN_SECONDS-1&&(canvas.cancelGUI=!1,canvas.optionsButton_player1.element.opacity=1),canvas.timeGUI.element.text=e<10?"0"+e:e.toString(),e<=10){if(playSound("pocoTiempo"),10==e){var t=new pc.Color;canvas.timeGUI.element.color=t.fromString(lowTimeColor),canvas.cancelGUI=!0,canvas.CancelOptions()}canvas.timeGUI.script.parpadear.autoStart=2}e<=0&&(_9_BALLS_LEVELS?(_TURN_TIME_OUT=!0,window.clearInterval(system.timerGUI),system.FinishEASEgame()):(system.CancelTurnAndSwitch(),_TURN_TIME_OUT=!0,window.clearInterval(system.timerGUI)))}}),1e3)}},this.poolCueGO.setLocalPosition(new pc.Vec3(0,0,0)),this.coreLoaded=!0},GameSystem.prototype.parseExtendedTargetGO=function(){var e=this.ball.getPosition().clone().x,t=this.ball.getPosition().clone().z,s=this.targetGO.getPosition().clone().x,l=this.targetGO.getPosition().clone().z,o=(l-t)/(s-e),a=s>e?s+3:s-3,i=o*a+(l-o*s);s>e?a=this.RIGHT.getPosition().clone().x:s<e&&(a=this.LEFT.getPosition().clone().x),(i=o*a+(l-o*s))<this.TOP.getPosition().clone().z?(a=(this.TOP.getPosition().clone().z-(l-o*s))/o,i=this.TOP.getPosition().clone().z):i>this.DOWN.getPosition().clone().z&&(a=(this.DOWN.getPosition().clone().z-(l-o*s))/o,i=this.DOWN.getPosition().clone().z),this.targetExtendedGO.setPosition(new pc.Vec3(a,this.ball.getPosition().y,i))};var ColliderHoyo=pc.createScript("colliderHoyo");ColliderHoyo.prototype.initialize=function(){this.balls=[]},ColliderHoyo.prototype.triggerStart=function(e,t,o){if(!e.pushedBall&&!e.captured){var l=new pc.Vec2(e.script.p2Body.body.velocity[0],e.script.p2Body.body.velocity[1]);l=l.length(),"1"!=e.name?(system.ResetPhysic(e),e.dir=pc.Vec3.ZERO,e.resetBall=!1,e.pushedBall=!0,e.white=!1,e.captured=!1,e.processing=!0,this.balls.push(e)):(system.ResetPhysic(e),e.dir=pc.Vec3.ZERO,e.resetBall=!1,e.pushedBall=!0,e.white=!0,e.captured=!1,e.processing=!0,this.balls.push(e)),e.script.p2Body.enabled=!1,this.animHoleIn(e,l,t,o)}},ColliderHoyo.prototype.animHoleIn=function(e,t,o,l){var i=this.entity.getLocalPosition(),a=new pc.Vec3(i.x,i.y,i.z+o),s=-.009583333333333334*(t-0)+.32;playSound("ballSlot"),_9_BOLAS_ACTIVADO&&CapturarBola(e,l),e.animationHoleIn=e.tween(e.getLocalPosition()).to(a,s,pc.Linear).onComplete((()=>{var o=.25*(t-0)+3,i=system.poolTable.getPosition(),a=e.getPosition(),s=i.distance(a)/o;e.setLocalScale(.45,.45,.45),e.animationHoleIn3=e.tween(e.getLocalScale()).to(new pc.Vec3(.1,.1,.1),s/4,pc.Linear).start(),e.animationHoleIn2=e.tween(e.getLocalPosition()).to(system.poolTable.getLocalPosition(),s,pc.SineOut).onComplete((()=>{e.dir=pc.Vec3.ZERO,e.pushedBall=!1,e.captured=!0,e.enabled=!1,e.setLocalScale(.45,.45,.45),this.balls.splice(this.balls.indexOf(e),1),system.CaptureBallFunction(e,l)})).start()})).start()},ColliderHoyo.prototype.update=function(e){};var Follower=pc.createScript("follower");Follower.attributes.add("follow",{type:"entity",title:"follow"}),Follower.attributes.add("withAngle",{type:"boolean",default:!1,title:"withAngle"}),Follower.attributes.add("withScale",{type:"boolean",default:!1,title:"withScale"}),Follower.prototype.initialize=function(){},Follower.prototype.postUpdate=function(t){this.entity.setPosition(this.follow.getPosition().clone()),this.withAngle&&this.entity.setRotation(this.follow.getRotation().clone()),this.withScale&&this.entity.setLocalScale(this.follow.getLocalScale().clone())};var Ball2dRot=pc.createScript("ball2dRot");Ball2dRot.attributes.add("radius",{type:"number",default:.19,title:"ball radius"}),Ball2dRot.attributes.add("fakeEntity",{type:"entity",title:"fake entity for aux quat"}),Ball2dRot.attributes.add("axes",{type:"number",enum:[{XY:1},{XZ:2},{YZ:3}],default:1,title:"Axes",description:"The axes for fake 3d rotate"}),Ball2dRot.prototype.initialize=function(){null==this.fakeEntity&&(this.fakeEntity=this.app.root.findByName("fakeEntity")),this.lastPosition=this.entity.getPosition().clone()},Ball2dRot.prototype.rotateBall=function(){if(0!=this.radius){var t=this.entity.getPosition().clone(),e=new pc.Vec3;e.sub2(this.lastPosition,t);var i=e.length();if(0!=i){var a;switch(i>.01&&(i=.01),this.axes){case 1:a=new pc.Vec3(0,0,-30);break;case 2:a=new pc.Vec3(0,-50,0);break;case 3:a=new pc.Vec3(-30,0,0)}var s=(new pc.Vec3).cross(a,e);if(s!=pc.Vec3.ZERO){var n=180*(i/this.radius)/Math.PI,o=new pc.Quat;o.setFromAxisAngle(s,n);var l=new pc.Quat;l.mul2(o,this.entity.getRotation()),this.fakeEntity.setRotation(l),this.entity.setLocalEulerAngles(this.fakeEntity.getLocalEulerAngles())}}}},Ball2dRot.prototype.update=function(t){this.rotateBall(),this.lastPosition=this.entity.getPosition().clone()};var CambiaTextura=pc.createScript("cambiaTextura");CambiaTextura.attributes.add("material",{type:"asset",assetType:"material",array:!1}),CambiaTextura.attributes.add("texturas",{type:"asset",assetType:"texture",array:!0,title:"texturas"}),CambiaTextura.attributes.add("transparente",{type:"number",default:0,title:"transparente"}),CambiaTextura.attributes.add("emisivo",{type:"number",default:0,title:"emisivo"}),CambiaTextura.attributes.add("esElement",{type:"number",default:0,title:"esElement"}),CambiaTextura.prototype.initialize=function(){},CambiaTextura.prototype.cambio=function(e){var t=this.texturas[e];if(0==this.esElement){var a=this.material.resource;a.diffuseMap=t.resource,1==this.transparente&&(a.opacityMap=t.resource),1==this.emisivo&&(a.emissiveMap=t.resource),a.update()}else this.entity.element.texture=t.resource};var DetectAspectRatio=pc.createScript("detectAspectRatio");DetectAspectRatio.attributes.add("camara",{type:"entity"}),DetectAspectRatio.attributes.add("powerBar",{type:"entity"}),DetectAspectRatio.prototype.initialize=function(){_2dScreen=this.entity,this.ortho=1,this.Detect()},DetectAspectRatio.prototype.Detect=function(){var t=window.innerWidth/window.innerHeight;if(t>1){if(!isMobile.any()){this.powerBar.enabled=!1,this.camara.camera.orthoHeight=4;var a=this.camara.getPosition();return this.camara.setPosition(.1,a.y,-.3),void(this.ortho=this.camara.camera.orthoHeight)}if(t>1.78){this.camara.camera.orthoHeight=4.05;a=this.camara.getPosition();this.camara.setPosition(-.313,a.y,-.34)}else if(t<=1.35){this.camara.camera.orthoHeight=5.4;a=this.camara.getPosition();this.camara.setPosition(-.3,a.y,a.z)}else{this.camara.camera.orthoHeight=4.5;a=this.camara.getPosition();this.camara.setPosition(-.313,a.y,a.z)}}else{if(t=window.innerHeight/window.innerWidth,!isMobile.any()){this.powerBar.enabled=!1,this.camara.camera.orthoHeight=3.5;a=this.camara.getPosition();return this.camara.setPosition(.8,a.y,0),void(this.ortho=this.camara.camera.orthoHeight)}if(t>1.78){this.camara.camera.orthoHeight=4.05;a=this.camara.getPosition();this.camara.setPosition(.5,a.y,-.25)}else if(t<=1.35){this.camara.camera.orthoHeight=3.5;a=this.camara.getPosition();this.camara.setPosition(.7,a.y,-.05)}else{this.camara.camera.orthoHeight=3.6;a=this.camara.getPosition();this.camara.setPosition(.25,a.y,-.3)}}this.ortho=this.camara.camera.orthoHeight};var GiroEntidad=pc.createScript("giroEntidad");GiroEntidad.attributes.add("speed",{type:"number",default:10}),GiroEntidad.attributes.add("axis",{type:"number",default:0}),GiroEntidad.prototype.initialize=function(){},GiroEntidad.prototype.update=function(t){0==this.axis?this.entity.rotateLocal(t*this.speed,0,0):1==this.axis?this.entity.rotateLocal(0,t*this.speed,0):2==this.axis&&this.entity.rotateLocal(0,0,t*this.speed)};var AnimaUvs=pc.createScript("animaUvs");AnimaUvs.attributes.add("material",{type:"asset",assetType:"material",array:!1}),AnimaUvs.attributes.add("speed",{type:"number",default:.01,title:"speed"}),AnimaUvs.attributes.add("eje",{type:"number",default:0,title:"ejeX_o_Y"}),AnimaUvs.attributes.add("loop",{type:"number",default:1,title:"LOOP"}),AnimaUvs.attributes.add("desde",{type:"number",default:0,title:"desde"}),AnimaUvs.attributes.add("hasta",{type:"number",default:1,title:"hasta"}),AnimaUvs.attributes.add("tipoMaterial",{type:"string",default:"opacityMapOffset",title:"opacityMapOffset"}),AnimaUvs.attributes.add("tipoMaterial2",{type:"string",default:"",title:"diffuseMapOffset"}),AnimaUvs.attributes.add("tipoMaterial3",{type:"string",default:"",title:"emissiveMapOffset"}),AnimaUvs.prototype.initialize=function(){this.materialCargado=this.material.resource},AnimaUvs.prototype.resetMaterial=function(t){this.materialCargado[this.tipoMaterial]=new pc.Vec2(0,0),this.materialCargado.update(),this.entity.enabled=!0,this.eje=t},AnimaUvs.prototype.update=function(t){var a;switch(this.tipoMaterial){case"opacityMapOffset":a=this.materialCargado.opacityMapOffset;break;case"diffuseMapOffset":a=this.materialCargado.diffuseMapOffset;break;case"emissiveMapOffset":a=this.materialCargado.emissiveMapOffset}if(0==this.eje)(e=a.y-t*this.speed)<0&&(0==this.loop?(e=0,this.eje=-99):e=1),this.materialCargado[this.tipoMaterial]=new pc.Vec2(0,e),""!=this.tipoMaterial2&&(this.materialCargado[this.tipoMaterial2]=new pc.Vec2(0,e)),""!=this.tipoMaterial3&&(this.materialCargado[this.tipoMaterial3]=new pc.Vec2(0,e)),this.materialCargado.update();else if(1==this.eje){var e;(e=a.x+t*this.speed)>this.hasta&&(0==this.loop?(e=this.hasta,this.eje=-99,setTimeout(this.apagaObjeto.bind(this),20)):e=this.desde),this.materialCargado[this.tipoMaterial]=new pc.Vec2(e,0),""!=this.tipoMaterial2&&(this.materialCargado[this.tipoMaterial2]=new pc.Vec2(e,0)),""!=this.tipoMaterial3&&(this.materialCargado[this.tipoMaterial3]=new pc.Vec2(e,0)),this.materialCargado.update()}},AnimaUvs.prototype.apagaObjeto=function(){this.entity.enabled=!1};var Parpadear=pc.createScript("parpadear");Parpadear.attributes.add("tiempoDesaparicion",{type:"number",default:.85,title:"tiempoDesaparicion"}),Parpadear.attributes.add("tiempoAparicion",{type:"number",default:.45,title:"tiempoAparicion"}),Parpadear.attributes.add("autoStart",{type:"number",default:1,title:"autoStart"}),Parpadear.prototype.initialize=function(){this.contador=0},Parpadear.prototype.update=function(t){0!=this.autoStart&&(this.contador=this.contador+t,this.entity.element.enabled?this.contador>this.tiempoDesaparicion&&(this.contador=0,this.entity.element.enabled=!1):this.entity.element.enabled||this.contador>this.tiempoAparicion&&(this.contador=0,this.entity.element.enabled=!0,2==this.autoStart&&(this.autoStart=0)))};var AnimaTextoMsg=pc.createScript("animaTextoMsg");AnimaTextoMsg.attributes.add("destinox",{type:"number",default:0,title:"destinox"}),AnimaTextoMsg.attributes.add("destinoy",{type:"number",default:0,title:"destinoy"}),AnimaTextoMsg.attributes.add("destinoz",{type:"number",default:0,title:"destinoz"}),AnimaTextoMsg.attributes.add("tiempo",{type:"number",default:.6,title:"tiempo"}),AnimaTextoMsg.attributes.add("esElement",{type:"number",default:0,title:"esElement"}),AnimaTextoMsg.attributes.add("delaySaca",{type:"number",default:1.8,title:"delaySaca"}),AnimaTextoMsg.attributes.add("boton",{type:"string",array:!0,title:"boton"}),AnimaTextoMsg.attributes.add("tipoTween",{type:"string",default:"BounceOut",title:"tipoTween"}),AnimaTextoMsg.prototype.elijeTween=function(t){switch(t){case"BounceOut":t=pc.BounceOut;break;case"SineIn":t=pc.SineIn;break;case"SineOut":t=pc.SineOut;break;case"SineInOut":t=pc.SineInOut}return t},AnimaTextoMsg.prototype.initialize=function(){this.mc=this.entity,this.tween=null;var t=this.entity.getLocalPosition();this.origen=new pc.Vec3(t.x,t.y,t.z),this.tipoTween=this.elijeTween(this.tipoTween),this.entity.enabled=!1},AnimaTextoMsg.prototype.clickBoton=function(t,e,i){null!=e?null!=this.boton&&null!=this.boton[i]&&(this.entity.element.text=this.boton[i]):this.boton.length>0&&null!=this.boton[1]&&(this.entity.element.text=this.boton[1],setTimeout(this.restauraBoton.bind(this,t),180))},AnimaTextoMsg.prototype.restauraBoton=function(t){null!=this.boton[0]&&(this.entity.element.text=this.boton[0],t())},AnimaTextoMsg.prototype.pone=function(t,e){var i=this.tiempo;null!=e&&(i=e),this.entity.setLocalPosition(this.origen.x,this.origen.y,this.origen.z);var n=this.entity.getLocalPosition(),s=new pc.Vec3(this.destinox,this.destinoy,this.destinoz),o=new pc.Vec3(n.x+s.x,n.y+s.y,n.z+s.z);this.entity.setLocalPosition(o.x,o.y,o.z),this.entity.enabled=!0,n=this.entity.getLocalPosition(),this.tween=this.mc.tween(n).to(this.origen,i,this.tipoTween),this.tween.onComplete((()=>{this.terminaPone(t)})),this.tween.start()},AnimaTextoMsg.prototype.poneYalfa=function(t,e){this.entity.children[0].element.opacity=1,this.entity.children[1].element.opacity=1,this.entity.children[2].element.opacity=1,this.entity.children[3].element.opacity=1,this.entity.children[0].element.outlineThickness=1,this.entity.children[1].element.outlineThickness=1,this.entity.children[2].element.outlineThickness=1,this.entity.children[3].element.outlineThickness=1;var i=this.tiempo;null!=e&&(i=e);var n=this.entity.getLocalPosition(),s=new pc.Vec3(this.destinox,this.destinoy,this.destinoz),o=new pc.Vec3(n.x+s.x,n.y+s.y,n.z+s.z);this.entity.enabled=!0,this.tween=this.mc.tween(n).to(o,i,this.tipoTween),this.tween.onComplete((()=>{this.terminaPone(t)})),this.tween.start();var a={x:1};this.app.tween(a).to({x:0},.34,pc.SineOut).onUpdate((()=>{this.entity.children[0].element.opacity=a.x,this.entity.children[1].element.opacity=a.x,this.entity.children[2].element.opacity=a.x,this.entity.children[3].element.opacity=a.x,this.entity.children[0].element.outlineThickness=a.x,this.entity.children[1].element.outlineThickness=a.x,this.entity.children[2].element.outlineThickness=a.x,this.entity.children[3].element.outlineThickness=a.x})).delay(.55).start()},AnimaTextoMsg.prototype.poneScale=function(t,e,i){var n=this.tiempo;null!=e&&(n=e);var s=this.tipoTween;null!=i&&(s=i),s=this.elijeTween(s),this.entity.setLocalScale(0,0,0);var o=new pc.Vec3(1,1,1),a=this.entity.getLocalScale();this.entity.enabled=!0,this.tween=this.mc.tween(a).to(o,n,s),this.tween.onComplete((()=>{this.terminaPone(t)})),this.tween.start()},AnimaTextoMsg.prototype.sacaScale=function(t,e,i,n){var s=this.tiempo;null!=i&&(s=i);var o=this.tipoTween;null!=n&&(o=n),o=this.elijeTween(o),this.entity.setLocalScale(1,1,1);var a=new pc.Vec3(0,0,0),h=this.entity.getLocalScale();this.entity.enabled=!0,this.tween=this.mc.tween(h).to(a,s,o),this.tween.onComplete((()=>{this.terminaSaca(t,e)})),this.tween.start()},AnimaTextoMsg.prototype.saca=function(t,e,i){var n=this.tiempo;null!=i&&(n=i),this.entity.setLocalPosition(this.origen.x,this.origen.y,this.origen.z);var s=this.entity.getLocalPosition(),o=new pc.Vec3(this.destinox,this.destinoy,this.destinoz);o=new pc.Vec3(s.x+o.x,s.y+o.y,s.z+o.z),this.entity.enabled=!0,this.tween=this.mc.tween(s).to(o,n,this.tipoTween),this.tween.onComplete((()=>{this.terminaSaca(t,e)})),this.tween.start()},AnimaTextoMsg.prototype.sacaInverso=function(t,e,i){var n=this.tiempo;null!=i&&(n=i),this.entity.setLocalPosition(this.origen.x,this.origen.y,this.origen.z);var s=this.entity.getLocalPosition(),o=new pc.Vec3(this.destinox,this.destinoy,this.destinoz);o=new pc.Vec3(s.x-o.x,s.y-o.y,s.z-o.z),this.entity.enabled=!0,this.tween=this.mc.tween(s).to(o,n,this.tipoTween),this.tween.onComplete((()=>{this.terminaSaca(t,e)})),this.tween.start()},AnimaTextoMsg.prototype.terminaPone=function(t){null!=t&&t()},AnimaTextoMsg.prototype.terminaSaca=function(t,e){t&&(this.entity.enabled=!1),null!=e&&e()},AnimaTextoMsg.prototype.poneSaca=function(t){};var Main3dcamera=pc.createScript("main3dcamera");Main3dcamera.attributes.add("speed",{type:"number",default:10}),Main3dcamera.attributes.add("node1",{type:"entity"}),Main3dcamera.attributes.add("node2",{type:"entity"}),Main3dcamera.attributes.add("camera",{type:"entity"}),Main3dcamera.prototype.initialize=function(){this.goToNode(1)},Main3dcamera.prototype.goToNode=function(t){3==t&&(t=1);var e=this["node"+t].getLocalPosition(),a=this["node"+t].getLocalEulerAngles(),i=this.entity.getPosition(),n=this["node"+t].getPosition(),o=i.distance(n)/this.speed;this.camera.tween(this.camera.getLocalEulerAngles()).rotate(a,o,pc.SineInOut).start(),this.camera.tween(this.camera.getLocalPosition()).to(e,o,pc.SineInOut).onComplete((()=>{this.goToNode(t+1)})).start()},Main3dcamera.prototype.update=function(t){};var UISlider=pc.createScript("uiSlider");UISlider.attributes.add("handle",{type:"entity",default:null,title:"Handle"}),UISlider.attributes.add("axis",{type:"string",default:"y",title:"Axis",description:"lock drag to axis: x, y or xy"}),UISlider.attributes.add("guiButton",{type:"entity"}),UISlider.attributes.add("reference",{type:"entity"}),UISlider.attributes.add("punto",{type:"entity"}),UISlider.attributes.add("camara",{type:"entity"}),UISlider.prototype.initialize=function(){_masse=this,this.screenX=0,this.screenY=0,this.forze=null,this.hitForze=0,this.angle=0},UISlider.prototype.postInitialize=function(){if(this.handle||(this.handle=this.entity.parent.findByName("UISliderHandle")),!this.handle)throw new Error("UISlider has no handle");this.addHandleListeners(),this.isDragging=!1,this.touchId=-1,this.mousePos=new pc.Vec3(0,0,0),this.anchorPos=this.handle.getLocalPosition().clone(),this.screen=this.getUIScreenComponent(),this.screenXBase=null,this.screenYBase=null},UISlider.prototype.getUIScreenComponent=function(){return this.handle.element.screen.screen},UISlider.prototype.addHandleListeners=function(){isMobile.any()?(console.log("initing touches"),this.reference.element.on(pc.EVENT_TOUCHSTART,this.soloClick,this),this.handle.element.on(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHCANCEL,this.onTouchEnd,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onTouchMove,this)):(this.reference.element.on(pc.EVENT_MOUSEDOWN,this.soloClick,this),this.handle.element.on(pc.EVENT_MOUSEDOWN,this.onPressDown,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onPressUp,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onPressMove,this)),this.on("destroy",(function(){this.handle.element.off(pc.EVENT_MOUSEDOWN,this.onPressDown,this),this.app.mouse.off(pc.EVENT_MOUSEUP,this.onPressUp,this),this.app.mouse.off(pc.EVENT_MOUSEMOVE,this.onPressMove,this),isMobile.any()&&(this.handle.element.off(pc.EVENT_TOUCHSTART,this.onTouchStart,this),this.app.touch.off(pc.EVENT_TOUCHEND,this.onTouchEnd,this),this.app.touch.off(pc.EVENT_TOUCHCANCEL,this.onTouchEnd,this),this.app.touch.off(pc.EVENT_TOUCHMOVE,this.onTouchMove,this))}))},UISlider.prototype.soloClick=function(e){console.log("REAL "+e.x+"  "+e.y),console.log("y mi punto x "+this.punto.getLocalPosition().x+"  y  "+this.punto.getLocalPosition().y),console.log("mi height "+this.app.graphicsDevice.height)},UISlider.prototype.onTouchStart=function(e){console.log(e.x+"  "+e.y);var t=e.changedTouches[0];this.touchId=t.identifier,console.log(e),this.startDrag(e.x,e.y),e.event.stopPropagation()},UISlider.prototype.onTouchMove=function(e){for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t];if(i.id==this.touchId)return e.event.stopPropagation(),void this.updateMove(i.x,i.y)}},UISlider.prototype.onTouchEnd=function(e){for(var t=0;t<e.changedTouches.length;t++){var i=e.changedTouches[t];if(i.id==this.touchId)return e.event.stopImmediatePropagation(),this.touchId=-1,void this.endDrag(i.x,i.y)}},UISlider.prototype.onPressDown=function(e){console.log("APRETE"),e.event.stopImmediatePropagation(),this.startDrag(e.x,e.y)},UISlider.prototype.onPressUp=function(e){e.event.stopImmediatePropagation(),this.endDrag(e.x,e.y)},UISlider.prototype.onPressMove=function(e){this.updateMove(e.x,e.y),e.event.stopImmediatePropagation()},UISlider.prototype.startDrag=function(e,t){if(console.log("APRETE AQUI PO "+e+"  "+t),isMobile.any()||(this.screenXBase=null),null==this.screenXBase){var i=this.app.graphicsDevice,s=this.handle.element.anchor.x*i.width/window.devicePixelRatio,o=this.handle.element.anchor.y*i.height/window.devicePixelRatio,n=1/(this.screen.scale/window.devicePixelRatio);console.log("punto x "+this.punto.getLocalPosition().x),console.log("punto y "+this.punto.getLocalPosition().y);var h=this.screen.scaleBlend,r=(1-this.screen.scaleBlend)*this.screen.referenceResolution.x/this.screen.resolution.x+h*this.screen.referenceResolution.y/this.screen.resolution.y;console.log("ESCALA RQ "+r);var a=this.punto.getLocalPosition(),c=Math.abs(a.x),l=Math.abs(a.y);c=c/r/window.devicePixelRatio,l=l/r/window.devicePixelRatio;var p=window.innerWidth,d=window.innerHeight;isMobile.any()||(p=this.app.graphicsDevice.width,d=this.app.graphicsDevice.height),c=p-c-this.punto.element.width/2*r/window.devicePixelRatio,l=d-l-this.punto.element.height/2*r/window.devicePixelRatio,console.log("punto x "+e),console.log("punto y "+t),console.log("punto Rx "+c),console.log("punto Ry "+l),this.screenXBase="x"==this.axis||"xy"==this.axis?(c-s)*n:this.anchorPos.x,this.screenYBase="y"==this.axis||"xy"==this.axis?(-l+o)*n:this.anchorPos.y,console.log(window.innerHeight),console.log(this.screenXBase+" base , "+this.screenYBase),console.log(window.devicePixelRatio)}this.isDragging=!0,this.setMouseXY(e,t),this.entity.setLocalScale(1.6,1.6,1.6),playSound("tapWhite")},UISlider.prototype.updateMove=function(e,t){this.isDragging&&this.setMouseXY(e,t)},UISlider.prototype.endDrag=function(e,t){this.isDragging&&playSound("endWhite"),this.isDragging=!1,this.setMouseXY(e,t),this.entity.setLocalScale(1,1,1)},UISlider.prototype.setMouseXY=function(e,t){this.mousePos.x=e,this.mousePos.y=t},UISlider.prototype.update=function(e){this.updateDrag()},UISlider.prototype.updateDrag=function(){if(this.isDragging){var e=this.app.graphicsDevice,t=this.handle.element.anchor.x*e.width/window.devicePixelRatio,i=this.handle.element.anchor.y*e.height/window.devicePixelRatio,s=1/(this.screen.scale/window.devicePixelRatio),o="x"==this.axis||"xy"==this.axis?(this.mousePos.x-t)*s:this.anchorPos.x,n="y"==this.axis||"xy"==this.axis?(-this.mousePos.y+i)*s:this.anchorPos.y;if(console.log("screenX "+o+" screenY "+n+" scale "+s),isMobile.any())o-=this.screenXBase,n-=this.screenYBase;else{var h=.9076971609815179,r=2.27,a=2.807577,c=7.38,l=(c-r)/(a-h),p=l*(s-h)+r,d=(l=((c=9)-(r=2.45))/((a=2.807577)-(h=.9076971609815179)))*(s-h)+r;o-=this.screenXBase/p,n-=this.screenYBase/d}var u=Math.sqrt(Math.pow(o,2)+Math.pow(n,2));console.log(o+"  ; "+n+"  ,r "+u),console.log(this.guiButton.getLocalPosition()),_9_BOLAS_ACTIVADO?u<=115&&(this.handle.setLocalPosition(o,n,0),this.screenX=o,this.screenY=n,this.guiButton.setLocalPosition(.2*o*2,.2*n*2,0),(u<=50||u<=180||u<=236)&&(extraScoreMasee=0)):u<=236&&(this.handle.setLocalPosition(o,n,0),this.screenX=o,this.screenY=n,this.guiButton.setLocalPosition(.2*o,.2*n,0))}},UISlider.prototype.doMasse=function(e,t){if(!this.alreadyApply){this.alreadyApply=!0;var i=this.angle,s=1,o=2;if(_9_BOLAS_ACTIVADO&&(this.screenX=4*this.screenX,this.screenY=4*this.screenY),"ball"==t){if(s=1.8,this.screenY>0&&(o=1),i>=45&&i<=135){var n=(2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(2.7*o-(a=0))/(235-(r=0))*(this.screenY-r)+a;setTimeout(function(){e.script.p2Body.body.applyImpulseLocal([n*this.hitForze,h*this.hitForze])}.bind(this),30)}else if(i<=-45&&i>=-135){n=(-2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(-2.7*o-(a=0))/(235-(r=0))*(this.screenY-r)+a;setTimeout(function(){e.script.p2Body.body.applyImpulseLocal([n*this.hitForze,h*this.hitForze])}.bind(this),30)}else if(i<=180&&i>=135||i<=-135&&i>=-180){n=(2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(-2.7*o-(a=0))/(235-(r=0))*(this.screenY-r)+a;setTimeout(function(){e.script.p2Body.body.applyImpulseLocal([h*this.hitForze,n*this.hitForze])}.bind(this),30)}else if(i<=45&&i>=-45){n=(-2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(2.7*o-(a=0))/(235-(r=0))*(this.screenY-r)+a;setTimeout(function(){e.script.p2Body.body.applyImpulseLocal([h*this.hitForze,n*this.hitForze])}.bind(this),30)}}else if(i>=45&&i<=135){n=(2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(-2.7*s-(a=0))/(235-(r=0))*(this.screenY-r)+a;e.script.p2Body.body.applyImpulseLocal([n*this.hitForze,h*this.hitForze])}else if(i<=-45&&i>=-135){n=(-2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(2.7*s-(a=0))/(235-(r=0))*(this.screenY-r)+a;e.script.p2Body.body.applyImpulseLocal([n*this.hitForze,h*this.hitForze])}else if(i<=180&&i>=135||i<=-135&&i>=-180){n=(2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(2.7*s-(a=0))/(235-(r=0))*(this.screenY-r)+a;e.script.p2Body.body.applyImpulseLocal([h*this.hitForze,n*this.hitForze])}else if(i<=45&&i>=-45){var r,a;n=(-2.7*s-(a=0))/(235-(r=0))*(this.screenX-r)+a,h=(-2.7*s-(a=0))/(235-(r=0))*(this.screenY-r)+a;e.script.p2Body.body.applyImpulseLocal([h*this.hitForze,n*this.hitForze])}console.log("FX "+n+"  FY "+h),this.resetMasse()}},UISlider.prototype.configMasse=function(e,t){this.alreadyApply=!1,this.hitForze=t,this.forze=e,this.forze.normalize(),this.angle=Math.atan2(this.forze.y,this.forze.x),this.angle=180*this.angle/Math.PI,extraScoreMasee=0,console.log(this.angle)},UISlider.prototype.resetMasse=function(){this.handle.setLocalPosition(0,0,0),this.screenX=0,this.screenY=0,this.guiButton.setLocalPosition(0,0,0)};var DragHelper=pc.createScript("dragHelper");DragHelper.prototype.initialize=function(){this.dragHelper=new pc.ElementDragHelper(this.entity.element,"y")},DragHelper.prototype.update=function(e){};var ColorMaterial=pc.createScript("colorMaterial");ColorMaterial.attributes.add("material",{type:"asset",assetType:"material",array:!1}),ColorMaterial.attributes.add("colours",{type:"string",array:!0}),ColorMaterial.prototype.initialize=function(){},ColorMaterial.prototype.colorChange=function(r){var a=this.material.resource;a.diffuse=(new pc.Color).fromString(this.colours[r]),a.update()};var TutorialController=pc.createScript("tutorialController");TutorialController.prototype.initialize=function(){tutorial=this,tutorial.tutorialStatus="",tutorial.timerFase2Enabled=!1,tutorial.FingerTutorial=this.app.root.findByName("FingerTutorial"),tutorial.MouseTutorial=this.app.root.findByName("MouseTutorial")},TutorialController.prototype.playTutorial=function(e){tutorial.turnState="Waiting",tutorial.tutorialStatus="",tutorial.timerFase2Enabled=!1,canvas.enableHeaderGame(!1),canvas.tutorialPanelGUI.enabled=!0,window.clearInterval(system.timerGUI),addEventFunction(canvas.tutorialOK,!0,1,(function(){playSound("mainMenuClick"),addEventFunction(canvas.tutorialOK,!1),canvas.tutorialPanelGUI.enabled=!1,canvas.messagesTutorialUp.enabled=!0,_IS_PHONE?canvas.messagesTutorialUp.children[0].enabled=!0:canvas.messagesTutorialUp.children[1].enabled=!0;for(var e=0;e<system.ballsFollower.length;e++)system.ballsFollower[e].enabled=!1;for(e=0;e<system.ballsAll.length;e++)system.ballsAll[e].enabled=!1,system.ballsAll[e].script.p2Body.enabled=!1;for(e=0;e<system.ballsClonedShadow.length;e++)system.ballsClonedShadow[e].enabled=!1;system.ballsFollower[0].enabled=!0,system.ballsFollower[1].enabled=!0,system.ballsAll[0].enabled=!0,system.ballsAll[1].enabled=!0,system.ballsClonedShadow[0].enabled=!0,system.ballsClonedShadow[1].enabled=!0,system.ballsAll[0].setPosition(new pc.Vec3(0,system.ballsAll[0].getPosition().y,0)),system.ballsAll[0].script.p2Body.body.position=[0,0],system.ballsAll[1].setPosition(new pc.Vec3(5.314,system.ballsAll[0].getPosition().y,-2.519)),system.ballsAll[1].script.p2Body.body.position=[5.314,2.519],system.ballsAll[0].script.p2Body.enabled=!0,system.ballsAll[1].script.p2Body.enabled=!0,_TUTORIAL_PLAYING=!0,system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,system.poolCueGO.enabled=!0,system.poolCueGO.setLocalPosition(new pc.Vec3(0,0,0)),system.ballsFollower[0].collision.enabled=!0,system.followerGO.setPosition(new pc.Vec3(0,system.followerGO.getPosition().y,0)),system.followerGO.lookAt(new pc.Vec3(5.314,system.followerGO.getPosition().y,0)),system.targetGO.setPosition(system.followerGO.forward.scale(10)),system.parseExtendedTargetGO(),system.DrawPoolCueLine(),_IS_PHONE?tutorial.FingerTutorial.enabled=!0:tutorial.MouseTutorial.enabled=!0;var moveUp=function(){var e=system.followerGO.getLocalEulerAngles().clone();system.TargetMouse.setPosition(new pc.Vec3(5.314,system.TargetMouse.getPosition().y,-2.519));var t=system.TargetMouse.getPosition();system.followerGO.lookAt(new pc.Vec3(t.x,system.followerGO.getPosition().y,t.z));var l=system.followerGO.getLocalEulerAngles().clone();system.followerGO.setLocalEulerAngles(e);var s=system.followerGO.getLocalEulerAngles();system.followerGO.animRot=system.followerGO.tween(s).rotate(l,3.5,pc.SineOut).onUpdate(function(){system.targetGO.setPosition(system.followerGO.forward.scale(10)),system.parseExtendedTargetGO(),_physicWorldSystem.simular(system,system.ball,system.ballColisionada,60,60),system.DrawPoolCueLine(),system.ballColisionada=null;var e=system.followerGO.forward.scale(4);_IS_PHONE?tutorial.FingerTutorial.setPosition(new pc.Vec3(e.x,tutorial.FingerTutorial.getPosition().y,e.z)):tutorial.MouseTutorial.setPosition(new pc.Vec3(e.x,tutorial.MouseTutorial.getPosition().y,e.z))}.bind(system)).onComplete((function(){window.setTimeout((function(){tutorial.tutorialStatus="Phase1",moveDown()}),1.5)})).start()},moveDown=function(){var e=system.followerGO.getLocalEulerAngles().clone();system.TargetMouse.setPosition(new pc.Vec3(5.314,system.TargetMouse.getPosition().y,0));var t=system.TargetMouse.getPosition();system.followerGO.lookAt(new pc.Vec3(t.x,system.followerGO.getPosition().y,t.z));var l=system.followerGO.getLocalEulerAngles().clone();system.followerGO.setLocalEulerAngles(e);var s=system.followerGO.getLocalEulerAngles();system.followerGO.animRot=system.followerGO.tween(s).rotate(l,3.5,pc.SineOut).onUpdate(function(){system.targetGO.setPosition(system.followerGO.forward.scale(10)),system.parseExtendedTargetGO(),_physicWorldSystem.simular(system,system.ball,system.ballColisionada,60,60),system.DrawPoolCueLine(),system.ballColisionada=null;var e=system.followerGO.forward.scale(4);_IS_PHONE?tutorial.FingerTutorial.setPosition(new pc.Vec3(e.x,tutorial.FingerTutorial.getPosition().y,e.z)):tutorial.MouseTutorial.setPosition(new pc.Vec3(e.x,tutorial.MouseTutorial.getPosition().y,e.z))}.bind(system)).onComplete((function(){window.setTimeout((function(){moveUp()}),1.5)})).start()};moveUp()}))},TutorialController.prototype.ResetInPlaceTutorial=function(){_BLOCKED=!0,tutorial.tutorialStatus="Phase3",system.turnState="ForceLap",system.ballsAll[0].setPosition(new pc.Vec3(0,system.ballsAll[0].getPosition().y,0)),system.ballsAll[0].script.p2Body.body.position=[0,0],system.ballsAll[1].setPosition(new pc.Vec3(5.314,system.ballsAll[0].getPosition().y,-2.519)),system.ballsAll[1].script.p2Body.body.position=[5.314,2.519],system.poolCueGO.enabled=!0,window.setTimeout((function(){system.poolCueGO.enabled=!0}),30),system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,system.followerGO.setPosition(new pc.Vec3(0,system.followerGO.getPosition().y,0)),system.TargetMouse.setPosition(new pc.Vec3(5.314,system.TargetMouse.getPosition().y,-2.519));var e=system.TargetMouse.getPosition();system.followerGO.lookAt(new pc.Vec3(e.x,system.followerGO.getPosition().y,e.z)),system.targetGO.setPosition(system.followerGO.forward.scale(10)),system.parseExtendedTargetGO(),system.ballColisionada=null,_physicWorldSystem.simular(system,system.ball,system.ballColisionada,60,60),system.DrawPoolCueLine(),system.ballWhiteLineInitial.enabled=!0,system.Ex.enabled=!0,system.ballWhiteLine.enabled=!0,system.circleGO.enabled=!0,system.ballWhiteColor.enabled=!0,canvas.messagesTutorialUp.children[2].enabled=!1,_IS_PHONE?(canvas.messagesTutorialUp.children[3].enabled=!0,_BLOCKED=!1,system.turnState="ForceLapGUI",canvas.panelTutoPowerBar.enabled=!0):canvas.panelTutoMouse.enabled=!0},TutorialController.prototype.MoveTutorial=function(){"Phase1"==tutorial.tutorialStatus&&(_IS_PHONE?(canvas.messagesTutorialUp.children[0].enabled=!1,canvas.messagesTutorialUp.children[2].enabled=!0):(canvas.messagesTutorialUp.children[1].enabled=!1,canvas.messagesTutorialUp.children[2].enabled=!0),system.followerGO.animRot.stop(),system.turnState="Waiting",_BLOCKED=!1,_IS_PHONE?tutorial.FingerTutorial.enabled=!1:tutorial.MouseTutorial.enabled=!1,tutorial.tutorialStatus="Phase2")},TutorialController.prototype.FinishPhase3=function(){_BLOCKED=!0,tutorial.tutorialStatus="Fase4",_TUTORIAL_PLAYING=!1,canvas.messagesTutorialUp.children[3].enabled=!1,canvas.messagesTutorialUp.enabled=!1,canvas.panelEndTutorial.enabled=!0,system.turnState="FinalizandoTutorial",ballWhiteFirstBallContact=null,addEventFunction(canvas.okbuttonEnd,!0,1,(function(){playSound("backClick"),addEventFunction(canvas.okbuttonEnd,!1),canvas.panelEndTutorial.enabled=!1,canvas.panelRules.enabled=!0,addEventFunction(canvas.okbuttonEndRules,!0,1,(function(){playSound("backClick"),addEventFunction(canvas.okbuttonEndRules,!1),canvas.panelRules.enabled=!1,canvas.messagesTutorialUp.enabled=!1,_TUTORIAL_PLAYING=!1,_sound.slot("menuMusic").stop(),system.b_PlayTutorial=!1,saveVariables("0","b_PlayTutorial");for(var e=0;e<system.ballsClonedShadow.length;e++)system.ballsClonedShadow[e].enabled=!0;canvas.enableHeaderGame(!0),system.playAgainFunction()}))}))},TutorialController.prototype.MouseUp=function(){"Phase3"==tutorial.tutorialStatus&&(_IS_PHONE||(_BLOCKED=!0))},TutorialController.prototype.HitMouseUp=function(){canvas.messagesTutorialUp.enabled=!1,canvas.panelTutoMouse.enabled=!1,canvas.panelTutoPowerBar.enabled=!1},TutorialController.prototype.tapUP=function(){"Phase3"!=tutorial.tutorialStatus&&(tutorial.tutorialStatus="Phase1",_BLOCKED=!1,system.turnState="Waiting"),"Phase3"==tutorial.tutorialStatus&&0==system.cueLoad?canvas.panelTutoPowerBar.enabled=!0:canvas.panelTutoPowerBar.enabled=!1},TutorialController.prototype.ClickTutorial=function(){"Phase3"==tutorial.tutorialStatus&&(_IS_PHONE||(_BLOCKED=!1))},TutorialController.prototype.Phase3=function(){tutorial.tutorialStatus="Phase3",_BLOCKED=!0,canvas.messagesTutorialUp.children[2].enabled=!1,_IS_PHONE?(canvas.messagesTutorialUp.children[3].enabled=!0,_BLOCKED=!1,system.turnState="ForceLapGUI",canvas.EnableCue(),canvas.panelTutoPowerBar.enabled=!0):canvas.panelTutoMouse.enabled=!0},TutorialController.prototype.update=function(e){"Phase2"==tutorial.tutorialStatus&&(null==system.ballColisionada||"2"!=system.ballColisionada.name||tutorial.timerFase2Enabled||(tutorial.timerFase2Enabled=!0,tutorial.timerFase2=window.setTimeout((function(){tutorial.Phase3()}),1e3)),null==system.ballColisionada&&tutorial.timerFase2Enabled&&(tutorial.timerFase2Enabled=!1,window.clearTimeout(tutorial.timerFase2)))};var AnimaTexturas=pc.createScript("animaTexturas");AnimaTexturas.attributes.add("texturas",{type:"asset",assetType:"texture",array:!0,title:"texturas"}),AnimaTexturas.attributes.add("loop",{type:"number",default:0,title:"loop"}),AnimaTexturas.attributes.add("autoAnim",{type:"number",default:0,title:"autoAnim"}),AnimaTexturas.attributes.add("texture3D",{type:"number",default:0,title:"texture3D"}),AnimaTexturas.attributes.add("frames",{type:"number",default:60,title:"frames"}),AnimaTexturas.prototype.initialize=function(){this.entity;var a=[this.entity,this.texturas,0,this.texturas.length,!1,0,0,0,!1];this.cont=0,this.arrayAnimaciones=[],this.arrayAnimaciones[0]=a,this.callBack=null,1==this.autoAnim&&(1==this.loop&&(this.arrayAnimaciones[0][8]=!0),this.arrayAnimaciones[0][4]=!0)},AnimaTexturas.prototype.inicioAnim=function(a,i,t){this.callBack=a,this.cont=0;var r=[this.entity,this.texturas,0,this.texturas.length,!1,0,0,0,!1];if(this.cont=0,null!=i&&null!=t)this.arrayAnimaciones[0][2]=i,this.arrayAnimaciones[0][3]=t;else{r=[this.entity,this.texturas,0,this.texturas.length,!1,0,0,0,!1];this.arrayAnimaciones=[],this.arrayAnimaciones[0]=r}this.cont=0,0==this.texture3D?this.entity.element.texture=this.texturas[this.arrayAnimaciones[0][2]].resource:this.cambiaTextura3D(this.texturas[this.arrayAnimaciones[0][2]].resource),this.arrayAnimaciones[0][4]=!0},AnimaTexturas.prototype.stopAnim=function(){this.arrayAnimaciones[0][4]=!1},AnimaTexturas.prototype.update=function(a){var i=a,t=1/i;this.cont=this.cont+i;var r=t/this.frames;if(r/=t,this.cont>=r){this.cont=0;for(var s=0;s<this.arrayAnimaciones.length;s++)if(1==this.arrayAnimaciones[s][4]){var e;if(0==this.arrayAnimaciones[s][7])0==(e=this.arrayAnimaciones[s][5])&&(e=this.arrayAnimaciones[s][2]),0==this.texture3D?this.arrayAnimaciones[s][0].element.texture=this.arrayAnimaciones[s][1][e].resource:this.cambiaTextura3D(this.arrayAnimaciones[s][1][e].resource),this.arrayAnimaciones[s][5]=this.arrayAnimaciones[s][5]+1,(e=this.arrayAnimaciones[s][5])==this.arrayAnimaciones[s][3]&&(0==this.arrayAnimaciones[s][6]?this.arrayAnimaciones[s][8]?this.arrayAnimaciones[s][5]=1:(this.arrayAnimaciones[s][4]=!1,this.arrayAnimaciones[s][5]=0,null!=this.callBack&&this.callBack()):2==this.arrayAnimaciones[s][6]&&(this.arrayAnimaciones[s][7]=1));if(1==this.arrayAnimaciones[s][7])(e=this.arrayAnimaciones[s][5])==this.arrayAnimaciones[s][3]&&(e=this.arrayAnimaciones[s][3]-2,this.arrayAnimaciones[s][5]=e),0==this.texture3D?this.arrayAnimaciones[s][0].element.texture=this.arrayAnimaciones[s][1][e].resource:this.cambiaTextura3D(this.arrayAnimaciones[s][1][e].resource),this.arrayAnimaciones[s][5]=this.arrayAnimaciones[s][5]-1,(e=this.arrayAnimaciones[s][5])==this.arrayAnimaciones[s][2]-1&&(this.arrayAnimaciones[s][4]=!1,this.arrayAnimaciones[s][5]=0,2==this.arrayAnimaciones[s][6]&&(this.arrayAnimaciones[s][7]=0))}}},AnimaTexturas.prototype.cambiaTextura3D=function(a){for(var i=this.entity.model.meshInstances,t=0;t<i.length;++t){var r=i[t];r.material.diffuseMap=a,r.material.opacityMap=a,r.material.update()}};var ElementAlphaAnim=pc.createScript("elementAlphaAnim");ElementAlphaAnim.attributes.add("speed",{type:"number",default:1}),ElementAlphaAnim.attributes.add("delayFadeIN",{type:"number",default:1}),ElementAlphaAnim.attributes.add("delayFadeOUT",{type:"number",default:1}),ElementAlphaAnim.prototype.initialize=function(){this.objeto=[],this.tipo=[]},ElementAlphaAnim.prototype.fadeOut=function(t){var e=this.entity.children[t];setTimeout(function(){if(this.objeto.includes(e)){var t=this.objeto.indexOf(e);this.tipo[t]=-1}else this.objeto.push(e),this.tipo.push(-1)}.bind(this),1e3*this.delayFadeOUT)},ElementAlphaAnim.prototype.fadeIn=function(t){var e=this.entity.children[t];setTimeout(function(){if(this.objeto.includes(e)){var t=this.objeto.indexOf(e);this.tipo[t]=1}else this.objeto.push(e),this.tipo.push(1)}.bind(this),1e3*this.delayFadeIN)},ElementAlphaAnim.prototype.reset=function(t,e){var i=this.entity.children[t];if(i.enabled=!0,this.objeto.includes(i)){var n=this.objeto.indexOf(i);this.tipo[n]=0}else this.objeto.push(i),this.tipo.push(0);i.element.opacity=e},ElementAlphaAnim.prototype.update=function(t){for(var e=0;e<this.objeto.length;e++){var i=this.objeto[e],n=this.tipo[e],o=this.objeto[e].element.opacity;1==n&&o<1?((o+=t*this.speed)>1&&(o=1),i.element.opacity=o):-1==n&&o>0&&((o-=t*this.speed)<0&&(o=0),i.element.opacity=o)}};var ArrowMovement=pc.createScript("arrowMovement");ArrowMovement.attributes.add("speed",{type:"number",default:5}),ArrowMovement.attributes.add("distanceX",{type:"number",default:22}),ArrowMovement.prototype.initialize=function(){this.sentido=-1,this.deltaX=0,this.initialPos=this.entity.getLocalPosition().clone()},ArrowMovement.prototype.update=function(t){this.deltaX=this.speed*t;var i=this.entity.getLocalPosition();this.entity.setLocalPosition(i.x+this.sentido*this.deltaX,i.y,i.z),(i=this.entity.getLocalPosition()).x<=this.initialPos.x-this.distanceX?(this.sentido=1,this.deltaX=0):i.x>=this.initialPos.x+this.distanceX&&(this.sentido=-1,this.deltaX=0)};var AnimaMsg=pc.createScript("animaMsg");AnimaMsg.attributes.add("destinox",{type:"number",default:0,title:"destinox"}),AnimaMsg.attributes.add("destinoy",{type:"number",default:0,title:"destinoy"}),AnimaMsg.attributes.add("destinoz",{type:"number",default:0,title:"destinoz"}),AnimaMsg.attributes.add("tiempo",{type:"number",default:.6,title:"tiempo"}),AnimaMsg.attributes.add("esElement",{type:"number",default:0,title:"esElement"}),AnimaMsg.attributes.add("delaySaca",{type:"number",default:1.8,title:"delaySaca"}),AnimaMsg.attributes.add("parteOculto",{type:"number",default:1,title:"parteOculto"}),AnimaMsg.attributes.add("boton",{type:"asset",assetType:"texture",array:!0,title:"boton"}),AnimaMsg.attributes.add("tipoTween",{type:"string",default:"BounceOut",title:"tipoTween"}),AnimaMsg.attributes.add("poneYsaca",{type:"string",default:"0"}),AnimaMsg.attributes.add("traducir",{type:"number",default:0}),AnimaMsg.prototype.elijeTween=function(t){switch(t){case"BounceOut":t=pc.BounceOut;break;case"SineIn":t=pc.SineIn;break;case"SineOut":t=pc.SineOut;break;case"SineInOut":t=pc.SineInOut}return t},AnimaMsg.prototype.initialize=function(){if(null==this.origen){this.mc=this.entity,this.tween=null;var t=this.entity.getLocalPosition();this.origen=new pc.Vec3(t.x,t.y,t.z),this.tipoTween=this.elijeTween(this.tipoTween),1==this.parteOculto&&(this.entity.enabled=!1),1==this.traducir&&this.clickBoton(null,!0,_LANGUAGE)}},AnimaMsg.prototype.clickBoton=function(t,e,i){null!=e?this.entity.element.texture=this.boton[i].resource:(this.entity.element.texture=this.boton[1].resource,setTimeout(this.restauraBoton.bind(this,t),180))},AnimaMsg.prototype.restauraBoton=function(t){this.entity.element.texture=this.boton[0].resource,t()},AnimaMsg.prototype.pone=function(t,e){_GUI_OPEN,null==this.origen&&this.initialize();var i=this.tiempo;null!=e&&(i=e),null!=this.tween&&this.tween.stop(),this.entity.setLocalPosition(this.origen.x,this.origen.y,this.origen.z);var n=this.entity.getLocalPosition(),s=new pc.Vec3(this.destinox,this.destinoy,this.destinoz),o=new pc.Vec3(n.x+s.x,n.y+s.y,n.z+s.z);this.entity.setLocalPosition(o.x,o.y,o.z),this.entity.enabled=!0,n=this.entity.getLocalPosition(),this.tween=this.mc.tween(n).to(this.origen,i,this.tipoTween),1==this.poneYsaca&&(t=this.saca.bind(this,!0,null,null,this.delaySaca)),this.tween.onComplete((()=>{this.terminaPone(t)})),this.tween.start()},AnimaMsg.prototype.poneScale=function(t,e,i){var n=this.tiempo;null!=e&&(n=e);var s=this.tipoTween;null!=i&&(s=i),s=this.elijeTween(s),this.entity.setLocalScale(0,0,0);var o=new pc.Vec3(1,1,1),a=this.entity.getLocalScale();this.entity.enabled=!0,this.tween=this.mc.tween(a).to(o,n,s),this.tween.onComplete((()=>{this.terminaPone(t)})),this.tween.start()},AnimaMsg.prototype.sacaScale=function(t,e,i,n){var s=this.tiempo;null!=i&&(s=i);var o=this.tipoTween;null!=n&&(o=n),o=this.elijeTween(o),this.entity.setLocalScale(1,1,1);var a=new pc.Vec3(0,0,0),h=this.entity.getLocalScale();this.entity.enabled=!0,this.tween=this.mc.tween(h).to(a,s,o),this.tween.onComplete((()=>{this.terminaSaca(t,e)})),this.tween.start()},AnimaMsg.prototype.saca=function(t,e,i,n){var s=this.tiempo;null!=i&&(s=i),null==n&&(n=0),this.entity.setLocalPosition(this.origen.x,this.origen.y,this.origen.z);var o=this.entity.getLocalPosition(),a=new pc.Vec3(this.destinox,this.destinoy,this.destinoz);a=new pc.Vec3(o.x+a.x,o.y+a.y,o.z+a.z),this.entity.enabled=!0,this.tween=this.mc.tween(o).to(a,s,this.tipoTween),this.tween.onComplete((()=>{this.terminaSaca(t,e)})).delay(n),this.tween.start()},AnimaMsg.prototype.sacaInverso=function(t,e,i){var n=this.tiempo;null!=i&&(n=i),this.entity.setLocalPosition(this.origen.x,this.origen.y,this.origen.z);var s=this.entity.getLocalPosition(),o=new pc.Vec3(this.destinox,this.destinoy,this.destinoz);o=new pc.Vec3(s.x-o.x,s.y-o.y,s.z-o.z),this.entity.enabled=!0,this.tween=this.mc.tween(s).to(o,n,this.tipoTween),this.tween.onComplete((()=>{this.terminaSaca(t,e)})),this.tween.start()},AnimaMsg.prototype.terminaPone=function(t){null!=t&&t()},AnimaMsg.prototype.terminaSaca=function(t,e){t&&(this.entity.enabled=!1);for(var i=0;i<this.entity.children.length-1;i++)this.entity.children[i].enabled=!1;null!=e&&e()},AnimaMsg.prototype.poneSaca=function(t){},AnimaMsg.prototype.animaMano=function(t){var e=this.tiempo,i=this.entity.getLocalPosition();if(0==t)var n=new pc.Vec3(i.x+this.destinox,i.y,i.z);else if(1==t){n=new pc.Vec3(i.x-2*this.destinox,i.y,i.z);e*=2}else if(2==t){n=new pc.Vec3(i.x+2*this.destinox,i.y,i.z);e*=2}3==(t+=1)&&(t=1),this.entity.enabled=!0,this.tween=this.mc.tween(i).to(n,e,this.tipoTween),this.tween.onComplete((()=>{this.animaMano(t)})),this.tween.start()},AnimaMsg.prototype.detieneMano=function(t){this.tween.stop()};var Messages=pc.createScript("messages");Messages.prototype.initialize=function(){messages=this,messages.setMessagesDown(),messages.setMessagesCenter(),messages.setMessages9Balls()},Messages.prototype.SendMessage=function(e,s){},Messages.prototype.ReceiveMessage=function(e){switch(e){case"opponentBreak":messages.MSG_opponentBreak_start();break;case"opponentTurnByBlackFoul":messages.MSG_youTurn_byOponentHitBlackFoul();break;case"opponentTurnByHitRivalBall":messages.MSG_youTurn_byOponentHitYouBall_FOUL();break;case"yourturn":messages.MSG_youTurn();break;case"opponentFoul":messages.MSGCENTER_OpponentFoul();break;case"oponenteFranjas":messages.MSGCENTER_youAreStripes(!0);break;case"oponenteLineas":messages.MSGCENTER_youAreSolid(!0);break;case"opponentDropWhiteBall":messages.MSG_OpponentDropWhiteBall();break;case"oponnentNoBallHit_FOUL":messages.MSG_OponnentNoBallHit_FOUL();break;case"oponnentTimeUp_FOUL":messages.MSG_OponnentTimeUp_FOUL();break;case"oponnentNoRail_FOUL":messages.MSG_OponnentNoRail_FOUL()}},Messages.prototype.hideMessages=function(){for(var e=0;e<19;e++)canvas.messagesLow.children[e].enabled=!1},Messages.prototype.setMessagesDown=function(){messages.MSG_clockTicking=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.children[1].element.text=messages.message8[_LANGUAGE],canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_youBreak_start=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null),_9_BOLAS_ACTIVADO||messages.SendMessage(_OPONENT_PLAYER_NUMBER,"opponentBreak")},messages.MSG_opponentBreak_start=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[2].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_hitBlackAtLast_FOUL=function(){messages.hideMessages(),window.setTimeout((function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[3].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)}),_DELAY_MSG_DOWN),messages.SendMessage(_OPONENT_PLAYER_NUMBER,"opponentTurnByBlackFoul")},messages.MSG_youTurn_byOponentHitBlackFoul=function(){messages.hideMessages(),window.setTimeout((function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[6].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)}),_DELAY_MSG_DOWN)},messages.MSG_hitRivalBall_FOUL=function(){messages.hideMessages(),window.setTimeout((function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[4].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)}),_DELAY_MSG_DOWN),messages.SendMessage(_OPONENT_PLAYER_NUMBER,"opponentTurnByHitRivalBall")},messages.MSG_youTurn_byOponentHitYouBall_FOUL=function(){messages.hideMessages(),window.setTimeout((function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[7].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)}),_DELAY_MSG_DOWN)},messages.MSG_youTurn=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[5].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_6moreBallsToWin=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[8].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_DropWhiteBall=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[10].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null),messages.SendMessage(_OPONENT_PLAYER_NUMBER,"opponentDropWhiteBall")},messages.MSG_OpponentDropWhiteBall=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[11].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_PassTurn=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[9].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null),_9_BOLAS_ACTIVADO||messages.SendMessage(_OPONENT_PLAYER_NUMBER,"yourturn")},messages.MSG_noBallHit_FOUL=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[15].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null),messages.SendMessage(_OPONENT_PLAYER_NUMBER,"oponnentNoBallHit_FOUL")},messages.MSG_OponnentNoBallHit_FOUL=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[16].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_timeUp_FOUL=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[17].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null),messages.SendMessage(_OPONENT_PLAYER_NUMBER,"oponnentTimeUp_FOUL")},messages.MSG_OponnentTimeUp_FOUL=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[18].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_noRail_FOUL=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[12].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null),messages.SendMessage(_OPONENT_PLAYER_NUMBER,"oponnentNoRail_FOUL")},messages.MSG_OponnentNoRail_FOUL=function(){messages.hideMessages(),canvas.messagesLow.enabled=!0,canvas.messagesLow.children[13].enabled=!0,canvas.messagesLow.script.animaMsg.pone(null)}},Messages.prototype.setMessagesCenter=function(){messages.MSGCENTER_Foul=function(){_9_BOLAS_ACTIVADO||messages.SendMessage(_OPONENT_PLAYER_NUMBER,"opponentFoul")},messages.MSGCENTER_OpponentFoul=function(){},messages.MSGCENTER_youAreSolid=function(e=!1){canvas.messagesCenter.script.elementAlphaAnim.reset(2,1),canvas.messagesCenter.script.elementAlphaAnim.fadeOut(2),e||messages.SendMessage(_OPONENT_PLAYER_NUMBER,"oponenteFranjas")},messages.MSGCENTER_youAreStripes=function(e=!1){canvas.messagesCenter.script.elementAlphaAnim.reset(3,1),canvas.messagesCenter.script.elementAlphaAnim.fadeOut(3),e||messages.SendMessage(_OPONENT_PLAYER_NUMBER,"oponenteLineas")}},Messages.prototype.setMessages9Balls=function(){messages.message0=["","",""],messages.message1=["Foul: No ball hit","Fout: Geen bal geraakt","Foul: Kein Ball getroffen"],messages.message2=["Foul","Fout","Foul"],messages.message3=["Foul: wrong ball touched first","Fout: Verkeerde bal gepot","Foul: Falscher Ball als erster berhrt"],messages.message4=["Foul","Fout","Foul"],messages.message5=["Foul: Can't pocket ball9 on the first shot","Mag bal 9 niet met het eerste schot potten","Kann Ball 9 beim ersten Schuss nicht versenken"],messages.message6=["Foul: Cue ball pocketed","Fout: witte bal gepot","Foul: Spielball versenkt"],messages.message7=["Foul","Fout","Foul"],messages.message8=["The clock is ticking..","De tijd tikt","Die Uhr tickt"],messages.MSG9ball_youBreak_start=function(){canvas._9BallReadyGo.enabled=!0,canvas._9BallReadyGo.script.animaTexturas.inicioAnim()},messages.MSG9BALL_FaulNoPegarANiuna=function(){},messages.MSG9BALL_FaulNoPegarA4Bandas=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.children[1].element.text=messages.message2[_LANGUAGE],canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG9BALL_FaulNoPegarNumeracionCorrecta=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.children[1].element.text=messages.message3[_LANGUAGE],canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG9BALL_FaulNoPegarA4BandasEnInicio=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.children[1].element.text=messages.message4[_LANGUAGE],canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG9BALL_CapturoBall9EnPrimeraRonda=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.children[1].element.text=messages.message5[_LANGUAGE],canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_DropWhiteBall9Balls=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.children[1].element.text=messages.message6[_LANGUAGE],canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG_TuTurno9Balls=function(){},messages.MSG9BALL_FaulNoPegarA1BandasNiEntronar=function(){canvas.messagesLow.enabled=!0,canvas.messagesLow.children[1].enabled=!0,canvas.messagesLow.children[1].element.text=messages.message7[_LANGUAGE],canvas.messagesLow.script.animaMsg.pone(null)},messages.MSG9BALL_Win9Bolas=function(e){sys9ball.mensajeWin9Bolas.script.elementAlphaAnim.reset(e,1),sys9ball.mensajeWin9Bolas.script.elementAlphaAnim.fadeOut(e)}},Messages.prototype.update=function(e){};var GamePlay=pc.createScript("gamePlay");GamePlay.prototype.update=function(){system.eventsQueue.length>0&&!system.b_eventQueueRunning&&!_GUI_OPEN&&(system.b_eventQueueRunning=!0,system.RunEventQueue());var e=this.app.graphicsDevice.width,s=this.app.graphicsDevice.height;s>e&&(!system.isPortrait||null==system.isPortrait)?(_2dScreen.script.detectAspectRatio.Detect(),system.isPortrait=!0,system.camera.setEulerAngles(-90,-90,0),system.camera.camera.orthoHeight=2.2*_2dScreen.script.detectAspectRatio.ortho,sys9ball.numerosUpLeft.setEulerAngles(0,-90,0),sys9ball.numerosUp.setEulerAngles(0,-90,0),sys9ball.numerosUpRight.setEulerAngles(0,-90,0),sys9ball.numerosDownLeft.setEulerAngles(0,-90,0),sys9ball.numerosDown.setEulerAngles(0,-90,0),sys9ball.numerosDownRight.setEulerAngles(0,-90,0),sys9ball.numerosX2.setEulerAngles(0,-90,0),sys9ball.numerosX3.setEulerAngles(0,-90,0),sys9ball.numerosBola.setEulerAngles(0,-90,0),system.circleGO.setEulerAngles(0,-90,0),canvas._9BallsIndicator=canvas._9BallsIndicatorP,canvas._9BallsIndicatorRight=canvas._9BallsIndicatorRightP,canvas.score9Balls=canvas._9BallsIndicatorRight.children[11],canvas.timeGUIA.setLocalPosition(48,-79,-.001),system.cameraBlur.enabled?canvas.Store_upBar.enabled&&canvas.EnableHeaderStore(!0):(canvas._9BallsIndicatorL.enabled=!1,canvas._9BallsIndicatorRightL.enabled=!1,canvas._9BallsIndicator.enabled=!0,canvas._9BallsIndicatorRight.enabled=!0,canvas.Drawscore(),canvas._9Balls_tutorialButtonP.enabled=!0,canvas._9Balls_tutorialButton.enabled=!1,canvas._9Balls_soundButtonP.enabled=!0,canvas._9Balls_soundButtonP.children[0].enabled=canvas._9Balls_soundButton.children[0].enabled,canvas._9Balls_soundButtonP.children[1].enabled=canvas._9Balls_soundButton.children[1].enabled,canvas._9Balls_soundButton.enabled=!1,PaintScore())):e>s&&(system.isPortrait||null==system.isPortrait)&&(_2dScreen.script.detectAspectRatio.Detect(),system.isPortrait=!1,system.camera.setEulerAngles(-90,0,0),system.camera.camera.orthoHeight=_2dScreen.script.detectAspectRatio.ortho,sys9ball.numerosUpLeft.setEulerAngles(0,0,0),sys9ball.numerosUp.setEulerAngles(0,0,0),sys9ball.numerosUpRight.setEulerAngles(0,0,0),sys9ball.numerosDownLeft.setEulerAngles(0,0,0),sys9ball.numerosDown.setEulerAngles(0,0,0),sys9ball.numerosDownRight.setEulerAngles(0,0,0),sys9ball.numerosX2.setEulerAngles(0,0,0),sys9ball.numerosX3.setEulerAngles(0,0,0),sys9ball.numerosBola.setEulerAngles(0,0,0),system.circleGO.setEulerAngles(0,0,0),canvas._9BallsIndicator=canvas._9BallsIndicatorL,canvas._9BallsIndicatorRight=canvas._9BallsIndicatorRightL,canvas.score9Balls=canvas._9BallsIndicatorRight.children[11],canvas.timeGUIA.setLocalPosition(30,-3,-.001),system.cameraBlur.enabled?canvas.Store_upBar.enabled&&canvas.EnableHeaderStore(!0):(canvas._9BallsIndicatorP.enabled=!1,canvas._9BallsIndicatorRightP.enabled=!1,canvas._9BallsIndicator.enabled=!0,canvas._9BallsIndicatorRight.enabled=!0,canvas.Drawscore(),canvas._9Balls_tutorialButtonP.enabled=!1,canvas._9Balls_tutorialButton.enabled=!0,canvas._9Balls_soundButton.enabled=!0,canvas._9Balls_soundButton.children[0].enabled=canvas._9Balls_soundButtonP.children[0].enabled,canvas._9Balls_soundButton.children[1].enabled=canvas._9Balls_soundButtonP.children[1].enabled,canvas._9Balls_soundButtonP.enabled=!1,PaintScore()))},GamePlay.prototype.initialize=function(){system.queueTimeOut=null,system.eventsQueue=[],system.b_eventQueueRunning=!1,system.AddEventQueue=function(e){system.eventsQueue.push(e)},system.RunEventQueue=function(){system.eventsQueue[0](),system.eventsQueue.splice(0,1),system.eventsQueue.length>0?system.queueTimeOut=window.setTimeout((function(){_GUI_OPEN||system.RunEventQueue()}),_9_BOLAS_ACTIVADO?5:100):system.b_eventQueueRunning=!1},system.Ball8Phase=function(){return!!system.b_ENABLE_TEST_BALL8||((7==system.capturedBallsPlayer1.length&&!system.isBall8Captured(system.capturedBallsPlayer1)||8==system.capturedBallsPlayer1.length)&&0==system.playerTurn||((7==system.capturedBallsPlayer2.length&&!system.isBall8Captured(system.capturedBallsPlayer2)||8==system.capturedBallsPlayer2.length)&&1==system.playerTurn||(canvas.choosePocketHoleGUI.enabled=!1,!1)))},system.SetBall8Phase=function(){if(_IS_LOCAL_PLAYER_PLAYING()){system.colliderBall8Entity.enabled=!0,canvas.choosePocketHoleGUI.enabled=!0;for(var e=0;e<system.colliderBall8.length;e++)system.colliderBall8[e].enabled=!0;for(e=0;e<this.colliderBall8ON.length;e++)system.colliderBall8ON[e].enabled=!1}else system.selectedHole="BOT",canvas.choosePocketHoleGUI.enabled=!1;system.b_SelectingBall8=!0,system.turnState="EligiendoBola8"},system.isBall8Captured=function(e){for(var s=!1,a=0;a<e.length;a++)"9"==e[a].name&&(s=!0);return s},system.GameOverFunction=function(e){switch(_sound.slot("vsCpuMusic").stop(),_sound.slot("vsMusic").stop(),_sound.slot("music2").stop(),_sound.slot("music3").stop(),setTimeout(function(){playSound("results")}.bind(system),200),playSound("derrota"),shake(300),canvas.gameEndPanel.enabled=!0,canvas.victoryGUI.enabled=!1,canvas.looseGUI.enabled=!0,canvas.gameEndPanel.children[6].enabled=!1,canvas.gameEndPanel.children[7].enabled=!1,canvas.gameEndPanel.children[8].enabled=!1,canvas.gameEndPanel.children[9].enabled=!1,canvas.gameEndPanel.children[10].enabled=!1,e){case"Captura negra":canvas.gameEndPanel.children[6].enabled=!0;break;case"Bot Win":canvas.gameEndPanel.children[10].enabled=!0;break;case"MISS POCKET 8 BALL":canvas.gameEndPanel.children[9].enabled=!0;break;case"Captura negra con blanca":canvas.gameEndPanel.children[7].enabled=!0;break;case"Captura negra con color":canvas.gameEndPanel.children[8].enabled=!0}window.clearInterval(system.timerGUI),0==system.playerTurn||system.playerTurn,system.b_GAME_FINISHED=!0},system.GameWinFunction=function(){_sound.slot("vsCpuMusic").stop(),_sound.slot("vsMusic").stop(),_sound.slot("music2").stop(),_sound.slot("music3").stop(),setTimeout(function(){playSound("results")}.bind(system),200),playSound("victoria"),shake(600),canvas.gameEndPanel.enabled=!0,canvas.victoryGUI.enabled=!0,canvas.looseGUI.enabled=!1,canvas.gameEndPanel.children[6].enabled=!1,canvas.gameEndPanel.children[7].enabled=!1,canvas.gameEndPanel.children[8].enabled=!1,canvas.gameEndPanel.children[9].enabled=!1,canvas.gameEndPanel.children[10].enabled=!1,window.clearInterval(system.timerGUI),0==system.playerTurn||system.playerTurn,system.b_GAME_FINISHED=!0},system.GetBallClon=function(e){for(var s=0;s<system.ballsCloned.length;s++){if(system.ballsCloned[s].name==e.name+"clon")return system.ballsCloned[s]}},system.IsSolidBallHit=function(e){return parseInt(e)>=2&&parseInt(e)<=8},system.IsStripesBallHit=function(e){return parseInt(e)>=10&&parseInt(e)<=16},system.GetBotBallTarget=function(){if(system.Ball8Phase()&&_BOT_PLAYING)return system.balls[7];if(!system.b_FirstTurnComplete){for(var e=[],s=0;s<system.balls.length;s++)if(7!=s){var a=system.ballsFollower[0].getPosition().clone(),l=system.ballsFollower[s+1].getPosition().clone();null!=(o=system.app.systems.rigidbody.raycastFirst(a,l))&&o.entity.name;null!==o&&o.entity.name==system.balls[s].name+"F"&&system.balls[s].enabled&&e.push(o.entity)}var n=Math.floor(Math.random()*e.length);return console.log("INDEX",n,"Pasaron: "+e.length+"/"+system.balls.length),e[n]}var t=system.player2.color;e=[];if("planas"==t){for(s=0;s<7;s++){a=system.ballsFollower[0].getPosition().clone(),l=system.ballsFollower[s+1].getPosition().clone(),null!=(o=system.app.systems.rigidbody.raycastFirst(a,l))&&o.entity.name;null!==o&&o.entity.name==system.balls[s].name+"F"&&system.balls[s].enabled&&e.push(o.entity)}n=Math.floor(Math.random()*e.length);return console.log("INDEX",n,"Pasaron: "+e.length+"/"+system.balls.length),e[n]}if("franjas"==t){for(s=8;s<15;s++){var o;a=system.ballsFollower[0].getPosition().clone(),l=system.ballsFollower[s+1].getPosition().clone(),null!==(o=system.app.systems.rigidbody.raycastFirst(a,l))&&o.entity.name;null!==o&&o.entity.name==system.balls[s].name+"F"&&system.balls[s].enabled&&e.push(o.entity)}n=Math.floor(Math.random()*e.length);return console.log("INDEX",n,"Pasaron: "+e.length+"/"+system.balls.length),e[n]}};var e=null,s=null;system.PreDrawLine=function(){system.TurnOffPoolCueLine();this.app.graphicsDevice.width,this.app.graphicsDevice.height;s=null==s?210:60,isMobile.any()&&parseInt(canvas.timeGUI.element.text)>175?(clearInterval(e),e=setTimeout((()=>{var e=new pc.Vec3;system.camera.camera.worldToScreen(sys9ball.indicador9Ball.getPosition(),e),system.Click(e.x,e.y,"manual")}),s)):isMobile.any()&&setTimeout((()=>{var e=new pc.Vec3;system.camera.camera.worldToScreen(sys9ball.indicador9Ball.getPosition(),e),system.Click(e.x,e.y,"manual")}),30),system.followerGO.setPosition(new pc.Vec3(system.ball.getPosition().x,system.followerGO.getPosition().y,system.ball.getPosition().z)),system.targetGO.setPosition(system.followerGO.forward.scale(10)),system.parseExtendedTargetGO(),isMobile.any(),_physicWorldSystem.simular(system,system.ball,system.ballColisionada,system.iteraciones,system.fps),system.DrawPoolCueLine(),system.ballColisionada=null},system.CheckRail=function(){for(var e=0,s=0;s<railHitsBalls.length;s++)console.log("Toco",railHitsBalls[s].name),("9"!=railHitsBalls[s].name||system.Ball8Phase())&&e++;return railHitsBalls=[],e>0}};pc.extend(pc,function(){var FxaaEffect=function(e){var o={aPosition:pc.SEMANTIC_POSITION},r=["attribute vec2 aPosition;","","void main(void)","{","    gl_Position = vec4(aPosition, 0.0, 1.0);","}"].join("\n"),a=["precision "+e.precision+" float;","","uniform sampler2D uColorBuffer;","uniform vec2 uResolution;","","#define FXAA_REDUCE_MIN   (1.0/128.0)","#define FXAA_REDUCE_MUL   (1.0/8.0)","#define FXAA_SPAN_MAX     8.0","","void main()","{","    vec3 rgbNW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbNE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, -1.0 ) ) * uResolution ).xyz;","    vec3 rgbSW = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( -1.0, 1.0 ) ) * uResolution ).xyz;","    vec3 rgbSE = texture2D( uColorBuffer, ( gl_FragCoord.xy + vec2( 1.0, 1.0 ) ) * uResolution ).xyz;","    vec4 rgbaM  = texture2D( uColorBuffer,  gl_FragCoord.xy  * uResolution );","    vec3 rgbM  = rgbaM.xyz;","    float opacity  = rgbaM.w;","","    vec3 luma = vec3( 0.299, 0.587, 0.114 );","","    float lumaNW = dot( rgbNW, luma );","    float lumaNE = dot( rgbNE, luma );","    float lumaSW = dot( rgbSW, luma );","    float lumaSE = dot( rgbSE, luma );","    float lumaM  = dot( rgbM,  luma );","    float lumaMin = min( lumaM, min( min( lumaNW, lumaNE ), min( lumaSW, lumaSE ) ) );","    float lumaMax = max( lumaM, max( max( lumaNW, lumaNE) , max( lumaSW, lumaSE ) ) );","","    vec2 dir;","    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));","    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));","","    float dirReduce = max( ( lumaNW + lumaNE + lumaSW + lumaSE ) * ( 0.25 * FXAA_REDUCE_MUL ), FXAA_REDUCE_MIN );","","    float rcpDirMin = 1.0 / ( min( abs( dir.x ), abs( dir.y ) ) + dirReduce );","    dir = min( vec2( FXAA_SPAN_MAX, FXAA_SPAN_MAX), max( vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), dir * rcpDirMin)) * uResolution;","","    vec3 rgbA = 0.5 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 1.0 / 3.0 - 0.5 ) ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * ( 2.0 / 3.0 - 0.5 ) ).xyz );","","    vec3 rgbB = rgbA * 0.5 + 0.25 * (","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * -0.5 ).xyz +","        texture2D( uColorBuffer, gl_FragCoord.xy  * uResolution + dir * 0.5 ).xyz );","","    float lumaB = dot( rgbB, luma );","","    if ( ( lumaB < lumaMin ) || ( lumaB > lumaMax ) )","    {","        gl_FragColor = vec4( rgbA, opacity );","    }","    else","    {","        gl_FragColor = vec4( rgbB, opacity );","    }","}"].join("\n");this.fxaaShader=new pc.Shader(e,{attributes:o,vshader:r,fshader:a}),this.resolution=new Float32Array(2)};return(FxaaEffect=pc.inherits(FxaaEffect,pc.PostEffect)).prototype=pc.extend(FxaaEffect.prototype,{render:function(e,o,r){var a=this.device,t=a.scope;this.resolution[0]=1/e.width,this.resolution[1]=1/e.height,t.resolve("uResolution").setValue(this.resolution),t.resolve("uColorBuffer").setValue(e.colorBuffer),pc.drawFullscreenQuad(a,o,this.vertexBuffer,this.fxaaShader,r)}}),{FxaaEffect:FxaaEffect}}());var Fxaa=pc.createScript("fxaa");Fxaa.prototype.initialize=function(){this.effect=new pc.FxaaEffect(this.app.graphicsDevice);var e=this.entity.camera.postEffects;e.addEffect(this.effect),this.on("state",(function(o){o?e.addEffect(this.effect):e.removeEffect(this.effect)})),this.on("destroy",(function(){e.removeEffect(this.effect)}))};"undefined"!=typeof document&&(
/*! FPSMeter 0.3.1 - 9th May 2013 | https://github.com/Darsain/fpsmeter */
function(t,e){function s(t,e){for(var n in e)try{t.style[n]=e[n]}catch(t){}return t}function H(t){return null==t?String(t):"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}function R(t,e){if("array"!==H(e))return-1;if(e.indexOf)return e.indexOf(t);for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1}function I(){var t,e=arguments;for(t in e[1])if(e[1].hasOwnProperty(t))switch(H(e[1][t])){case"object":e[0][t]=I({},e[0][t],e[1][t]);break;case"array":e[0][t]=e[1][t].slice(0);break;default:e[0][t]=e[1][t]}return 2<e.length?I.apply(null,[e[0]].concat(Array.prototype.slice.call(e,2))):e[0]}function N(t){return 1===(t=Math.round(255*t).toString(16)).length?"0"+t:t}function S(t,e,n,i){t.addEventListener?t[i?"removeEventListener":"addEventListener"](e,n,!1):t.attachEvent&&t[i?"detachEvent":"attachEvent"]("on"+e,n)}function D(t,e){function g(t,e,n,i){return h[0|t][Math.round(Math.min((e-n)/(i-n)*C,C))]}function r(){O.legend.fps!==T&&(O.legend.fps=T,O.legend[l]=T?"FPS":"ms"),v=T?y.fps:y.duration,O.count[l]=999<v?"999+":v.toFixed(99<v?0:F.decimals)}function m(){for(p=n(),A<p-F.threshold&&(y.fps-=y.fps/Math.max(1,60*F.smoothing/F.interval),y.duration=1e3/y.fps),b=F.history;b--;)j[b]=0===b?y.fps:j[b-1],q[b]=0===b?y.duration:q[b-1];if(r(),F.heat){if(M.length)for(b=M.length;b--;)M[b].el.style[i[M[b].name].heatOn]=T?g(i[M[b].name].heatmap,y.fps,0,F.maxFps):g(i[M[b].name].heatmap,y.duration,F.threshold,0);if(O.graph&&i.column.heatOn)for(b=P.length;b--;)P[b].style[i.column.heatOn]=T?g(i.column.heatmap,j[b],0,F.maxFps):g(i.column.heatmap,q[b],F.threshold,0)}if(O.graph)for(w=0;w<F.history;w++)P[w].style.height=(T?j[w]?Math.round(x/F.maxFps*Math.min(j[w],F.maxFps)):0:q[w]?Math.round(x/F.threshold*Math.min(q[w],F.threshold)):0)+"px"}function k(){20>F.interval?(c=o(k),m()):(c=setTimeout(k,F.interval),f=o(m))}function G(t){(t=t||window.event).preventDefault?(t.preventDefault(),t.stopPropagation()):(t.returnValue=!1,t.cancelBubble=!0),y.toggle()}function U(){F.toggleOn&&S(O.container,F.toggleOn,G,1),t.removeChild(O.container)}function V(){if(O.container&&U(),i=D.theme[F.theme],!(h=i.compiledHeatmaps||[]).length&&i.heatmaps.length){for(w=0;w<i.heatmaps.length;w++)for(h[w]=[],b=0;b<=C;b++){var e,n=h[w],a=b;e=.33/C*b;var o=i.heatmaps[w].saturation,p=i.heatmaps[w].lightness,c=void 0,l=void 0,u=void 0,d=u=void 0,f=c=l=void 0;f=void 0;0===(u=.5>=p?p*(1+o):p+o-p*o)?e="#000":(l=(u-(d=2*p-u))/u,f=(e*=6)-(c=Math.floor(e)),f*=u*l,0===c||6===c?(c=u,l=d+f,u=d):1===c?(c=u-f,l=u,u=d):2===c?(c=d,l=u,u=d+f):3===c?(c=d,l=u-f):4===c?(c=d+f,l=d):(c=u,l=d,u-=f),e="#"+N(c)+N(l)+N(u)),n[a]=e}i.compiledHeatmaps=h}for(var v in O.container=s(document.createElement("div"),i.container),O.count=O.container.appendChild(s(document.createElement("div"),i.count)),O.legend=O.container.appendChild(s(document.createElement("div"),i.legend)),O.graph=F.graph?O.container.appendChild(s(document.createElement("div"),i.graph)):0,M.length=0,O)O[v]&&i[v].heatOn&&M.push({name:v,el:O[v]});if(P.length=0,O.graph)for(O.graph.style.width=F.history*i.column.width+(F.history-1)*i.column.spacing+"px",b=0;b<F.history;b++)P[b]=O.graph.appendChild(s(document.createElement("div"),i.column)),P[b].style.position="absolute",P[b].style.bottom=0,P[b].style.right=b*i.column.width+b*i.column.spacing+"px",P[b].style.width=i.column.width+"px",P[b].style.height="0px";s(O.container,F),r(),t.appendChild(O.container),O.graph&&(x=O.graph.clientHeight),F.toggleOn&&("click"===F.toggleOn&&(O.container.style.cursor="pointer"),S(O.container,F.toggleOn,G))}"object"===H(t)&&undefined===t.nodeType&&(e=t,t=document.body),t||(t=document.body);var i,h,p,c,f,x,v,b,w,y=this,F=I({},D.defaults,e||{}),O={},P=[],C=100,M=[],z=F.threshold,E=0,A=n()-z,j=[],q=[],T="fps"===F.show;y.options=F,y.fps=0,y.duration=0,y.isPaused=0,y.tickStart=function(){E=n()},y.tick=function(){p=n(),z+=(p-A-z)/F.smoothing,y.fps=1e3/z,y.duration=E<A?z:p-E,A=p},y.pause=function(){return c&&(y.isPaused=1,clearTimeout(c),a(c),a(f),c=f=0),y},y.resume=function(){return c||(y.isPaused=0,k()),y},y.set=function(t,e){return F[t]=e,T="fps"===F.show,-1!==R(t,u)&&V(),-1!==R(t,d)&&s(O.container,F),y},y.showDuration=function(){return y.set("show","ms"),y},y.showFps=function(){return y.set("show","fps"),y},y.toggle=function(){return y.set("show",T?"ms":"fps"),y},y.hide=function(){return y.pause(),O.container.style.display="none",y},y.show=function(){return y.resume(),O.container.style.display="block",y},y.destroy=function(){y.pause(),U(),y.tick=y.tickStart=function(){}},V(),k()}var n,i=t.performance;n=i&&(i.now||i.webkitNow)?i[i.now?"now":"webkitNow"].bind(i):function(){return+new Date};for(var a=t.cancelAnimationFrame||t.cancelRequestAnimationFrame,o=t.requestAnimationFrame,h=0,p=0,c=(i=["moz","webkit","o"]).length;p<c&&!a;++p)o=(a=t[i[p]+"CancelAnimationFrame"]||t[i[p]+"CancelRequestAnimationFrame"])&&t[i[p]+"RequestAnimationFrame"];a||(o=function(e){var i=n(),a=Math.max(0,16-(i-h));return h=i+a,t.setTimeout((function(){e(i+a)}),a)},a=function(t){clearTimeout(t)});var l="string"===H(document.createElement("div").textContent)?"textContent":"innerText";D.extend=I,window.FPSMeter=D,D.defaults={interval:100,smoothing:10,show:"fps",toggleOn:"click",decimals:1,maxFps:60,threshold:100,position:"absolute",zIndex:10,left:"5px",top:"5px",right:"auto",bottom:"auto",margin:"0 0 0 0",theme:"dark",heat:0,graph:0,history:20};var u=["toggleOn","theme","heat","graph","history"],d="position zIndex left top right bottom margin".split(" ")}(window),function(t,e){e.theme={};var n=e.theme.base={heatmaps:[],container:{heatOn:null,heatmap:null,padding:"5px",minWidth:"95px",height:"30px",lineHeight:"30px",textAlign:"right",textShadow:"none"},count:{heatOn:null,heatmap:null,position:"absolute",top:0,right:0,padding:"5px 10px",height:"30px",fontSize:"24px",fontFamily:"Consolas, Andale Mono, monospace",zIndex:2},legend:{heatOn:null,heatmap:null,position:"absolute",top:0,left:0,padding:"5px 10px",height:"30px",fontSize:"12px",lineHeight:"32px",fontFamily:"sans-serif",textAlign:"left",zIndex:2},graph:{heatOn:null,heatmap:null,position:"relative",boxSizing:"padding-box",MozBoxSizing:"padding-box",height:"100%",zIndex:1},column:{width:4,spacing:1,heatOn:null,heatmap:null}};e.theme.dark=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.8}],container:{background:"#222",color:"#fff",border:"1px solid #1a1a1a",textShadow:"1px 1px 0 #222"},count:{heatOn:"color"},column:{background:"#3f3f3f"}}),e.theme.light=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.5}],container:{color:"#666",background:"#fff",textShadow:"1px 1px 0 rgba(255,255,255,.5), -1px -1px 0 rgba(255,255,255,.5)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},count:{heatOn:"color"},column:{background:"#eaeaea"}}),e.theme.colorful=e.extend({},n,{heatmaps:[{saturation:.5,lightness:.6}],container:{heatOn:"backgroundColor",background:"#888",color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.2)",boxShadow:"0 0 0 1px rgba(0,0,0,.1)"},column:{background:"#777",backgroundColor:"rgba(0,0,0,.2)"}}),e.theme.transparent=e.extend({},n,{heatmaps:[{saturation:.8,lightness:.5}],container:{padding:0,color:"#fff",textShadow:"1px 1px 0 rgba(0,0,0,.5)"},count:{padding:"0 5px",height:"40px",lineHeight:"40px"},legend:{padding:"0 5px",height:"40px",lineHeight:"42px"},graph:{height:"40px"},column:{width:5,background:"#999",heatOn:"backgroundColor",opacity:.5}})}(window,FPSMeter));var Fps=pc.createScript("fps");Fps.prototype.initialize=function(){_fps=this},Fps.prototype.ini=function(){this.iniciarCalculos=!0},Fps.prototype.update=function(t){if(this.iniciarCalculos&&this.rectificadores!=this.maxRectificadores)if(this.fps.tick(),this.tiempo=this.tiempo+t,this.tiempo<this.tiempoMax)this.sumFps=this.sumFps+this.fps.fps,this.cantFps=this.cantFps+1;else{var e=this.sumFps/this.cantFps;if(this.primerIntento)console.log("el promedio de fps 1 intento fue de "+e),this.primerIntento=!1,this.tiempoMax=2;else{console.log("el promedio de fps fue de "+e),this.rectificadores=this.rectificadores+1;var n="";if(n=e>45?"alta":e>33?"media":e>14?"mediaBaja":"baja",qualityFactor!=n)switch(qualityFactor=n,qualityFactor){case"alta":this.app.graphicsDevice.maxPixelRatio=window.devicePixelRatio;break;case"media":window.devicePixelRatio>2?this.app.graphicsDevice.maxPixelRatio=2:window.devicePixelRatio>1.5?this.app.graphicsDevice.maxPixelRatio=1.5:this.app.graphicsDevice.maxPixelRatio=1;break;case"mediaBaja":window.devicePixelRatio,this.app.graphicsDevice.maxPixelRatio=1;break;case"baja":this.app.graphicsDevice.maxPixelRatio=.75}}this.sumFps=0,this.tiempo=0,this.cantFps=0}};var _CLICK=function(e,s,t){var o=!1;if("manual"==t&&(o=!0),t=new pc.Vec2(e,s),_TUTORIAL_PLAYING&&tutorial.ClickTutorial(),o&&isMobile.any())setTimeout((()=>{system.lastVector=new pc.Vec2(e,s),system.lastVectorAuxA=new pc.Vec2(e,s),system.inTap=1,system.isClicking=!0,system.countEventTap=0,_MOVE(e,s),_UP(e,s)}),260);else if(!(_TUTORIAL_PLAYING&&"Phase2"==tutorial.tutorialStatus||system.b_GAME_FINISHED||_GUI_OPEN||_TURN_TIME_OUT||_BLOCKED||_BOT_PLAYING||_INGAME_MENU_OPEN||system.b_BOT_ENABLE&&1==system.playerTurn)){if(_9_BOLAS_ACTIVADO);else if(system.Ball8Phase()){if(system.b_SelectingBall8){var l=RayCast(t,system.camera.camera,system.app);if(null!==l&&"Box"==l.name.substring(0,3)){canvas.choosePocketHoleGUI.enabled=!1;for(var a=0;a<system.colliderBall8.length;a++)system.colliderBall8[a].enabled=!0;for(a=0;a<system.colliderBall8ON.length;a++)system.colliderBall8ON[a].enabled=!1;for(a=0;a<system.colliderBall8ON.length;a++)if(system.colliderBall8ON[a].name==l.name+"A"){system.colliderBall8ON[a].enabled=!0;break}return _CLICKED_HOLE_8=!0,l.enabled=!1,playSound("clickMute"),system.selectedHole=l.name,console.log("el hoyo elegido "+l.name),void(system.turnState="Waiting")}}if(null===system.selectedHole||""==system.selectedHole)return}if(system.inTap=1,isMobile.any()&&!_GUI_OPEN&&(system.lastVector=new pc.Vec2(e,s)),system.lastVectorAuxA=new pc.Vec2(e,s),"ShootLap"!=system.turnState&&"MovingPoolCueLap"!=system.turnState)if(system.isClicking=!0,_IS_PHONE?"ForceLapGUI"==system.turnState&&0==system.usingCueLoadBar&&(system.turnState="Waiting"):"Waiting"==system.turnState&&(system.turnState="ForceLap",system.loopShootBall(),system.posicionHit=GetMouseFloorPosition(new pc.Vec2(system.target.x,system.target.y),system.camera.camera,system.app).point),_IS_PHONE){if(system.b_movingWhiteBall||system.arrowsIconWhiteBall.enabled){i=new pc.Vec2(e,s);system.ActiveCanMoveWhiteBall(i)}}else if(system.takeIconWhiteBall.enabled||system.b_movingWhiteBall||system.arrowsIconWhiteBall.enabled){var i=new pc.Vec2(e,s);system.ActiveCanMoveWhiteBall(i)}}},_MOVE=function(e,s,t){if(t=new pc.Vec2(e,s),_TUTORIAL_PLAYING&&tutorial.MoveTutorial(),!(system.b_GAME_FINISHED||_GUI_OPEN||_TURN_TIME_OUT||_BLOCKED||_BOT_PLAYING||"MovingPoolCueLap"==system.turnState||_INGAME_MENU_OPEN||_CLICKED_HOLE_8)){if(_9_BOLAS_ACTIVADO);else if(system.Ball8Phase()&&(null===system.selectedHole||""==system.selectedHole))return;if((!system.b_BOT_ENABLE||1!=system.playerTurn)&&system.coreLoaded){if(system.b_whiteBallReleased){var o=new pc.Vec2(e,s);null!==(l=RayCast(o,system.camera.camera,system.app))&&"1"==l.name||(system.b_whiteBallReleased=!1)}if(system.b_enableCanMoveWhiteBall&&((!system.b_BOT_ENABLE||system.b_BOT_ENABLE&&0==system.playerTurn)&&(system.arrowsIconWhiteBall.enabled=!0),system.arrowsIconWhiteBall.setPosition(system.ball.getPosition())),"ForceLap"!=system.turnState&&"ShootLap"!=system.turnState||(system.arrowsIconWhiteBall.enabled=!1),system.b_enableCanMoveWhiteBall&&!system.b_movingWhiteBall&&"ForceLap"!=system.turnState&&"ForceLapGUI"!=system.turnState){o=new pc.Vec2(e,s);null===(l=RayCast(o,system.camera.camera,system.app))||"1"!=l.name||system.b_whiteBallReleased?((!system.b_BOT_ENABLE||system.b_BOT_ENABLE&&0==system.playerTurn)&&(system.arrowsIconWhiteBall.enabled=!0),system.arrowsIconWhiteBall.setPosition(system.ball.getPosition()),system.takeIconWhiteBall.enabled=!1,system.glowFloor.enabled=!1,system.glowFloorInitial.enabled=!1):(system.takeIconWhiteBall.enabled=!0,system.arrowsIconWhiteBall.enabled=!1,system.arrowsIconWhiteBall.setPosition(system.ball.getPosition()),system.b_IS_FIRST_TURN?system.glowFloorInitial.enabled=!0:system.glowFloor.enabled=!0,system.takeIconWhiteBall.setPosition(system.ball.getPosition()),system.TurnOffPoolCueLine())}else if(system.b_movingWhiteBall&&"ForceLap"!=system.turnState&&"ForceLapGUI"!=system.turnState){o=new pc.Vec2(e,s);var l=RayCast(o,system.camera.camera,system.app);system.arrowsIconWhiteBall.enabled=!1,system.takeIconWhiteBall.enabled=!0,system.b_IS_FIRST_TURN?system.glowFloorInitial.enabled=!0:system.glowFloor.enabled=!0,system.takeIconWhiteBall.setPosition(system.ball.getPosition()),system.TurnOffPoolCueLine()}if(system.b_WrongPositionWhiteBall?(system.takeWhiteBallError.enabled=!0,system.takeIconWhiteBall.enabled=!0,system.b_IS_FIRST_TURN?system.glowFloorInitial.enabled=!0:system.glowFloor.enabled=!0,system.takeIconWhiteBall.setPosition(system.ball.getPosition()),system.takeWhiteBallError.setPosition(system.ball.getPosition()),system.TurnOffPoolCueLine()):system.takeWhiteBallError.enabled=!1,(system.b_movingWhiteBall||system.b_enableCanMoveWhiteBall)&&(_physicWorldSystem.stepToFuture(.01),arrayBallsInCollision.length>0&&(system.takeWhiteBallError.enabled=!0,system.takeWhiteBallError.setPosition(system.ball.getPosition()))),system.b_movingWhiteBall){var a=GetMouseFloorPosition(new pc.Vec2(system.target.x,system.target.y),system.camera.camera,system.app).point;if(null===a)return;system.b_IS_FIRST_TURN?(a.x=pc.math.clamp(a.x,system.LEFTWHITEBALLFirstTurn.getPosition().clone().x,system.RIGHTWHITEBALLFirstTurn.getPosition().clone().x),a.z=pc.math.clamp(a.z,system.TOPWHITEBALLFirstTurn.getPosition().clone().z,system.DOWNWHITEBALLFirstTurn.getPosition().clone().z)):(a.x=pc.math.clamp(a.x,system.LEFTWHITEBALL.getPosition().clone().x,system.RIGHTWHITEBALL.getPosition().clone().x),a.z=pc.math.clamp(a.z,system.TOPWHITEBALL.getPosition().clone().z,system.DOWNWHITEBALL.getPosition().clone().z)),system.ball.setPosition(new pc.Vec3(a.x,system.ball.getPosition().y,a.z)),system.ball.script.p2Body.body.position=[a.x,-1*a.z]}if(_IS_PHONE&&"Waiting"==system.turnState&&"Phase3"!=tutorial.tutorialStatus){var i=system.ball.getPosition().clone();if(null==system.lastVectorAuxA)return;var n=(e-system.lastVectorAuxA.x)/65,m=(s-system.lastVectorAuxA.y)/65,y=GetMouseFloorPosition(new pc.Vec2(system.target.x,system.target.y),system.camera.camera,system.app).point;vc=system.TargetMouse.getPosition();var c=new pc.Vec2(i.x,i.z).distance(new pc.Vec2(y.x,y.z));c>8&&(c=8);var r=system.TargetMouse.right.normalize().scale(-n),g=system.TargetMouse.forward.normalize().scale(-m),u=new pc.Vec3(vc.x,vc.y,vc.z),p=c/1,d=i.x,P=i.z,b=system.tetaAngleRad,_=Math.atan2(y.z-i.z,y.x-i.x);system.isPortrait&&(_-=Math.PI/2);var O,h=180*Math.atan2(Math.sin(_),Math.cos(_))/Math.PI,E=0;Math.abs(r.x)>=Math.abs(g.z)?h>=0&&h<=180?(O=d+Math.cos(b+r.x/p)*c,E=P+Math.sin(b+r.x/p)*c,system.tetaAngleRad=b+r.x/p):(O=d+Math.cos(b-r.x/p)*c,E=P+Math.sin(b-r.x/p)*c,system.tetaAngleRad=b-r.x/p):h<=90&&h>=-90?(O=d+Math.cos(b+g.z/p)*c,E=P+Math.sin(b+g.z/p)*c,system.tetaAngleRad=b+g.z/p):(O=d+Math.cos(b-g.z/p)*c,E=P+Math.sin(b-g.z/p)*c,system.tetaAngleRad=b-g.z/p),u.x=O,u.z=E,system.TargetMouse.setPosition(u),system.lastVectorAuxA=new pc.Vec2(e,s),system.followerGO.lookAt(new pc.Vec3(vc.x,system.followerGO.getPosition().y,vc.z)),console.log("PERO Q WEA)")}if(system.forcedMoving){system.forcedMoving=!1;var B={x:0,z:0}}else{if(null===(B=GetMouseFloorPosition(new pc.Vec2(system.target.x,system.target.y),system.camera.camera,system.app).point))return}if(system.mobileWaitingClick=!1,"Waiting"==system.turnState){system.poolCueGO.enabled=!0,B.x=pc.math.clamp(B.x,system.LEFT.getPosition().clone().x,system.RIGHT.getPosition().clone().x),B.z=pc.math.clamp(B.z,system.TOP.getPosition().clone().z,system.DOWN.getPosition().clone().z);var L=system.targetGO.getPosition().clone();isMobile.any()?(system.followerGO.rotateLocal(new pc.Vec3(0,system.dynamicDistance*system.rotationSpeed,0)),system.targetGO.setPosition(system.followerGO.getLocalPosition().add(system.followerGO.forward))):system.targetGO.setPosition(new pc.Vec3(B.x,L.y,B.z));var T=system.ball.getPosition().clone().x,I=system.ball.getPosition().clone().z,w=system.targetGO.getPosition().clone().x,W=system.targetGO.getPosition().clone().z,f=(W-I)/(w-T),v=w>T?w+3:w-3,A=f*v+(W-f*w);w>T?v=system.RIGHT.getPosition().clone().x:w<T&&(v=system.LEFT.getPosition().clone().x),(A=f*v+(W-f*w))<system.TOP.getPosition().clone().z?(v=(system.TOP.getPosition().clone().z-(W-f*w))/f,A=system.TOP.getPosition().clone().z):A>system.DOWN.getPosition().clone().z&&(v=(system.DOWN.getPosition().clone().z-(W-f*w))/f,A=system.DOWN.getPosition().clone().z),system.targetExtendedGO.setPosition(new pc.Vec3(v,system.ball.getPosition().y,A)),system.loopShootBall()}else if("ForceLap"==system.turnState){system.b_SelectingBall8&&(system.colliderBall8Entity.enabled=!1),system.loopShootBall();var C=system.posicionHit,G=B,M=system.ball.getPosition().clone();(system.followerGO.getEulerAngles().y<12&&system.followerGO.getEulerAngles().y>0||system.followerGO.getEulerAngles().y>-12&&system.followerGO.getEulerAngles().y<0)&&0==parseInt(system.followerGO.getEulerAngles().x)?G.z>=C.z?system.distancia=C.distance(G):system.distancia=0:(system.followerGO.getEulerAngles().y<12&&system.followerGO.getEulerAngles().y>0||system.followerGO.getEulerAngles().y>-12&&system.followerGO.getEulerAngles().y<0)&&180==parseInt(system.followerGO.getEulerAngles().x)?G.z<=C.z?system.distancia=C.distance(G):system.distancia=0:M.x<system.targetExtendedGO.getPosition().clone().x?G.x<=C.x?system.distancia=C.distance(G):system.distancia=0:G.x>=C.x?system.distancia=C.distance(G):system.distancia=0}else if("ForceLapGUI"==system.turnState&&system.usingCueLoadBar){console.log("Pase por aca 2"),system.b_SelectingBall8&&(system.colliderBall8Entity.enabled=!1),isMobile.any()?(system.cueDistance=system.cueClicky-system.lastTouchPosition.y,system.cueClicky=system.lastTouchPosition.y):(system.cueDistance=system.cueClicky-t.y,system.cueClicky=t.y);var S=canvas.poolCue.getLocalPosition().clone().y,N=1045;S=pc.math.clamp(S+system.cueDistance*(system.barSpeed*speedCue),-1045,0),canvas.poolCue.setLocalPosition(canvas.poolCue.getLocalPosition().x,S,canvas.poolCue.getLocalPosition().z),console.log(canvas.poolCue.getLocalPosition().x);e=Math.abs(S);system.cueLoad=e/N;S=canvas.shadowBarMove.getLocalPosition().y;S=pc.math.clamp(S-system.cueDistance*(system.barSpeed*speedCue),0,1045),canvas.shadowBarMove.setLocalPosition(canvas.shadowBarMove.getLocalPosition().x,S,canvas.shadowBarMove.getLocalPosition().z)}if(system.isClicking)system.app.graphicsDevice.canvas.clientHeight}}},_UP=function(e,s,t){if(_TUTORIAL_PLAYING&&((null!=system.distancia||!isNaN(system.distancia))&&system.distancia>0?tutorial.HitMouseUp():tutorial.MouseUp(),_IS_PHONE&&tutorial.tapUP()),!(system.b_GAME_FINISHED||_GUI_OPEN||_TURN_TIME_OUT||_BLOCKED||_BOT_PLAYING||_INGAME_MENU_OPEN||system.b_BOT_ENABLE&&1==system.playerTurn)){if(_9_BOLAS_ACTIVADO);else if(_CLICKED_HOLE_8)return void(_CLICKED_HOLE_8=!1);if(system.lastVectorAuxA=null,isMobile.any()&&(system.lastVector=null),system.inTap=0,system.b_movingWhiteBall)return _physicWorldSystem.stepToFuture(.01),void(arrayBallsInCollision.length>0?(system.b_WrongPositionWhiteBall=!0,system.takeWhiteBallError.enabled=!0,system.takeWhiteBallError.setPosition(system.ball.getPosition()),system.b_movingWhiteBall=!1):(system.takeWhiteBallError.enabled=!1,system.b_WrongPositionWhiteBall=!1,system.takeIconWhiteBall.enabled=!1,playSound("endWhite"),system.arrowsIconWhiteBall.enabled=!0,system.arrowsIconWhiteBall.setPosition(system.ball.getPosition()),system.glowFloorInitial.enabled=!1,system.glowFloor.enabled=!1,system.b_movingWhiteBall=!1,console.log("dejar de mover blanca"),system.turnState="Waiting",simulation=!0,system.ball.script.p2Circle.sensor=!1,system.b_whiteBallReleased=!0));if(_IS_PHONE){if(system.isClicking){if(system.isClicking=!1,system.countEventTap<=system.eventTapLimitTime&&"Phase3"!=tutorial.tutorialStatus&&"Waiting"==system.turnState){var o=system.followerGO.getLocalEulerAngles().clone(),l=GetMouseFloorPosition(new pc.Vec2(e,s),system.camera.camera,system.app).point;system.TargetMouse.setPosition(new pc.Vec3(l.x,system.TargetMouse.getPosition().y,l.z));var a=system.TargetMouse.getPosition();system.followerGO.lookAt(new pc.Vec3(a.x,system.followerGO.getPosition().y,a.z));var i=system.followerGO.getLocalEulerAngles().clone(),n=GetMouseFloorPosition(new pc.Vec2(system.target.x,system.target.y),system.camera.camera,system.app).point,m=(Math.abs(system.ball.getPosition().x-n.x),Math.abs(system.ball.getPosition().y-n.y),system.ball.getPosition()),y=Math.atan2(a.z-m.z,a.x-m.x);system.tetaAngleRad=y;d=system.ball.getPosition().clone().x,P=system.ball.getPosition().clone().z;var c=(b=system.TargetMouse.getPosition().clone().x)>d?b+3:b-3,r=(h=((_=system.TargetMouse.getPosition().clone().z)-P)/(b-d))*c+(_-h*b);b>d?c=system.RIGHT.getPosition().clone().x:b<d&&(c=system.LEFT.getPosition().clone().x),(r=h*c+(_-h*b))<system.TOP.getPosition().clone().z?(c=(system.TOP.getPosition().clone().z-(_-h*b))/h,r=system.TOP.getPosition().clone().z):r>system.DOWN.getPosition().clone().z&&(c=(system.DOWN.getPosition().clone().z-(_-h*b))/h,r=system.DOWN.getPosition().clone().z),system.ballColisionada=null,system.followerGO.setLocalEulerAngles(o);var g=system.followerGO.getLocalEulerAngles();system.followerGO.tween(g).rotate(i,.09,pc.SineOut).onUpdate(function(){system.targetGO.setPosition(system.followerGO.getLocalPosition().add(system.followerGO.forward));var e=system.ball.getPosition().clone().x,s=system.ball.getPosition().clone().z,t=system.targetGO.getPosition().clone().x,o=system.targetGO.getPosition().clone().z,l=(o-s)/(t-e),a=t>e?t+3:t-3,i=l*a+(o-l*t);t>e?a=system.RIGHT.getPosition().clone().x:t<e&&(a=system.LEFT.getPosition().clone().x),(i=l*a+(o-l*t))<system.TOP.getPosition().clone().z?(a=(system.TOP.getPosition().clone().z-(o-l*t))/l,i=system.TOP.getPosition().clone().z):i>system.DOWN.getPosition().clone().z&&(a=(system.DOWN.getPosition().clone().z-(o-l*t))/l,i=system.DOWN.getPosition().clone().z),system.ballColisionada=null,system.targetExtendedGO.setPosition(new pc.Vec3(a,system.ball.getPosition().y,i)),system.loopShootBall()}.bind(system)).start()}system.countEventTap=0}if(system.usingCueLoadBar)if(system.usingCueLoadBar=!1,console.log("Solto barra fuera de sprite"),system.cueLoad>0){system.b_SelectingBall8&&(system.b_SelectingBall8=!1,system.colliderBall8Entity.enabled=!1,system.b_ENABLE_TEST_BALL8=!1),console.log("up","shootBallFunction"),system.turnState="MovingPoolCueLap",system.fuerzaDisparo=system.distancia,system.distancia=0,system.adjustDistance=system.poolCueGO.getPosition().clone().distance(system.ball.getPosition().clone()),system.followerGO.script.follower.enabled=!1,system.callbackDisparo=function(){system.circleGO.enabled=!1,system.circleErrorGO.enabled=!1,system.ballWhiteLineInitial.enabled=!1,system.ballWhiteLineInitial2.enabled=!1,system.ballWhiteLine.enabled=!1,system.ballWhiteColor.enabled=!1,system.ballWhiteColor2.enabled=!1,system.ballWhiteLine2.enabled=!1,system.Ex.enabled=!1,window.setTimeout((function(){system.hidePoolCueGO()}),30),system.shootBallFunction(),system.turnState="ShootLap"},system.preShoot();h=((_=25)-(P=0))/((b=1)-(d=0));var u=new pc.Vec3(0,0,0).distance(system.poolCueGO.getLocalPosition());L=u/(B=h*(pc.math.clamp(hitForze*system.cueLoad,_MIN_FORCE_CUE,1)-d)+P);(O=canvas.poolCue.tween(canvas.poolCue.getLocalPosition()).to(new pc.Vec3(0,0,0),L,pc.Linear)).start(),canvas.shadowBarMove.setLocalPosition(new pc.Vec3(0,0,0));L=u/B;(O=system.poolCueGO.tween(system.poolCueGO.getLocalPosition()).to(new pc.Vec3(0,0,0),L,pc.Linear)).onComplete((()=>{system.callbackDisparo()})),O.start(),_9_BOLAS_ACTIVADO&&system.esconderIndicados9Bolas(),system.cueLoad=0}else system.b_SelectingBall8&&(system.colliderBall8Entity.enabled=!0)}else{if(system.isClicking&&(system.isClicking=!1,null==system.distancia||isNaN(system.distancia)))return void(system.turnState="Waiting");if("ForceLap"==system.turnState){var p=new pc.Vec3(0,0,0).distance(system.poolCueGO.getLocalPosition())>0;if(system.distancia<=0||null==system.distancia||isNaN(system.distancia)||!p)system.b_SelectingBall8&&(system.colliderBall8Entity.enabled=!0),system.turnState="Waiting",system.b_movingWhiteBall&&(system.b_enableCanMoveWhiteBall=!0,system.arrowsIconWhiteBall.enabled=!0,system.arrowsIconWhiteBall.setPosition(system.ball.getPosition()));else{system.b_SelectingBall8&&(system.b_SelectingBall8=!1,system.colliderBall8Entity.enabled=!1,system.b_ENABLE_TEST_BALL8=!1),system.turnState="MovingPoolCueLap",system.fuerzaDisparo=system.distancia,system.distancia=0,system.adjustDistance=system.poolCueGO.getPosition().clone().distance(system.ball.getPosition().clone()),system.followerGO.script.follower.enabled=!1,system.callbackDisparo=function(){system.circleGO.enabled=!1,system.circleErrorGO.enabled=!1,system.ballWhiteLineInitial.enabled=!1,system.ballWhiteLineInitial2.enabled=!1,system.ballWhiteLine.enabled=!1,system.ballWhiteColor.enabled=!1,system.ballWhiteColor2.enabled=!1,system.ballWhiteLine2.enabled=!1,system.Ex.enabled=!1,window.setTimeout((function(){system.hidePoolCueGO()}),100),system.shootBallFunction(),system.turnState="ShootLap"},system.preShoot();var d,P,b,_,O,h=((_=25)-(P=0))/((b=1)-(d=0)),E=pc.math.clamp(new pc.Vec3(0,0,0).distance(system.poolCueGO.getLocalPosition())/2.5,_MIN_FORCE_CUE,1),B=h*(hitForze*E-d)+P,L=new pc.Vec3(0,0,0).distance(system.poolCueGO.getLocalPosition())/B;(O=system.poolCueGO.tween(system.poolCueGO.getLocalPosition()).to(new pc.Vec3(0,0,0),L,pc.Linear)).onComplete((()=>{system.callbackDisparo()})),O.start(),_9_BOLAS_ACTIVADO&&system.esconderIndicados9Bolas()}}}}},_BUTTON_EVENTS=function(){_IS_PHONE?(system.app.touch.on(pc.EVENT_TOUCHSTART,system.onTouchStart,system),system.app.touch.on(pc.EVENT_TOUCHMOVE,system.onTouchMove,system),system.app.touch.on(pc.EVENT_TOUCHEND,system.onTouchEnd,system)):(system.app.mouse.on(pc.EVENT_MOUSEDOWN,system.onMouseDown,system),system.app.mouse.on(pc.EVENT_MOUSEMOVE,system.onMouseMove,system),system.app.mouse.on(pc.EVENT_MOUSEUP,system.onMouseUp,system),document.addEventListener("mouseout",system.onMouseLeave));system.app.keyboard.on("keydown",(function(e){e.event.preventDefault()}),system)};var Generador9Bolas=pc.createScript("generador9Bolas");Generador9Bolas.attributes.add("buildRandomLevels",{type:"boolean"}),Generador9Bolas.prototype.initialize=function(){var a="",o=this.app.root.findByName("LimiteIzBlancaGenerador"),e=this.app.root.findByName("LimiteDeBlancaGenerador"),t=this.app.root.findByName("LimiteAbBlancaGenerador"),i=this.app.root.findByName("LimiteArrBlancaGenerador");if(this.buildRandomLevels){for(var r=0;r<300;r++){var n="";n+=pc.math.random(o.getPosition().x,e.getPosition().x).toFixed(4)+"/"+pc.math.random(t.getPosition().z,i.getPosition().z).toFixed(4),n+="|";for(var d=[2,3,4,5,6,7,8],l="";d.length>0;){var s=Math.floor(pc.math.random(0,d.length));l+=d[s],d.splice(s,1)}a+=n+=l,a+=r<299?",":""}console.log(a)}};var GameSystem9Ball=pc.createScript("gameSystem9Ball");GameSystem9Ball.prototype.checkGameAssetsPreload=function(){for(var e=this.app.assets.findByTag("preload"),s=0;s<e.length;s++)console.log("CARGAREMOS EL "+e[s].name),this.app.assets.load(e[s]),e[s].ready((function(e){1,e.tags.list().includes("musics")&&preloadSound(e)}),this)},GameSystem9Ball.prototype.initialize=function(){sys9ball=this,this.checkGameAssetsPreload();var e=0;sys9ball._1b=this.app.root.findByName("ContedorDiamante").children[0],sys9ball._2b=this.app.root.findByName("ContedorDiamante").children[1],sys9ball._3b=this.app.root.findByName("ContedorDiamante").children[2],sys9ball._4b=this.app.root.findByName("ContedorDiamante").children[3],sys9ball._5b=this.app.root.findByName("ContedorDiamante").children[4],sys9ball._6b=this.app.root.findByName("ContedorDiamante").children[5],sys9ball._7b=this.app.root.findByName("ContedorDiamante").children[6],sys9ball._8b=this.app.root.findByName("ContedorDiamante").children[7],sys9ball._9b=this.app.root.findByName("ContedorDiamante").children[8],sys9ball.posicionesDiamante=[sys9ball._2b,sys9ball._3b,sys9ball._4b,sys9ball._5b,sys9ball._6b,sys9ball._7b,sys9ball._8b],sys9ball.indicador9Ball=this.app.root.findByName("indicador-nextball"),sys9ball.indicador9Ball.enabled=!1,sys9ball.mensajeWin9Bolas=this.app.root.findByName("_9Ball_MessagesWin"),sys9ball.numerosUpLeft=this.app.root.findByName("numerosUpLeft"),sys9ball.numerosUp=this.app.root.findByName("numerosUp"),sys9ball.numerosUpRight=this.app.root.findByName("numerosUpRight"),sys9ball.numerosDownLeft=this.app.root.findByName("numerosDownLeft"),sys9ball.numerosDown=this.app.root.findByName("numerosDown"),sys9ball.numerosDownRight=this.app.root.findByName("numerosDownRight"),sys9ball.numerosX2=this.app.root.findByName("numerosX2"),sys9ball.numerosX3=this.app.root.findByName("numerosX3"),sys9ball.numerosBola=this.app.root.findByName("numerosBola"),system.InitFirstTImeGame9Balls=function(){_SCORE_9_BALLS=0,AddScore9Balls(0)},system.StartGame9Balls=function(e=!0){showAds(function(){for(var s="",a=0;a<20;a++){var t=Math.floor(298*Math.random());19==a?s+=t:s=s+t+"-"}if(setLevels(s),_LOCAL_PLAYER_NUMBER=0,system.player1.color="planas",sys9ball.SetNew9BallGame(),system.playerTurn=playerTurnStart,onGameStart(),system.poolTable.script.cambiaTextura.cambio(_SELECTED_TABLE_INDEX),system.poolTable.script.colorMaterial.colorChange(_SELECTED_TABLE_INDEX),system.cueBotIndex=Math.floor(Math.random()*system.poolCueGO.children.length),system.setCueToPlayer(playerTurnStart),ballWhiteFirstBallContact=null,system.followerGO.enabled=!0,system.followerGO.script.follower.enabled=!0,system.followerGO.setPosition(new pc.Vec3(system.ball.getPosition().x,system.followerGO.getPosition().y,system.ball.getPosition().z)),system.followerGO.lookAt(new pc.Vec3(0,system.followerGO.getPosition().y,0)),_IS_PHONE){system.lastVectorAuxA={x:null,y:null},system.lastVectorAuxA.x=0,system.lastVectorAuxA.y=0;var l=system.ball.getPosition().clone();if(null==system.lastVectorAuxA)return;var n=(0-system.lastVectorAuxA.x)/65,o=(0-system.lastVectorAuxA.y)/65,r=GetMouseFloorPosition(new pc.Vec2(system.target.x,system.target.y),system.camera.camera,system.app).point;vc=system.TargetMouse.getPosition();var i=new pc.Vec2(l.x,l.z).distance(new pc.Vec2(r.x,r.z));i>8&&(i=8);var m,c=system.TargetMouse.right.normalize().scale(-n),y=system.TargetMouse.forward.normalize().scale(-o),u=new pc.Vec3(vc.x,vc.y,vc.z),b=i/1,d=l.x,p=l.z,_=system.tetaAngleRad,B=Math.atan2(r.z-l.z,r.x-l.x),f=180*Math.atan2(Math.sin(B),Math.cos(B))/Math.PI,g=0;Math.abs(c.x)>=Math.abs(y.z)?f>=0&&f<=180?(m=d+Math.cos(_+c.x/b)*i,g=p+Math.sin(_+c.x/b)*i,system.tetaAngleRad=_+c.x/b):(m=d+Math.cos(_-c.x/b)*i,g=p+Math.sin(_-c.x/b)*i,system.tetaAngleRad=_-c.x/b):f<=90&&f>=-90?(m=d+Math.cos(_+y.z/b)*i,g=p+Math.sin(_+y.z/b)*i,system.tetaAngleRad=_+y.z/b):(m=d+Math.cos(_-y.z/b)*i,g=p+Math.sin(_-y.z/b)*i,system.tetaAngleRad=_-y.z/b),u.x=m,u.z=g,system.TargetMouse.setPosition(u);system.ball.getPosition().clone().distance(system.TargetMouse.getPosition());system.lastVectorAuxA=new pc.Vec2(0,0),system.followerGO.lookAt(new pc.Vec3(vc.x,system.followerGO.getPosition().y,vc.z))}system.PreDrawLine(),system.TurnOffPoolCueLine(),system.cameraBlur.enabled=!1,system.Camera.enabled=!0,system.correctNumberBeforeShoot=null,ReinicioPuntajesMesa(),ballWhiteFirstBallContact=null,_sound.slot("menuMusic").stop(),system.playMusic(),_masse.resetMasse(),setTimeout(function(){playSound("cambioTurno")}.bind(system),150),setTimeout((function(){if(system.b_IS_FIRST_TURN=!0,system.turnState="Waiting",system.ponerIndicados9Bolas(),system.poolCueGO.enabled=!0,e){var s=_LIMIT_TIME_TURN_SECONDS;canvas.timeGUI.element.text=s<10?"0"+s:s.toString(),system.StartTurnTimer9Balls()}_BLOCKED=!1,_GUI_OPEN=!1,console.log(system.playerTurn+"/"+_LOCAL_PLAYER_NUMBER),_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG9ball_youBreak_start()}),150)}.bind(this))},system.changeTurn9Balls=function(){var e=!1;if(system.ballsCapturedInTurn.length>0)for(var s=0;s<system.ballsCapturedInTurn.length;s++)"1"==system.ballsCapturedInTurn[s].name&&(e=!0);if(system.ballsCapturedInTurn.length>0)for(s=0;s<system.ballsCapturedInTurn.length;s++)"1"!=system.ballsCapturedInTurn[s].name&&"9"!=system.ballsCapturedInTurn[s].name&&!0;if(system.b_FirstTurnComplete){e=!1;if(system.ballsCapturedInTurn.length>0)for(s=0;s<system.ballsCapturedInTurn.length;s++)"1"==system.ballsCapturedInTurn[s].name&&(e=!0);if(system.ballsCapturedInTurn.length>0)for(s=0;s<system.ballsCapturedInTurn.length;s++)"1"!=system.ballsCapturedInTurn[s].name&&"9"!=system.ballsCapturedInTurn[s].name&&!0;a=null!==ballWhiteFirstBallContact?ballWhiteFirstBallContact.name:"";ballWhiteFirstBallContact=null;if(0==system.ballsCapturedInTurn.length)!function(e){return""!==e}(a)?(messages.MSG9BALL_FaulNoPegarANiuna(),system.switch("La bola blanca no golpea ninguna otra bola. ",!0)):system.IsFirstHitCorrect9Balls(a)?system.PegoBienA1Muros()?(messages.MSG_TuTurno9Balls(),system.switch("Continua sin foul")):(messages.MSG9BALL_FaulNoPegarA1BandasNiEntronar(),system.switch("No entronera ninguna bola y ninguna bola golpea la banda (sin contar la blanca).",!0)):(messages.MSG9BALL_FaulNoPegarNumeracionCorrecta(),system.switch("La primera bola contactada por la blanca no es la de menor numeracin de las de encima de la mesa de billar",!0),b_perfectMesa=!1);else if(system.ballsCapturedInTurn.length>0){system.ballsCapturedInTurn[0].name;e?(messages.MSG_DropWhiteBall9Balls(),system.switch("Falta capturo la blanca",!0,!0),b_perfectMesa=!1):system.IsFirstHitCorrect9Balls(a)?system.isBall9Captured(system.ballsCapturedInTurn)?(b_perfectMultiMesa=multiplicador9Ball>=2&&b_perfectMultiMesa,PasarMesa(),system.WinGame9Balls()):(b_perfectMultiMesa=multiplicador9Ball>=2&&b_perfectMultiMesa,messages.MSG_TuTurno9Balls(),system.switch("Tu turno")):(messages.MSG9BALL_FaulNoPegarNumeracionCorrecta(),system.switch("La primera bola contactada por la blanca no es la de menor numeracin de las de encima de la mesa de billar",!0,!0),b_perfectMesa=!1)}}else{system.b_FirstTurnComplete=!0;var a=null!==ballWhiteFirstBallContact?ballWhiteFirstBallContact.name:"";if(ballWhiteFirstBallContact=null,0==system.ballsCapturedInTurn.length)""!==a?system.IsFirstHitCorrect9Balls(a)?system.PegoBienA4Muros()||_DESACTIVAR_CONDICION_4_MUROS_9_BOLAS?(messages.MSG_TuTurno9Balls(),system.switch("Continua sin foul")):(messages.MSG9BALL_FaulNoPegarA4BandasEnInicio(),system.switch("En el momento de romper (inicio de partida), al menos 4 bolas no tocan banda.",!0),b_perfectMesa=!1):(messages.MSG9BALL_FaulNoPegarNumeracionCorrecta(),system.switch("La primera bola contactada por la blanca no es la de menor numeracin de las de encima de la mesa de billar",!0),b_perfectMesa=!1):(messages.MSG9BALL_FaulNoPegarANiuna(),system.switch("La bola blanca no golpea ninguna otra bola. ",!0));else if(system.ballsCapturedInTurn.length>0){system.ballsCapturedInTurn[0].name;e?(messages.MSG_DropWhiteBall9Balls(),system.switch("Falta capturo la blanca",!0,!0),b_perfectMesa=!1):system.isBall9Captured(system.ballsCapturedInTurn)?(messages.MSG9BALL_CapturoBall9EnPrimeraRonda(),system.ReiniciaPrimeraJugada9Balls()):system.IsFirstHitCorrect9Balls(a)?(b_perfectMultiMesa=multiplicador9Ball>=2&&b_perfectMultiMesa,messages.MSG_TuTurno9Balls(),system.switch("Tu turno")):(messages.MSG9BALL_FaulNoPegarNumeracionCorrecta(),system.switch("La primera bola contactada por la blanca no es la de menor numeracin de las de encima de la mesa de billar",!0),b_perfectMesa=!1)}}system.ballsCapturedInTurn=[],system.correctNumberBeforeShoot=null},system.GetCorrect9BallsNumber=function(){system.ballsAll[1];for(var e=1;e<10;e++)if(isNaN(system.ballsAll[e].captured)||0==system.ballsAll[e].captured)return{index:e,objeto:system.ballsAll[e]}},system.IsFirstHitCorrect9Balls=function(e){return parseInt(e)==system.correctNumberBeforeShoot.objeto.name},system.PegoBienA4Muros=function(){for(var e=0,s=0;s<railHitsBalls.length;s++)"0"!=railHitsBalls[s].name&&e++;return railHitsBalls=[],e>=4},system.isBall9Captured=function(){for(var e=0;e<system.ballsCapturedInTurn.length;e++)if("10"==system.ballsCapturedInTurn[e].name)return!0;return!1},system.PegoBienA1Muros=function(){for(var e=0,s=0;s<railHitsBalls.length;s++)"0"!=railHitsBalls[s].name&&e++;return railHitsBalls=[],e>=1},system.ReiniciaPrimeraJugada9Balls=function(){system.switch("Falta capturo la blanca",!1,!0)},system.WinGame9Balls=function(e=!1){e||(playSound("victoria"),system.turnState="Ganando"),canvas.CerrarCortinasInGame((function(){system.REINITGAME(e),system.StartGame9Balls(e),window.setTimeout((function(){canvas.AbrirCortinasInGame((function(){}))}),50)}))},system.FinishEASEgame=function(){canvas.macePanelGUI.enabled=!1,system.b_GAME_FINISHED=!0,canvas.panelInstrucciones.enabled=!1,canvas.maceButtonGUIA.enabled=!0,canvas.YouWin9Balls.enabled=!0,playSound("results"),canvas.finalScoreText.element.text=_SCORE_9_BALLS.toString(),_SCORE_9_BALLS>_bestScore&&(_bestScore=_SCORE_9_BALLS),canvas.finalBestText.element.text=_bestScore,saveVariables(_bestScore+"","bestScore"),adsUsados=!1,console.log("LOS ADS USADOS LOS REINICIAMOS!! "+adsUsados),onGameEnd(),canvas.botonNoReward.enabled=!0,canvas.botonReward.enabled=!0,canvas.botonHome.enabled=!1,canvas.botonRestart.enabled=!1,canvas.store_coins.enabled=!0;var e=.012*(_SCORE_9_BALLS-0)+0,s=Math.round(e)*(mesasPasadas+1);canvas.finalRewardCoins.element.text=s,_COINS+=parseInt(canvas.finalRewardCoins.element.text),canvas.PaintCoins(),mesasPasadas=0,s<50&&canvas.EndGameButtons(!1),canvas.menu_storeButton.enabled=!0},system.StartTurnTimer9Balls=function(){if(!(system.b_GAME_FINISHED||_TUTORIAL_PLAYING||_GUI_OPEN)){e=_LIMIT_TIME_TURN_SECONDS,canvas.timeGUI.element.text=e<10?"0"+e:e.toString();var s=new pc.Color;canvas.timeGUI.element.color=s.fromString(normalColor),canvas.timeGUI.script.parpadear.autoStart=0,canvas.timeGUI.enabled=!0,system.timerGUI=setInterval((function(){if(system.b_GAME_FINISHED)window.clearInterval(system.timerGUI);else if(!continuePanel.enabled&&0!=e){if(_GUI_OPEN&&_SINGLE_PLAYER&&0==system.player||canvas.pause9Balls.enabled||(e--,clonTiempo=e),e==_LIMIT_TIME_TURN_SECONDS/2&&_IS_LOCAL_PLAYER_PLAYING()&&messages.MSG_clockTicking(),e==_LIMIT_TIME_TURN_SECONDS-1&&(canvas.cancelGUI=!1,canvas.optionsButton_player1.element.opacity=1),canvas.timeGUI.element.text=e<10?"0"+e:e.toString(),e<=10){if(playSound("pocoTiempo"),10==e){var s=new pc.Color;canvas.timeGUI.element.color=s.fromString(lowTimeColor),canvas.cancelGUI=!0,canvas.CancelOptions()}canvas.timeGUI.script.parpadear.autoStart=2}if(e<=0)if(_9_BALLS_LEVELS){console.log("ENTRE AQUI PO!! 1 VEZ!! "+e),_TURN_TIME_OUT=!0,_GUI_OPEN=!0;var a=function(){_TURN_TIME_OUT=!0,_GUI_OPEN=!1,window.clearInterval(system.timerGUI),system.FinishEASEgame()}.bind(system),t=function(){_TURN_TIME_OUT=!1,_GUI_OPEN=!1,e=e+tiempoExtra+1;var s=new pc.Color;canvas.timeGUI.element.color=s.fromString(normalColor),canvas.timeGUI.script.parpadear.autoStart=0,canvas.timeGUI.enabled=!0}.bind(system);poneContinue(t,a)}else system.CancelTurnAndSwitch(),_TURN_TIME_OUT=!0,window.clearInterval(system.timerGUI)}}),1e3)}},system.ponerIndicados9Bolas=function(){var e=sys9ball.indicador9Ball.getPosition();null!=system.GetCorrect9BallsNumber()&&(sys9ball.indicador9Ball.setPosition(new pc.Vec3(system.GetCorrect9BallsNumber().objeto.getPosition().x,e.y,system.GetCorrect9BallsNumber().objeto.getPosition().z)),sys9ball.indicador9Ball.enabled=!0)},system.esconderIndicados9Bolas=function(){sys9ball.indicador9Ball.enabled=!1}},GameSystem9Ball.prototype.SetNew9BallGame=function(){var e=GetNewLevelToPlay9Balls();console.log(e),system.ball.script.p2Body.body.position=[e.blanca.x,-e.blanca.z],system.ball.setPosition(new pc.Vec3(e.blanca.x,2.586,e.blanca.z)),system.ballsAll[1].script.p2Body.body.position=[sys9ball._1b.getPosition().x,-1*sys9ball._1b.getPosition().z],system.ballsAll[1].setPosition(new pc.Vec3(sys9ball._1b.getPosition().x,2.586,sys9ball._1b.getPosition().z)),system.ballsAll[9].script.p2Body.body.position=[sys9ball._9b.getPosition().x,-1*sys9ball._9b.getPosition().z],system.ballsAll[9].setPosition(new pc.Vec3(sys9ball._9b.getPosition().x,2.586,sys9ball._9b.getPosition().z));for(var s=0;s<e.bolas.length;s++)system.ballsAll[e.bolas[s]].script.p2Body.body.position=[sys9ball.posicionesDiamante[s].getPosition().x,-1*sys9ball.posicionesDiamante[s].getPosition().z],system.ballsAll[e.bolas[s]].setPosition(new pc.Vec3(sys9ball.posicionesDiamante[s].getPosition().x,2.586,sys9ball.posicionesDiamante[s].getPosition().z));for(s=10;s<16;s++)system.ballsAll[s].script.p2Body.body.enabled=!1,system.ballsAll[s].enabled=!1,system.ballsFollower[s].enabled=!1,system.ballsClonedShadow[s].enabled=!1};var ScoreNumeros=pc.createScript("scoreNumeros");ScoreNumeros.attributes.add("material",{type:"asset",assetType:"material",array:!0}),ScoreNumeros.prototype.initialize=function(){this.iniciaAlfa=!1,this.desde=0,this.hasta=0,this.currentNum="",this.indexMaterial=0,this.speed=8,this.entity.enabled=!1,this.modo="poneYsaca",this.hilo=null,this.tiempoVisible=.45,this.materiales=[];for(var e=0;e<this.material.length;e++)this.materiales[e]=this.material[e].resource.clone();this.entity.enabled=!1},ScoreNumeros.prototype.setNumero=function(e){console.log("el num "+e);var t=this.getIndex(e);this.indexMaterial=t,console.log(e),console.log(t);for(var i=this.materiales[t],s=this.entity.model.meshInstances,a=0;a<s.length;++a){var r=s[a];r.material=i,r.material.opacity=this.desde,r.material.update()}},ScoreNumeros.prototype.poneNumero=function(e,t,i,s){clearInterval(this.hilo),this.desde=t,this.hasta=i,this.speed=s,this.currentNum=e,this.setNumero(e),this.iniciaAlfa=!0},ScoreNumeros.prototype.getIndex=function(e){switch(e){case"+100":return 0;case"+200":return 1;case"+300":return 2;case"+1000":return 3;case"+2000":return 4;case"+3000":return 5;case"+1100":return 6;case"+2200":return 7;case"+3300":return 8;case"-100":return 9;case"x2":return 10;case"x3":return 11}},ScoreNumeros.prototype.update=function(e){if(this.iniciaAlfa){for(var t,i=this.entity.model.meshInstances,s=0;s<i.length;++s){var a=i[s];t=a.material.opacity,this.desde<this.hasta?(t+=this.speed*e)>1&&(t=1,this.iniciaAlfa=!1):(t-=this.speed*e)<0&&(t=0,this.iniciaAlfa=!1),a.material.opacity=t,a.material.update()}this.iniciaAlfa||"poneYsaca"==this.modo&&(1==t?(clearInterval(this.hilo),this.hilo=setInterval(this.poneNumero.bind(this,this.currentNum,1,0,3),1e3*this.tiempoVisible)):this.entity.enabled=!1)}};var ScoreNumerosManager=pc.createScript("scoreNumerosManager");ScoreNumerosManager.attributes.add("slot",{type:"entity",array:!0}),ScoreNumerosManager.prototype.initialize=function(){this.indexSlot=0,this.speed=7,this.desde=0,this.hasta=1},ScoreNumerosManager.prototype.poneNumero=function(e,t,s,i){null!=t&&(this.desde=t),null!=s&&(this.hasta=s),null!=i&&(this.speed=i),this.slot[this.indexSlot].enabled=!0,this.slot[this.indexSlot].script.scoreNumeros.poneNumero(e,this.desde,this.hasta,this.speed),this.indexSlot=this.indexSlot+1,this.indexSlot==this.slot.length&&(this.indexSlot=0)};var DetectaVersion=pc.createScript("detectaVersion");DetectaVersion.attributes.add("prenderEntity",{type:"entity",array:!0}),DetectaVersion.attributes.add("apagarEntity",{type:"entity",array:!0}),DetectaVersion.prototype.initialize=function(){if(0==tipoVersion){for(var t=0;t<this.prenderEntity.length;t++)this.prenderEntity[t].enabled=!0;for(t=0;t<this.apagarEntity.length;t++)this.apagarEntity[t].enabled=!1}else if(1==tipoVersion){for(t=0;t<this.prenderEntity.length;t++)this.prenderEntity[t].enabled=!1;for(t=0;t<this.apagarEntity.length;t++)this.apagarEntity[t].enabled=!0}},DetectaVersion.prototype.update=function(t){};var continuePanel,classCallBack,_menu,tiempoExtra=50,adsUsados=!1;function loadScript(e,n){var o=document.head,i=document.createElement("script");i.type="text/javascript",i.src=e,i.onreadystatechange=n,i.onload=n,o.appendChild(i)}function iniPoki(){PokiSDK.init().then((()=>{console.log("PokiSDK initialized")})).catch((()=>{console.log("Adblock enabled")})),PokiSDK.setDebug(!1)}PokiSDK.gameLoadingStart(),console.log("POKI GAME LOAD START"),iniPoki();var soundBeforeAds=0;function showAds(e){pause=!0,soundBeforeAds=mute,mute=1,muteMusic(),PokiSDK.commercialBreak().then((()=>{mute=soundBeforeAds,0==mute&&unmuteMusic(),pause=!1,e()}))}function showReward(e,n,o){soundBeforeAds=mute,mute=1,muteMusic(),PokiSDK.rewardedBreak().then((i=>{mute=soundBeforeAds,0==mute&&unmuteMusic(),i?("revive"==o&&(console.log("Revive!"),adsUsados=!0,PokiSDK.gameplayStart()),e()):n()}))}function poneContinue(e,n){if(adsUsados)detenerContinue(!1,e,n);else{continuePanel.enabled=!0;var o=continuePanel.findByName("fill"),i=continuePanel.findByName("botonYes"),t=continuePanel.findByName("botonNo");o.script.animaTexturas.inicioAnim(finTiempoContinue.bind(window,e,n)),addEventFunction(i,!0,1,clickRewardVideo.bind(window,!0,e,n)),addEventFunction(t,!0,1,clickRewardVideo.bind(window,!1,e,n))}}function finTiempoContinue(e,n){detenerContinue(!1,e,n)}function clickRewardVideo(e,n,o){detenerContinue(e,n,o)}function detenerContinue(e,n,o){adsUsados=!0;var i=continuePanel.findByName("fill"),t=continuePanel.findByName("botonYes"),a=continuePanel.findByName("botonNo");i.script.animaTexturas.stopAnim(),addEventFunction(t,!1),addEventFunction(a,!1),e?showReward(n,o,"revive"):(console.log(o),o()),continuePanel.enabled=!1}pc.extend(pc,function(){var TweenManager=function(t){this._app=t,this._tweens=[],this._add=[]};TweenManager.prototype={add:function(t){return this._add.push(t),t},update:function(t){for(var i=0,e=this._tweens.length;i<e;)this._tweens[i].update(t)?i++:(this._tweens.splice(i,1),e--);if(this._add.length){for(let t=0;t<this._add.length;t++)this._tweens.indexOf(this._add[t])>-1||this._tweens.push(this._add[t]);this._add.length=0}}};var Tween=function(t,i,e){pc.events.attach(this),this.manager=i,e&&(this.entity=null),this.time=0,this.complete=!1,this.playing=!1,this.stopped=!0,this.pending=!1,this.target=t,this.duration=0,this._currentDelay=0,this.timeScale=1,this._reverse=!1,this._delay=0,this._yoyo=!1,this._count=0,this._numRepeats=0,this._repeatDelay=0,this._from=!1,this._slerp=!1,this._fromQuat=new pc.Quat,this._toQuat=new pc.Quat,this._quat=new pc.Quat,this.easing=pc.Linear,this._sv={},this._ev={}},_parseProperties=function(t){var i;return t instanceof pc.Vec2?i={x:t.x,y:t.y}:t instanceof pc.Vec3?i={x:t.x,y:t.y,z:t.z}:t instanceof pc.Vec4||t instanceof pc.Quat?i={x:t.x,y:t.y,z:t.z,w:t.w}:t instanceof pc.Color?(i={r:t.r,g:t.g,b:t.b},void 0!==t.a&&(i.a=t.a)):i=t,i};Tween.prototype={to:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this},from:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._from=!0,this},rotate:function(t,i,e,s,n,r){return this._properties=_parseProperties(t),this.duration=i,e&&(this.easing=e),s&&this.delay(s),n&&this.repeat(n),r&&this.yoyo(r),this._slerp=!0,this},start:function(){var t,i,e,s;if(this.playing=!0,this.complete=!1,this.stopped=!1,this._count=0,this.pending=this._delay>0,this._reverse&&!this.pending?this.time=this.duration:this.time=0,this._from){for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this._properties[t],this._ev[t]=this.target[t]);this._slerp&&(this._toQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,this._fromQuat.setFromEulerAngles(i,e,s))}else{for(t in this._properties)this._properties.hasOwnProperty(t)&&(this._sv[t]=this.target[t],this._ev[t]=this._properties[t]);this._slerp&&(i=void 0!==this._properties.x?this._properties.x:this.target.x,e=void 0!==this._properties.y?this._properties.y:this.target.y,s=void 0!==this._properties.z?this._properties.z:this.target.z,void 0!==this._properties.w?(this._fromQuat.copy(this.target),this._toQuat.set(i,e,s,this._properties.w)):(this._fromQuat.setFromEulerAngles(this.target.x,this.target.y,this.target.z),this._toQuat.setFromEulerAngles(i,e,s)))}return this._currentDelay=this._delay,this.manager.add(this),this},pause:function(){this.playing=!1},resume:function(){this.playing=!0},stop:function(){this.playing=!1,this.stopped=!0},delay:function(t){return this._delay=t,this.pending=!0,this},repeat:function(t,i){return this._count=0,this._numRepeats=t,this._repeatDelay=i||0,this},loop:function(t){return t?(this._count=0,this._numRepeats=1/0):this._numRepeats=0,this},yoyo:function(t){return this._yoyo=t,this},reverse:function(){return this._reverse=!this._reverse,this},chain:function(){for(var t=arguments.length;t--;)t>0?arguments[t-1]._chained=arguments[t]:this._chained=arguments[t];return this},onUpdate:function(t){return this.on("update",t),this},onComplete:function(t){return this.on("complete",t),this},onLoop:function(t){return this.on("loop",t),this},update:function(t){if(this.stopped)return!1;if(!this.playing)return!0;if(!this._reverse||this.pending?this.time+=t*this.timeScale:this.time-=t*this.timeScale,this.pending){if(!(this.time>this._currentDelay))return!0;this._reverse?this.time=this.duration-(this.time-this._currentDelay):this.time-=this._currentDelay,this.pending=!1}var i=0;(!this._reverse&&this.time>this.duration||this._reverse&&this.time<0)&&(this._count++,this.complete=!0,this.playing=!1,this._reverse?(i=this.duration-this.time,this.time=0):(i=this.time-this.duration,this.time=this.duration));var e,s,n=0===this.duration?1:this.time/this.duration,r=this.easing(n);for(var h in this._properties)this._properties.hasOwnProperty(h)&&(e=this._sv[h],s=this._ev[h],this.target[h]=e+(s-e)*r);if(this._slerp&&this._quat.slerp(this._fromQuat,this._toQuat,r),this.entity&&(this.entity._dirtifyLocal(),this.element&&this.entity.element&&(this.entity.element[this.element]=this.target),this._slerp&&this.entity.setLocalRotation(this._quat)),this.fire("update",t),this.complete){var a=this._repeat(i);return a?this.fire("loop"):(this.fire("complete",i),this.entity&&this.entity.off("destroy",this.stop,this),this._chained&&this._chained.start()),a}return!0},_repeat:function(t){if(this._count<this._numRepeats){if(this._reverse?this.time=this.duration-t:this.time=t,this.complete=!1,this.playing=!0,this._currentDelay=this._repeatDelay,this.pending=!0,this._yoyo){for(var i in this._properties){var e=this._sv[i];this._sv[i]=this._ev[i],this._ev[i]=e}this._slerp&&(this._quat.copy(this._fromQuat),this._fromQuat.copy(this._toQuat),this._toQuat.copy(this._quat))}return!0}return!1}};var BounceOut=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},BounceIn=function(t){return 1-BounceOut(1-t)};return{TweenManager:TweenManager,Tween:Tween,Linear:function(t){return t},QuadraticIn:function(t){return t*t},QuadraticOut:function(t){return t*(2-t)},QuadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},CubicIn:function(t){return t*t*t},CubicOut:function(t){return--t*t*t+1},CubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},QuarticIn:function(t){return t*t*t*t},QuarticOut:function(t){return 1- --t*t*t*t},QuarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},QuinticIn:function(t){return t*t*t*t*t},QuinticOut:function(t){return--t*t*t*t*t+1},QuinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},SineIn:function(t){return 0===t?0:1===t?1:1-Math.cos(t*Math.PI/2)},SineOut:function(t){return 0===t?0:1===t?1:Math.sin(t*Math.PI/2)},SineInOut:function(t){return 0===t?0:1===t?1:.5*(1-Math.cos(Math.PI*t))},ExponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},ExponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},ExponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},CircularIn:function(t){return 1-Math.sqrt(1-t*t)},CircularOut:function(t){return Math.sqrt(1- --t*t)},CircularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},BackIn:function(t){var i=1.70158;return t*t*((i+1)*t-i)},BackOut:function(t){var i=1.70158;return--t*t*((i+1)*t+i)+1},BackInOut:function(t){var i=2.5949095;return(t*=2)<1?t*t*((i+1)*t-i)*.5:.5*((t-=2)*t*((i+1)*t+i)+2)},BounceIn:BounceIn,BounceOut:BounceOut,BounceInOut:function(t){return t<.5?.5*BounceIn(2*t):.5*BounceOut(2*t-1)+.5},ElasticIn:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),-e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/.4))},ElasticOut:function(t){var i,e=.1;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=.4*Math.asin(1/e)/(2*Math.PI),e*Math.pow(2,-10*t)*Math.sin((t-i)*(2*Math.PI)/.4)+1)},ElasticInOut:function(t){var i,e=.1,s=.4;return 0===t?0:1===t?1:(!e||e<1?(e=1,i=.1):i=s*Math.asin(1/e)/(2*Math.PI),(t*=2)<1?e*Math.pow(2,10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*-.5:e*Math.pow(2,-10*(t-=1))*Math.sin((t-i)*(2*Math.PI)/s)*.5+1)}}}()),function(){pc.AppBase.prototype.addTweenManager=function(){this._tweenManager=new pc.TweenManager(this),this.on("update",(function(t){this._tweenManager.update(t)}))},pc.AppBase.prototype.tween=function(t){return new pc.Tween(t,this._tweenManager)},pc.Entity.prototype.tween=function(t,i){var e=this._app.tween(t);return e.entity=this,this.once("destroy",e.stop,e),i&&i.element&&(e.element=i.element),e};var t=pc.AppBase.getApplication();t&&t.addTweenManager()}();var CircularDrag=pc.createScript("circularDrag");CircularDrag.attributes.add("handle",{type:"entity",default:null,title:"Handle"}),CircularDrag.attributes.add("radius",{type:"number",default:115,title:"Radius"}),CircularDrag.attributes.add("parentElement",{type:"entity",default:null,title:"Parent Element"}),CircularDrag.prototype.initialize=function(){this.isDragging=!1,isMobile.any()?(this.handle.element.on(pc.EVENT_TOUCHSTART,this.onStart,this),this.app.touch.on(pc.EVENT_TOUCHMOVE,this.onMove,this),this.app.touch.on(pc.EVENT_TOUCHEND,this.onEnd,this)):(this.handle.element.on(pc.EVENT_MOUSEDOWN,this.onStart,this),this.app.mouse.on(pc.EVENT_MOUSEMOVE,this.onMove,this),this.app.mouse.on(pc.EVENT_MOUSEUP,this.onEnd,this))},CircularDrag.prototype.onStart=function(t){this.isDragging=!0,console.log("Posicin inicial del punto rojo: ",this.handle.getLocalPosition())},CircularDrag.prototype.onMove=function(t){if(this.isDragging){var e=this.getPointerPosition(t);console.log("Posicin del pointer (pantalla): ",e);var i=this.parentElement.element.screenCorners,o=(i[0].x+i[2].x)/2,n=(i[0].y+i[2].y)/2;console.log("Centro ajustado del padre (X, Y): ",o,n);var a=e.x-o,r=e.y-n;console.log("Offset respecto al centro (X, Y): ",a,r);var s=Math.sqrt(a*a+r*r);if(console.log("Distancia desde el centro: ",s),s>this.radius){var l=Math.atan2(r,a);a=Math.cos(l)*this.radius,r=Math.sin(l)*this.radius,console.log("Punto ajustado al radio: ",a,r)}this.handle.setLocalPosition(a,r,0),console.log("Posicin final del punto rojo: ",a,r)}},CircularDrag.prototype.getPointerPosition=function(t){var e=t.changedTouches?t.changedTouches[0]:t;return{x:e.clientX||e.x,y:e.clientY||e.y}},CircularDrag.prototype.onEnd=function(t){this.isDragging=!1},CircularDrag.prototype.getPointerPosition=function(t){var e=t.changedTouches?t.changedTouches[0]:t;return{x:e.x||e.clientX,y:e.y||e.clientY}},pc.Entity.prototype.getScreenPosition=function(){var t=new pc.Vec3;return this.element.screen.screenToWorld(this.getLocalPosition(),t),t};var Draggable=pc.createScript("draggable");Draggable.attributes.add("radius",{type:"number",default:115,title:"Radius"}),Draggable.attributes.add("bigBall",{type:"entity"}),Draggable.attributes.add("pointAux",{type:"entity",array:!1}),Draggable.attributes.add("guiButton",{type:"entity"}),Draggable.prototype.initialize=function(){_masse=this,this.screenX=0,this.screenY=0,this.forze=null,this.hitForze=0,this.angle=0,this.axis=null,this.helper=new pc.ElementDragHelper(this.entity.element,this.axis),this.helper.on("drag:move",this.onHandleDrag,this),console.log(this.helper),this.centerX=this.entity.getLocalPosition().x,this.centerY=this.entity.getLocalPosition().y;for(var t=0;t<this.pointAux.children.length-1;t++)addEventFunction(this.pointAux.children[t],!0,1,this.onParentClick.bind(this));addEventFunction(this.entity,!0,1,this.MouseDown.bind(this)),addEventFunction(this.entity,!0,2,this.MouseUp.bind(this))},Draggable.prototype.MouseDown=function(){this.entity.children[0].setLocalScale(1.6,1.6,1.6),playSound("tapWhite")},Draggable.prototype.MouseUp=function(){playSound("endWhite"),this.entity.children[0].setLocalScale(1,1,1)},Draggable.prototype.onHandleDrag=function(t){this.movePoint(t.x,t.y)},Draggable.prototype.movePoint=function(t,e){var i=t-this.centerX,s=e-this.centerY;if(Math.sqrt(i*i+s*s)>this.radius){var o=Math.atan2(s,i);i=Math.cos(o)*this.radius,s=Math.sin(o)*this.radius}var n=this.centerX+i,r=this.centerY+s;this.entity.setLocalPosition(n,r,0),this.ComputeMasse(new pc.Vec3(n,r))},Draggable.prototype.ComputeMasse=function(t){var e=-115.8,i=-115,s=114.2,o=115,n=(o-i)/(s-e),r=n*(t.x-e)+i;r<-115?r=-115:r>115&&(r=115),this.screenX=r,(r=(n=((o=-115)-(i=115))/((s=-113)-(e=117)))*(t.y-e)+i)<-115?r=-115:r>115&&(r=115),this.screenY=r,this.guiButton.setLocalPosition(.2*this.screenX*2,.2*this.screenY*2,0)},Draggable.prototype.onParentClick=function(t){var e=t.element.entity.localPosition.clone();this.movePoint(e.x,e.y),playSound("endWhite"),this.entity.children[0].setLocalScale(1,1,1)},Draggable.prototype.screenToWorld=function(t,e){var i=this.app.root.findByName("Camera").camera,s=this.app.graphicsDevice.canvas,o=t/s.width*2-1,n=e/s.height*-2+1;return i.screenToWorld(o,n,i.nearClip)},Draggable.prototype.worldToLocal=function(t,e){var i=new pc.Mat4;i.copy(e.getWorldTransform()).invert();var s=new pc.Vec3;return i.transformPoint(t,s),s},Draggable.prototype.configMasse=function(t,e){this.alreadyApply=!1,this.hitForze=e,this.forze=t,this.forze.normalize(),this.angle=Math.atan2(this.forze.y,this.forze.x),this.angle=180*this.angle/Math.PI,extraScoreMasee=0,console.log(this.angle)},Draggable.prototype.resetMasse=function(){this.screenX=0,this.screenY=0,this.entity.setLocalPosition(-1.8,3,0),this.guiButton.setLocalPosition(0,0,0)},Draggable.prototype.doMasse=function(t,e){if(!this.alreadyApply){this.alreadyApply=!0;var i=this.angle,s=1,o=2;if(_9_BOLAS_ACTIVADO&&(this.screenX=4*this.screenX,this.screenY=4*this.screenY),"ball"==e){if(s=1.8,this.screenY>0&&(o=1),i>=45&&i<=135){var n=(2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(2.7*o-(h=0))/(235-(a=0))*(this.screenY-a)+h;setTimeout(function(){t.script.p2Body.body.applyImpulseLocal([n*this.hitForze,r*this.hitForze])}.bind(this),30)}else if(i<=-45&&i>=-135){n=(-2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(-2.7*o-(h=0))/(235-(a=0))*(this.screenY-a)+h;setTimeout(function(){t.script.p2Body.body.applyImpulseLocal([n*this.hitForze,r*this.hitForze])}.bind(this),30)}else if(i<=180&&i>=135||i<=-135&&i>=-180){n=(2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(-2.7*o-(h=0))/(235-(a=0))*(this.screenY-a)+h;setTimeout(function(){t.script.p2Body.body.applyImpulseLocal([r*this.hitForze,n*this.hitForze])}.bind(this),30)}else if(i<=45&&i>=-45){n=(-2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(2.7*o-(h=0))/(235-(a=0))*(this.screenY-a)+h;setTimeout(function(){t.script.p2Body.body.applyImpulseLocal([r*this.hitForze,n*this.hitForze])}.bind(this),30)}}else if(i>=45&&i<=135){n=(2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(-2.7*s-(h=0))/(235-(a=0))*(this.screenY-a)+h;t.script.p2Body.body.applyImpulseLocal([n*this.hitForze,r*this.hitForze])}else if(i<=-45&&i>=-135){n=(-2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(2.7*s-(h=0))/(235-(a=0))*(this.screenY-a)+h;t.script.p2Body.body.applyImpulseLocal([n*this.hitForze,r*this.hitForze])}else if(i<=180&&i>=135||i<=-135&&i>=-180){n=(2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(2.7*s-(h=0))/(235-(a=0))*(this.screenY-a)+h;t.script.p2Body.body.applyImpulseLocal([r*this.hitForze,n*this.hitForze])}else if(i<=45&&i>=-45){var a,h;n=(-2.7*s-(h=0))/(235-(a=0))*(this.screenX-a)+h,r=(-2.7*s-(h=0))/(235-(a=0))*(this.screenY-a)+h;t.script.p2Body.body.applyImpulseLocal([r*this.hitForze,n*this.hitForze])}console.log("FX "+n+"  FY "+r),this.resetMasse()}};var AsignaGlobal=pc.createScript("asignaGlobal");AsignaGlobal.attributes.add("tipo",{type:"string",title:"tipo"}),AsignaGlobal.prototype.initialize=function(){switch(this.tipo){case"sonido":_sonidos=this.entity.sound;break;case"2dScreen":_2dScreen=this.entity;break;case"musica":_sound=this.entity.sound}};